[{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\electron\\database\\db.js","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":145,"column":17,"nodeType":"BlockStatement","messageId":"unexpected","endLine":145,"endColumn":19,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[4408,4408],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":230,"column":103,"nodeType":"BlockStatement","messageId":"unexpected","endLine":230,"endColumn":105,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8022,8022],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":231,"column":104,"nodeType":"BlockStatement","messageId":"unexpected","endLine":231,"endColumn":106,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8129,8129],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":232,"column":101,"nodeType":"BlockStatement","messageId":"unexpected","endLine":232,"endColumn":103,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8233,8233],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":237,"column":103,"nodeType":"BlockStatement","messageId":"unexpected","endLine":237,"endColumn":105,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8534,8534],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":238,"column":96,"nodeType":"BlockStatement","messageId":"unexpected","endLine":238,"endColumn":98,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8633,8633],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":243,"column":102,"nodeType":"BlockStatement","messageId":"unexpected","endLine":243,"endColumn":104,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[8918,8918],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":248,"column":88,"nodeType":"BlockStatement","messageId":"unexpected","endLine":248,"endColumn":90,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9200,9200],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":249,"column":88,"nodeType":"BlockStatement","messageId":"unexpected","endLine":249,"endColumn":90,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9291,9291],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":254,"column":105,"nodeType":"BlockStatement","messageId":"unexpected","endLine":254,"endColumn":107,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9578,9578],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":309,"column":109,"nodeType":"BlockStatement","messageId":"unexpected","endLine":309,"endColumn":111,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11816,11816],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":310,"column":114,"nodeType":"BlockStatement","messageId":"unexpected","endLine":310,"endColumn":116,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[11933,11933],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":821,"column":60,"nodeType":"BlockStatement","messageId":"unexpected","endLine":821,"endColumn":62,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[31636,31636],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'needsSequenceUpdate' is assigned a value but never used.","line":1506,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":1506,"endColumn":37},{"ruleId":"no-dupe-class-members","severity":2,"message":"Duplicate name 'getAllOrders'.","line":1553,"column":3,"nodeType":"MethodDefinition","messageId":"unexpected","endLine":1562,"endColumn":4},{"ruleId":"no-unused-vars","severity":1,"message":"'mixedAdd' is assigned a value but never used.","line":1623,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1623,"endColumn":16},{"ruleId":"no-unused-vars","severity":1,"message":"'dueAdd' is assigned a value but never used.","line":1628,"column":37,"nodeType":"Identifier","messageId":"unusedVar","endLine":1628,"endColumn":43},{"ruleId":"no-dupe-class-members","severity":2,"message":"Duplicate name 'getOrdersByPhone'.","line":2716,"column":3,"nodeType":"MethodDefinition","messageId":"unexpected","endLine":2732,"endColumn":4},{"ruleId":"no-dupe-class-members","severity":2,"message":"Duplicate name 'getSetting'.","line":2766,"column":3,"nodeType":"MethodDefinition","messageId":"unexpected","endLine":2769,"endColumn":4},{"ruleId":"no-dupe-class-members","severity":2,"message":"Duplicate name 'getUserByUsername'.","line":2800,"column":3,"nodeType":"MethodDefinition","messageId":"unexpected","endLine":2803,"endColumn":4},{"ruleId":"no-dupe-class-members","severity":2,"message":"Duplicate name 'getUserByPin'.","line":2805,"column":3,"nodeType":"MethodDefinition","messageId":"unexpected","endLine":2808,"endColumn":4},{"ruleId":"no-dupe-class-members","severity":2,"message":"Duplicate name 'logSession'.","line":2810,"column":3,"nodeType":"MethodDefinition","messageId":"unexpected","endLine":2812,"endColumn":4},{"ruleId":"no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":2810,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":2810,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'action' is defined but never used.","line":2810,"column":22,"nodeType":"Identifier","messageId":"unusedVar","endLine":2810,"endColumn":28},{"ruleId":"no-dupe-class-members","severity":2,"message":"Duplicate name 'getInventoryHistory'.","line":3024,"column":3,"nodeType":"MethodDefinition","messageId":"unexpected","endLine":3036,"endColumn":4},{"ruleId":"no-dupe-class-members","severity":2,"message":"Duplicate name 'getSetting'.","line":3102,"column":3,"nodeType":"MethodDefinition","messageId":"unexpected","endLine":3105,"endColumn":4}],"suppressedMessages":[],"errorCount":21,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// sql.js database wrapper for Electron\r\n// sql.js is a pure JavaScript SQLite implementation that doesn't require native compilation\r\nconst initSqlJs = require('sql.js');\r\nconst { app } = require('electron');\r\nconst path = require('path');\r\nconst fs = require('fs');\r\nconst { v4: uuidv4 } = require('uuid');\r\n\r\nclass Database {\r\n  constructor() {\r\n    this.db = null;\r\n    this.dbPath = null;\r\n  }\r\n\r\n  async initialize() {\r\n    // Get the WASM file path from node_modules\r\n    const wasmPath = path.join(\r\n      require.resolve('sql.js'),\r\n      '..',\r\n      'sql-wasm.wasm'\r\n    );\r\n    \r\n    // Read the WASM file as a buffer\r\n    const wasmBinary = fs.readFileSync(wasmPath);\r\n    \r\n    // Initialize sql.js with the WASM binary\r\n    const SQL = await initSqlJs({\r\n      wasmBinary\r\n    });\r\n\r\n    // Database path in user data directory\r\n    const userDataPath = app.getPath('userData');\r\n    const configPath = path.join(userDataPath, 'config.json');\r\n    \r\n    // Check for custom path in config\r\n    let dbFolder = userDataPath;\r\n    try {\r\n      if (fs.existsSync(configPath)) {\r\n        const config = JSON.parse(fs.readFileSync(configPath, 'utf8'));\r\n        if (config.dbPath && fs.existsSync(config.dbPath)) {\r\n          dbFolder = config.dbPath;\r\n        }\r\n      }\r\n    } catch (error) {\r\n      console.error('Error reading config.json:', error);\r\n    }\r\n\r\n    this.dbPath = path.join(dbFolder, 'restaurant_pos.db');\r\n    \r\n    // Load existing database or create new one\r\n    if (fs.existsSync(this.dbPath)) {\r\n      const fileBuffer = fs.readFileSync(this.dbPath);\r\n      this.db = new SQL.Database(fileBuffer);\r\n    } else {\r\n      this.db = new SQL.Database();\r\n    }\r\n    \r\n    // Initialize schema\r\n    await this.initSchema();\r\n    \r\n    // Ensure at least one menu exists and link existing data\r\n    this.ensureDefaultMenu();\r\n    \r\n    console.log('Database initialized at:', this.dbPath);\r\n    return this;\r\n  }\r\n\r\n  async initSchema() {\r\n    const schemaPath = path.join(__dirname, 'schema.sql');\r\n    const schema = fs.readFileSync(schemaPath, 'utf-8');\r\n    \r\n    // Execute schema SQL\r\n    this.db.run(schema);\r\n\r\n    // Create menus table\r\n    this.db.run(`CREATE TABLE IF NOT EXISTS menus (\r\n      id TEXT PRIMARY KEY,\r\n      name TEXT NOT NULL,\r\n      is_active INTEGER DEFAULT 0,\r\n      created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n      is_deleted INTEGER DEFAULT 0\r\n    )`);\r\n\r\n    // Run migrations for existing databases\r\n    this.migrateSchema();\r\n    \r\n    // Create expenses table\r\n    this.db.run(`CREATE TABLE IF NOT EXISTS expenses (\r\n      id TEXT PRIMARY KEY,\r\n      reason TEXT,\r\n      amount REAL,\r\n      explanation TEXT,\r\n      employee_id TEXT,\r\n      employee_name TEXT,\r\n      paid_from TEXT,\r\n      date TEXT,\r\n      created_at TEXT,\r\n      updated_at TEXT\r\n    )`);\r\n\r\n    // Create shifts table\r\n    this.db.run(`CREATE TABLE IF NOT EXISTS shifts (\r\n      id TEXT PRIMARY KEY,\r\n      user_id TEXT REFERENCES users(id),\r\n      start_time TEXT NOT NULL,\r\n      end_time TEXT,\r\n      start_cash REAL DEFAULT 0,\r\n      end_cash REAL,\r\n      status TEXT CHECK(status IN ('active', 'closed')) DEFAULT 'active',\r\n      created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n      updated_at TEXT DEFAULT CURRENT_TIMESTAMP\r\n    )`);\r\n\r\n    // Create day_logs table\r\n    this.db.run(`CREATE TABLE IF NOT EXISTS day_logs (\r\n      id TEXT PRIMARY KEY,\r\n      business_date TEXT UNIQUE NOT NULL,\r\n      opening_time TEXT NOT NULL,\r\n      closing_time TEXT,\r\n      opening_balance REAL DEFAULT 0,\r\n      closing_balance REAL,\r\n      status TEXT CHECK(status IN ('open', 'closed')) DEFAULT 'open',\r\n      opened_by TEXT,\r\n      created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n      updated_at TEXT DEFAULT CURRENT_TIMESTAMP\r\n    )`);\r\n\r\n    // Create item_discounts table\r\n    this.db.run(`CREATE TABLE IF NOT EXISTS item_discounts (\r\n      id TEXT PRIMARY KEY,\r\n      menu_item_id TEXT REFERENCES menu_items(id),\r\n      variant_name TEXT,\r\n      discount_type TEXT CHECK(discount_type IN ('percentage', 'flat')),\r\n      discount_value REAL NOT NULL,\r\n      start_date TEXT,\r\n      end_date TEXT,\r\n      is_active INTEGER DEFAULT 1,\r\n      created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n      updated_at TEXT DEFAULT CURRENT_TIMESTAMP\r\n    )`);\r\n\r\n    // Create indexes\r\n    try {\r\n      this.db.run(\"CREATE INDEX IF NOT EXISTS idx_expenses_date ON expenses(date)\");\r\n    } catch (e) {}\r\n\r\n    // Save to disk\r\n    this.save();\r\n  }\r\n\r\n  ensureDefaultMenu() {\r\n    try {\r\n      // Check if any menu exists\r\n      const menus = this.execute(\"SELECT * FROM menus WHERE is_deleted = 0\");\r\n      let activeMenuId;\r\n\r\n      if (menus.length === 0) {\r\n        // Create default menu\r\n        activeMenuId = 'menu_default';\r\n        this.run(\"INSERT INTO menus (id, name, is_active, created_at) VALUES (?, ?, ?, ?)\",\r\n          [activeMenuId, 'Default Menu', 1, new Date().toISOString()]);\r\n      } else {\r\n        const active = menus.find(m => m.is_active === 1);\r\n        if (active) {\r\n          activeMenuId = active.id;\r\n        } else {\r\n          activeMenuId = menus[0].id;\r\n          this.run(\"UPDATE menus SET is_active = 1 WHERE id = ?\", [activeMenuId]);\r\n        }\r\n      }\r\n\r\n      // Link categories and menu items without menu_id to the active menu\r\n      this.run(\"UPDATE categories SET menu_id = ? WHERE menu_id IS NULL OR menu_id = ''\", [activeMenuId]);\r\n      this.run(\"UPDATE menu_items SET menu_id = ? WHERE menu_id IS NULL OR menu_id = ''\", [activeMenuId]);\r\n    } catch (error) {\r\n      console.error('Error ensuring default menu:', error);\r\n    }\r\n  }\r\n\r\n  migrateSchema() {\r\n    try {\r\n      this.db.run(`\r\n        CREATE TABLE IF NOT EXISTS order_payments (\r\n            id TEXT PRIMARY KEY,\r\n            order_id TEXT REFERENCES orders(id) ON DELETE CASCADE,\r\n            payment_method TEXT CHECK(payment_method IN ('cash', 'card', 'upi', 'due')),\r\n            amount REAL NOT NULL,\r\n            created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n            is_deleted INTEGER DEFAULT 0\r\n        )\r\n      `);\r\n    } catch (error) { console.log('Migration note (order_payments):', error.message); }\r\n\r\n    try {\r\n      // Add is_deleted to order_items if missing\r\n      this.db.run(\"ALTER TABLE order_items ADD COLUMN is_deleted INTEGER DEFAULT 0\");\r\n    } catch (error) {\r\n      if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message);\r\n    }\r\n\r\n    try {\r\n      // Add variants/addons to menu_items\r\n      this.db.run(\"ALTER TABLE menu_items ADD COLUMN variants TEXT\");\r\n    } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      this.db.run(\"ALTER TABLE menu_items ADD COLUMN addons TEXT\");\r\n    } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      this.db.run(\"ALTER TABLE menu_items ADD COLUMN is_favorite INTEGER DEFAULT 0\");\r\n    } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      // Add is_hold to orders\r\n      this.db.run(\"ALTER TABLE orders ADD COLUMN is_hold INTEGER DEFAULT 0\");\r\n    } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      // Add variant/addons to order_items\r\n      this.db.run(\"ALTER TABLE order_items ADD COLUMN variant TEXT\");\r\n    } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      this.db.run(\"ALTER TABLE order_items ADD COLUMN addons TEXT\");\r\n    } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n       // Add delivery_charge, container_charge, and customer_paid to orders\r\n       try { this.db.run(\"ALTER TABLE orders ADD COLUMN delivery_charge REAL DEFAULT 0\"); } catch (e) {}\r\n       try { this.db.run(\"ALTER TABLE orders ADD COLUMN container_charge REAL DEFAULT 0\"); } catch (e) {}\r\n       try { this.db.run(\"ALTER TABLE orders ADD COLUMN customer_paid REAL DEFAULT 0\"); } catch (e) {}\r\n    } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n        // Add urgency and chef_instructions to orders\r\n        try { this.db.run(\"ALTER TABLE orders ADD COLUMN urgency TEXT DEFAULT 'normal'\"); } catch (e) {}\r\n        try { this.db.run(\"ALTER TABLE orders ADD COLUMN chef_instructions TEXT\"); } catch (e) {}\r\n     } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n        // Add tax_rate to order_items\r\n        try { this.db.run(\"ALTER TABLE order_items ADD COLUMN tax_rate REAL DEFAULT 0\"); } catch (e) {}\r\n     } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      // Add menu_id to categories and menu_items\r\n      try { this.db.run(\"ALTER TABLE categories ADD COLUMN menu_id TEXT\"); } catch (e) {}\r\n      try { this.db.run(\"ALTER TABLE menu_items ADD COLUMN menu_id TEXT\"); } catch (e) {}\r\n    } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      // Add is_deleted to order_items\r\n      try { this.db.run(\"ALTER TABLE order_items ADD COLUMN is_deleted INTEGER DEFAULT 0\"); } catch (e) {}\r\n    } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      // Create addons table if not exists (for existing databases)\r\n      this.db.run(`\r\n        CREATE TABLE IF NOT EXISTS addons (\r\n            id TEXT PRIMARY KEY,\r\n            name TEXT NOT NULL,\r\n            price REAL NOT NULL,\r\n            type TEXT CHECK(type IN ('veg', 'non-veg')) DEFAULT 'veg',\r\n            is_available INTEGER DEFAULT 1,\r\n            created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n            updated_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n            synced_at TEXT,\r\n            is_deleted INTEGER DEFAULT 0\r\n        )\r\n      `);\r\n    } catch (error) { console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      // Add inventory_transactions table for history\r\n      this.db.run(`\r\n        CREATE TABLE IF NOT EXISTS inventory_transactions (\r\n            id TEXT PRIMARY KEY,\r\n            inventory_id TEXT REFERENCES inventory(id),\r\n            type TEXT CHECK(type IN ('add', 'subtract', 'adjustment')),\r\n            quantity REAL NOT NULL,\r\n            current_stock_snapshot REAL,\r\n            reason TEXT,\r\n            notes TEXT,\r\n            created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n            is_deleted INTEGER DEFAULT 0\r\n        )\r\n      `);\r\n    } catch (error) { console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      // Create master_addons table\r\n      this.db.run(`\r\n        CREATE TABLE IF NOT EXISTS master_addons (\r\n            id TEXT PRIMARY KEY,\r\n            name TEXT NOT NULL,\r\n            addon_ids TEXT, -- JSON array of global addon IDs\r\n            is_mandatory INTEGER DEFAULT 0,\r\n            selection_type TEXT CHECK(selection_type IN ('single', 'multi')) DEFAULT 'multi',\r\n            created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n            updated_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n            is_deleted INTEGER DEFAULT 0\r\n        )\r\n      `);\r\n    } catch (error) { console.log('Migration note:', error.message); }\r\n\r\n    try {\r\n      // Add missing columns to master_addons if they don't exist\r\n      try { this.db.run(\"ALTER TABLE master_addons ADD COLUMN is_mandatory INTEGER DEFAULT 0\"); } catch (e) {}\r\n      try { this.db.run(\"ALTER TABLE master_addons ADD COLUMN selection_type TEXT DEFAULT 'multi'\"); } catch (e) {}\r\n    } catch (error) { console.log('Migration note (master_addons columns):', error.message); }\r\n\r\n    try {\r\n      // Add master_addon_ids to menu_items\r\n      this.db.run(\"ALTER TABLE menu_items ADD COLUMN master_addon_ids TEXT\");\r\n    } catch (error) { if (!error.message.includes(\"duplicate column name\")) console.log('Migration note:', error.message); }\r\n\r\n    // Migrate orders table to support 'held' status in CHECK constraint\r\n    this.migrateOrdersTableForHeldStatus();\r\n\r\n    // Migrate orders table to support 'due' payment method in CHECK constraint\r\n    this.migrateOrdersTableForDuePayment();\r\n\r\n    // Seed sample products with variants\r\n    this.seedSampleProducts();\r\n  }\r\n\r\n  migrateOrdersTableForDuePayment() {\r\n    try {\r\n      // Check if migration is needed by trying to check schema\r\n      const testResult = this.execute(\"SELECT sql FROM sqlite_master WHERE type='table' AND name='orders'\");\r\n      // If table exists and SQL doesn't contain 'due' in payment_method check\r\n      if (testResult.length > 0 && testResult[0].sql && !testResult[0].sql.includes(\"'due'\")) {\r\n        console.log('Migrating orders table to support due payment method...');\r\n        \r\n        // Backup existing orders (chk if backup exists first to be safe, drop if so)\r\n        this.db.run(`DROP TABLE IF EXISTS orders_backup_due`);\r\n        this.db.run(`CREATE TABLE orders_backup_due AS SELECT * FROM orders`);\r\n        \r\n        // Drop old table\r\n        this.db.run(`DROP TABLE orders`);\r\n        \r\n        // Create new orders table with updated CHECK constraint for payment_method\r\n        this.db.run(`\r\n          CREATE TABLE orders (\r\n            id TEXT PRIMARY KEY,\r\n            order_number INTEGER NOT NULL,\r\n            order_type TEXT CHECK(order_type IN ('dine_in', 'takeaway', 'delivery')) DEFAULT 'dine_in',\r\n            table_number TEXT,\r\n            customer_name TEXT,\r\n            customer_phone TEXT,\r\n            subtotal REAL NOT NULL,\r\n            tax_amount REAL DEFAULT 0,\r\n            discount_amount REAL DEFAULT 0,\r\n            discount_reason TEXT,\r\n            total_amount REAL NOT NULL,\r\n            delivery_charge REAL DEFAULT 0,\r\n            container_charge REAL DEFAULT 0,\r\n            customer_paid REAL DEFAULT 0,\r\n            payment_method TEXT CHECK(payment_method IN ('cash', 'card', 'upi', 'mixed', 'due')),\r\n            payment_status TEXT CHECK(payment_status IN ('pending', 'partial', 'completed')) DEFAULT 'pending',\r\n            status TEXT CHECK(status IN ('active', 'completed', 'cancelled', 'held')) DEFAULT 'active',\r\n            is_hold INTEGER DEFAULT 0,\r\n            notes TEXT,\r\n            urgency TEXT CHECK(urgency IN ('normal', 'urgent', 'critical')) DEFAULT 'normal',\r\n            chef_instructions TEXT,\r\n            cashier_id TEXT REFERENCES users(id),\r\n            created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n            updated_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n            completed_at TEXT,\r\n            synced_at TEXT,\r\n            is_deleted INTEGER DEFAULT 0\r\n          )\r\n        `);\r\n        \r\n        // Restore data\r\n        // We need to list columns explicitly to avoid issues if schema changed order or count invisibly, \r\n        // but SELECT * is usually fine if structure is identical except constraints.\r\n        // However, safely assuming columns match name-for-name is better.\r\n        // For simplicity in this specific constraint update, we'll use SELECT * as we did in held status migration.\r\n        this.db.run(`INSERT INTO orders SELECT * FROM orders_backup_due`);\r\n        \r\n        // Re-create indexes\r\n        this.db.run(`CREATE INDEX IF NOT EXISTS idx_orders_created_at ON orders(created_at)`);\r\n        this.db.run(`CREATE INDEX IF NOT EXISTS idx_orders_status ON orders(status)`);\r\n        this.db.run(`CREATE INDEX IF NOT EXISTS idx_orders_date ON orders(date(created_at))`);\r\n\r\n        // Drop backup\r\n        this.db.run(`DROP TABLE orders_backup_due`);\r\n        \r\n        console.log('Orders table migration for due payment completed.');\r\n        this.save();\r\n      }\r\n    } catch (error) {\r\n      console.log('Orders table migration (due payment) note:', error.message);\r\n      // If it fails, restore from backup if main table is gone\r\n      try {\r\n         const checkMain = this.execute(\"SELECT name FROM sqlite_master WHERE type='table' AND name='orders'\");\r\n         if (checkMain.length === 0) {\r\n             console.log('Restoring from backup due to migration failure...');\r\n             this.db.run(`ALTER TABLE orders_backup_due RENAME TO orders`);\r\n         }\r\n      } catch (e) {\r\n          console.error('Critical failure in migration recovery:', e);\r\n      }\r\n    }\r\n  }\r\n\r\n  migrateOrdersTableForHeldStatus() {\r\n    try {\r\n      // Check if migration is needed by trying to insert a held status\r\n      const testResult = this.execute(\"SELECT sql FROM sqlite_master WHERE type='table' AND name='orders'\");\r\n      if (testResult.length > 0 && testResult[0].sql && !testResult[0].sql.includes(\"'held'\")) {\r\n        console.log('Migrating orders table to support held status...');\r\n        \r\n        // Backup existing orders\r\n        this.db.run(`CREATE TABLE IF NOT EXISTS orders_backup AS SELECT * FROM orders`);\r\n        \r\n        // Drop old table\r\n        this.db.run(`DROP TABLE orders`);\r\n        \r\n        // Create new orders table with updated CHECK constraint\r\n        this.db.run(`\r\n          CREATE TABLE orders (\r\n            id TEXT PRIMARY KEY,\r\n            order_number INTEGER NOT NULL,\r\n            order_type TEXT CHECK(order_type IN ('dine_in', 'takeaway', 'delivery')) DEFAULT 'dine_in',\r\n            table_number TEXT,\r\n            customer_name TEXT,\r\n            customer_phone TEXT,\r\n            subtotal REAL NOT NULL,\r\n            tax_amount REAL DEFAULT 0,\r\n            discount_amount REAL DEFAULT 0,\r\n            discount_reason TEXT,\r\n            total_amount REAL NOT NULL,\r\n            payment_method TEXT CHECK(payment_method IN ('cash', 'card', 'upi', 'mixed')),\r\n            payment_status TEXT CHECK(payment_status IN ('pending', 'partial', 'completed')) DEFAULT 'pending',\r\n            status TEXT CHECK(status IN ('active', 'completed', 'cancelled', 'held')) DEFAULT 'active',\r\n            is_hold INTEGER DEFAULT 0,\r\n            notes TEXT,\r\n            cashier_id TEXT REFERENCES users(id),\r\n            created_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n            updated_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n            synced_at TEXT,\r\n            is_deleted INTEGER DEFAULT 0\r\n          )\r\n        `);\r\n        \r\n        // Restore data\r\n        this.db.run(`INSERT INTO orders SELECT * FROM orders_backup`);\r\n        \r\n        // Drop backup\r\n        this.db.run(`DROP TABLE orders_backup`);\r\n        \r\n        console.log('Orders table migration completed.');\r\n        this.save();\r\n      }\r\n    } catch (error) {\r\n      console.log('Orders table migration note:', error.message);\r\n    }\r\n  }\r\n\r\n  seedSampleProducts() {\r\n    try {\r\n      // Check if we already have products with variants\r\n      const existingWithVariants = this.execute(\"SELECT id FROM menu_items WHERE variants IS NOT NULL AND variants != '' LIMIT 1\");\r\n      if (existingWithVariants.length > 0) return; // Already seeded\r\n\r\n      console.log('Seeding sample products with variants and add-ons...');\r\n\r\n      // Add Pizza category\r\n      const pizzaCatId = 'cat_pizza';\r\n      this.db.run(`INSERT OR IGNORE INTO categories (id, name, description, display_order, is_active) VALUES (?, ?, ?, ?, ?)`,\r\n        [pizzaCatId, 'Pizza', 'Delicious pizzas', 0, 1]);\r\n\r\n      // Pizza variants and add-ons\r\n      const pizzaVariants = JSON.stringify([\r\n        { name: 'Small (6\")', price: 199 },\r\n        { name: 'Medium (9\")', price: 299 },\r\n        { name: 'Large (12\")', price: 449 },\r\n        { name: 'Extra Large (14\")', price: 599 }\r\n      ]);\r\n\r\n      const pizzaAddons = JSON.stringify([\r\n        { name: 'Extra Cheese', price: 50, type: 'veg' },\r\n        { name: 'Jalapenos', price: 30, type: 'veg' },\r\n        { name: 'Olives', price: 40, type: 'veg' },\r\n        { name: 'Mushrooms', price: 35, type: 'veg' },\r\n        { name: 'Chicken Tikka', price: 80, type: 'non-veg' },\r\n        { name: 'Pepperoni', price: 70, type: 'non-veg' }\r\n      ]);\r\n\r\n      // Insert pizzas\r\n      const pizzas = [\r\n        { id: 'pizza_001', name: 'Margherita Pizza', desc: 'Classic tomato and mozzarella', price: 199, veg: 1 },\r\n        { id: 'pizza_002', name: 'Pepperoni Pizza', desc: 'Loaded with pepperoni slices', price: 249, veg: 0 },\r\n        { id: 'pizza_003', name: 'Veggie Supreme', desc: 'Loaded with fresh vegetables', price: 229, veg: 1 },\r\n        { id: 'pizza_004', name: 'Chicken BBQ', desc: 'BBQ chicken with onions', price: 279, veg: 0 }\r\n      ];\r\n\r\n      for (const pizza of pizzas) {\r\n        this.db.run(`\r\n          INSERT OR IGNORE INTO menu_items (id, category_id, name, description, price, tax_rate, is_vegetarian, is_available, variants, addons)\r\n          VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n        `, [pizza.id, pizzaCatId, pizza.name, pizza.desc, pizza.price, 5, pizza.veg, 1, pizzaVariants, pizzaAddons]);\r\n      }\r\n\r\n      // Add Burger category with variants\r\n      const burgerCatId = 'cat_burgers';\r\n      this.db.run(`INSERT OR IGNORE INTO categories (id, name, description, display_order, is_active) VALUES (?, ?, ?, ?, ?)`,\r\n        [burgerCatId, 'Burgers', 'Juicy burgers', 1, 1]);\r\n\r\n      const burgerVariants = JSON.stringify([\r\n        { name: 'Single Patty', price: 149 },\r\n        { name: 'Double Patty', price: 229 },\r\n        { name: 'Triple Patty', price: 299 }\r\n      ]);\r\n\r\n      const burgerAddons = JSON.stringify([\r\n        { name: 'Extra Cheese', price: 25, type: 'veg' },\r\n        { name: 'Bacon', price: 50, type: 'non-veg' },\r\n        { name: 'Fried Egg', price: 30, type: 'non-veg' },\r\n        { name: 'Extra Patty', price: 80, type: 'non-veg' }\r\n      ]);\r\n\r\n      const burgers = [\r\n        { id: 'burger_001', name: 'Classic Burger', desc: 'Beef patty with fresh veggies', price: 149, veg: 0 },\r\n        { id: 'burger_002', name: 'Veggie Burger', desc: 'Crispy veg patty', price: 129, veg: 1 },\r\n        { id: 'burger_003', name: 'Chicken Burger', desc: 'Grilled chicken patty', price: 169, veg: 0 }\r\n      ];\r\n\r\n      for (const burger of burgers) {\r\n        this.db.run(`\r\n          INSERT OR IGNORE INTO menu_items (id, category_id, name, description, price, tax_rate, is_vegetarian, is_available, variants, addons)\r\n          VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\r\n        `, [burger.id, burgerCatId, burger.name, burger.desc, burger.price, 5, burger.veg, 1, burgerVariants, burgerAddons]);\r\n      }\r\n\r\n      this.save();\r\n      console.log('Sample products seeded successfully.');\r\n    } catch (error) {\r\n      console.log('Sample product seeding note:', error.message);\r\n    }\r\n  }\r\n\r\n  save() {\r\n    if (this.db && this.dbPath) {\r\n      const data = this.db.export();\r\n      const buffer = Buffer.from(data);\r\n      fs.writeFileSync(this.dbPath, buffer);\r\n    }\r\n  }\r\n\r\n  close() {\r\n    if (this.db) {\r\n      this.save();\r\n      this.db.close();\r\n    }\r\n  }\r\n\r\n  // Generic select method\r\n  select(table, where = {}, orderBy = null) {\r\n    let query = `SELECT * FROM ${table}`;\r\n    const params = [];\r\n    const conditions = [];\r\n\r\n    // Build WHERE clause\r\n    for (const [key, value] of Object.entries(where)) {\r\n      conditions.push(`${key} = ?`);\r\n      params.push(value);\r\n    }\r\n\r\n    if (conditions.length > 0) {\r\n      query += ` WHERE ${conditions.join(' AND ')}`;\r\n    }\r\n\r\n    if (orderBy) {\r\n      query += ` ORDER BY ${orderBy}`;\r\n    }\r\n\r\n    const stmt = this.db.prepare(query);\r\n    stmt.bind(params);\r\n    \r\n    const results = [];\r\n    while (stmt.step()) {\r\n      results.push(stmt.getAsObject());\r\n    }\r\n    stmt.free();\r\n    \r\n    return results;\r\n  }\r\n\r\n  // Execute raw SQL for reading (safe for transactions)\r\n  execute(sql, params = []) {\r\n    const stmt = this.db.prepare(sql);\r\n    if (params.length > 0) stmt.bind(params);\r\n    \r\n    const results = [];\r\n    while (stmt.step()) {\r\n      results.push(stmt.getAsObject());\r\n    }\r\n    stmt.free();\r\n    return results;\r\n  }\r\n\r\n  // Run SQL without returning results\r\n  run(sql, params = []) {\r\n    if (params.length > 0) {\r\n      const stmt = this.db.prepare(sql);\r\n      stmt.run(params);\r\n      stmt.free();\r\n    } else {\r\n      this.db.run(sql);\r\n    }\r\n    this.save();\r\n  }\r\n\r\n  // Insert and return last inserted id\r\n  insert(table, data) {\r\n    const columns = Object.keys(data);\r\n    const placeholders = columns.map(() => '?').join(', ');\r\n    const values = Object.values(data);\r\n    \r\n    const query = `INSERT INTO ${table} (${columns.join(', ')}) VALUES (${placeholders})`;\r\n    this.db.run(query, values);\r\n    this.save();\r\n    \r\n    // Get last insert rowid\r\n    const result = this.execute('SELECT last_insert_rowid() as id');\r\n    return result[0]?.id;\r\n  }\r\n\r\n  // Update records\r\n  update(table, data, where) {\r\n    const setClauses = Object.keys(data).map(k => `${k} = ?`);\r\n    const whereClauses = Object.keys(where).map(k => `${k} = ?`);\r\n    \r\n    const query = `UPDATE ${table} SET ${setClauses.join(', ')} WHERE ${whereClauses.join(' AND ')}`;\r\n    const params = [...Object.values(data), ...Object.values(where)];\r\n    \r\n    this.db.run(query, params);\r\n    this.save();\r\n  }\r\n\r\n  // Soft delete records\r\n  delete(table, where) {\r\n    const whereClauses = Object.keys(where).map(k => `${k} = ?`);\r\n    const query = `UPDATE ${table} SET is_deleted = 1 WHERE ${whereClauses.join(' AND ')}`;\r\n    \r\n    this.db.run(query, Object.values(where));\r\n    this.save();\r\n  }\r\n\r\n  // ===== Sync Queue Operations =====\r\n  addToSyncQueue(entityType, entityId, operation, data) {\r\n    // Map operation names to valid SQL operations\r\n    const operationMap = {\r\n      'create': 'INSERT',\r\n      'insert': 'INSERT',\r\n      'update': 'UPDATE',\r\n      'delete': 'DELETE',\r\n    };\r\n    const sqlOperation = operationMap[operation.toLowerCase()] || operation.toUpperCase();\r\n    \r\n    return this.insert('sync_queue', {\r\n      id: uuidv4(),\r\n      table_name: entityType,\r\n      record_id: entityId,\r\n      operation: sqlOperation,\r\n      payload: JSON.stringify(data),\r\n      status: 'pending',\r\n      retry_count: 0,\r\n      created_at: new Date().toISOString(),\r\n    });\r\n  }\r\n\r\n  getAllOrders(limit = 50) {\r\n    return this.execute(`SELECT * FROM orders WHERE is_deleted = 0 ORDER BY created_at DESC LIMIT ?`, [limit]);\r\n  }\r\n\r\n  getRecentOrders(limit = 10) {\r\n    const orders = this.execute(`SELECT * FROM orders WHERE is_deleted = 0 ORDER BY created_at DESC LIMIT ?`, [limit]);\r\n    \r\n    // Enrich with items for display\r\n    for (const order of orders) {\r\n      order.items = this.execute(`\r\n        SELECT * FROM order_items \r\n        WHERE order_id = ? AND is_deleted = 0\r\n      `, [order.id]);\r\n    }\r\n    \r\n    return orders;\r\n  }\r\n\r\n  getPendingSyncItems(limit = 50) {\r\n    return this.execute(\r\n      `SELECT * FROM sync_queue WHERE status = 'pending' ORDER BY created_at ASC LIMIT ?`,\r\n      [limit]\r\n    );\r\n  }\r\n\r\n  updateSyncItemStatus(id, status, errorMessage = null) {\r\n    this.update('sync_queue', \r\n      { status, error_message: errorMessage, synced_at: status === 'completed' ? new Date().toISOString() : null },\r\n      { id }\r\n    );\r\n  }\r\n\r\n  incrementSyncRetry(id) {\r\n    this.run(`UPDATE sync_queue SET retry_count = retry_count + 1 WHERE id = ?`, [id]);\r\n  }\r\n\r\n  // ===== Menu Operations =====\r\n  getMenus() {\r\n    return this.execute(`SELECT * FROM menus WHERE is_deleted = 0 ORDER BY created_at DESC`);\r\n  }\r\n\r\n  getActiveMenu() {\r\n    // Try to find marked active menu\r\n    const result = this.execute(`SELECT * FROM menus WHERE is_active = 1 AND is_deleted = 0 LIMIT 1`);\r\n    if (result && result.length > 0) return result[0];\r\n\r\n    // Fallback: If no menu is marked active, pick the first one and mark it as active\r\n    const fallback = this.execute(`SELECT * FROM menus WHERE is_deleted = 0 ORDER BY created_at ASC LIMIT 1`);\r\n    if (fallback && fallback.length > 0) {\r\n      this.run('UPDATE menus SET is_active = 1 WHERE id = ?', [fallback[0].id]);\r\n      return { ...fallback[0], is_active: 1 };\r\n    }\r\n\r\n    return null;\r\n  }\r\n\r\n  setActiveMenu(menuId) {\r\n    if (!menuId) return { success: false, error: 'Menu ID is required' };\r\n    \r\n    console.log(`Switching active menu to: ${menuId}`);\r\n    this.db.run('BEGIN TRANSACTION');\r\n    try {\r\n      this.db.run('UPDATE menus SET is_active = 0');\r\n      this.db.run('UPDATE menus SET is_active = 1 WHERE id = ?', [menuId]);\r\n      this.db.run('COMMIT');\r\n      this.save();\r\n      console.log(`Menu ${menuId} is now active.`);\r\n      return { success: true };\r\n    } catch (e) {\r\n      try { this.db.run('ROLLBACK'); } catch (rollbackError) { /* Already handled */ }\r\n      console.error('Set active menu error:', e);\r\n      return { success: false, error: e.message };\r\n    }\r\n  }\r\n\r\n  saveMenu(menu) {\r\n    if (menu.id) {\r\n      this.update('menus', { name: menu.name }, { id: menu.id });\r\n      return menu.id;\r\n    } else {\r\n      const id = uuidv4();\r\n      this.insert('menus', {\r\n        id,\r\n        name: menu.name,\r\n        is_active: 0,\r\n        created_at: new Date().toISOString(),\r\n        is_deleted: 0\r\n      });\r\n      return id;\r\n    }\r\n  }\r\n\r\n  deleteMenu(id) {\r\n    // Cannot delete active menu\r\n    const menu = this.execute('SELECT is_active FROM menus WHERE id = ?', [id])[0];\r\n    if (menu && menu.is_active) {\r\n      return { success: false, error: 'Cannot delete the active menu.' };\r\n    }\r\n    this.run('UPDATE menus SET is_deleted = 1 WHERE id = ?', [id]);\r\n    return { success: true };\r\n  }\r\n\r\n  duplicateMenu(menuId, newName) {\r\n    const original = this.execute('SELECT * FROM menus WHERE id = ?', [menuId])[0];\r\n    if (!original) return { success: false, error: 'Original menu not found' };\r\n\r\n    const newMenuId = uuidv4();\r\n    this.db.run('BEGIN TRANSACTION');\r\n    try {\r\n      this.db.run(`\r\n        INSERT INTO menus (id, name, is_active, created_at, is_deleted) \r\n        VALUES (?, ?, 0, ?, 0)\r\n      `, [newMenuId, newName || `${original.name} (Copy)`, new Date().toISOString()]);\r\n\r\n      // Copy categories\r\n      const categories = this.execute('SELECT * FROM categories WHERE menu_id = ? AND is_deleted = 0', [menuId]);\r\n      for (const cat of categories) {\r\n        const newCatId = uuidv4();\r\n        this.db.run(`\r\n          INSERT INTO categories (id, name, description, display_order, menu_id, is_active, is_deleted) \r\n          VALUES (?, ?, ?, ?, ?, ?, 0)\r\n        `, [newCatId, cat.name, cat.description, cat.display_order, newMenuId, cat.is_active]);\r\n\r\n        // Copy items for this category\r\n        const items = this.execute('SELECT * FROM menu_items WHERE category_id = ? AND is_deleted = 0', [cat.id]);\r\n        for (const item of items) {\r\n          const newItemId = uuidv4();\r\n          this.db.run(`\r\n            INSERT INTO menu_items (\r\n              id, category_id, name, description, price, cost_price, tax_rate, \r\n              is_vegetarian, is_available, preparation_time, variants, addons, menu_id, is_deleted\r\n            ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, 0)\r\n          `, [\r\n            newItemId, newCatId, item.name, item.description, item.price, item.cost_price, \r\n            item.tax_rate, item.is_vegetarian, item.is_available, item.preparation_time, \r\n            item.variants, item.addons, newMenuId\r\n          ]);\r\n        }\r\n      }\r\n\r\n      this.db.run('COMMIT');\r\n      this.save();\r\n      return { success: true, id: newMenuId };\r\n    } catch (e) {\r\n      try { this.db.run('ROLLBACK'); } catch (rollbackErr) {}\r\n      console.error('Duplicate menu error:', e);\r\n      return { success: false, error: e.message };\r\n    }\r\n  }\r\n\r\n  getCategories() {\r\n    const activeMenu = this.getActiveMenu();\r\n    if (!activeMenu) return [];\r\n    \r\n    return this.execute(\r\n      `SELECT * FROM categories WHERE menu_id = ? AND is_deleted = 0 ORDER BY display_order, name`,\r\n      [activeMenu.id]\r\n    );\r\n  }\r\n\r\n  saveCategory(category) {\r\n    const activeMenu = this.getActiveMenu();\r\n    if (!activeMenu) return null;\r\n\r\n    if (category.id) {\r\n      this.update('categories', {\r\n        name: category.name,\r\n        description: category.description,\r\n        display_order: category.display_order || 0,\r\n        updated_at: new Date().toISOString(),\r\n      }, { id: category.id });\r\n      return category.id;\r\n    } else {\r\n      const id = uuidv4();\r\n      this.insert('categories', {\r\n        id,\r\n        name: category.name,\r\n        description: category.description,\r\n        display_order: category.display_order || 0,\r\n        menu_id: activeMenu.id,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n        is_deleted: 0,\r\n        is_active: 1\r\n      });\r\n      this.addToSyncQueue('category', id, 'create', category);\r\n      return id;\r\n    }\r\n  }\r\n\r\n  getMenuItems(categoryId = null) {\r\n    const activeMenu = this.getActiveMenu();\r\n    if (!activeMenu) return [];\r\n\r\n    let query = `\r\n      SELECT m.*, c.name as category_name \r\n      FROM menu_items m \r\n      LEFT JOIN categories c ON m.category_id = c.id \r\n      WHERE m.is_deleted = 0 AND m.menu_id = ?\r\n    `;\r\n    const params = [activeMenu.id];\r\n\r\n    if (categoryId) {\r\n      query += ` AND m.category_id = ?`;\r\n      params.push(categoryId);\r\n    }\r\n\r\n    query += ` ORDER BY c.display_order, m.name`;\r\n    return this.execute(query, params);\r\n  }\r\n\r\n  saveMenuItem(item) {\r\n    const activeMenu = this.getActiveMenu();\r\n    if (!activeMenu) return null;\r\n\r\n    // Helper to safely stringify JSON or return null\r\n    const safeStringify = (data) => {\r\n      try {\r\n        if (!data) return null;\r\n        if (typeof data === 'string') return data;\r\n        return JSON.stringify(data);\r\n      } catch (e) {\r\n        return null;\r\n      }\r\n    };\r\n\r\n    if (item.id) {\r\n      this.update('menu_items', {\r\n        name: item.name,\r\n        description: item.description,\r\n        category_id: item.category_id,\r\n        price: item.price,\r\n        cost_price: item.cost_price,\r\n        tax_rate: item.tax_rate || 5,\r\n        is_vegetarian: item.is_vegetarian,\r\n        is_available: item.is_available,\r\n        preparation_time: item.preparation_time,\r\n        variants: safeStringify(item.variants),\r\n        addons: safeStringify(item.addons),\r\n        master_addon_ids: safeStringify(item.master_addon_ids),\r\n        updated_at: new Date().toISOString(),\r\n      }, { id: item.id });\r\n      \r\n      this.addToSyncQueue('menu_item', item.id, 'update', item);\r\n      return item.id;\r\n    } else {\r\n      const id = uuidv4();\r\n      this.insert('menu_items', {\r\n        id,\r\n        name: item.name,\r\n        description: item.description,\r\n        category_id: item.category_id,\r\n        price: item.price,\r\n        cost_price: item.cost_price,\r\n        tax_rate: item.tax_rate || 5,\r\n        is_vegetarian: item.is_vegetarian,\r\n        is_available: item.is_available,\r\n        preparation_time: item.preparation_time,\r\n        variants: safeStringify(item.variants),\r\n        addons: safeStringify(item.addons),\r\n        master_addon_ids: safeStringify(item.master_addon_ids),\r\n        menu_id: activeMenu.id,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n        is_deleted: 0,\r\n      });\r\n      \r\n      this.addToSyncQueue('menu_item', id, 'create', item);\r\n      return id;\r\n    }\r\n  }\r\n\r\n  // ============ MASTER ADDONS ============\r\n  getMasterAddons() {\r\n    return this.execute('SELECT * FROM master_addons WHERE is_deleted = 0 ORDER BY name');\r\n  }\r\n\r\n  saveMasterAddon(data) {\r\n    if (data.id) {\r\n      this.update('master_addons', {\r\n        name: data.name,\r\n        addon_ids: typeof data.addon_ids === 'string' ? data.addon_ids : JSON.stringify(data.addon_ids),\r\n        is_mandatory: data.is_mandatory ? 1 : 0,\r\n        selection_type: data.selection_type || 'multi',\r\n        updated_at: new Date().toISOString()\r\n      }, { id: data.id });\r\n      return data.id;\r\n    } else {\r\n      const id = uuidv4();\r\n      this.insert('master_addons', {\r\n        id,\r\n        name: data.name,\r\n        addon_ids: typeof data.addon_ids === 'string' ? data.addon_ids : JSON.stringify(data.addon_ids),\r\n        is_mandatory: data.is_mandatory ? 1 : 0,\r\n        selection_type: data.selection_type || 'multi',\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n        is_deleted: 0\r\n      });\r\n      return id;\r\n    }\r\n  }\r\n\r\n  deleteMasterAddon(id) {\r\n    return this.update('master_addons', { is_deleted: 1 }, { id });\r\n  }\r\n\r\n  deleteMenuItem(id) {\r\n    this.delete('menu_items', { id });\r\n    this.addToSyncQueue('menu_item', id, 'delete', { id });\r\n  }\r\n\r\n  toggleFavorite(id, isFavorite) {\r\n    this.run('UPDATE menu_items SET is_favorite = ?, updated_at = ? WHERE id = ?', [isFavorite ? 1 : 0, new Date().toISOString(), id]);\r\n    this.addToSyncQueue('menu_item', id, 'update', { id, is_favorite: isFavorite });\r\n    return { success: true };\r\n  }\r\n\r\n  // Internal helper for queries inside transactions (no automatic save)\r\n  _rawQuery(sql, params = []) {\r\n    const stmt = this.db.prepare(sql);\r\n    stmt.bind(params);\r\n    const results = [];\r\n    while (stmt.step()) {\r\n      results.push(stmt.getAsObject());\r\n    }\r\n    stmt.free();\r\n    return results;\r\n  }\r\n\r\n  importMenu(items, menuName = null) {\r\n    let successCount = 0;\r\n    let errorCount = 0;\r\n    const errors = [];\r\n\r\n    this.db.run('BEGIN TRANSACTION');\r\n    try {\r\n      let targetMenuId;\r\n      if (menuName) {\r\n        // Create or find named menu\r\n        const existingMenu = this._rawQuery('SELECT id FROM menus WHERE name = ? AND is_deleted = 0 COLLATE NOCASE', [menuName]);\r\n        if (existingMenu && existingMenu.length > 0) {\r\n          targetMenuId = existingMenu[0].id;\r\n        } else {\r\n          targetMenuId = uuidv4();\r\n          // Use this.db.run directly for simple one-off insert\r\n          this.db.run('INSERT INTO menus (id, name, is_active, created_at, is_deleted) VALUES (?, ?, 0, ?, 0)', \r\n            [targetMenuId, menuName, new Date().toISOString()]);\r\n          console.log(`Created new menu profile: ${menuName} (${targetMenuId})`);\r\n        }\r\n        \r\n        // Auto-activate this menu if we are importing specifically into it\r\n        this.db.run('UPDATE menus SET is_active = 0');\r\n        this.db.run('UPDATE menus SET is_active = 1 WHERE id = ?', [targetMenuId]);\r\n      } else {\r\n        const activeMenuResult = this._rawQuery('SELECT * FROM menus WHERE is_active = 1 AND is_deleted = 0 LIMIT 1');\r\n        if (!activeMenuResult || activeMenuResult.length === 0) {\r\n          // Fallback to default if no active\r\n          const allMenus = this._rawQuery('SELECT id FROM menus WHERE is_deleted = 0 LIMIT 1');\r\n          if (allMenus && allMenus.length > 0) {\r\n            targetMenuId = allMenus[0].id;\r\n            this.db.run('UPDATE menus SET is_active = 1 WHERE id = ?', [targetMenuId]);\r\n          } else {\r\n            throw new Error('No menu profile found to import into.');\r\n          }\r\n        } else {\r\n          targetMenuId = activeMenuResult[0].id;\r\n        }\r\n      }\r\n\r\n      for (const item of items) {\r\n        try {\r\n          // 1. Find or Create Category within THIS menu\r\n          let categoryId;\r\n          const catResult = this._rawQuery('SELECT id FROM categories WHERE name = ? AND menu_id = ? AND is_deleted = 0 COLLATE NOCASE', [item.category, targetMenuId]);\r\n          \r\n          if (catResult && catResult.length > 0) {\r\n            categoryId = catResult[0].id;\r\n          } else {\r\n            categoryId = uuidv4();\r\n            this.db.run('INSERT INTO categories (id, name, display_order, is_active, menu_id, is_deleted) VALUES (?, ?, ?, ?, ?, 0)',\r\n              [categoryId, item.category, 99, 1, targetMenuId]);\r\n          }\r\n\r\n          // 2. Insert or Update Menu Item within THIS menu and THIS category\r\n          const existing = this._rawQuery('SELECT id FROM menu_items WHERE name = ? AND menu_id = ? AND is_deleted = 0 COLLATE NOCASE', [item.name, targetMenuId]);\r\n          \r\n          if (existing && existing.length > 0) {\r\n            // Update\r\n            this.db.run(`\r\n              UPDATE menu_items SET \r\n                category_id = ?, price = ?, tax_rate = ?, is_vegetarian = ?, description = ?, updated_at = ?\r\n              WHERE id = ?\r\n            `, [categoryId, item.price, item.tax_rate, item.is_vegetarian, item.description, new Date().toISOString(), existing[0].id]);\r\n          } else {\r\n            // Insert\r\n            const id = uuidv4();\r\n            this.db.run(`\r\n              INSERT INTO menu_items (id, name, category_id, price, tax_rate, is_vegetarian, description, is_available, created_at, updated_at, is_deleted, menu_id)\r\n              VALUES (?, ?, ?, ?, ?, ?, ?, 1, ?, ?, 0, ?)\r\n            `, [id, item.name, categoryId, item.price, item.tax_rate, item.is_vegetarian, item.description, new Date().toISOString(), new Date().toISOString(), targetMenuId]);\r\n          }\r\n          successCount++;\r\n        } catch (err) {\r\n          console.error(`Row import error (${item.name}):`, err);\r\n          errorCount++;\r\n          errors.push(`${item.name}: ${err.message}`);\r\n        }\r\n      }\r\n      this.db.run('COMMIT');\r\n    } catch (e) {\r\n      console.error('Menu import transaction failed:', e);\r\n      try {\r\n        this.db.run('ROLLBACK');\r\n      } catch (rollbackErr) {\r\n        // Transaction might already be closed by the error\r\n      }\r\n      return { success: false, error: 'Transaction failed: ' + e.message };\r\n    }\r\n\r\n    this.save();\r\n    return { success: true, successCount, errorCount, errors };\r\n  }\r\n\r\n  importInventory(items) {\r\n    let successCount = 0;\r\n    let errorCount = 0;\r\n    const errors = [];\r\n\r\n    this.db.run('BEGIN TRANSACTION');\r\n    try {\r\n      for (const item of items) {\r\n        try {\r\n          const existing = this._rawQuery('SELECT id FROM inventory WHERE name = ? COLLATE NOCASE', [item.name]);\r\n          if (existing && existing.length > 0) {\r\n            this.db.run(`\r\n              UPDATE inventory SET \r\n                unit = ?, current_stock = ?, minimum_stock = ?, cost_per_unit = ?, supplier = ?, updated_at = ?\r\n              WHERE id = ?\r\n            `, [item.unit, item.current_stock, item.minimum_stock, item.cost_per_unit, item.supplier, new Date().toISOString(), existing[0].id]);\r\n          } else {\r\n            const id = uuidv4();\r\n            this.db.run(`\r\n              INSERT INTO inventory (id, name, unit, current_stock, minimum_stock, cost_per_unit, supplier, created_at, updated_at, is_deleted)\r\n              VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 0)\r\n            `, [id, item.name, item.unit, item.current_stock, item.minimum_stock, item.cost_per_unit, item.supplier, new Date().toISOString(), new Date().toISOString()]);\r\n          }\r\n          successCount++;\r\n        } catch (err) {\r\n          console.error(`Inventory row import error (${item.name}):`, err);\r\n          errorCount++;\r\n          errors.push(`${item.name}: ${err.message}`);\r\n        }\r\n      }\r\n      this.db.run('COMMIT');\r\n    } catch (e) {\r\n      console.error('Inventory import transaction failed:', e);\r\n      try {\r\n        this.db.run('ROLLBACK');\r\n      } catch (rollbackErr) {\r\n        // Transaction might already be closed\r\n      }\r\n      return { success: false, error: 'Transaction failed: ' + e.message };\r\n    }\r\n    \r\n    this.save();\r\n    return { success: true, successCount, errorCount, errors };\r\n  }\r\n\r\n  // ===== Order Operations =====\r\n  getActiveOrderCount() {\r\n    try {\r\n      const result = this.execute(`\r\n        SELECT COUNT(*) as count \r\n        FROM orders \r\n        WHERE status IN ('pending', 'in-progress', 'ready')\r\n      `);\r\n      return result[0]?.count || 0;\r\n    } catch (error) {\r\n      console.error('Error fetching active order count:', error);\r\n      return 0;\r\n    }\r\n  }\r\n\r\n  // ===== Global Addons Operations =====\r\n  getAddons() {\r\n    return this.execute(\r\n      `SELECT * FROM addons WHERE is_deleted = 0 ORDER BY name`\r\n    );\r\n  }\r\n\r\n  saveAddon(addon) {\r\n    if (addon.id) {\r\n      this.update('addons', {\r\n        name: addon.name,\r\n        price: addon.price,\r\n        type: addon.type || 'veg',\r\n        is_available: addon.is_available,\r\n        updated_at: new Date().toISOString(),\r\n      }, { id: addon.id });\r\n      \r\n      this.addToSyncQueue('addon', addon.id, 'update', addon);\r\n      return addon.id;\r\n    } else {\r\n      const id = uuidv4();\r\n      this.insert('addons', {\r\n        id,\r\n        name: addon.name,\r\n        price: addon.price,\r\n        type: addon.type || 'veg',\r\n        is_available: addon.is_available,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n        is_deleted: 0,\r\n      });\r\n      \r\n      this.addToSyncQueue('addon', id, 'create', addon);\r\n      return id;\r\n    }\r\n  }\r\n\r\n  deleteAddon(id) {\r\n    this.delete('addons', { id });\r\n    this.addToSyncQueue('addon', id, 'delete', { id });\r\n  }\r\n\r\n  // ===== Order Operations =====\r\n  createOrder(order, items, userId) {\r\n    console.log('Creating order with:', JSON.stringify({ order, items, userId }, null, 2));\r\n    \r\n    const orderId = uuidv4();\r\n    const sequence = this.getNextOrderNumber();\r\n    \r\n    // Generate YYMMDDxxx formatted order number\r\n    const now = new Date();\r\n    const yy = now.getFullYear().toString().slice(-2);\r\n    const mm = (now.getMonth() + 1).toString().padStart(2, '0');\r\n    const dd = now.getDate().toString().padStart(2, '0');\r\n    const seq = sequence.toString().padStart(3, '0');\r\n    const orderNumber = parseInt(`${yy}${mm}${dd}${seq}`);\r\n    \r\n    const isoNow = now.toISOString();\r\n\r\n    let paymentStatus = order.payment_status || 'pending';\r\n    const pm = order.payment_method;\r\n    \r\n    if (pm === 'cash' || pm === 'card' || pm === 'upi') {\r\n      paymentStatus = 'completed';\r\n    } else if ((pm === 'mixed' || pm === 'split') && order.payment_details?.splits) {\r\n      const hasDue = order.payment_details.splits.some(s => s.method === 'due' && s.amount > 0);\r\n      const hasPaid = order.payment_details.splits.some(s => ['cash', 'card', 'upi'].includes(s.method) && s.amount > 0);\r\n      \r\n      if (hasDue && hasPaid) {\r\n        paymentStatus = 'partial';\r\n      } else if (!hasDue && hasPaid) {\r\n        paymentStatus = 'completed';\r\n      } else {\r\n        paymentStatus = 'pending';\r\n      }\r\n    }\r\n\r\n    // Insert order - ensure no undefined values\r\n    const orderData = {\r\n      id: orderId,\r\n      order_number: orderNumber,\r\n      order_type: order.order_type || 'dine_in',\r\n      table_number: order.table_number || '',\r\n      customer_name: order.customer_name || '',\r\n      customer_phone: order.customer_phone || '',\r\n      subtotal: order.subtotal || 0,\r\n      tax_amount: order.tax_amount || 0,\r\n      discount_amount: order.discount_amount || 0,\r\n      delivery_charge: order.delivery_charge || 0,\r\n      container_charge: order.container_charge || 0,\r\n      customer_paid: order.customer_paid || 0,\r\n      total_amount: order.total_amount || 0,\r\n      payment_method: (pm === 'split' ? 'mixed' : pm) || null,\r\n      payment_status: paymentStatus,\r\n      notes: order.notes || '',\r\n    urgency: order.urgency || 'normal',\r\n    chef_instructions: order.chef_instructions || '',\r\n      status: order.status || 'active',\r\n      is_hold: order.is_hold || 0,\r\n      cashier_id: userId || null,\r\n      created_at: isoNow,\r\n      updated_at: isoNow,\r\n    };\r\n    \r\n    console.log('Order data:', JSON.stringify(orderData, null, 2));\r\n    this.insert('orders', orderData);\r\n\r\n    // Insert order items\r\n    for (const item of items || []) {\r\n      const itemData = {\r\n        id: uuidv4(),\r\n        order_id: orderId,\r\n        menu_item_id: item.menu_item_id || '',\r\n        item_name: item.name || 'Unknown Item',\r\n        quantity: item.quantity || 1,\r\n        unit_price: item.unit_price || 0,\r\n        item_total: (item.quantity || 1) * (item.unit_price || 0),\r\n        tax_rate: item.tax_rate || 0,\r\n        special_instructions: item.special_instructions || '',\r\n        variant: item.variant || null,\r\n        addons: item.addons || null,\r\n        kot_status: 'pending',\r\n        created_at: isoNow,\r\n        is_deleted: 0\r\n      };\r\n      // console.log('Item data:', JSON.stringify(itemData, null, 2));\r\n      this.insert('order_items', itemData);\r\n    }\r\n\r\n    // Insert split payments right away if provided\r\n    if (orderData.payment_method === 'mixed' && order.payment_details?.splits) {\r\n      for (const split of order.payment_details.splits) {\r\n        if (split.amount > 0) {\r\n           this.insert('order_payments', {\r\n             id: uuidv4(),\r\n             order_id: orderId,\r\n             payment_method: split.method,\r\n             amount: split.amount,\r\n             created_at: isoNow,\r\n             is_deleted: 0\r\n           });\r\n        }\r\n      }\r\n    }\r\n\r\n    // Add to sync queue\r\n    this.addToSyncQueue('order', orderId, 'create', {\r\n      ...order,\r\n      id: orderId,\r\n      order_number: orderNumber,\r\n      items,\r\n    });\r\n\r\n    return { id: orderId, orderNumber: orderNumber };\r\n  }\r\n\r\n  getNextOrderNumber() {\r\n    const today = new Date().toLocaleDateString('en-CA');\r\n    \r\n    const results = this.execute(\r\n      `SELECT current_value, date FROM sequences WHERE sequence_name = 'order_number'`\r\n    );\r\n    \r\n    if (results.length > 0) {\r\n      // Check if it's a new day - reset the counter\r\n      if (results[0].date !== today) {\r\n        this.run(\r\n          `UPDATE sequences SET current_value = 1, date = ? WHERE sequence_name = 'order_number'`,\r\n          [today]\r\n        );\r\n        return 1;\r\n      } else {\r\n        // Same day - increment\r\n        const nextValue = results[0].current_value + 1;\r\n        this.run(\r\n          `UPDATE sequences SET current_value = ? WHERE sequence_name = 'order_number'`,\r\n          [nextValue]\r\n        );\r\n        return nextValue;\r\n      }\r\n    } else {\r\n      // First order ever - create the sequence\r\n      this.run(\r\n        `INSERT OR REPLACE INTO sequences (sequence_name, current_value, date) VALUES ('order_number', 1, ?)`,\r\n        [today]\r\n      );\r\n      return 1;\r\n    }\r\n  }\r\n\r\n  getOrders(date = null, status = null) {\r\n    let query = `SELECT * FROM orders WHERE 1=1`;\r\n    const params = [];\r\n\r\n    if (date) {\r\n      query += ` AND DATE(created_at, 'localtime') = ?`;\r\n      params.push(date);\r\n    }\r\n\r\n    if (status) {\r\n      query += ` AND status = ?`;\r\n      params.push(status);\r\n    }\r\n\r\n    query += ` ORDER BY created_at DESC`;\r\n    return this.execute(query, params);\r\n  }\r\n\r\n  getOrdersByPhone(phone) {\r\n    if (!phone) return [];\r\n    \r\n    return this.execute(`\r\n      SELECT o.id, o.order_number, o.total_amount, o.status, o.created_at, o.payment_method\r\n      FROM orders o\r\n      WHERE o.customer_phone LIKE ?\r\n        AND o.is_deleted = 0\r\n        AND o.status = 'completed'\r\n      ORDER BY o.created_at DESC\r\n      LIMIT 10\r\n    `, [`%${phone}%`]);\r\n  }\r\n\r\n  // Get order by ID with items\r\n  getOrderById(id) {\r\n    const orders = this.execute(`SELECT * FROM orders WHERE id = ?`, [id]);\r\n    if (orders.length === 0) return null;\r\n\r\n    const order = orders[0];\r\n    order.items = this.execute(`\r\n      SELECT oi.*, mi.category_id, oi.unit_price as price \r\n      FROM order_items oi\r\n      LEFT JOIN menu_items mi ON oi.menu_item_id = mi.id\r\n      WHERE oi.order_id = ?\r\n    `, [id]);\r\n    return order;\r\n  }\r\n\r\n  completeOrder(id, paymentMethod, paymentDetails) {\r\n    const now = new Date().toISOString();\r\n    \r\n    // Determine payment status\r\n    let paymentStatus = 'completed';\r\n    if (paymentMethod === 'due') {\r\n      paymentStatus = 'pending';\r\n    } else if (paymentMethod === 'mixed' && paymentDetails?.splits) {\r\n      const hasDue = paymentDetails.splits.some(s => s.method === 'due' && s.amount > 0);\r\n      const hasPaid = paymentDetails.splits.some(s => ['cash', 'card', 'upi'].includes(s.method) && s.amount > 0);\r\n      \r\n      if (hasDue && hasPaid) {\r\n        paymentStatus = 'partial';\r\n      } else if (hasDue) {\r\n        paymentStatus = 'pending';\r\n      }\r\n    }\r\n\r\n    this.update('orders', {\r\n      status: 'completed',\r\n      payment_method: paymentMethod,\r\n      payment_status: paymentStatus,\r\n      updated_at: now,\r\n    }, { id });\r\n\r\n    // Handle split payments if provided\r\n    if (paymentMethod === 'mixed' && paymentDetails?.splits) {\r\n      this.run(`DELETE FROM order_payments WHERE order_id = ?`, [id]);\r\n      for (const split of paymentDetails.splits) {\r\n        if (split.amount > 0) {\r\n           this.insert('order_payments', {\r\n             id: uuidv4(),\r\n             order_id: id,\r\n             payment_method: split.method,\r\n             amount: split.amount,\r\n             created_at: now,\r\n             is_deleted: 0\r\n           });\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update daily sales\r\n    const order = this.getOrderById(id);\r\n    if (order) {\r\n      this.updateDailySales(order, paymentMethod, paymentDetails);\r\n    }\r\n\r\n    this.addToSyncQueue('order', id, 'update', { status: 'completed', paymentMethod });\r\n    \r\n    // Save to disk to persist changes\r\n    this.save();\r\n    \r\n    return { success: true, order };\r\n  }\r\n\r\n  cancelOrder(id) {\r\n    const now = new Date().toISOString();\r\n    \r\n    this.update('orders', {\r\n      status: 'cancelled',\r\n      updated_at: now,\r\n    }, { id });\r\n\r\n    this.addToSyncQueue('order', id, 'update', { status: 'cancelled' });\r\n    return { success: true };\r\n  }\r\n\r\n  deleteOrder(id) {\r\n    const order = this.getOrderById(id);\r\n    if (!order) return { success: false, error: 'Order not found' };\r\n    if (order.is_deleted) return { success: true }; // Already deleted\r\n\r\n    const now = new Date();\r\n    const isoNow = now.toISOString();\r\n    const deletedOrderNumber = order.order_number;\r\n    \r\n    console.log(`[deleteOrder] Deleting order ID: ${id}, Number: ${deletedOrderNumber}`);\r\n\r\n    // 1. Soft delete and negate order number immediately\r\n    this.update('orders', {\r\n      is_deleted: 1,\r\n      order_number: -Math.abs(deletedOrderNumber), // Ensure negative\r\n      updated_at: isoNow,\r\n    }, { id });\r\n\r\n    // 2. RE-INDEXING STRATEGY: Use ID Prefix to find all orders for this \"Day\" (Sequence)\r\n    // This avoids Date/Timezone parsing issues by relying on the integer structure YYMMDDxxx\r\n    try {\r\n         const orderNumStr = Math.abs(deletedOrderNumber).toString();\r\n         if (orderNumStr.length === 9) {\r\n             const prefixStr = orderNumStr.substring(0, 6); // \"260213\"\r\n             const minNum = parseInt(`${prefixStr}000`);\r\n             const maxNum = parseInt(`${prefixStr}999`);\r\n             \r\n             console.log(`[deleteOrder] Re-indexing range: ${minNum} - ${maxNum}`);\r\n\r\n             // Fetch all active orders in this ID range\r\n             const dailyOrders = this.execute(`\r\n                SELECT id, order_number, created_at FROM orders \r\n                WHERE is_deleted = 0 \r\n                AND order_number BETWEEN ? AND ?\r\n                ORDER BY order_number ASC\r\n             `, [minNum, maxNum]);\r\n\r\n             console.log(`[deleteOrder] Found ${dailyOrders.length} active orders to re-index.`);\r\n\r\n             // Re-assign numbers sequentially starting from prefix + 001\r\n             let needsSequenceUpdate = false;\r\n             \r\n             dailyOrders.forEach((subOrder, index) => {\r\n                 const seqNum = index + 1;\r\n                 const seqStr = seqNum.toString().padStart(3, '0');\r\n                 const expectedNumber = parseInt(`${prefixStr}${seqStr}`);\r\n                 \r\n                 if (subOrder.order_number !== expectedNumber) {\r\n                     console.log(`[deleteOrder] Correcting ${subOrder.order_number} -> ${expectedNumber}`);\r\n                     this.update('orders', {\r\n                         order_number: expectedNumber,\r\n                         updated_at: isoNow\r\n                     }, { id: subOrder.id });\r\n                     \r\n                     this.addToSyncQueue('order', subOrder.id, 'update', { order_number: expectedNumber });\r\n                 }\r\n             });\r\n\r\n             // 3. Update the sequence counter\r\n             // We verify if this batch corresponds to \"today\" before updating the global sequence\r\n             // (Though technically we should update that specific day's sequence regardless)\r\n             const today = new Date();\r\n             const todayYY = today.getFullYear().toString().slice(-2);\r\n             const todayMM = (today.getMonth() + 1).toString().padStart(2, '0');\r\n             const todayDD = today.getDate().toString().padStart(2, '0');\r\n             const todayPrefix = `${todayYY}${todayMM}${todayDD}`;\r\n\r\n             if (prefixStr === todayPrefix) {\r\n                 const newCount = dailyOrders.length;\r\n                 const todayDateStr = today.toLocaleDateString('en-CA');\r\n                 \r\n                 console.log(`[deleteOrder] Updating TODAY sequence (${todayDateStr}) to: ${newCount}`);\r\n                 this.run(\r\n                   `UPDATE sequences SET current_value = ? WHERE sequence_name = 'order_number' AND date = ?`,\r\n                   [newCount, todayDateStr]\r\n                 );\r\n             }\r\n         }\r\n    } catch (error) {\r\n      console.error('[deleteOrder] Error during re-indexing:', error);\r\n    }\r\n\r\n    this.addToSyncQueue('order', id, 'delete', { id });\r\n    this.save(); \r\n    return { success: true };\r\n  }\r\n\r\n  getAllOrders(limit = 50) {\r\n    return this.execute(`\r\n      SELECT o.*, u.full_name as cashier_name\r\n      FROM orders o\r\n      LEFT JOIN users u ON o.cashier_id = u.id\r\n      WHERE o.is_deleted = 0\r\n      ORDER BY o.created_at DESC\r\n      LIMIT ?\r\n    `, [limit]);\r\n  }\r\n\r\n  getActiveOrders() {\r\n    return this.execute(`\r\n      SELECT o.*, u.full_name as cashier_name\r\n      FROM orders o\r\n      LEFT JOIN users u ON o.cashier_id = u.id\r\n      WHERE o.status = 'active' AND o.is_deleted = 0\r\n      ORDER BY o.created_at DESC\r\n    `);\r\n  }\r\n\r\n  getHeldOrders() {\r\n    const orders = this.execute(`\r\n      SELECT o.*, u.full_name as cashier_name\r\n      FROM orders o\r\n      LEFT JOIN users u ON o.cashier_id = u.id\r\n      WHERE o.status = 'held' AND o.is_deleted = 0\r\n      ORDER BY o.created_at DESC\r\n    `);\r\n\r\n    // Attach items to each order\r\n    return orders.map(order => {\r\n      order.items = this.execute(`\r\n        SELECT oi.*, mi.name as item_name\r\n        FROM order_items oi\r\n        LEFT JOIN menu_items mi ON oi.menu_item_id = mi.id\r\n        WHERE oi.order_id = ?\r\n      `, [order.id]);\r\n      return order;\r\n    });\r\n  }\r\n\r\n  resumeHeldOrder(orderId) {\r\n    // Mark the held order as deleted so it doesn't show anymore\r\n    this.execute(`\r\n      UPDATE orders\r\n      SET is_deleted = 1\r\n      WHERE id = ?\r\n    `, [orderId]);\r\n    this.save();\r\n    return { success: true };\r\n  }\r\n\r\n  updateDailySales(order, paymentMethod, paymentDetails) {\r\n    const today = new Date().toLocaleDateString('en-CA');\r\n    \r\n    const existing = this.execute(\r\n      `SELECT * FROM daily_sales WHERE date = ?`,\r\n      [today]\r\n    );\r\n\r\n    let cashAdd = 0, cardAdd = 0, upiAdd = 0, mixedAdd = 0, dueAdd = 0;\r\n\r\n    if (paymentMethod === 'mixed' && paymentDetails?.splits) {\r\n       for (const split of paymentDetails.splits) {\r\n         if (split.method === 'cash') cashAdd += split.amount;\r\n         if (split.method === 'card') cardAdd += split.amount;\r\n         if (split.method === 'upi') upiAdd += split.amount;\r\n         if (split.method === 'due') dueAdd += split.amount;\r\n       }\r\n       mixedAdd = order.total_amount; // Track total mixed for backward compatibility or pure mixed stat\r\n    } else {\r\n       if (paymentMethod === 'cash') cashAdd = order.total_amount;\r\n       if (paymentMethod === 'card') cardAdd = order.total_amount;\r\n       if (paymentMethod === 'upi') upiAdd = order.total_amount;\r\n       if (paymentMethod === 'due') dueAdd = order.total_amount;\r\n    }\r\n\r\n    if (existing.length > 0) {\r\n      this.run(`\r\n        UPDATE daily_sales SET\r\n          total_orders = total_orders + 1,\r\n          total_revenue = total_revenue + ?,\r\n          total_tax = total_tax + ?,\r\n          total_discount = total_discount + ?,\r\n          cash_amount = cash_amount + ?,\r\n          card_amount = card_amount + ?,\r\n          upi_amount = upi_amount + ?\r\n        WHERE date = ?\r\n      `, [\r\n        order.total_amount,\r\n        order.tax_amount,\r\n        order.discount_amount || 0,\r\n        cashAdd,\r\n        cardAdd,\r\n        upiAdd,\r\n        today,\r\n      ]);\r\n    } else {\r\n      this.insert('daily_sales', {\r\n        id: uuidv4(),\r\n        date: today,\r\n        total_orders: 1,\r\n        total_revenue: order.total_amount,\r\n        total_tax: order.tax_amount,\r\n        total_discount: order.discount_amount || 0,\r\n        cash_amount: cashAdd,\r\n        card_amount: cardAdd,\r\n        upi_amount: upiAdd,\r\n      });\r\n    }\r\n  }\r\n\r\n  // ===== KOT Operations =====\r\n  getPendingKOTs() {\r\n    return this.execute(`\r\n      SELECT oi.*, o.order_number, o.table_number, o.order_type, o.created_at as order_time,\r\n             o.customer_name, o.customer_phone, o.notes, o.urgency, o.chef_instructions\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      WHERE oi.kot_status != 'served' AND o.status != 'cancelled' AND o.is_deleted = 0 AND oi.is_deleted = 0\r\n      ORDER BY \r\n        CASE o.urgency WHEN 'critical' THEN 0 WHEN 'urgent' THEN 1 ELSE 2 END,\r\n        o.created_at ASC\r\n    `);\r\n  }\r\n\r\n  updateKOTStatus(orderItemId, status) {\r\n    this.update('order_items', { kot_status: status }, { id: orderItemId });\r\n  }\r\n\r\n  // ===== Inventory Operations =====\r\n  getInventory() {\r\n    return this.execute(\r\n      `SELECT * FROM inventory WHERE is_deleted = 0 ORDER BY name`\r\n    );\r\n  }\r\n\r\n  getInventoryHistory(inventoryId) {\r\n    return this.execute(`\r\n      SELECT * FROM inventory_transactions \r\n      WHERE inventory_id = ? AND is_deleted = 0 \r\n      ORDER BY created_at DESC\r\n    `, [inventoryId]);\r\n  }\r\n\r\n  saveInventoryItem(item) {\r\n    if (item.id) {\r\n      this.update('inventory', {\r\n        name: item.name,\r\n        unit: item.unit,\r\n        current_stock: item.current_stock,\r\n        minimum_stock: item.minimum_stock,\r\n        cost_per_unit: item.cost_per_unit,\r\n        supplier: item.supplier,\r\n        updated_at: new Date().toISOString(),\r\n      }, { id: item.id });\r\n      \r\n      // If it's an edit that changes stock directly (not recommended but possible via edit modal),\r\n      // we might want to log it as an 'adjustment', but simpler to just update for now.\r\n      \r\n      return item.id;\r\n    } else {\r\n      const id = uuidv4();\r\n      const initialStock = item.current_stock || 0;\r\n      \r\n      this.insert('inventory', {\r\n        id,\r\n        name: item.name,\r\n        unit: item.unit,\r\n        current_stock: initialStock,\r\n        minimum_stock: item.minimum_stock || 0,\r\n        cost_per_unit: item.cost_per_unit,\r\n        supplier: item.supplier,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n        is_deleted: 0,\r\n      });\r\n\r\n      // Log initial stock\r\n      if (initialStock > 0) {\r\n        this.logInventoryTransaction(id, 'add', initialStock, initialStock, 'Initial Stock', 'Added during item creation');\r\n      }\r\n      \r\n      return id;\r\n    }\r\n  }\r\n\r\n  updateInventoryStock(id, quantity, operation, reason = '', notes = '') {\r\n    const items = this.execute(`SELECT current_stock FROM inventory WHERE id = ?`, [id]);\r\n    if (items.length === 0) return;\r\n    \r\n    const currentStock = items[0].current_stock;\r\n    let newStock = currentStock;\r\n    let type = 'adjustment';\r\n\r\n    if (operation === 'add') {\r\n      newStock = currentStock + quantity;\r\n      type = 'add';\r\n    } else if (operation === 'subtract') {\r\n      newStock = Math.max(0, currentStock - quantity);\r\n      type = 'subtract';\r\n    } else if (operation === 'set') {\r\n      newStock = quantity;\r\n      type = 'adjustment'; // Direct set\r\n    }\r\n    \r\n    this.update('inventory', { \r\n      current_stock: newStock,\r\n      updated_at: new Date().toISOString()\r\n    }, { id });\r\n\r\n    // Log transaction\r\n    this.logInventoryTransaction(id, type, quantity, newStock, reason, notes);\r\n    \r\n    return { success: true, newStock };\r\n  }\r\n\r\n  logInventoryTransaction(inventoryId, type, quantity, snapshot, reason, notes) {\r\n    this.insert('inventory_transactions', {\r\n      id: uuidv4(),\r\n      inventory_id: inventoryId,\r\n      type,\r\n      quantity,\r\n      current_stock_snapshot: snapshot,\r\n      reason,\r\n      notes,\r\n      created_at: new Date().toISOString(),\r\n      is_deleted: 0\r\n    });\r\n  }\r\n\r\n  deleteInventoryItem(id) {\r\n    this.delete('inventory', { id });\r\n    return { success: true };\r\n  }\r\n\r\n  // ===== Settings Operations =====\r\n  getSettings() {\r\n    return this.execute(`SELECT * FROM settings`);\r\n  }\r\n\r\n  getSetting(key) {\r\n    const results = this.execute(`SELECT value FROM settings WHERE key = ?`, [key]);\r\n    return results[0]?.value || null;\r\n  }\r\n\r\n  updateSetting(key, value) {\r\n    const existing = this.execute(`SELECT * FROM settings WHERE key = ?`, [key]);\r\n    if (existing.length > 0) {\r\n      this.run(`UPDATE settings SET value = ?, updated_at = ? WHERE key = ?`, \r\n        [value, new Date().toISOString(), key]);\r\n    } else {\r\n      this.insert('settings', {\r\n        key,\r\n        value,\r\n        updated_at: new Date().toISOString()\r\n      });\r\n    }\r\n    return { success: true };\r\n  }\r\n\r\n  // ===== Reports =====\r\n  getDailyReport(date) {\r\n    // Calculate sales directly from orders table for accuracy\r\n    const sales = this.execute(`\r\n      SELECT \r\n        ? as date,\r\n        COUNT(CASE WHEN status != 'cancelled' THEN 1 END) as total_orders,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN total_amount ELSE 0 END), 0) as total_revenue,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN tax_amount ELSE 0 END), 0) as total_tax,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN discount_amount ELSE 0 END), 0) as total_discount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'cash' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'cash' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as cash_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'card' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'card' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as card_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'upi' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'upi' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as upi_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'mixed' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) as mixed_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'due' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'due' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as due_amount\r\n        \r\n      FROM orders \r\n      WHERE DATE(created_at, 'localtime') = ? \r\n        AND is_deleted = 0\r\n    `, [date, date, date, date, date, date]);\r\n    \r\n    const orders = this.execute(`SELECT * FROM orders WHERE DATE(created_at, 'localtime') = ? AND is_deleted = 0 ORDER BY created_at DESC`, [date]);\r\n    \r\n    // Top Items (Include active/served orders too, not just completed)\r\n    const topItems = this.execute(`\r\n      SELECT \r\n        CASE \r\n          WHEN oi.variant IS NOT NULL AND oi.variant != '' AND oi.variant != 'null' AND oi.variant != '[object Object]' \r\n            THEN oi.item_name || ' (' || json_extract(oi.variant, '$.name') || ')'\r\n          ELSE oi.item_name\r\n        END as item_name,\r\n        SUM(oi.quantity) as total_quantity, \r\n        SUM(oi.item_total) as total_revenue\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      WHERE DATE(o.created_at, 'localtime') = ? \r\n        AND o.status != 'cancelled' \r\n        AND o.is_deleted = 0 \r\n        AND oi.is_deleted = 0\r\n      GROUP BY item_name\r\n      ORDER BY total_quantity DESC\r\n      LIMIT 10\r\n    `, [date]);\r\n\r\n    // Category Wise Sales\r\n    const categorySales = this.execute(`\r\n      SELECT c.name as category_name, SUM(oi.item_total) as total_revenue, SUM(oi.quantity) as total_quantity\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      LEFT JOIN menu_items mi ON oi.menu_item_id = mi.id\r\n      LEFT JOIN categories c ON mi.category_id = c.id\r\n      WHERE DATE(o.created_at, 'localtime') = ? AND o.status != 'cancelled'\r\n        AND o.is_deleted = 0 AND oi.is_deleted = 0\r\n      GROUP BY c.name\r\n      ORDER BY total_revenue DESC\r\n    `, [date]);\r\n\r\n    // Total Expenses for the day\r\n    const expenses = this.execute(`\r\n        SELECT COALESCE(SUM(amount), 0) as total_expenses \r\n        FROM expenses \r\n        WHERE date = ?\r\n    `, [date]);\r\n\r\n    // Day Opening Balance\r\n    const dayLog = this.execute(`SELECT opening_balance FROM day_logs WHERE business_date = ?`, [date])[0];\r\n    const openingBalance = dayLog?.opening_balance || 0;\r\n    \r\n    const totalExpenses = expenses[0]?.total_expenses || 0;\r\n    const totalRevenue = sales[0]?.total_revenue || 0;\r\n\r\n    return {\r\n      sales: {\r\n        ...sales[0],\r\n        total_expenses: totalExpenses,\r\n        opening_balance: openingBalance,\r\n        net_revenue: totalRevenue - totalExpenses\r\n      },\r\n      orders,\r\n      topItems,\r\n      categorySales\r\n    };\r\n  }\r\n\r\n  // Get report for a specific biller on a given date\r\n  getBillerReport(userId, date) {\r\n    const sales = this.execute(`\r\n      SELECT \r\n        COUNT(CASE WHEN status != 'cancelled' THEN 1 END) as total_orders,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN total_amount ELSE 0 END), 0) as total_revenue,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN tax_amount ELSE 0 END), 0) as total_tax,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN discount_amount ELSE 0 END), 0) as total_discount,\r\n        COALESCE(SUM(CASE WHEN payment_method = 'cash' AND status = 'completed' THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'cash' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.cashier_id = ? AND o2.status = 'completed' AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as cash_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'card' AND status = 'completed' THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'card' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.cashier_id = ? AND o2.status = 'completed' AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as card_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'upi' AND status = 'completed' THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'upi' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.cashier_id = ? AND o2.status = 'completed' AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as upi_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'mixed' AND status = 'completed' THEN total_amount ELSE 0 END), 0) as mixed_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'due' AND status = 'completed' THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'due' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.cashier_id = ? AND o2.status = 'completed' AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as due_amount\r\n        \r\n      FROM orders \r\n      WHERE DATE(created_at, 'localtime') = ? \r\n        AND cashier_id = ?\r\n        AND is_deleted = 0\r\n    `, [date, userId, date, userId, date, userId, date, userId, date, userId]);\r\n\r\n    const expenses = this.execute(`\r\n      SELECT COALESCE(SUM(amount), 0) as total_expenses FROM expenses WHERE date = ? AND employee_id = ?\r\n    `, [date, userId]);\r\n\r\n    const shifts = this.execute(`\r\n      SELECT COALESCE(SUM(start_cash), 0) as total_start_cash \r\n      FROM shifts \r\n      WHERE user_id = ? AND date(start_time, 'localtime') = ?\r\n    `, [userId, date]);\r\n\r\n    const orders = this.execute(`\r\n      SELECT * FROM orders \r\n      WHERE DATE(created_at, 'localtime') = ? AND cashier_id = ? AND is_deleted = 0 \r\n      ORDER BY created_at DESC\r\n    `, [date, userId]);\r\n\r\n    const totalRevenue = sales[0]?.total_revenue || 0;\r\n    const totalExpenses = expenses[0]?.total_expenses || 0;\r\n    const openingBalance = shifts[0]?.total_start_cash || 0;\r\n\r\n    return {\r\n      sales: {\r\n        ...(sales[0] || { total_orders: 0, total_revenue: 0, cash_amount: 0, card_amount: 0, upi_amount: 0, mixed_amount: 0, due_amount: 0 }),\r\n        total_expenses: totalExpenses,\r\n        opening_balance: openingBalance,\r\n        net_revenue: totalRevenue - totalExpenses\r\n      },\r\n      orders,\r\n    };\r\n  }\r\n\r\n  // Get performance summary for all billers on a given date\r\n  getAllBillersReport(date) {\r\n    return this.execute(`\r\n      SELECT \r\n        u.id as user_id,\r\n        u.full_name,\r\n        u.username,\r\n        u.role,\r\n        COUNT(CASE WHEN o.status != 'cancelled' THEN 1 END) as total_orders,\r\n        COALESCE(SUM(CASE WHEN o.status != 'cancelled' THEN o.total_amount ELSE 0 END), 0) as total_revenue,\r\n        \r\n        COALESCE(SUM(CASE WHEN o.payment_method = 'cash' AND o.status = 'completed' THEN o.total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'cash' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.cashier_id = u.id AND o2.status = 'completed' AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as cash_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN o.payment_method = 'card' AND o.status = 'completed' THEN o.total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'card' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.cashier_id = u.id AND o2.status = 'completed' AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as card_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN o.payment_method = 'upi' AND o.status = 'completed' THEN o.total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'upi' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.cashier_id = u.id AND o2.status = 'completed' AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as upi_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN o.payment_method = 'mixed' AND o.status = 'completed' THEN o.total_amount ELSE 0 END), 0) as mixed_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN o.payment_method = 'due' AND o.status = 'completed' THEN o.total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'due' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') = ? AND o2.cashier_id = u.id AND o2.status = 'completed' AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as due_amount\r\n      FROM users u\r\n      LEFT JOIN orders o ON o.cashier_id = u.id \r\n        AND DATE(o.created_at, 'localtime') = ? \r\n        AND o.is_deleted = 0\r\n      WHERE u.is_deleted = 0 AND u.is_active = 1 AND u.role IN ('cashier', 'admin')\r\n      GROUP BY u.id\r\n      ORDER BY total_revenue DESC\r\n    `, [date, date, date, date, date, date]);\r\n  }\r\n\r\n  // Get custom date range report with add-on statistics\r\n  getCustomReport(startDate, endDate) {\r\n    // 1. Sales Summary\r\n    const sales = this.execute(`\r\n      SELECT \r\n        COUNT(CASE WHEN status != 'cancelled' THEN 1 END) as total_orders,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN total_amount ELSE 0 END), 0) as total_revenue,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN tax_amount ELSE 0 END), 0) as total_tax,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN discount_amount ELSE 0 END), 0) as total_discount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'cash' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'cash' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') BETWEEN ? AND ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as cash_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'card' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'card' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') BETWEEN ? AND ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as card_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'upi' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'upi' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') BETWEEN ? AND ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as upi_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'mixed' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) as mixed_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'due' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'due' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') BETWEEN ? AND ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as due_amount\r\n      FROM orders \r\n      WHERE DATE(created_at, 'localtime') BETWEEN ? AND ?\r\n        AND is_deleted = 0\r\n    `, [startDate, endDate, startDate, endDate, startDate, endDate, startDate, endDate, startDate, endDate]);\r\n\r\n    // 2. Top Items\r\n    const topItems = this.execute(`\r\n      SELECT \r\n        CASE \r\n          WHEN oi.variant IS NOT NULL AND oi.variant != '' AND oi.variant != 'null' AND oi.variant != '[object Object]' \r\n            THEN oi.item_name || ' (' || json_extract(oi.variant, '$.name') || ')'\r\n          ELSE oi.item_name\r\n        END as item_name,\r\n        SUM(oi.quantity) as total_quantity, \r\n        SUM(oi.item_total) as total_revenue\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      WHERE DATE(o.created_at, 'localtime') BETWEEN ? AND ?\r\n        AND o.status != 'cancelled' \r\n        AND o.is_deleted = 0 \r\n        AND oi.is_deleted = 0\r\n      GROUP BY item_name\r\n      ORDER BY total_quantity DESC\r\n      LIMIT 10\r\n    `, [startDate, endDate]);\r\n\r\n    // 3. Category Sales\r\n    const categorySales = this.execute(`\r\n      SELECT c.name as category_name, SUM(oi.item_total) as total_revenue, SUM(oi.quantity) as total_quantity\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      LEFT JOIN menu_items mi ON oi.menu_item_id = mi.id\r\n      LEFT JOIN categories c ON mi.category_id = c.id\r\n      WHERE DATE(o.created_at, 'localtime') BETWEEN ? AND ? \r\n        AND o.status != 'cancelled'\r\n      GROUP BY c.name\r\n      ORDER BY total_revenue DESC\r\n    `, [startDate, endDate]);\r\n\r\n    // 4. Add-on Statistics\r\n    // Fetch all order items with addons in the date range\r\n    const itemsWithAddons = this.execute(`\r\n      SELECT oi.addons, oi.quantity\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      WHERE DATE(o.created_at, 'localtime') BETWEEN ? AND ?\r\n        AND o.status != 'cancelled'\r\n        AND oi.addons IS NOT NULL \r\n        AND oi.addons != ''\r\n        AND oi.addons != '[]'\r\n    `, [startDate, endDate]);\r\n\r\n    const addonStats = {};\r\n    let totalAddonRevenue = 0;\r\n\r\n    itemsWithAddons.forEach(row => {\r\n      try {\r\n        const addons = JSON.parse(row.addons);\r\n        if (Array.isArray(addons)) {\r\n          addons.forEach(addon => {\r\n            const name = addon.name;\r\n            const price = parseFloat(addon.price || 0);\r\n            const qty = row.quantity; // Addon quantity matches item quantity usually\r\n            \r\n            if (!addonStats[name]) {\r\n              addonStats[name] = { name, quantity: 0, revenue: 0 };\r\n            }\r\n            addonStats[name].quantity += qty;\r\n            addonStats[name].revenue += (price * qty);\r\n            totalAddonRevenue += (price * qty);\r\n          });\r\n        }\r\n      } catch (e) {\r\n        // Ignore parse errors\r\n      }\r\n    });\r\n\r\n    const topAddons = Object.values(addonStats)\r\n      .sort((a, b) => b.quantity - a.quantity)\r\n      .slice(0, 10);\r\n\r\n    // 5. Total Expenses\r\n    const expenses = this.execute(`\r\n      SELECT COALESCE(SUM(amount), 0) as total_expenses \r\n      FROM expenses \r\n      WHERE date BETWEEN ? AND ?\r\n    `, [startDate, endDate]);\r\n\r\n    const totalExpenses = expenses[0]?.total_expenses || 0;\r\n\r\n  // Custom Range Opening Balance\r\n  const customOpening = this.execute(`\r\n    SELECT COALESCE(SUM(opening_balance), 0) as total_opening \r\n    FROM day_logs \r\n    WHERE business_date BETWEEN ? AND ?\r\n  `, [startDate, endDate]);\r\n\r\n  const openingBalance = customOpening[0]?.total_opening || 0;\r\n  \r\n  // Ensure sales data exists\r\n  const salesData = sales[0] || {\r\n    total_orders: 0,\r\n    total_revenue: 0,\r\n    total_tax: 0,\r\n    total_discount: 0,\r\n    cash_amount: 0,\r\n    card_amount: 0,\r\n    upi_amount: 0\r\n  };\r\n\r\n  const totalRevenue = salesData.total_revenue || 0;\r\n\r\n  return {\r\n    sales: { \r\n      ...salesData, \r\n      total_addon_revenue: totalAddonRevenue,\r\n      total_expenses: totalExpenses,\r\n      opening_balance: openingBalance,\r\n      net_revenue: totalRevenue - totalExpenses\r\n    },\r\n      topItems,\r\n      categorySales,\r\n      topAddons\r\n    };\r\n  }\r\n\r\n  // ===== Shift Management =====\r\n  startShift(userId, startCash) {\r\n    // Check if user already has an active shift\r\n    const existing = this.execute(`\r\n      SELECT * FROM shifts WHERE user_id = ? AND status = 'active'\r\n    `, [userId]);\r\n\r\n    if (existing.length > 0) {\r\n      throw new Error('User already has an active shift');\r\n    }\r\n\r\n    const id = uuidv4();\r\n    const startTime = new Date().toISOString();\r\n\r\n    this.db.run(`\r\n      INSERT INTO shifts (id, user_id, start_time, start_cash, status)\r\n      VALUES (?, ?, ?, ?, 'active')\r\n    `, [id, userId, startTime, startCash]);\r\n\r\n    return { id, userId, startTime, startCash, status: 'active' };\r\n  }\r\n\r\n  endShift(userId, endCash) {\r\n    const shift = this.getActiveShift(userId);\r\n    if (!shift) {\r\n      throw new Error('No active shift found for user');\r\n    }\r\n\r\n    const endTime = new Date().toISOString();\r\n    \r\n    this.db.run(`\r\n      UPDATE shifts \r\n      SET end_time = ?, end_cash = ?, status = 'closed', updated_at = CURRENT_TIMESTAMP\r\n      WHERE id = ?\r\n    `, [endTime, endCash, shift.id]);\r\n\r\n    return { ...shift, endTime, endCash, status: 'closed' };\r\n  }\r\n\r\n  getActiveShift(userId) {\r\n    const shifts = this.execute(`\r\n      SELECT * FROM shifts WHERE user_id = ? AND status = 'active'\r\n    `, [userId]);\r\n    return shifts[0] || null;\r\n  }\r\n\r\n  autoCloseShifts() {\r\n    // Close any shifts that are still active from previous days\r\n    // This is a simple logic: if start_time is not today, close it.\r\n    // In a real scenario, we might want more complex logic (e.g. shifts spanning midnight)\r\n    // For now, we'll just close shifts started before today 00:00\r\n    \r\n    const today = new Date().toLocaleDateString('en-CA');\r\n    \r\n    this.db.run(`\r\n      UPDATE shifts \r\n      SET status = 'closed', end_time = datetime('now'), end_cash = 0, updated_at = CURRENT_TIMESTAMP\r\n      WHERE status = 'active' AND date(start_time, 'localtime') < ?\r\n    `, [today]);\r\n  }\r\n\r\n  getShiftReport(shiftId) {\r\n    const shift = this.execute(`SELECT * FROM shifts WHERE id = ?`, [shiftId])[0];\r\n    if (!shift) return null;\r\n\r\n    // Get orders within this shift window\r\n    // If shift is active, use current time as end time for report\r\n    const endTime = shift.end_time || new Date().toISOString();\r\n\r\n    const sales = this.execute(`\r\n      SELECT \r\n        COUNT(*) as total_orders,\r\n        COALESCE(SUM(total_amount), 0) as total_revenue,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'cash' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'cash' AND o2.payment_method = 'mixed' AND o2.cashier_id = ? AND o2.created_at >= ? AND o2.created_at <= ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as cash_sales,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'card' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'card' AND o2.payment_method = 'mixed' AND o2.cashier_id = ? AND o2.created_at >= ? AND o2.created_at <= ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as card_sales,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'upi' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'upi' AND o2.payment_method = 'mixed' AND o2.cashier_id = ? AND o2.created_at >= ? AND o2.created_at <= ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as upi_sales,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method NOT IN ('cash', 'card', 'upi', 'due', 'mixed') AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method NOT IN ('cash', 'card', 'upi', 'due') AND o2.payment_method = 'mixed' AND o2.cashier_id = ? AND o2.created_at >= ? AND o2.created_at <= ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as mixed_sales,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'due' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'due' AND o2.payment_method = 'mixed' AND o2.cashier_id = ? AND o2.created_at >= ? AND o2.created_at <= ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as due_sales\r\n      FROM orders\r\n      WHERE cashier_id = ? \r\n        AND created_at >= ? \r\n        AND created_at <= ?\r\n        AND status != 'cancelled'\r\n        AND is_deleted = 0\r\n    `, [\r\n      shift.user_id, shift.start_time, endTime,\r\n      shift.user_id, shift.start_time, endTime,\r\n      shift.user_id, shift.start_time, endTime,\r\n      shift.user_id, shift.start_time, endTime,\r\n      shift.user_id, shift.start_time, endTime\r\n    ])[0];\r\n\r\n    const expenses = this.execute(`\r\n      SELECT COALESCE(SUM(amount), 0) as total_expenses\r\n      FROM expenses\r\n      WHERE employee_id = ?\r\n        AND created_at >= ?\r\n        AND created_at <= ?\r\n    `, [shift.user_id, shift.start_time, endTime])[0];\r\n\r\n    const totalRevenue = sales?.total_revenue || 0;\r\n    const totalExpenses = expenses?.total_expenses || 0;\r\n\r\n    return {\r\n      shift,\r\n      sales: {\r\n        ...(sales || { total_orders: 0, total_revenue: 0, cash_sales: 0, card_sales: 0, upi_sales: 0, mixed_sales: 0, due_sales: 0 }),\r\n        total_expenses: totalExpenses,\r\n        opening_balance: shift.start_cash || 0,\r\n        net_revenue: totalRevenue - totalExpenses\r\n      }\r\n    };\r\n  }\r\n\r\n  getShiftsByDate(date) {\r\n    // date format: YYYY-MM-DD\r\n    // Get all shifts that started on this date\r\n    const shifts = this.execute(`\r\n      SELECT s.*, u.full_name as user_name, u.role as user_role\r\n      FROM shifts s\r\n      JOIN users u ON s.user_id = u.id\r\n      WHERE date(s.start_time, 'localtime') = ?\r\n      ORDER BY s.start_time DESC\r\n    `, [date]);\r\n\r\n    // For each shift, calculate the sales summary\r\n    return shifts.map(shift => {\r\n      const endTime = shift.end_time || new Date().toISOString();\r\n      const sales = this.execute(`\r\n        SELECT \r\n          COUNT(*) as total_orders,\r\n          COALESCE(SUM(total_amount), 0) as total_revenue,\r\n          COALESCE(SUM(CASE WHEN payment_method = 'cash' THEN total_amount ELSE 0 END), 0) as cash_sales,\r\n          COALESCE(SUM(CASE WHEN payment_method = 'card' THEN total_amount ELSE 0 END), 0) as card_sales,\r\n          COALESCE(SUM(CASE WHEN payment_method = 'upi' THEN total_amount ELSE 0 END), 0) as upi_sales,\r\n          COALESCE(SUM(CASE WHEN payment_method = 'mixed' THEN total_amount ELSE 0 END), 0) as mixed_sales,\r\n          COALESCE(SUM(CASE WHEN payment_method = 'due' THEN total_amount ELSE 0 END), 0) as due_sales\r\n        FROM orders\r\n        WHERE cashier_id = ? \r\n          AND created_at >= ? \r\n          AND created_at <= ?\r\n          AND status != 'cancelled'\r\n          AND is_deleted = 0\r\n      `, [shift.user_id, shift.start_time, endTime])[0];\r\n      \r\n      return {\r\n        ...shift,\r\n        sales: sales || { total_orders: 0, total_revenue: 0, cash_sales: 0, card_sales: 0, upi_sales: 0, mixed_sales: 0, due_sales: 0 }\r\n      };\r\n    });\r\n  }\r\n\r\n  // ===== Day Management =====\r\n  getDayStatus(dateStr) {\r\n    const date = dateStr || new Date().toLocaleDateString('en-CA');\r\n    // First, auto-close previous days and shifts if needed\r\n    this.autoCloseDays();\r\n    this.autoCloseShifts();\r\n    \r\n    const logs = this.execute(`SELECT * FROM day_logs WHERE business_date = ?`, [date]);\r\n    return logs[0] || null;\r\n  }\r\n\r\n  openDay(userId, openingBalance) {\r\n    const today = new Date().toLocaleDateString('en-CA');\r\n    const existing = this.getDayStatus(today);\r\n    if (existing) return existing;\r\n    \r\n    const id = uuidv4();\r\n    this.insert('day_logs', {\r\n      id,\r\n      business_date: today,\r\n      opening_time: new Date().toISOString(),\r\n      opening_balance: openingBalance,\r\n      status: 'open',\r\n      opened_by: userId\r\n    });\r\n    \r\n    // Automatically start the first shift for the user opening the day\r\n    // This avoids showing the redundant Start Shift modal\r\n    try {\r\n      this.startShift(userId, openingBalance);\r\n    } catch (e) {\r\n      // Ignore if user already has an active shift or other error\r\n      console.log('Auto-shift note:', e.message);\r\n    }\r\n    \r\n    return this.getDayStatus(today);\r\n  }\r\n\r\n  addDayBalance(amount) {\r\n    const today = new Date().toLocaleDateString('en-CA');\r\n    const existing = this.getDayStatus(today);\r\n    if (!existing) {\r\n      throw new Error('Day is not currently open');\r\n    }\r\n    \r\n    // Add to day logs\r\n    this.db.run(`\r\n      UPDATE day_logs \r\n      SET opening_balance = opening_balance + ?\r\n      WHERE business_date = ?\r\n    `, [amount, today]);\r\n    \r\n    // Update all currently active shifts so their individual math checks out\r\n    this.db.run(`\r\n      UPDATE shifts \r\n      SET start_cash = start_cash + ? \r\n      WHERE status = 'active'\r\n    `, [amount]);\r\n    \r\n    return this.getDayStatus(today);\r\n  }\r\n\r\n  autoCloseDays() {\r\n    const today = new Date().toLocaleDateString('en-CA');\r\n    this.db.run(`\r\n      UPDATE day_logs \r\n      SET status = 'closed', closing_time = business_date || ' 23:59:59', updated_at = CURRENT_TIMESTAMP\r\n      WHERE status = 'open' AND business_date < ?\r\n    `, [today]);\r\n  }\r\n\r\n  // Get detailed daily export (User-wise product sales with all details)\r\n  getDetailedDailyExport(date) {\r\n    return this.execute(`\r\n      SELECT \r\n        o.order_number,\r\n        o.id as order_id,\r\n        COALESCE(u.full_name, u.username, 'Unknown') as cashier_name,\r\n        oi.item_name,\r\n        oi.quantity,\r\n        oi.unit_price,\r\n        oi.item_total,\r\n        oi.addons,\r\n        DATE(o.created_at, 'localtime') as order_date,\r\n        TIME(o.created_at, 'localtime') as order_time,\r\n        o.customer_name,\r\n        o.customer_phone,\r\n        o.payment_method,\r\n        o.order_type,\r\n        o.table_number,\r\n        o.total_amount as order_total,\r\n        o.tax_amount,\r\n        o.discount_amount,\r\n        o.status\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      LEFT JOIN users u ON o.cashier_id = u.id\r\n      WHERE DATE(o.created_at, 'localtime') = ?\r\n        AND o.status != 'cancelled'\r\n        AND o.is_deleted = 0\r\n        AND oi.is_deleted = 0\r\n      ORDER BY o.created_at DESC, o.order_number\r\n    `, [date]);\r\n  }\r\n\r\n  getWeeklyReport(startDate) {\r\n    // 1. Daily Trend\r\n    const dailyTrend = this.execute(`\r\n      SELECT \r\n        DATE(created_at, 'localtime') as date,\r\n        COUNT(CASE WHEN status != 'cancelled' THEN 1 END) as total_orders,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN total_amount ELSE 0 END), 0) as total_revenue,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN tax_amount ELSE 0 END), 0) as total_tax,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN discount_amount ELSE 0 END), 0) as total_discount\r\n      FROM orders \r\n      WHERE DATE(created_at, 'localtime') >= ? \r\n        AND DATE(created_at, 'localtime') < date(?, '+7 days')\r\n        AND is_deleted = 0\r\n      GROUP BY DATE(created_at, 'localtime')\r\n      ORDER BY date ASC\r\n    `, [startDate, startDate]);\r\n\r\n    // 2. Top Items (Weekly)\r\n    const topItems = this.execute(`\r\n      SELECT \r\n        CASE \r\n          WHEN oi.variant IS NOT NULL AND oi.variant != '' AND oi.variant != 'null' AND oi.variant != '[object Object]' \r\n            THEN oi.item_name || ' (' || json_extract(oi.variant, '$.name') || ')'\r\n          ELSE oi.item_name\r\n        END as item_name,\r\n        SUM(oi.quantity) as total_quantity, \r\n        SUM(oi.item_total) as total_revenue\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      WHERE DATE(o.created_at, 'localtime') >= ? \r\n        AND DATE(o.created_at, 'localtime') < date(?, '+7 days')\r\n        AND o.status != 'cancelled' \r\n        AND o.is_deleted = 0 \r\n        AND oi.is_deleted = 0\r\n      GROUP BY item_name\r\n      ORDER BY total_quantity DESC\r\n      LIMIT 10\r\n    `, [startDate, startDate]);\r\n\r\n    // 3. Category Sales (Weekly)\r\n    const categorySales = this.execute(`\r\n      SELECT c.name as category_name, SUM(oi.quantity) as total_quantity, SUM(oi.item_total) as total_revenue\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      LEFT JOIN menu_items mi ON oi.menu_item_id = mi.id\r\n      LEFT JOIN categories c ON mi.category_id = c.id\r\n      WHERE DATE(o.created_at, 'localtime') >= ? \r\n        AND DATE(o.created_at, 'localtime') < date(?, '+7 days')\r\n        AND o.status != 'cancelled'\r\n        AND o.is_deleted = 0\r\n        AND oi.is_deleted = 0\r\n      GROUP BY c.name\r\n      ORDER BY total_revenue DESC\r\n    `, [startDate, startDate]);\r\n\r\n    // 4. Total Sales Summary\r\n    const sales = this.execute(`\r\n      SELECT \r\n        COUNT(CASE WHEN status != 'cancelled' THEN 1 END) as total_orders,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN total_amount ELSE 0 END), 0) as total_revenue,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN tax_amount ELSE 0 END), 0) as total_tax,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN discount_amount ELSE 0 END), 0) as total_discount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'cash' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'cash' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') >= ? AND DATE(o2.created_at, 'localtime') < date(?, '+7 days') AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as cash_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'card' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'card' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') >= ? AND DATE(o2.created_at, 'localtime') < date(?, '+7 days') AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as card_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'upi' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'upi' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') >= ? AND DATE(o2.created_at, 'localtime') < date(?, '+7 days') AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as upi_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'due' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'due' AND o2.payment_method = 'mixed' AND DATE(o2.created_at, 'localtime') >= ? AND DATE(o2.created_at, 'localtime') < date(?, '+7 days') AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as due_amount\r\n        \r\n      FROM orders \r\n      WHERE DATE(created_at, 'localtime') >= ? \r\n        AND DATE(created_at, 'localtime') < date(?, '+7 days')\r\n        AND is_deleted = 0\r\n    `, [startDate, startDate, startDate, startDate, startDate, startDate, startDate, startDate, startDate, startDate])[0];\r\n\r\n    // Weekly Expenses\r\n  const weeklyExpenses = this.execute(`\r\n    SELECT COALESCE(SUM(amount), 0) as total_expenses \r\n    FROM expenses \r\n    WHERE date >= ? AND date < date(?, '+7 days')\r\n  `, [startDate, startDate]);\r\n\r\n  // Weekly Opening Balance\r\n  const weeklyOpening = this.execute(`\r\n    SELECT COALESCE(SUM(opening_balance), 0) as total_opening \r\n    FROM day_logs \r\n    WHERE business_date >= ? AND business_date < date(?, '+7 days')\r\n  `, [startDate, startDate]);\r\n\r\n  const totalExpenses = weeklyExpenses[0]?.total_expenses || 0;\r\n  const openingBalance = weeklyOpening[0]?.total_opening || 0;\r\n  const totalRevenue = (sales && sales.total_revenue) || 0;\r\n\r\n  return {\r\n    sales: {\r\n      ...(sales || { total_orders: 0, total_revenue: 0, total_tax: 0, total_discount: 0, cash_amount: 0, card_amount: 0, upi_amount: 0, mixed_amount: 0, due_amount: 0 }),\r\n      total_expenses: totalExpenses,\r\n      opening_balance: openingBalance,\r\n      net_revenue: totalRevenue - totalExpenses\r\n    },\r\n      dailyTrend,\r\n      topItems,\r\n      categorySales\r\n    };\r\n  }\r\n\r\n  getMonthlyReport(monthStr) {\r\n    // monthStr format: 'YYYY-MM'\r\n    \r\n    // 1. Daily Trend\r\n    const dailyTrend = this.execute(`\r\n      SELECT \r\n        DATE(created_at, 'localtime') as date,\r\n        COUNT(CASE WHEN status != 'cancelled' THEN 1 END) as total_orders,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN total_amount ELSE 0 END), 0) as total_revenue,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN tax_amount ELSE 0 END), 0) as total_tax,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN discount_amount ELSE 0 END), 0) as total_discount\r\n      FROM orders \r\n      WHERE strftime('%Y-%m', created_at, 'localtime') = ?\r\n        AND is_deleted = 0\r\n      GROUP BY DATE(created_at, 'localtime')\r\n      ORDER BY date ASC\r\n    `, [monthStr]);\r\n\r\n    // 2. Top Items (Monthly)\r\n    const topItems = this.execute(`\r\n      SELECT \r\n        CASE \r\n          WHEN oi.variant IS NOT NULL AND oi.variant != '' AND oi.variant != 'null' AND oi.variant != '[object Object]' \r\n            THEN oi.item_name || ' (' || json_extract(oi.variant, '$.name') || ')'\r\n          ELSE oi.item_name\r\n        END as item_name,\r\n        SUM(oi.quantity) as total_quantity, \r\n        SUM(oi.item_total) as total_revenue\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      WHERE strftime('%Y-%m', o.created_at, 'localtime') = ?\r\n        AND o.status != 'cancelled' \r\n        AND o.is_deleted = 0 \r\n        AND oi.is_deleted = 0\r\n      GROUP BY item_name\r\n      ORDER BY total_quantity DESC\r\n      LIMIT 10\r\n    `, [monthStr]);\r\n\r\n    // 3. Category Sales (Monthly)\r\n    const categorySales = this.execute(`\r\n      SELECT c.name as category_name, SUM(oi.quantity) as total_quantity, SUM(oi.item_total) as total_revenue\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      LEFT JOIN menu_items mi ON oi.menu_item_id = mi.id\r\n      LEFT JOIN categories c ON mi.category_id = c.id\r\n      WHERE strftime('%Y-%m', o.created_at, 'localtime') = ?\r\n        AND o.status != 'cancelled'\r\n        AND o.is_deleted = 0\r\n        AND oi.is_deleted = 0\r\n      GROUP BY c.name\r\n      ORDER BY total_revenue DESC\r\n    `, [monthStr]);\r\n\r\n    // 4. Total Sales Summary\r\n    const sales = this.execute(`\r\n      SELECT \r\n        COUNT(CASE WHEN status != 'cancelled' THEN 1 END) as total_orders,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN total_amount ELSE 0 END), 0) as total_revenue,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN tax_amount ELSE 0 END), 0) as total_tax,\r\n        COALESCE(SUM(CASE WHEN status != 'cancelled' THEN discount_amount ELSE 0 END), 0) as total_discount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'cash' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'cash' AND o2.payment_method = 'mixed' AND strftime('%Y-%m', o2.created_at, 'localtime') = ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as cash_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'card' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'card' AND o2.payment_method = 'mixed' AND strftime('%Y-%m', o2.created_at, 'localtime') = ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as card_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'upi' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'upi' AND o2.payment_method = 'mixed' AND strftime('%Y-%m', o2.created_at, 'localtime') = ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as upi_amount,\r\n        \r\n        COALESCE(SUM(CASE WHEN payment_method = 'due' AND status IN ('completed', 'active') THEN total_amount ELSE 0 END), 0) +\r\n        COALESCE((SELECT SUM(amount) FROM order_payments op JOIN orders o2 ON op.order_id = o2.id WHERE op.payment_method = 'due' AND o2.payment_method = 'mixed' AND strftime('%Y-%m', o2.created_at, 'localtime') = ? AND o2.status IN ('completed', 'active') AND o2.is_deleted = 0 AND op.is_deleted = 0), 0) as due_amount\r\n        \r\n      FROM orders \r\n      WHERE strftime('%Y-%m', created_at, 'localtime') = ?\r\n        AND is_deleted = 0\r\n    `, [monthStr, monthStr, monthStr, monthStr, monthStr])[0];\r\n\r\n    // Monthly Expenses\r\n  const monthlyExpenses = this.execute(`\r\n    SELECT COALESCE(SUM(amount), 0) as total_expenses \r\n    FROM expenses \r\n    WHERE strftime('%Y-%m', date) = ?\r\n  `, [monthStr]);\r\n\r\n  // Monthly Opening Balance\r\n  const monthlyOpening = this.execute(`\r\n    SELECT COALESCE(SUM(opening_balance), 0) as total_opening \r\n    FROM day_logs \r\n    WHERE strftime('%Y-%m', business_date) = ?\r\n  `, [monthStr]);\r\n\r\n  const totalExpenses = monthlyExpenses[0]?.total_expenses || 0;\r\n  const openingBalance = monthlyOpening[0]?.total_opening || 0;\r\n  const totalRevenue = (sales && sales.total_revenue) || 0;\r\n\r\n  return {\r\n    sales: {\r\n      ...(sales || { total_orders: 0, total_revenue: 0 }),\r\n      total_expenses: totalExpenses,\r\n      opening_balance: openingBalance,\r\n      net_revenue: totalRevenue - totalExpenses\r\n    },\r\n      dailyTrend,\r\n      topItems,\r\n      categorySales\r\n    };\r\n  }\r\n\r\n  // ===== Users =====\r\n  getUsers() {\r\n    return this.execute(\r\n      `SELECT id, username, full_name, role, is_active, created_at FROM users WHERE is_deleted = 0 ORDER BY full_name`\r\n    );\r\n  }\r\n\r\n  getUserById(id) {\r\n    const users = this.execute(`SELECT * FROM users WHERE id = ?`, [id]);\r\n    return users[0] || null;\r\n  }\r\n\r\n  getUserByUsername(username) {\r\n    const users = this.execute(`SELECT * FROM users WHERE username = ? AND is_deleted = 0`, [username]);\r\n    return users[0] || null;\r\n  }\r\n\r\n  getUserByPin(pin) {\r\n    const users = this.execute(`SELECT * FROM users WHERE pin_code = ? AND is_deleted = 0 AND is_active = 1`, [pin]);\r\n    return users[0] || null;\r\n  }\r\n\r\n  saveUser(user) {\r\n    if (user.id) {\r\n      const updateData = {\r\n        username: user.username,\r\n        full_name: user.fullName,\r\n        role: user.role,\r\n        is_active: user.isActive ? 1 : 0,\r\n        updated_at: new Date().toISOString(),\r\n      };\r\n      \r\n      if (user.password) {\r\n        updateData.password_hash = user.password;\r\n      }\r\n      if (user.pinCode) {\r\n        updateData.pin_code = user.pinCode;\r\n      }\r\n      \r\n      this.update('users', updateData, { id: user.id });\r\n      return user.id;\r\n    } else {\r\n      const id = uuidv4();\r\n      this.insert('users', {\r\n        id,\r\n        username: user.username,\r\n        password_hash: user.password,\r\n        full_name: user.fullName,\r\n        role: user.role,\r\n        pin_code: user.pinCode || null,\r\n        is_active: 1,\r\n        created_at: new Date().toISOString(),\r\n        updated_at: new Date().toISOString(),\r\n        is_deleted: 0,\r\n      });\r\n      return id;\r\n    }\r\n  }\r\n\r\n  deleteUser(id) {\r\n    this.delete('users', { id });\r\n  }\r\n\r\n  // ===== Customer Operations =====\r\n  searchCustomers(query) {\r\n    if (!query) return [];\r\n    const search = `%${query}%`;\r\n    return this.execute(`\r\n      SELECT DISTINCT customer_name, customer_phone \r\n      FROM orders \r\n      WHERE (customer_phone LIKE ? OR customer_name LIKE ?) \r\n        AND customer_phone IS NOT NULL \r\n        AND customer_phone != ''\r\n      LIMIT 10\r\n    `, [search, search]);\r\n  }\r\n\r\n  getOrdersByPhone(phone) {\r\n    const orders = this.execute(`\r\n      SELECT * FROM orders \r\n      WHERE customer_phone = ? AND is_deleted = 0 \r\n      ORDER BY created_at DESC\r\n    `, [phone]);\r\n\r\n    // Enrich with items\r\n    for (const order of orders) {\r\n      order.items = this.execute(`\r\n        SELECT * FROM order_items \r\n        WHERE order_id = ? AND is_deleted = 0\r\n      `, [order.id]);\r\n    }\r\n    \r\n    return orders;\r\n  }\r\n\r\n  getCustomerDueStatus(phone) {\r\n    if (!phone) return { hasDue: false, totalDue: 0, dueCount: 0 };\r\n    const results = this.execute(`\r\n      SELECT \r\n        COUNT(*) as due_count,\r\n        SUM(total_amount) as total_amount\r\n      FROM orders\r\n      WHERE customer_phone = ? \r\n        AND payment_status != 'completed'\r\n        AND status != 'cancelled'\r\n        AND is_deleted = 0\r\n    `, [phone]);\r\n    \r\n    const data = results[0] || { due_count: 0, total_amount: 0 };\r\n    return {\r\n      hasDue: data.due_count > 0,\r\n      totalDue: data.total_amount || 0,\r\n      dueCount: data.due_count || 0\r\n    };\r\n  }\r\n\r\n  // ===== Sessions =====\r\n  logSession(userId, action) {\r\n    this.insert('sessions', {\r\n      id: uuidv4(),\r\n      user_id: userId,\r\n      login_time: action === 'login' ? new Date().toISOString() : null,\r\n      logout_time: action === 'logout' ? new Date().toISOString() : null,\r\n    });\r\n  }\r\n\r\n  // ===== Settings =====\r\n  getSetting(key) {\r\n    const results = this.execute(`SELECT value FROM settings WHERE key = ?`, [key]);\r\n    return results[0]?.value || null;\r\n  }\r\n\r\n  setSetting(key, value) {\r\n    const existing = this.execute(`SELECT * FROM settings WHERE key = ?`, [key]);\r\n    \r\n    if (existing.length > 0) {\r\n      this.run(`UPDATE settings SET value = ? WHERE key = ?`, [value, key]);\r\n    } else {\r\n      this.insert('settings', { key, value });\r\n    }\r\n  }\r\n  // ===== User Operations =====\r\n  createUser(user) {\r\n    this.insert('users', {\r\n      id: user.id,\r\n      username: user.username,\r\n      password_hash: user.password_hash,\r\n      full_name: user.full_name,\r\n      role: user.role,\r\n      is_active: user.is_active,\r\n      pin_code: user.pin_code,\r\n      created_at: new Date().toISOString()\r\n    });\r\n    return { success: true, id: user.id };\r\n  }\r\n\r\n  updateUser(id, updates) {\r\n    this.update('users', updates, { id });\r\n    return { success: true };\r\n  }\r\n\r\n  getUserByUsername(username) {\r\n    const users = this.execute('SELECT * FROM users WHERE username = ?', [username]);\r\n    return users[0] || null;\r\n  }\r\n\r\n  getUserByPin(pin) {\r\n    const users = this.execute('SELECT * FROM users WHERE pin_code = ? AND is_active = 1', [pin]);\r\n    return users[0] || null;\r\n  }\r\n\r\n  logSession(userId, action) {\r\n    // Implementation for session logging if needed\r\n  }\r\n  // ===== Expenses =====\r\n  createExpenses(expenses) {\r\n    const placeholders = expenses.map(() => '(?, ?, ?, ?, ?, ?, ?, ?, ?, ?)').join(',');\r\n    const values = expenses.flatMap(exp => {\r\n      const id = uuidv4();\r\n      const now = new Date().toISOString();\r\n      return [\r\n        id,\r\n        exp.reason,\r\n        exp.amount,\r\n        exp.explanation,\r\n        exp.employee_id,\r\n        exp.employee_name,\r\n        exp.paid_from,\r\n        exp.date,\r\n        now,\r\n        now\r\n      ];\r\n    });\r\n\r\n    if (expenses.length > 0) {\r\n      this.db.run(\r\n        `INSERT INTO expenses (id, reason, amount, explanation, employee_id, employee_name, paid_from, date, created_at, updated_at) VALUES ${placeholders}`,\r\n        values\r\n      );\r\n    }\r\n    return { success: true };\r\n  }\r\n\r\n  getExpensesByDate(date) {\r\n    return this.execute('SELECT * FROM expenses WHERE date = ? ORDER BY created_at ASC', [date]);\r\n  }\r\n\r\n  deleteExpense(id) {\r\n    this.delete('expenses', { id });\r\n    return { success: true };\r\n  }\r\n\r\n  // ============ ADVANCED REPORTS ============\r\n\r\n  // --- SALES REPORTS ---\r\n  getAddonSales(startDate, endDate) {\r\n    const items = this.execute(`\r\n      SELECT oi.addons\r\n      FROM order_items oi\r\n      JOIN orders o ON oi.order_id = o.id\r\n      WHERE o.is_deleted = 0 \r\n        AND o.status != 'cancelled'\r\n        AND date(o.created_at, 'localtime') BETWEEN date(?) AND date(?)\r\n        AND oi.addons IS NOT NULL \r\n        AND oi.addons != '[]'\r\n        AND oi.addons != ''\r\n    `, [startDate, endDate]);\r\n\r\n    const addonStats = {};\r\n\r\n    for (const item of items) {\r\n      try {\r\n        const addons = typeof item.addons === 'string' ? JSON.parse(item.addons) : item.addons;\r\n        if (Array.isArray(addons)) {\r\n          for (const addon of addons) {\r\n            const name = addon.name || addon.addon_name;\r\n            const price = parseFloat(addon.price || addon.addon_price || 0);\r\n            \r\n            if (name) {\r\n              if (!addonStats[name]) {\r\n                addonStats[name] = { name, quantity: 0, revenue: 0 };\r\n              }\r\n              addonStats[name].quantity += 1; // Assuming 1 per item, or check if qty is in addon object\r\n              addonStats[name].revenue += price;\r\n            }\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.error('Error parsing addons:', e);\r\n      }\r\n    }\r\n\r\n    return Object.values(addonStats).sort((a, b) => b.revenue - a.revenue);\r\n  }\r\n\r\n  getItemWiseSales(startDate, endDate) {\r\n    return this.execute(`\r\n      SELECT \r\n        mi.name as item_name,\r\n        json_extract(oi.variant, '$.name') as variant_name,\r\n        c.name as category_name,\r\n        SUM(oi.quantity) as total_quantity,\r\n        SUM(oi.item_total) as total_revenue,\r\n        COUNT(DISTINCT oi.order_id) as orders_count\r\n      FROM order_items oi\r\n      LEFT JOIN menu_items mi ON oi.menu_item_id = mi.id\r\n      LEFT JOIN categories c ON mi.category_id = c.id\r\n      JOIN orders o ON oi.order_id = o.id\r\n      WHERE o.is_deleted = 0 \r\n        AND o.status != 'cancelled'\r\n        AND date(o.created_at, 'localtime') BETWEEN date(?) AND date(?)\r\n      GROUP BY mi.name, json_extract(oi.variant, '$.name'), c.name\r\n      ORDER BY total_revenue DESC\r\n    `, [startDate, endDate]);\r\n  }\r\n\r\n  getCategoryWiseSales(startDate, endDate) {\r\n    return this.execute(`\r\n      SELECT \r\n        c.name as category_name,\r\n        COUNT(DISTINCT oi.order_id) as orders_count,\r\n        SUM(oi.quantity) as total_quantity,\r\n        SUM(oi.item_total) as total_revenue\r\n      FROM order_items oi\r\n      LEFT JOIN menu_items mi ON oi.menu_item_id = mi.id\r\n      LEFT JOIN categories c ON mi.category_id = c.id\r\n      JOIN orders o ON oi.order_id = o.id\r\n      WHERE o.is_deleted = 0 \r\n        AND o.status != 'cancelled'\r\n        AND date(o.created_at, 'localtime') BETWEEN date(?) AND date(?)\r\n      GROUP BY c.name\r\n      ORDER BY total_revenue DESC\r\n    `, [startDate, endDate]);\r\n  }\r\n\r\n  getHourlySales(date) {\r\n    return this.execute(`\r\n      SELECT \r\n        strftime('%H', created_at, 'localtime') as hour,\r\n        COUNT(*) as total_orders,\r\n        SUM(total_amount) as total_revenue\r\n      FROM orders\r\n      WHERE is_deleted = 0 \r\n        AND status != 'cancelled'\r\n        AND date(created_at, 'localtime') = date(?)\r\n      GROUP BY hour\r\n      ORDER BY hour ASC\r\n    `, [date]);\r\n  }\r\n\r\n  getCancelledOrders(startDate, endDate) {\r\n    return this.execute(`\r\n      SELECT \r\n        o.order_number,\r\n        o.created_at,\r\n        o.updated_at as cancelled_at,\r\n        o.total_amount,\r\n        o.notes as reason,\r\n        u.username as cashier_name\r\n      FROM orders o\r\n      LEFT JOIN users u ON o.cashier_id = u.id\r\n      WHERE o.status = 'cancelled'\r\n        AND date(o.created_at, 'localtime') BETWEEN date(?) AND date(?)\r\n      ORDER BY o.updated_at DESC\r\n    `, [startDate, endDate]);\r\n  }\r\n\r\n  getDiscountReport(startDate, endDate) {\r\n    return this.execute(`\r\n      SELECT \r\n        o.order_number,\r\n        o.created_at,\r\n        o.subtotal,\r\n        o.discount_amount,\r\n        o.discount_reason,\r\n        o.total_amount,\r\n        u.username as cashier_name\r\n      FROM orders o\r\n      LEFT JOIN users u ON o.cashier_id = u.id\r\n      WHERE o.is_deleted = 0 \r\n        AND o.status != 'cancelled'\r\n        AND o.discount_amount > 0\r\n        AND date(o.created_at, 'localtime') BETWEEN date(?) AND date(?)\r\n      ORDER BY o.created_at DESC\r\n    `, [startDate, endDate]);\r\n  }\r\n\r\n  getGSTReport(startDate, endDate) {\r\n    return this.execute(`\r\n      SELECT \r\n        date(created_at, 'localtime') as date,\r\n        COUNT(*) as total_orders,\r\n        SUM(subtotal) as taxable_amount,\r\n        SUM(tax_amount) as total_tax,\r\n        SUM(total_amount) as total_amount\r\n      FROM orders\r\n      WHERE is_deleted = 0 \r\n        AND status != 'cancelled'\r\n        AND date(created_at, 'localtime') BETWEEN date(?) AND date(?)\r\n      GROUP BY date\r\n      ORDER BY date DESC\r\n    `, [startDate, endDate]);\r\n  }\r\n\r\n  // --- INVENTORY REPORTS ---\r\n  getStockLevelReport() {\r\n    return this.execute(`\r\n      SELECT \r\n        name,\r\n        unit,\r\n        current_stock,\r\n        minimum_stock,\r\n        cost_per_unit,\r\n        supplier,\r\n        (current_stock * cost_per_unit) as stock_value,\r\n        CASE \r\n          WHEN current_stock <= minimum_stock THEN 'Low Stock' \r\n          ELSE 'In Stock' \r\n        END as status\r\n      FROM inventory\r\n      WHERE is_deleted = 0\r\n      ORDER BY current_stock ASC\r\n    `);\r\n  }\r\n\r\n  getInventoryHistory(startDate, endDate) {\r\n    return this.execute(`\r\n      SELECT \r\n        it.*,\r\n        i.name as item_name,\r\n        i.unit\r\n      FROM inventory_transactions it\r\n      JOIN inventory i ON it.inventory_id = i.id\r\n      WHERE it.is_deleted = 0\r\n        AND date(it.created_at, 'localtime') BETWEEN date(?) AND date(?)\r\n      ORDER BY it.created_at DESC\r\n    `, [startDate, endDate]);\r\n  }\r\n\r\n  // --- CRM REPORTS ---\r\n  getCustomerVisitFrequency(startDate, endDate) {\r\n    return this.execute(`\r\n      SELECT \r\n        customer_phone,\r\n        customer_name,\r\n        COUNT(*) as visit_count,\r\n        SUM(total_amount) as total_spent,\r\n        MAX(created_at) as last_visit\r\n      FROM orders\r\n      WHERE is_deleted = 0 \r\n        AND status != 'cancelled'\r\n        AND customer_phone IS NOT NULL \r\n        AND customer_phone != ''\r\n        AND date(created_at, 'localtime') BETWEEN date(?) AND date(?)\r\n      GROUP BY customer_phone\r\n      ORDER BY visit_count DESC\r\n    `, [startDate, endDate]);\r\n  }\r\n\r\n  getCustomerOrderHistory(phone) {\r\n    return this.execute(`\r\n      SELECT * \r\n      FROM orders \r\n      WHERE is_deleted = 0 \r\n        AND customer_phone = ?\r\n      ORDER BY created_at DESC\r\n    `, [phone]);\r\n  }\r\n\r\n  // --- STAFF REPORTS ---\r\n  getStaffPerformance(startDate, endDate) {\r\n    return this.execute(`\r\n      SELECT \r\n        COALESCE(u.full_name, u.username, o.cashier_id, 'Unknown') as staff_name,\r\n        COALESCE(u.role, 'Unknown') as role,\r\n        COUNT(o.id) as orders_handled,\r\n        SUM(o.total_amount) as total_sales,\r\n        AVG(o.total_amount) as avg_order_value\r\n      FROM orders o\r\n      LEFT JOIN users u ON o.cashier_id = u.id\r\n      WHERE o.is_deleted = 0 \r\n        AND o.status != 'cancelled'\r\n        AND date(o.created_at, 'localtime') BETWEEN date(?) AND date(?)\r\n      GROUP BY COALESCE(u.id, o.cashier_id)\r\n    `, [startDate, endDate]);\r\n  }\r\n\r\n  // --- PAYMENT REPORTS ---\r\n  getPaymentModeReport(startDate, endDate) {\r\n    return this.execute(`\r\n      SELECT \r\n        payment_method,\r\n        COUNT(*) as count,\r\n        SUM(total_amount) as total_amount\r\n      FROM orders\r\n      WHERE is_deleted = 0 \r\n        AND status != 'cancelled'\r\n        AND date(created_at, 'localtime') BETWEEN date(?) AND date(?)\r\n      GROUP BY payment_method\r\n    `, [startDate, endDate]);\r\n  }\r\n\r\n  //  Settings Helper \r\n  getSetting(key) {\r\n    const rows = this.execute(`SELECT value FROM settings WHERE key = ?`, [key]);\r\n    return rows.length > 0 ? rows[0].value : null;\r\n  }\r\n\r\n  // ============ PRINTING SYSTEM ============\r\n\r\n  // KOT Number Sequencing (daily reset, same pattern as order numbers)\r\n  getNextKOTNumber() {\r\n    const today = new Date().toLocaleDateString('en-CA');\r\n    \r\n    const results = this.execute(\r\n      `SELECT current_value, date FROM sequences WHERE sequence_name = 'kot_number'`\r\n    );\r\n    \r\n    if (results.length > 0) {\r\n      if (results[0].date !== today) {\r\n        // New day  reset\r\n        this.run(\r\n          `UPDATE sequences SET current_value = 1, date = ? WHERE sequence_name = 'kot_number'`,\r\n          [today]\r\n        );\r\n        return 1;\r\n      } else {\r\n        const nextValue = results[0].current_value + 1;\r\n        this.run(\r\n          `UPDATE sequences SET current_value = ? WHERE sequence_name = 'kot_number'`,\r\n          [nextValue]\r\n        );\r\n        return nextValue;\r\n      }\r\n    } else {\r\n      this.run(\r\n        `INSERT OR REPLACE INTO sequences (sequence_name, current_value, date) VALUES ('kot_number', 1, ?)`,\r\n        [today]\r\n      );\r\n      return 1;\r\n    }\r\n  }\r\n\r\n  // Log a KOT print event\r\n  logKOT({ orderId, stationId, type, items, printedBy, notes }) {\r\n    const id = uuidv4();\r\n    const kotNumber = this.getNextKOTNumber();\r\n    \r\n    this.insert('kot_logs', {\r\n      id,\r\n      kot_number: kotNumber,\r\n      order_id: orderId || null,\r\n      station_id: stationId || null,\r\n      type: type || 'new',\r\n      items: typeof items === 'string' ? items : JSON.stringify(items),\r\n      printed_at: new Date().toISOString(),\r\n      printed_by: printedBy || null,\r\n      notes: notes || null\r\n    });\r\n\r\n    return { id, kotNumber };\r\n  }\r\n\r\n  // Get all KOT logs for an order (for reprint support)\r\n  getKOTLogs(orderId) {\r\n    return this.execute(`\r\n      SELECT kl.*, ps.station_name, ps.printer_name as station_printer\r\n      FROM kot_logs kl\r\n      LEFT JOIN printer_stations ps ON kl.station_id = ps.id\r\n      WHERE kl.order_id = ?\r\n      ORDER BY kl.printed_at DESC\r\n    `, [orderId]);\r\n  }\r\n\r\n  // --- Printer Station CRUD ---\r\n  getPrinterStations() {\r\n    return this.execute(`SELECT * FROM printer_stations WHERE is_active = 1 ORDER BY station_name`);\r\n  }\r\n\r\n  savePrinterStation(station) {\r\n    if (station.id) {\r\n      // Update existing\r\n      this.run(`\r\n        UPDATE printer_stations SET station_name = ?, printer_name = ?, is_active = ?\r\n        WHERE id = ?\r\n      `, [station.station_name, station.printer_name, station.is_active ?? 1, station.id]);\r\n      return { id: station.id };\r\n    } else {\r\n      // Create new\r\n      const id = uuidv4();\r\n      this.insert('printer_stations', {\r\n        id,\r\n        station_name: station.station_name,\r\n        printer_name: station.printer_name,\r\n        is_active: 1,\r\n        created_at: new Date().toISOString()\r\n      });\r\n      return { id };\r\n    }\r\n  }\r\n\r\n  deletePrinterStation(id) {\r\n    // Remove associated mappings first\r\n    this.run(`DELETE FROM category_station_map WHERE station_id = ?`, [id]);\r\n    this.run(`DELETE FROM printer_stations WHERE id = ?`, [id]);\r\n    return { success: true };\r\n  }\r\n\r\n  // --- Category  Station Mapping ---\r\n  getCategoryStationMap() {\r\n    return this.execute(`\r\n      SELECT csm.category_id, csm.station_id, c.name as category_name, ps.station_name, ps.printer_name\r\n      FROM category_station_map csm\r\n      JOIN categories c ON csm.category_id = c.id\r\n      JOIN printer_stations ps ON csm.station_id = ps.id\r\n      WHERE ps.is_active = 1\r\n    `);\r\n  }\r\n\r\n  saveCategoryStationMap(categoryId, stationIds) {\r\n    // Clear existing mappings for this category\r\n    this.run(`DELETE FROM category_station_map WHERE category_id = ?`, [categoryId]);\r\n    \r\n    // Insert new mappings\r\n    for (const stationId of stationIds) {\r\n      this.run(`INSERT INTO category_station_map (category_id, station_id) VALUES (?, ?)`,\r\n        [categoryId, stationId]);\r\n    }\r\n    return { success: true };\r\n  }\r\n\r\n  // Given category IDs, return grouped station info with items\r\n  getStationsForCategories(categoryIds) {\r\n    if (!categoryIds || categoryIds.length === 0) return [];\r\n    \r\n    const placeholders = categoryIds.map(() => '?').join(',');\r\n    return this.execute(`\r\n      SELECT DISTINCT ps.id as station_id, ps.station_name, ps.printer_name,\r\n             csm.category_id\r\n      FROM category_station_map csm\r\n      JOIN printer_stations ps ON csm.station_id = ps.id\r\n      WHERE csm.category_id IN (${placeholders})\r\n        AND ps.is_active = 1\r\n    `, categoryIds);\r\n  }\r\n\r\n  // Ensure new tables exist (called during init for migration of existing databases)\r\n  ensurePrintingTables() {\r\n    this.run(`CREATE TABLE IF NOT EXISTS printer_stations (\r\n      id TEXT PRIMARY KEY,\r\n      station_name TEXT NOT NULL,\r\n      printer_name TEXT NOT NULL,\r\n      is_active INTEGER DEFAULT 1,\r\n      created_at TEXT DEFAULT CURRENT_TIMESTAMP\r\n    )`);\r\n\r\n    this.run(`CREATE TABLE IF NOT EXISTS category_station_map (\r\n      category_id TEXT REFERENCES categories(id),\r\n      station_id TEXT REFERENCES printer_stations(id),\r\n      PRIMARY KEY (category_id, station_id)\r\n    )`);\r\n\r\n    this.run(`CREATE TABLE IF NOT EXISTS kot_logs (\r\n      id TEXT PRIMARY KEY,\r\n      kot_number INTEGER NOT NULL,\r\n      order_id TEXT REFERENCES orders(id),\r\n      station_id TEXT,\r\n      type TEXT CHECK(type IN ('new', 'reprint', 'void', 'update')) DEFAULT 'new',\r\n      items TEXT NOT NULL,\r\n      printed_at TEXT DEFAULT CURRENT_TIMESTAMP,\r\n      printed_by TEXT REFERENCES users(id),\r\n      notes TEXT\r\n    )`);\r\n\r\n    // Ensure KOT sequence exists\r\n    this.run(`INSERT OR IGNORE INTO sequences (sequence_name, current_value, date) VALUES ('kot_number', 0, date('now'))`);\r\n\r\n    // Ensure new default settings\r\n    const defaultSettings = [\r\n      ['bill_show_logo', 'false'],\r\n      ['bill_logo_path', ''],\r\n      ['bill_show_qr', 'false'],\r\n      ['bill_qr_upi_id', ''],\r\n      ['bill_show_itemwise_tax', 'false'],\r\n      ['bill_show_customer_details', 'true'],\r\n      ['bill_paper_width', '80'],\r\n      ['bill_fssai_number', ''],\r\n      ['auto_print_kot', 'true'],\r\n      ['auto_print_bill', 'false'],\r\n      ['printer_bill', ''],\r\n      ['printer_kot', '']\r\n    ];\r\n    for (const [key, value] of defaultSettings) {\r\n      this.run(`INSERT OR IGNORE INTO settings (key, value) VALUES (?, ?)`, [key, value]);\r\n    }\r\n  }\r\n\r\n  // ==========================================\r\n  // DISCOUNTS MANAGEMENT\r\n  // ==========================================\r\n  \r\n  getAllItemDiscounts() {\r\n    return this.execute(`\r\n      SELECT d.*, m.name as item_name \r\n      FROM item_discounts d\r\n      LEFT JOIN menu_items m ON d.menu_item_id = m.id\r\n      ORDER BY d.created_at DESC\r\n    `);\r\n  }\r\n\r\n  getActiveItemDiscounts() {\r\n    // Get all discounts that are active, and either don't have dates, or are currently valid\r\n    const now = new Date().toISOString();\r\n    const today = now.split('T')[0];\r\n    \r\n    // Simplistic handling of dates: If start_date/end_date is set, compare against today/now\r\n    return this.execute(`\r\n      SELECT d.*, m.name as item_name \r\n      FROM item_discounts d\r\n      LEFT JOIN menu_items m ON d.menu_item_id = m.id\r\n      WHERE d.is_active = 1\r\n      AND (d.start_date IS NULL OR d.start_date <= ?)\r\n      AND (d.end_date IS NULL OR d.end_date >= ?)\r\n    `, [today, today]);\r\n  }\r\n\r\n  addItemDiscount(discount) {\r\n    const { v4: uuidv4 } = require('uuid');\r\n    const id = discount.id || uuidv4();\r\n    this.insert('item_discounts', {\r\n      ...discount,\r\n      id,\r\n      created_at: new Date().toISOString(),\r\n      updated_at: new Date().toISOString()\r\n    });\r\n    return this.getItemDiscount(id);\r\n  }\r\n\r\n  updateItemDiscount(id, updates) {\r\n    updates.updated_at = new Date().toISOString();\r\n    this.update('item_discounts', updates, { id });\r\n    return this.getItemDiscount(id);\r\n  }\r\n\r\n  deleteItemDiscount(id) {\r\n    this.run('DELETE FROM item_discounts WHERE id = ?', [id]);\r\n    return { success: true };\r\n  }\r\n\r\n  getItemDiscount(id) {\r\n    return this.execute('SELECT * FROM item_discounts WHERE id = ?', [id])[0];\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = { Database };\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\electron\\main.js","messages":[{"ruleId":"no-undef","severity":2,"message":"'syncService' is not defined.","line":1314,"column":12,"nodeType":"Identifier","messageId":"undef","endLine":1314,"endColumn":23},{"ruleId":"no-undef","severity":2,"message":"'syncService' is not defined.","line":1319,"column":20,"nodeType":"Identifier","messageId":"undef","endLine":1319,"endColumn":31}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const { app, BrowserWindow, ipcMain, Menu, Tray, dialog } = require('electron');\r\nconst path = require('path');\r\nconst { autoUpdater } = require('electron-updater');\r\nconst log = require('electron-log');\r\nconst { Database } = require('./database/db');\r\nconst AuthService = require('./services/auth.service');\r\nconst PrinterService = require('./services/printer.service');\r\nconst dataImporter = require('./services/dataImporter');\r\nconst fs = require('fs');\r\n\r\n// Configure logging\r\nlog.transports.file.level = 'info';\r\nautoUpdater.logger = log;\r\n\r\n// Keep a global reference of the window object\r\nlet mainWindow = null;\r\nlet tray = null;\r\nlet db = null;\r\nlet authService = null;\r\nlet printerService = null;\r\n\r\n// Determine if in development mode\r\nconst isDev = !app.isPackaged;\r\n\r\nfunction createWindow() {\r\n  // Create the browser window\r\n  mainWindow = new BrowserWindow({\r\n    width: 1400,\r\n    height: 900,\r\n    minWidth: 1200,\r\n    minHeight: 700,\r\n    title: 'ZapBill POS',\r\n    icon: path.join(__dirname, '../public/icon.png'),\r\n    webPreferences: {\r\n      nodeIntegration: false,\r\n      contextIsolation: true,\r\n      preload: path.join(__dirname, 'preload.js'),\r\n      devTools: isDev,\r\n    },\r\n    show: false, // Don't show until ready\r\n    autoHideMenuBar: true, // Hide default menu bar\r\n  });\r\n\r\n  // Load the app\r\n  if (isDev) {\r\n    mainWindow.loadURL('http://localhost:5173');\r\n    // DevTools disabled from auto-opening\r\n  } else {\r\n    mainWindow.loadFile(path.join(__dirname, '../dist/index.html'));\r\n  }\r\n\r\n  // Show window when ready\r\n  mainWindow.once('ready-to-show', () => {\r\n    mainWindow.maximize();\r\n    mainWindow.show();\r\n    mainWindow.focus();\r\n  });\r\n\r\n  // Handle window closed\r\n  mainWindow.on('closed', () => {\r\n    mainWindow = null;\r\n  });\r\n\r\n  // Prevent navigation to external URLs\r\n  mainWindow.webContents.on('will-navigate', (event, url) => {\r\n    if (!url.startsWith('http://localhost') && !url.startsWith('file://')) {\r\n      event.preventDefault();\r\n    }\r\n  });\r\n}\r\n\r\nfunction createTray() {\r\n  try {\r\n    const iconPath = path.join(__dirname, '../public/icon.png');\r\n    const fs = require('fs');\r\n    \r\n    if (!fs.existsSync(iconPath)) {\r\n      log.warn('Tray icon not found, skipping tray creation');\r\n      return;\r\n    }\r\n    \r\n    tray = new Tray(iconPath);\r\n    \r\n    const contextMenu = Menu.buildFromTemplate([\r\n      { \r\n        label: 'Open POS', \r\n        click: () => {\r\n          if (mainWindow) {\r\n            mainWindow.show();\r\n            mainWindow.focus();\r\n          }\r\n        }\r\n      },\r\n      { type: 'separator' },\r\n      { \r\n        label: 'Quit', \r\n        click: () => {\r\n          app.quit();\r\n        }\r\n      }\r\n    ]);\r\n    \r\n    tray.setToolTip('Restaurant POS');\r\n    tray.setContextMenu(contextMenu);\r\n    \r\n    tray.on('double-click', () => {\r\n      if (mainWindow) {\r\n        mainWindow.show();\r\n        mainWindow.focus();\r\n      }\r\n    });\r\n  } catch (error) {\r\n    log.warn('Failed to create tray:', error.message);\r\n  }\r\n}\r\n\r\nasync function initializeServices() {\r\n  // Initialize database (async for sql.js)\r\n  db = new Database();\r\n  await db.initialize();\r\n  \r\n  // Ensure printing tables exist (migration for existing databases)\r\n  try { db.ensurePrintingTables(); } catch (e) { log.warn('ensurePrintingTables:', e.message); }\r\n  \r\n  // Initialize services (fully offline - no sync)\r\n  authService = new AuthService(db);\r\n  printerService = new PrinterService();\r\n  \r\n  log.info('Services initialized successfully (offline mode)');\r\n}\r\n\r\nfunction setupIpcHandlers() {\r\n  // ============ AUTHENTICATION ============\r\n  ipcMain.handle('auth:login', async (event, { username, password }) => {\r\n    try {\r\n      return await authService.login(username, password);\r\n    } catch (error) {\r\n      log.error('Login error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('auth:loginWithPin', async (event, { pin }) => {\r\n    try {\r\n      return await authService.loginWithPin(pin);\r\n    } catch (error) {\r\n      log.error('PIN login error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('auth:logout', async (event, { userId }) => {\r\n    try {\r\n      return await authService.logout(userId);\r\n    } catch (error) {\r\n      log.error('Logout error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('auth:getCurrentUser', async () => {\r\n    return authService.getCurrentUser();\r\n  });\r\n\r\n  // ============ DATABASE OPERATIONS ============\r\n  ipcMain.handle('db:query', async (event, { table, action, data, where }) => {\r\n    try {\r\n      // For settings table, redirect to proper methods\r\n      if (table === 'settings' && action === 'SELECT') {\r\n        return db.getSettings();\r\n      }\r\n      return db.execute(table, action, data, where);\r\n    } catch (error) {\r\n      log.error('Database error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('db:getPath', async () => {\r\n    return db.dbPath;\r\n  });\r\n\r\n  ipcMain.handle('db:movePath', async () => {\r\n    try {\r\n      const result = await dialog.showOpenDialog(mainWindow, {\r\n        properties: ['openDirectory', 'createDirectory'],\r\n        title: 'Select New Database Folder',\r\n        buttonLabel: 'Move Database Here'\r\n      });\r\n\r\n      if (result.canceled || result.filePaths.length === 0) {\r\n        return { success: false, cancelled: true };\r\n      }\r\n\r\n      const newFolder = result.filePaths[0];\r\n      const oldPath = db.dbPath;\r\n      const newPath = path.join(newFolder, 'restaurant_pos.db');\r\n\r\n      if (oldPath === newPath) {\r\n        return { success: false, error: 'Source and destination are the same.' };\r\n      }\r\n\r\n      // Close current connection\r\n      db.close();\r\n\r\n      // Copy file\r\n      fs.copyFileSync(oldPath, newPath);\r\n\r\n      // Update config\r\n      const userDataPath = app.getPath('userData');\r\n      const configPath = path.join(userDataPath, 'config.json');\r\n      fs.writeFileSync(configPath, JSON.stringify({ dbPath: newFolder }));\r\n\r\n      return { success: true, newPath };\r\n    } catch (error) {\r\n      log.error('Move DB error:', error);\r\n      // Try to re-open DB if failed\r\n      await db.initialize(); \r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ SETTINGS OPERATIONS ============\r\n  ipcMain.handle('settings:getAll', async () => {\r\n    try {\r\n      return db.getSettings();\r\n    } catch (error) {\r\n      log.error('Get settings error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('settings:get', async (event, { key }) => {\r\n    try {\r\n      return db.getSetting(key);\r\n    } catch (error) {\r\n      log.error('Get setting error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('settings:update', async (event, { key, value }) => {\r\n    try {\r\n      return db.updateSetting(key, value);\r\n    } catch (error) {\r\n      log.error('Update setting error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ MENU OPERATIONS ============\r\n  ipcMain.handle('menu:getCategories', async () => {\r\n    try {\r\n      return db.getCategories();\r\n    } catch (error) {\r\n      log.error('Get categories error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:getItems', async (event, params = {}) => {\r\n    try {\r\n      // Safely destructure or default to undefined\r\n      const categoryId = params ? params.categoryId : undefined;\r\n      return db.getMenuItems(categoryId);\r\n    } catch (error) {\r\n      log.error('Get menu items error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:saveCategory', async (event, { category }) => {\r\n    try {\r\n      return db.saveCategory(category);\r\n    } catch (error) {\r\n      log.error('Save category error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:saveItem', async (event, { item }) => {\r\n    try {\r\n      return db.saveMenuItem(item);\r\n    } catch (error) {\r\n      log.error('Save menu item error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:deleteItem', async (event, { id }) => {\r\n    try {\r\n      return db.deleteMenuItem(id);\r\n    } catch (error) {\r\n      log.error('Delete menu item error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:toggleFavorite', async (event, { id, isFavorite }) => {\r\n    try {\r\n      return db.toggleFavorite(id, isFavorite);\r\n    } catch (error) {\r\n      log.error('Toggle favorite error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ MASTER ADDONS ============\r\n  ipcMain.handle('menu:getMasterAddons', async () => {\r\n    try {\r\n      return db.getMasterAddons();\r\n    } catch (error) {\r\n      log.error('Get master addons error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:saveMasterAddon', async (event, { data }) => {\r\n    try {\r\n      return db.saveMasterAddon(data);\r\n    } catch (error) {\r\n      log.error('Save master addon error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:deleteMasterAddon', async (event, { id }) => {\r\n    try {\r\n      return db.deleteMasterAddon(id);\r\n    } catch (error) {\r\n      log.error('Delete master addon error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ MULTI-MENU OPERATIONS ============\r\n  ipcMain.handle('menu:getMenus', async () => {\r\n    try {\r\n      return db.getMenus();\r\n    } catch (error) {\r\n      log.error('Get menus error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:getActiveMenu', async () => {\r\n    try {\r\n      return db.getActiveMenu();\r\n    } catch (error) {\r\n      log.error('Get active menu error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:setActiveMenu', async (event, { id }) => {\r\n    try {\r\n      return db.setActiveMenu(id);\r\n    } catch (error) {\r\n      log.error('Set active menu error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:saveMenu', async (event, { menu }) => {\r\n    try {\r\n      return db.saveMenu(menu);\r\n    } catch (error) {\r\n      log.error('Save menu error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:deleteMenu', async (event, { id }) => {\r\n    try {\r\n      return db.deleteMenu(id);\r\n    } catch (error) {\r\n      log.error('Delete menu error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:duplicateMenu', async (event, { id, name }) => {\r\n    try {\r\n      return db.duplicateMenu(id, name);\r\n    } catch (error) {\r\n      log.error('Duplicate menu error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:deleteCategory', async (event, { id }) => {\r\n    try {\r\n      // Check if any items use this category\r\n      const items = db.execute('SELECT id FROM menu_items WHERE category_id = ? AND is_deleted = 0', [id]);\r\n      if (items.length > 0) {\r\n        return { success: false, error: 'Cannot delete category with existing items. Please remove or move checking items first.' };\r\n      }\r\n\r\n      // Soft delete category\r\n      db.run('UPDATE categories SET is_deleted = 1 WHERE id = ?', [id]);\r\n      return { success: true };\r\n    } catch (error) {\r\n      log.error('Delete category error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:getActiveCount', async () => {\r\n    try {\r\n      return db.getActiveOrderCount();\r\n    } catch (error) {\r\n      log.error('Get active order count error:', error);\r\n      return 0;\r\n    }\r\n  });\r\n\r\n\r\n\r\n  // ============ ADDONS OPERATIONS ============\r\n  ipcMain.handle('menu:getAddons', async () => {\r\n    try {\r\n      return db.getAddons();\r\n    } catch (error) {\r\n      log.error('Get addons error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:saveAddon', async (event, { addon }) => {\r\n    try {\r\n      return db.saveAddon(addon);\r\n    } catch (error) {\r\n      log.error('Save addon error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('menu:deleteAddon', async (event, { id }) => {\r\n    try {\r\n      return db.deleteAddon(id);\r\n    } catch (error) {\r\n      log.error('Delete addon error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ ORDER OPERATIONS ============\r\n  ipcMain.handle('order:create', async (event, { order, items }) => {\r\n    try {\r\n      const userId = authService.getCurrentUser()?.id;\r\n      return db.createOrder(order, items, userId);\r\n    } catch (error) {\r\n      log.error('Create order error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:update', async (event, { id, updates }) => {\r\n    try {\r\n      db.update('orders', updates, { id });\r\n      return { success: true };\r\n    } catch (error) {\r\n      log.error('Update order error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:getActive', async () => {\r\n    try {\r\n      return db.getActiveOrders();\r\n    } catch (error) {\r\n      log.error('Get active orders error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:getAll', async (event, { limit }) => {\r\n    try {\r\n      return db.getAllOrders(limit || 50);\r\n    } catch (error) {\r\n      log.error('Get all orders error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:getRecent', async (event, { limit }) => {\r\n    try {\r\n      return db.getRecentOrders(limit || 10);\r\n    } catch (error) {\r\n      log.error('Get recent orders error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:getById', async (event, { id }) => {\r\n    try {\r\n      return db.getOrderById(id);\r\n    } catch (error) {\r\n      log.error('Get order error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:complete', async (event, { id, paymentMethod, paymentDetails }) => {\r\n    try {\r\n      log.info('Completing order:', id, 'with payment method:', paymentMethod);\r\n      const result = db.completeOrder(id, paymentMethod, paymentDetails);\r\n      log.info('Order completion result:', result);\r\n      return result;\r\n    } catch (error) {\r\n      log.error('Complete order error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:cancel', async (event, { id }) => {\r\n    try {\r\n      return db.cancelOrder(id);\r\n    } catch (error) {\r\n      log.error('Cancel order error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:getHeld', async () => {\r\n    try {\r\n      return db.getHeldOrders();\r\n    } catch (error) {\r\n      log.error('Get held orders error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:resume', async (event, { id }) => {\r\n    try {\r\n      return db.resumeHeldOrder(id);\r\n    } catch (error) {\r\n      log.error('Resume order error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('customer:search', async (event, { query }) => {\r\n    try {\r\n      return db.searchCustomers(query);\r\n    } catch (error) {\r\n      log.error('Search customers error:', error);\r\n      return [];\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('customer:getHistory', async (event, { phone }) => {\r\n    try {\r\n      return db.getOrdersByPhone(phone);\r\n    } catch (error) {\r\n      log.error('Get customer history error:', error);\r\n      return [];\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('customer:getDueStatus', async (event, { phone }) => {\r\n    try {\r\n      return db.getCustomerDueStatus(phone);\r\n    } catch (error) {\r\n      log.error('Get customer due status error:', error);\r\n      return { hasDue: false, totalDue: 0, dueCount: 0 };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:getByPhone', async (event, { phone }) => {\r\n    try {\r\n      return db.getOrdersByPhone(phone);\r\n    } catch (error) {\r\n      log.error('Get orders by phone error:', error);\r\n      return [];\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:delete', async (event, { id }) => {\r\n    try {\r\n      // First get the order details to subtract from daily_sales\r\n      const order = db.execute('SELECT * FROM orders WHERE id = ?', [id])[0];\r\n      \r\n      if (order && order.status === 'completed') {\r\n        // Get the date of the order\r\n        const orderDate = order.created_at.split('T')[0];\r\n        \r\n        // Subtract from daily_sales\r\n        db.run(`\r\n          UPDATE daily_sales \r\n          SET total_orders = total_orders - 1,\r\n              total_revenue = total_revenue - ?,\r\n              total_tax = total_tax - ?,\r\n              total_discount = total_discount - ?,\r\n              cash_amount = CASE WHEN ? = 'cash' THEN cash_amount - ? ELSE cash_amount END,\r\n              card_amount = CASE WHEN ? = 'card' THEN card_amount - ? ELSE card_amount END,\r\n              upi_amount = CASE WHEN ? = 'upi' THEN upi_amount - ? ELSE upi_amount END\r\n          WHERE date = ?\r\n        `, [\r\n          order.total_amount || 0,\r\n          order.tax_amount || 0,\r\n          order.discount_amount || 0,\r\n          order.payment_method, order.total_amount || 0,\r\n          order.payment_method, order.total_amount || 0,\r\n          order.payment_method, order.total_amount || 0,\r\n          orderDate\r\n        ]);\r\n      }\r\n      \r\n      // Soft delete by marking as deleted\r\n      db.run(`UPDATE orders SET is_deleted = 1, updated_at = ? WHERE id = ?`, \r\n        [new Date().toISOString(), id]);\r\n      db.run(`UPDATE order_items SET is_deleted = 1 WHERE order_id = ?`, [id]);\r\n      return { success: true };\r\n    } catch (error) {\r\n      log.error('Delete order error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('order:updateItem', async (event, { id, updates }) => {\r\n    try {\r\n      db.update('order_items', updates, { id });\r\n      return { success: true };\r\n    } catch (error) {\r\n      log.error('Update order item error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ KOT OPERATIONS ============\r\n  ipcMain.handle('kot:getPending', async () => {\r\n    try {\r\n      return db.getPendingKOTs();\r\n    } catch (error) {\r\n      log.error('Get pending KOTs error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('kot:updateStatus', async (event, { orderItemId, status }) => {\r\n    try {\r\n      return db.updateKOTStatus(orderItemId, status);\r\n    } catch (error) {\r\n      log.error('Update KOT status error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ DISCOUNTS OPERATIONS ============\r\n  ipcMain.handle('discounts:getAll', async () => {\r\n    try {\r\n      return db.getAllItemDiscounts();\r\n    } catch (error) {\r\n      log.error('Get all discounts error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('discounts:getActive', async () => {\r\n    try {\r\n      return db.getActiveItemDiscounts();\r\n    } catch (error) {\r\n      log.error('Get active discounts error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('discounts:add', async (event, discount) => {\r\n    try {\r\n      return db.addItemDiscount(discount);\r\n    } catch (error) {\r\n      log.error('Add discount error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('discounts:update', async (event, { id, updates }) => {\r\n    try {\r\n      return db.updateItemDiscount(id, updates);\r\n    } catch (error) {\r\n      log.error('Update discount error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('discounts:delete', async (event, { id }) => {\r\n    try {\r\n      return db.deleteItemDiscount(id);\r\n    } catch (error) {\r\n      log.error('Delete discount error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ INVENTORY OPERATIONS ============\r\n  ipcMain.handle('inventory:getAll', async () => {\r\n    try {\r\n      return db.getInventory();\r\n    } catch (error) {\r\n      log.error('Get inventory error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('inventory:save', async (event, { item }) => {\r\n    try {\r\n      return db.saveInventoryItem(item);\r\n    } catch (error) {\r\n      log.error('Save inventory error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('inventory:updateStock', async (event, { id, quantity, operation, reason, notes }) => {\r\n    try {\r\n      return db.updateInventoryStock(id, quantity, operation, reason, notes);\r\n    } catch (error) {\r\n      log.error('Update inventory error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('inventory:getHistory', async (event, { id }) => {\r\n    try {\r\n      return db.getInventoryHistory(id);\r\n    } catch (error) {\r\n      log.error('Get inventory history error:', error);\r\n      return [];\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('inventory:delete', async (event, { id }) => {\r\n    try {\r\n      return db.deleteInventoryItem(id);\r\n    } catch (error) {\r\n      log.error('Delete inventory error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ SHIFT MANAGEMENT OPERATIONS ============\r\n  ipcMain.handle('shifts:start', async (event, { userId, startCash }) => {\r\n    try {\r\n      return db.startShift(userId, startCash);\r\n    } catch (error) {\r\n      log.error('Start shift error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('shifts:end', async (event, { userId, endCash }) => {\r\n    try {\r\n      return db.endShift(userId, endCash);\r\n    } catch (error) {\r\n      log.error('End shift error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('shifts:getStatus', async (event, { userId }) => {\r\n    try {\r\n      const shift = db.getActiveShift(userId);\r\n      return { success: true, shift };\r\n    } catch (error) {\r\n      log.error('Get shift status error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('shifts:getReport', async (event, { shiftId }) => {\r\n    try {\r\n      const report = db.getShiftReport(shiftId);\r\n      return { success: true, report };\r\n    } catch (error) {\r\n      log.error('Get shift report error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('shifts:getByDate', async (event, { date }) => {\r\n    try {\r\n      const shifts = db.getShiftsByDate(date);\r\n      return { success: true, shifts };\r\n    } catch (error) {\r\n      log.error('Get shifts by date error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ DAY MANAGEMENT OPERATIONS ============\r\n  ipcMain.handle('day:getStatus', async (event, { date }) => {\r\n    try {\r\n      const status = db.getDayStatus(date);\r\n      return { success: true, status };\r\n    } catch (error) {\r\n      log.error('Get day status error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('day:open', async (event, { userId, openingBalance }) => {\r\n    try {\r\n      const status = db.openDay(userId, openingBalance);\r\n      return { success: true, status };\r\n    } catch (error) {\r\n      log.error('Open day error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('day:addBalance', async (event, { amount }) => {\r\n    try {\r\n      const status = db.addDayBalance(amount);\r\n      return { success: true, status };\r\n    } catch (error) {\r\n      log.error('Add day balance error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // Auto-close shifts on startup (optional, but good practice)\r\n  try {\r\n    db.autoCloseShifts();\r\n    db.autoCloseDays();\r\n  } catch (e) {\r\n    log.error('Auto close shifts/days error:', e);\r\n  }\r\n\r\n  // ============ EXPENSES OPERATIONS ============\r\n  ipcMain.handle('expenses:create', async (event, { expenses }) => {\r\n    try {\r\n      return db.createExpenses(expenses);\r\n    } catch (error) {\r\n      log.error('Create expenses error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('expenses:getByDate', async (event, { date }) => {\r\n    try {\r\n      return db.getExpensesByDate(date);\r\n    } catch (error) {\r\n      log.error('Get expenses error:', error);\r\n      return [];\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('expenses:delete', async (event, { id }) => {\r\n    try {\r\n      return db.deleteExpense(id);\r\n    } catch (error) {\r\n      log.error('Delete expense error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ FILE PICKER (for imports) ============\r\n  ipcMain.handle('dialog:selectFile', async (event, { title, filters } = {}) => {\r\n    try {\r\n      const result = await dialog.showOpenDialog(mainWindow, {\r\n        properties: ['openFile'],\r\n        title: title || 'Select File',\r\n        filters: filters || [\r\n          { name: 'Spreadsheets', extensions: ['xlsx', 'xls', 'csv'] },\r\n          { name: 'All Files', extensions: ['*'] }\r\n        ]\r\n      });\r\n\r\n      if (result.canceled || result.filePaths.length === 0) {\r\n        return { success: false, cancelled: true };\r\n      }\r\n\r\n      return { success: true, filePath: result.filePaths[0] };\r\n    } catch (error) {\r\n      log.error('File picker error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('data:importMenu', async (event, { filePath, menuName }) => {\r\n    try {\r\n      const items = dataImporter.parseMenu(filePath);\r\n      return db.importMenu(items, menuName);\r\n    } catch (error) {\r\n      log.error('Import menu error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('data:importInventory', async (event, { filePath }) => {\r\n    try {\r\n      const items = dataImporter.parseInventory(filePath);\r\n      return db.importInventory(items);\r\n    } catch (error) {\r\n      log.error('Import inventory error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ REPORTS ============\r\n  ipcMain.handle('reports:daily', async (event, { date }) => {\r\n    try {\r\n      return db.getDailyReport(date);\r\n    } catch (error) {\r\n      log.error('Get daily report error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('reports:weekly', async (event, { startDate }) => {\r\n    try {\r\n      return db.getWeeklyReport(startDate);\r\n    } catch (error) {\r\n      log.error('Get weekly report error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('reports:monthly', async (event, { month }) => {\r\n    try {\r\n      return db.getMonthlyReport(month);\r\n    } catch (error) {\r\n      log.error('Get monthly report error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('reports:dailyDetailed', async (event, { date }) => {\r\n    try {\r\n      return db.getDetailedDailyExport(date);\r\n    } catch (error) {\r\n      log.error('Get detailed daily report error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('reports:custom', async (event, { startDate, endDate }) => {\r\n    try {\r\n      return db.getCustomReport(startDate, endDate);\r\n    } catch (error) {\r\n      log.error('Get custom report error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('reports:salesSummary', async (event, { from, to }) => {\r\n    try {\r\n      return db.getSalesSummary(from, to);\r\n    } catch (error) {\r\n      log.error('Get sales summary error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('reports:billerDaily', async (event, { userId, date }) => {\r\n    try {\r\n      return db.getBillerReport(userId, date);\r\n    } catch (error) {\r\n      log.error('Get biller report error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('reports:allBillers', async (event, { date }) => {\r\n    try {\r\n      return db.getAllBillersReport(date);\r\n    } catch (error) {\r\n      log.error('Get all billers report error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // --- Advanced Reports IPC ---\r\n  \r\n  // Sales\r\n  ipcMain.handle('reports:itemWiseSales', async (event, { startDate, endDate }) => {\r\n    try { return db.getItemWiseSales(startDate, endDate); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  ipcMain.handle('reports:addonSales', async (event, { startDate, endDate }) => {\r\n    try { return db.getAddonSales(startDate, endDate); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  ipcMain.handle('reports:categoryWiseSales', async (event, { startDate, endDate }) => {\r\n    try { return db.getCategoryWiseSales(startDate, endDate); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  ipcMain.handle('reports:hourlySales', async (event, { date }) => {\r\n    try { return db.getHourlySales(date); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  ipcMain.handle('reports:cancelledOrders', async (event, { startDate, endDate }) => {\r\n    try { return db.getCancelledOrders(startDate, endDate); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  ipcMain.handle('reports:discounts', async (event, { startDate, endDate }) => {\r\n    try { return db.getDiscountReport(startDate, endDate); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  ipcMain.handle('reports:gst', async (event, { startDate, endDate }) => {\r\n    try { return db.getGSTReport(startDate, endDate); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  // Inventory\r\n  ipcMain.handle('reports:stockLevel', async () => {\r\n    try { return db.getStockLevelReport(); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  ipcMain.handle('reports:inventoryHistory', async (event, { startDate, endDate }) => {\r\n    try { return db.getInventoryHistory(startDate, endDate); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  // CRM\r\n  ipcMain.handle('reports:customerVisitFrequency', async (event, { startDate, endDate }) => {\r\n    try { return db.getCustomerVisitFrequency(startDate, endDate); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  ipcMain.handle('reports:customerOrderHistory', async (event, { phone }) => {\r\n    try { return db.getCustomerOrderHistory(phone); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  // Staff\r\n  ipcMain.handle('reports:staffPerformance', async (event, { startDate, endDate }) => {\r\n    try { return db.getStaffPerformance(startDate, endDate); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  // Payment\r\n  ipcMain.handle('reports:paymentMode', async (event, { startDate, endDate }) => {\r\n    try { return db.getPaymentModeReport(startDate, endDate); } catch (e) { log.error(e); return []; }\r\n  });\r\n\r\n  // ============ USER MANAGEMENT ============\r\n  ipcMain.handle('users:getAll', async () => {\r\n    try {\r\n      return db.getUsers();\r\n    } catch (error) {\r\n      log.error('Get users error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('users:save', async (event, { user }) => {\r\n    try {\r\n      return await authService.createOrUpdateUser(user);\r\n    } catch (error) {\r\n      log.error('Save user error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('users:delete', async (event, { id }) => {\r\n    try {\r\n      return db.deleteUser(id);\r\n    } catch (error) {\r\n      log.error('Delete user error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ PRINTING ============\r\n  ipcMain.handle('print:receipt', async (event, { order }) => {\r\n    try {\r\n      // Fetch settings to enrich receipt and get printer name\r\n      const settingsRows = db.execute('SELECT * FROM settings');\r\n      const settings = {};\r\n      settingsRows.forEach(row => { settings[row.key] = row.value; });\r\n      \r\n      const enrichedOrder = {\r\n        ...order,\r\n        restaurantName: settings.restaurant_name,\r\n        restaurantAddress: settings.restaurant_address,\r\n        restaurantPhone: settings.restaurant_phone,\r\n        gstNumber: settings.gst_number,\r\n        receiptFooter: settings.receipt_footer,\r\n        fssaiNumber: settings.bill_fssai_number,\r\n        showLogo: settings.bill_show_logo === 'true',\r\n        logoPath: settings.bill_logo_path,\r\n        showQR: settings.bill_show_qr === 'true',\r\n        qrUpiId: settings.bill_qr_upi_id,\r\n        showItemwiseTax: settings.bill_show_itemwise_tax === 'true',\r\n        showCustomerDetails: settings.bill_show_customer_details !== 'false',\r\n        paperWidth: settings.bill_paper_width || '80',\r\n        currencySymbol: settings.currency_symbol || ''\r\n      };\r\n      \r\n      return await printerService.printReceipt(enrichedOrder, settings.printer_bill);\r\n    } catch (error) {\r\n      log.error('Print receipt error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('print:kot', async (event, { order, items }) => {\r\n    try {\r\n      const printerName = db.getSetting('printer_kot');\r\n      return await printerService.printKOT(order, items, printerName);\r\n    } catch (error) {\r\n      log.error('Print KOT error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('print:testPrint', async (event, { printerName } = {}) => {\r\n    try {\r\n      // If no printer name provided, use default or fetch from settings?\r\n      // For test print, we might want to test a specific printer from settings page\r\n      return await printerService.testPrint(printerName);\r\n    } catch (error) {\r\n      log.error('Test print error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('print:getPrinters', async () => {\r\n    try {\r\n      if (mainWindow) {\r\n        return await mainWindow.webContents.getPrintersAsync();\r\n      }\r\n      return [];\r\n    } catch (error) {\r\n      log.error('Get printers error:', error);\r\n      return [];\r\n    }\r\n  });\r\n\r\n  // ============ PRINTER STATIONS & KOT ============\r\n  ipcMain.handle('printer:getStations', async () => {\r\n    try { return db.getPrinterStations(); }\r\n    catch (e) { log.error('Get printer stations error:', e); return []; }\r\n  });\r\n\r\n  ipcMain.handle('printer:saveStation', async (event, { station }) => {\r\n    try { return db.savePrinterStation(station); }\r\n    catch (e) { log.error('Save printer station error:', e); return { success: false, error: e.message }; }\r\n  });\r\n\r\n  ipcMain.handle('printer:deleteStation', async (event, { id }) => {\r\n    try { return db.deletePrinterStation(id); }\r\n    catch (e) { log.error('Delete printer station error:', e); return { success: false, error: e.message }; }\r\n  });\r\n\r\n  ipcMain.handle('printer:getCategoryMap', async () => {\r\n    try { return db.getCategoryStationMap(); }\r\n    catch (e) { log.error('Get category map error:', e); return []; }\r\n  });\r\n\r\n  ipcMain.handle('printer:saveCategoryMap', async (event, { categoryId, stationIds }) => {\r\n    try { return db.saveCategoryStationMap(categoryId, stationIds); }\r\n    catch (e) { log.error('Save category map error:', e); return { success: false, error: e.message }; }\r\n  });\r\n\r\n  ipcMain.handle('kot:log', async (event, data) => {\r\n    try { return db.logKOT(data); }\r\n    catch (e) { log.error('Log KOT error:', e); return { success: false, error: e.message }; }\r\n  });\r\n\r\n  ipcMain.handle('kot:getLogs', async (event, { orderId }) => {\r\n    try { return db.getKOTLogs(orderId); }\r\n    catch (e) { log.error('Get KOT logs error:', e); return []; }\r\n  });\r\n\r\n  // Station-wise KOT printing: routes items to correct kitchen station printers\r\n  ipcMain.handle('print:kotStation', async (event, { order, items, stationId, kotNumber }) => {\r\n    try {\r\n      // Get station printer name\r\n      const stations = db.getPrinterStations();\r\n      const station = stations.find(s => s.id === stationId);\r\n      const printerName = station ? station.printer_name : db.getSetting('printer_kot');\r\n      return await printerService.printKOT(order, items, printerName, kotNumber, station?.station_name);\r\n    } catch (e) {\r\n      log.error('Print KOT station error:', e);\r\n      return { success: false, error: e.message };\r\n    }\r\n  });\r\n\r\n  // ============ ROUTED KOT + BILL SIMULTANEOUS PRINTING ============\r\n  // Sends bill to bill printer AND routes KOTs to kitchen station printers concurrently\r\n  ipcMain.handle('print:kotRouted', async (event, { order, items, printBill = false }) => {\r\n    try {\r\n      const settingsRows = db.execute('SELECT * FROM settings');\r\n      const settings = {};\r\n      settingsRows.forEach(row => { settings[row.key] = row.value; });\r\n\r\n      // Enrich order with restaurant info (needed for receipt + mini-bill)\r\n      const enrichedOrder = {\r\n        ...order,\r\n        restaurantName: settings.restaurant_name,\r\n        restaurantAddress: settings.restaurant_address,\r\n        restaurantPhone: settings.restaurant_phone,\r\n        gstNumber: settings.gst_number,\r\n        receiptFooter: settings.receipt_footer,\r\n        fssaiNumber: settings.bill_fssai_number,\r\n        showLogo: settings.bill_show_logo === 'true',\r\n        logoPath: settings.bill_logo_path,\r\n        showQR: settings.bill_show_qr === 'true',\r\n        qrUpiId: settings.bill_qr_upi_id,\r\n        showItemwiseTax: settings.bill_show_itemwise_tax === 'true',\r\n        showCustomerDetails: settings.bill_show_customer_details !== 'false',\r\n        paperWidth: settings.bill_paper_width || '80',\r\n        currencySymbol: settings.currency_symbol || ''\r\n      };\r\n\r\n      // Get station mapping\r\n      const categoryMap = db.getCategoryStationMap();\r\n      const defaultKotPrinter = settings.printer_kot;\r\n      const attachBill = settings.kot_attach_bill !== 'false';\r\n\r\n      const printJobs = [];\r\n\r\n      // 1. Route KOTs to kitchen station printers\r\n      printJobs.push(\r\n        printerService.printStationKOTs(enrichedOrder, items, categoryMap, defaultKotPrinter, attachBill)\r\n          .catch(err => ({ success: false, error: err.message, type: 'kot' }))\r\n      );\r\n\r\n      // 2. Simultaneously print customer receipt if requested\r\n      if (printBill && settings.printer_bill) {\r\n        printJobs.push(\r\n          printerService.printReceipt(enrichedOrder, settings.printer_bill)\r\n            .catch(err => ({ success: false, error: err.message, type: 'receipt' }))\r\n        );\r\n      }\r\n\r\n      const results = await Promise.allSettled(printJobs);\r\n      const failures = results.filter(r => r.status === 'rejected' || (r.value && !r.value.success));\r\n\r\n      return {\r\n        success: true,\r\n        kotResult: results[0]?.value,\r\n        receiptResult: printBill ? results[1]?.value : null,\r\n        failures: failures.length\r\n      };\r\n    } catch (e) {\r\n      log.error('Print KOT routed error:', e);\r\n      return { success: false, error: e.message };\r\n    }\r\n  });\r\n\r\n  // Void KOT\r\n  ipcMain.handle('print:voidKOT', async (event, { order, items, reason, kotNumber }) => {\r\n    try {\r\n      const printerName = db.getSetting('printer_kot');\r\n      return await printerService.printVoidKOT(order, items, reason, printerName, kotNumber);\r\n    } catch (e) {\r\n      log.error('Print void KOT error:', e);\r\n      return { success: false, error: e.message };\r\n    }\r\n  });\r\n\r\n  // Reprint receipt (marks as REPRINT)\r\n  ipcMain.handle('print:reprint', async (event, { order, type }) => {\r\n    try {\r\n      const settingsRows = db.execute('SELECT * FROM settings');\r\n      const settings = {};\r\n      settingsRows.forEach(row => { settings[row.key] = row.value; });\r\n      \r\n      const enrichedOrder = {\r\n        ...order,\r\n        restaurantName: settings.restaurant_name,\r\n        restaurantAddress: settings.restaurant_address,\r\n        restaurantPhone: settings.restaurant_phone,\r\n        gstNumber: settings.gst_number,\r\n        receiptFooter: settings.receipt_footer,\r\n        fssaiNumber: settings.bill_fssai_number,\r\n        showLogo: settings.bill_show_logo === 'true',\r\n        logoPath: settings.bill_logo_path,\r\n        showQR: settings.bill_show_qr === 'true',\r\n        qrUpiId: settings.bill_qr_upi_id,\r\n        showItemwiseTax: settings.bill_show_itemwise_tax === 'true',\r\n        showCustomerDetails: settings.bill_show_customer_details === 'true',\r\n        paperWidth: settings.bill_paper_width || '80',\r\n        isReprint: true\r\n      };\r\n      \r\n      const printerName = type === 'kot' ? settings.printer_kot : settings.printer_bill;\r\n      \r\n      if (type === 'kot') {\r\n        return await printerService.printKOT(enrichedOrder, order.items || [], printerName, null, null, true);\r\n      } else {\r\n        return await printerService.printReceipt(enrichedOrder, printerName);\r\n      }\r\n    } catch (e) {\r\n      log.error('Reprint error:', e);\r\n      return { success: false, error: e.message };\r\n    }\r\n  });\r\n\r\n  // Logo file picker for bill customization\r\n  ipcMain.handle('print:selectLogo', async () => {\r\n    try {\r\n      const { dialog } = require('electron');\r\n      const result = await dialog.showOpenDialog(mainWindow, {\r\n        properties: ['openFile'],\r\n        filters: [{ name: 'Images', extensions: ['png', 'jpg', 'jpeg', 'bmp'] }]\r\n      });\r\n      if (result.canceled || !result.filePaths.length) return { cancelled: true };\r\n      \r\n      // Read file and convert to base64\r\n      const fs = require('fs');\r\n      const filePath = result.filePaths[0];\r\n      const buffer = fs.readFileSync(filePath);\r\n      const ext = require('path').extname(filePath).slice(1).toLowerCase();\r\n      const base64 = `data:image/${ext === 'jpg' ? 'jpeg' : ext};base64,${buffer.toString('base64')}`;\r\n      return { success: true, base64, filePath };\r\n    } catch (e) {\r\n      log.error('Select logo error:', e);\r\n      return { success: false, error: e.message };\r\n    }\r\n  });\r\n\r\n  // ============ SYNC STATUS ============\r\n  ipcMain.handle('sync:status', async () => {\r\n    return syncService.getStatus();\r\n  });\r\n\r\n  ipcMain.handle('sync:forceSync', async () => {\r\n    try {\r\n      return await syncService.forceSync();\r\n    } catch (error) {\r\n      log.error('Force sync error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  ipcMain.handle('sync:getPending', async () => {\r\n    try {\r\n      return db.getPendingSyncItems();\r\n    } catch (error) {\r\n      log.error('Get pending sync error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n\r\n  // ============ APP INFO ============\r\n  ipcMain.handle('app:getVersion', async () => {\r\n    return app.getVersion();\r\n  });\r\n\r\n  ipcMain.handle('app:checkForUpdates', async () => {\r\n    try {\r\n      return await autoUpdater.checkForUpdatesAndNotify();\r\n    } catch (error) {\r\n      log.error('Check updates error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  });\r\n}\r\n\r\n// App event handlers\r\napp.whenReady().then(async () => {\r\n  await initializeServices();\r\n  setupIpcHandlers();\r\n  createWindow();\r\n  createTray();\r\n\r\n  app.on('activate', () => {\r\n    if (BrowserWindow.getAllWindows().length === 0) {\r\n      createWindow();\r\n    }\r\n  });\r\n\r\n  // Check for updates (in production only)\r\n  if (!isDev) {\r\n    autoUpdater.checkForUpdatesAndNotify();\r\n  }\r\n});\r\n\r\napp.on('window-all-closed', () => {\r\n  // On macOS, keep app running in tray\r\n  if (process.platform !== 'darwin') {\r\n    // Keep running in background on Windows\r\n    // app.quit();\r\n  }\r\n});\r\n\r\napp.on('before-quit', () => {\r\n  // Cleanup\r\n  if (db) {\r\n    db.close();\r\n  }\r\n});\r\n\r\n// Auto-updater events\r\nautoUpdater.on('update-available', (info) => {\r\n  log.info('Update available:', info);\r\n  if (mainWindow) {\r\n    mainWindow.webContents.send('update:available', info);\r\n  }\r\n});\r\n\r\nautoUpdater.on('update-downloaded', (info) => {\r\n  log.info('Update downloaded:', info);\r\n  if (mainWindow) {\r\n    mainWindow.webContents.send('update:downloaded', info);\r\n  }\r\n});\r\n\r\nautoUpdater.on('error', (error) => {\r\n  log.error('Auto-updater error:', error);\r\n});\r\n\r\n// Handle uncaught exceptions\r\nprocess.on('uncaughtException', (error) => {\r\n  log.error('Uncaught exception:', error);\r\n});\r\n\r\nprocess.on('unhandledRejection', (reason, promise) => {\r\n  log.error('Unhandled rejection at:', promise, 'reason:', reason);\r\n});\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\electron\\preload.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\electron\\services\\auth.service.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'userId' is defined but never used.","line":88,"column":16,"nodeType":"Identifier","messageId":"unusedVar","endLine":88,"endColumn":22}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const bcrypt = require('bcryptjs');\r\nconst { v4: uuidv4 } = require('uuid');\r\nconst log = require('electron-log');\r\n\r\nclass AuthService {\r\n  constructor(db) {\r\n    this.db = db;\r\n    this.currentUser = null;\r\n    this.currentSession = null;\r\n  }\r\n\r\n  async login(username, password) {\r\n    try {\r\n      log.info(`Login attempt for user: ${username}`);\r\n      const user = this.db.getUserByUsername(username);\r\n      \r\n      if (!user) {\r\n        log.warn(`User ${username} not found`);\r\n        return { success: false, error: 'Invalid username or password' };\r\n      }\r\n      \r\n      log.info(`User found: ${user.username}, role: ${user.role}, active: ${user.is_active}`);\r\n      \r\n      if (!user.is_active) {\r\n        return { success: false, error: 'Account is deactivated' };\r\n      }\r\n      \r\n      log.info(`Comparing password with hash: ${user.password_hash?.substring(0, 20)}...`);\r\n      const isValid = await bcrypt.compare(password, user.password_hash);\r\n      log.info(`Password valid: ${isValid}`);\r\n      \r\n      if (!isValid) {\r\n        return { success: false, error: 'Invalid username or password' };\r\n      }\r\n      \r\n      // Create session\r\n      this.db.logSession(user.id, 'login');\r\n      \r\n      this.currentUser = {\r\n        id: user.id,\r\n        username: user.username,\r\n        role: user.role,\r\n        fullName: user.full_name,\r\n      };\r\n      \r\n      log.info(`User ${username} logged in successfully`);\r\n      \r\n      return {\r\n        success: true,\r\n        user: this.currentUser,\r\n      };\r\n    } catch (error) {\r\n      log.error('Login error:', error);\r\n      return { success: false, error: 'Login failed. Please try again.' };\r\n    }\r\n  }\r\n\r\n  async loginWithPin(pin) {\r\n    try {\r\n      const user = this.db.getUserByPin(pin);\r\n      \r\n      if (!user) {\r\n        return { success: false, error: 'Invalid PIN' };\r\n      }\r\n      \r\n      // Create session\r\n      this.db.logSession(user.id, 'login');\r\n      \r\n      this.currentUser = {\r\n        id: user.id,\r\n        username: user.username,\r\n        role: user.role,\r\n        fullName: user.full_name,\r\n      };\r\n      \r\n      log.info(`User ${user.username} logged in with PIN`);\r\n      \r\n      return {\r\n        success: true,\r\n        user: this.currentUser,\r\n      };\r\n    } catch (error) {\r\n      log.error('PIN login error:', error);\r\n      return { success: false, error: 'Login failed. Please try again.' };\r\n    }\r\n  }\r\n\r\n  async logout(userId) {\r\n    try {\r\n      if (this.currentUser) {\r\n        this.db.logSession(this.currentUser.id, 'logout');\r\n      }\r\n      \r\n      log.info(`User ${this.currentUser?.username} logged out`);\r\n      \r\n      this.currentUser = null;\r\n      \r\n      return { success: true };\r\n    } catch (error) {\r\n      log.error('Logout error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  getCurrentUser() {\r\n    return this.currentUser;\r\n  }\r\n\r\n  async createOrUpdateUser(userData) {\r\n    try {\r\n      // Hash password if provided\r\n      let passwordHash = null;\r\n      if (userData.password) {\r\n        passwordHash = await bcrypt.hash(userData.password, 10);\r\n      }\r\n      \r\n      if (userData.id) {\r\n        // Update existing user\r\n        const updates = {\r\n          username: userData.username,\r\n          full_name: userData.fullName,\r\n          role: userData.role,\r\n          is_active: userData.isActive ? 1 : 0,\r\n          pin_code: userData.pinCode || null,\r\n        };\r\n        \r\n        if (passwordHash) {\r\n          updates.password_hash = passwordHash;\r\n        }\r\n        \r\n        return this.db.updateUser(userData.id, updates);\r\n      } else {\r\n        // Create new user\r\n        if (!passwordHash) {\r\n          return { success: false, error: 'Password is required for new users' };\r\n        }\r\n        \r\n        const newUser = {\r\n          id: uuidv4(),\r\n          username: userData.username,\r\n          password_hash: passwordHash,\r\n          full_name: userData.fullName,\r\n          role: userData.role,\r\n          is_active: 1,\r\n          pin_code: userData.pinCode || null,\r\n        };\r\n        \r\n        return this.db.createUser(newUser);\r\n      }\r\n    } catch (error) {\r\n      log.error('Create/update user error:', error);\r\n      \r\n      if (error.message.includes('UNIQUE constraint failed')) {\r\n        return { success: false, error: 'Username already exists' };\r\n      }\r\n      \r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  getDeviceInfo() {\r\n    return JSON.stringify({\r\n      platform: process.platform,\r\n      arch: process.arch,\r\n      hostname: require('os').hostname(),\r\n    });\r\n  }\r\n}\r\n\r\nmodule.exports = AuthService;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\electron\\services\\dataImporter.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\electron\\services\\encryption.service.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\electron\\services\\printer.service.js","messages":[{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":228,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":228,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9417,9417],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":238,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":238,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[9825,9825],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":370,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":370,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[15540,15540],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":380,"column":21,"nodeType":"BlockStatement","messageId":"unexpected","endLine":380,"endColumn":23,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[15906,15906],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const log = require('electron-log');\r\nconst { BrowserWindow } = require('electron');\r\n\r\n/**\r\n * PrinterService  Comprehensive printing for receipts, KOTs, void KOTs, reprints.\r\n * Supports station-wise KOT routing, customizable bill format, print pool, and 58/80mm paper.\r\n */\r\nclass PrinterService {\r\n  constructor() {\r\n    this.printPool = []; // Reusable hidden windows for faster printing\r\n    this.maxPoolSize = 3;\r\n    this.activePrints = new Set();\r\n  }\r\n\r\n  //  Print Pool (High-Speed) \r\n  _getOrCreatePrintWindow() {\r\n    // Reuse from pool if available\r\n    if (this.printPool.length > 0) {\r\n      const win = this.printPool.pop();\r\n      if (!win.isDestroyed()) return win;\r\n    }\r\n    // Create new\r\n    const win = new BrowserWindow({\r\n      show: false,\r\n      width: 350,\r\n      height: 800,\r\n      webPreferences: { nodeIntegration: false, contextIsolation: true }\r\n    });\r\n    return win;\r\n  }\r\n\r\n  _returnToPool(win) {\r\n    if (!win || win.isDestroyed()) return;\r\n    if (this.printPool.length < this.maxPoolSize) {\r\n      this.printPool.push(win);\r\n    } else {\r\n      win.close();\r\n    }\r\n  }\r\n\r\n  //  Core Print Method \r\n  async printHtml(htmlContent, printerName, paperWidth = '80') {\r\n    return new Promise((resolve) => {\r\n      const printWindow = this._getOrCreatePrintWindow();\r\n      this.activePrints.add(printWindow);\r\n\r\n      const contentWidth = paperWidth === '58' ? 190 : 270;\r\n      const pageSize = paperWidth === '58' ? '58mm' : '72mm';\r\n\r\n      const html = `<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <meta charset=\"UTF-8\">\r\n    <style>\r\n      @page { margin: 0; size: ${pageSize} auto; }\r\n      body { \r\n        margin: 0; padding: 5px; \r\n        font-family: 'Consolas', 'Courier New', monospace;\r\n        font-size: 12px; color: #000; background: #fff;\r\n        width: ${contentWidth}px; line-height: 1.3;\r\n      }\r\n      *, *::before, *::after { box-sizing: border-box; }\r\n      h1,h2,h3,h4,h5,h6,p { margin: 0; padding: 0; }\r\n      table { width: 100%; border-collapse: collapse; }\r\n      th, td { text-align: left; padding: 1px 0; vertical-align: top; }\r\n      .text-right { text-align: right; }\r\n      .text-center { text-align: center; }\r\n      .bold { font-weight: bold; }\r\n      .divider { border-top: 1px dashed #000; margin: 5px 0; }\r\n      .double-divider { border-top: 2px solid #000; margin: 5px 0; }\r\n      .header { font-size: 16px; font-weight: bold; text-align: center; text-transform: uppercase; }\r\n      .subheader { font-size: 11px; text-align: center; }\r\n      .total-row { display: flex; justify-content: space-between; font-weight: bold; font-size: 14px; }\r\n      .reprint-badge { text-align: center; background: #000; color: #fff; font-weight: bold; padding: 3px; font-size: 13px; letter-spacing: 2px; margin-bottom: 4px; }\r\n      .void-badge { text-align: center; border: 3px solid #000; font-weight: bold; padding: 6px; font-size: 18px; letter-spacing: 3px; margin-bottom: 6px; }\r\n      .logo { text-align: center; margin-bottom: 4px; }\r\n      .logo img { max-width: ${contentWidth - 40}px; max-height: 80px; object-fit: contain; }\r\n      .qr-section { text-align: center; margin-top: 6px; }\r\n      .qr-section img { width: 120px; height: 120px; }\r\n      .item-row { margin-bottom: 3px; }\r\n      .item-detail { font-size: 10px; padding-left: 10px; color: #333; }\r\n      .tax-detail { font-size: 10px; color: #555; }\r\n      .kot-header { font-size: 18px; font-weight: bold; text-align: center; letter-spacing: 1px; }\r\n      .station-name { text-align: center; background: #000; color: #fff; font-weight: bold; padding: 4px; font-size: 14px; margin-bottom: 4px; }\r\n      .kot-item { font-size: 14px; font-weight: bold; margin-bottom: 6px; padding-bottom: 4px; border-bottom: 1px dotted #aaa; }\r\n      .kot-note { font-size: 12px; background: #eee; font-weight: bold; padding: 3px 6px; margin-top: 2px; }\r\n    </style>\r\n  </head>\r\n  <body>${htmlContent}</body>\r\n</html>`;\r\n\r\n      printWindow.loadURL('data:text/html;charset=utf-8,' + encodeURIComponent(html));\r\n\r\n      printWindow.webContents.on('did-finish-load', () => {\r\n        const options = {\r\n          silent: true,\r\n          printBackground: false,\r\n          color: false,\r\n          margin: { marginType: 'custom', top: 0, bottom: 0, left: 0, right: 0 }\r\n        };\r\n        if (printerName) options.deviceName = printerName;\r\n\r\n        printWindow.webContents.print(options, (success, errorType) => {\r\n          if (!success) {\r\n            log.error('Print failed:', errorType);\r\n            resolve({ success: false, error: errorType });\r\n          } else {\r\n            resolve({ success: true });\r\n          }\r\n          \r\n          setTimeout(() => {\r\n            this.activePrints.delete(printWindow);\r\n            this._returnToPool(printWindow);\r\n          }, 1500);\r\n        });\r\n      });\r\n    });\r\n  }\r\n\r\n  //  Get System Printers \r\n  async getPrinters() {\r\n    try {\r\n      const win = new BrowserWindow({ show: false, width: 100, height: 100 });\r\n      const printers = await win.webContents.getPrintersAsync();\r\n      win.close();\r\n      return printers;\r\n    } catch (error) {\r\n      log.error('Get printers error:', error);\r\n      return [];\r\n    }\r\n  }\r\n\r\n  //  Print Receipt \r\n  async printReceipt(order, printerName = null) {\r\n    try {\r\n      const html = this.generateReceiptHtml(order);\r\n      return await this.printHtml(html, printerName, order.paperWidth || '80');\r\n    } catch (error) {\r\n      log.error('Print receipt error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  //  Print KOT \r\n  async printKOT(order, items, printerName = null, kotNumber = null, stationName = null, isReprint = false) {\r\n    try {\r\n      const html = this.generateKOTHtml(order, items, kotNumber, stationName, isReprint);\r\n      return await this.printHtml(html, printerName, '80');\r\n    } catch (error) {\r\n      log.error('Print KOT error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  //  Print Void KOT \r\n  async printVoidKOT(order, items, reason, printerName = null, kotNumber = null) {\r\n    try {\r\n      const html = this.generateVoidKOTHtml(order, items, reason, kotNumber);\r\n      return await this.printHtml(html, printerName, '80');\r\n    } catch (error) {\r\n      log.error('Print Void KOT error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  //  Test Print \r\n  async testPrint(printerName = null) {\r\n    try {\r\n      const html = `\r\n        <div style=\"text-align: center; padding: 10px;\">\r\n          <div style=\"font-size: 20px; font-weight: bold; margin-bottom: 8px;\"> TEST PRINT</div>\r\n          <div class=\"divider\"></div>\r\n          <p style=\"font-size: 13px; margin: 8px 0;\">Printer is working correctly!</p>\r\n          <p style=\"font-size: 11px; color: #666;\">${new Date().toLocaleString()}</p>\r\n          <div class=\"divider\"></div>\r\n          <p style=\"font-size: 10px; color: #888; margin-top: 6px;\">ZapBill POS System</p>\r\n        </div>\r\n      `;\r\n      return await this.printHtml(html, printerName);\r\n    } catch (error) {\r\n      log.error('Test print error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  // \r\n  //  HTML GENERATORS\r\n  // \r\n\r\n  //  Receipt HTML \r\n  generateReceiptHtml(order) {\r\n    const items = order.items || [];\r\n    const cs = order.currencySymbol || '';\r\n\r\n    // REPRINT badge\r\n    const reprintBadge = order.isReprint\r\n      ? '<div class=\"reprint-badge\">*** REPRINT ***</div>' : '';\r\n\r\n    // Logo\r\n    const logoHtml = order.showLogo && order.logoPath\r\n      ? `<div class=\"logo\"><img src=\"${order.logoPath}\" alt=\"Logo\"></div>` : '';\r\n\r\n    // Restaurant header\r\n    const restaurantName = order.restaurantName || 'RESTAURANT';\r\n    const address = order.restaurantAddress ? `<div class=\"subheader\">${order.restaurantAddress}</div>` : '';\r\n    const phone = order.restaurantPhone ? `<div class=\"subheader\">Tel: ${order.restaurantPhone}</div>` : '';\r\n    const gst = order.gstNumber ? `<div class=\"subheader\">GSTIN: ${order.gstNumber}</div>` : '';\r\n    const fssai = order.fssaiNumber ? `<div class=\"subheader\">FSSAI: ${order.fssaiNumber}</div>` : '';\r\n\r\n    // Customer info\r\n    let customerHtml = '';\r\n    if (order.showCustomerDetails !== false) {\r\n      const parts = [];\r\n      if (order.customer_name) parts.push(`Cust: ${order.customer_name}`);\r\n      if (order.customer_phone) parts.push(`Ph: ${order.customer_phone}`);\r\n      if (parts.length > 0) {\r\n        customerHtml = `<div style=\"font-size: 11px; margin-bottom: 2px;\">${parts.join(' | ')}</div>`;\r\n      }\r\n    }\r\n\r\n    // Items with optional item-wise tax\r\n    const itemsHtml = items.map(item => {\r\n      let details = '';\r\n      if (item.variant) {\r\n        try {\r\n          const v = typeof item.variant === 'string' ? JSON.parse(item.variant) : item.variant;\r\n          if (v && v.name) details += `<div class=\"item-detail\"> ${v.name}</div>`;\r\n        } catch (_) {}\r\n      }\r\n      if (item.addons) {\r\n        try {\r\n          const a = typeof item.addons === 'string' ? JSON.parse(item.addons) : item.addons;\r\n          if (Array.isArray(a)) {\r\n            a.forEach(addon => {\r\n              details += `<div class=\"item-detail\">+ ${addon.name}${addon.price ? ` (${cs}${Number(addon.price).toFixed(2)})` : ''}</div>`;\r\n            });\r\n          }\r\n        } catch (_) {}\r\n      }\r\n\r\n      let taxInfo = '';\r\n      if (order.showItemwiseTax && item.tax_rate) {\r\n        const taxAmt = ((item.item_total || 0) * (item.tax_rate / 100)).toFixed(2);\r\n        taxInfo = `<div class=\"tax-detail\">Tax ${item.tax_rate}%: ${cs}${taxAmt}</div>`;\r\n      }\r\n\r\n      return `\r\n        <div class=\"item-row\">\r\n          <div style=\"display:flex; justify-content:space-between;\">\r\n            <span style=\"flex:1;\">${item.item_name} <span style=\"font-size:10px;\">x${item.quantity}</span></span>\r\n            <span class=\"bold\">${cs}${(item.item_total || 0).toFixed(2)}</span>\r\n          </div>\r\n          ${details}${taxInfo}\r\n        </div>`;\r\n    }).join('');\r\n\r\n    // Totals\r\n    const subtotalRow = `<div style=\"display:flex; justify-content:space-between; margin-bottom:2px;\"><span>Subtotal</span><span>${cs}${(order.subtotal || 0).toFixed(2)}</span></div>`;\r\n    \r\n    const taxRow = (order.tax_amount > 0) ? `\r\n      <div style=\"display:flex; justify-content:space-between; margin-bottom:2px;\">\r\n        <span>Tax</span><span>${cs}${order.tax_amount.toFixed(2)}</span>\r\n      </div>` : '';\r\n\r\n    const deliveryRow = (order.delivery_charge > 0) ? `\r\n      <div style=\"display:flex; justify-content:space-between; margin-bottom:2px;\">\r\n        <span>Delivery Charge</span><span>${cs}${order.delivery_charge.toFixed(2)}</span>\r\n      </div>` : '';\r\n\r\n    const containerRow = (order.container_charge > 0) ? `\r\n      <div style=\"display:flex; justify-content:space-between; margin-bottom:2px;\">\r\n        <span>Container Charge</span><span>${cs}${order.container_charge.toFixed(2)}</span>\r\n      </div>` : '';\r\n\r\n    const discountRow = (order.discount_amount > 0) ? `\r\n      <div style=\"display:flex; justify-content:space-between; margin-bottom:2px;\">\r\n        <span>Discount</span><span>-${cs}${order.discount_amount.toFixed(2)}</span>\r\n      </div>` : '';\r\n\r\n    // Payment info\r\n    const paymentMethod = order.payment_method ? order.payment_method.toUpperCase() : '';\r\n    const paymentRow = paymentMethod ? `\r\n      <div style=\"font-size:11px; text-align:center; margin-top:2px;\">\r\n        Paid via: <strong>${paymentMethod}</strong>\r\n      </div>` : '';\r\n\r\n    // QR Code (simple SVG-based UPI QR if enabled)\r\n    let qrHtml = '';\r\n    if (order.showQR && order.qrUpiId) {\r\n      // Using a text-based UPI link display since we can't generate real QR in this context\r\n      qrHtml = `\r\n        <div class=\"qr-section\">\r\n          <div class=\"divider\"></div>\r\n          <div style=\"font-size:11px; font-weight:bold; margin-bottom:4px;\">Scan to Pay via UPI</div>\r\n          <div style=\"border:2px solid #000; padding:8px; display:inline-block; font-size:11px;\">\r\n            <div style=\"font-weight:bold;\">UPI: ${order.qrUpiId}</div>\r\n            <div style=\"font-size:10px; color:#555;\">Amount: ${cs}${(order.total_amount || 0).toFixed(2)}</div>\r\n          </div>\r\n        </div>`;\r\n    }\r\n\r\n    return `\r\n      ${reprintBadge}\r\n      ${logoHtml}\r\n      <div class=\"header\">${restaurantName}</div>\r\n      ${address}${phone}${gst}${fssai}\r\n      \r\n      <div class=\"divider\"></div>\r\n      \r\n      <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\r\n        <span>Bill #: <strong>${order.order_number || ''}</strong></span>\r\n        <span>${new Date(order.created_at || Date.now()).toLocaleDateString()}</span>\r\n      </div>\r\n      <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\r\n        <span>${new Date(order.created_at || Date.now()).toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>\r\n        <span>${(order.order_type || '').replace('_', ' ').toUpperCase()}</span>\r\n      </div>\r\n      ${order.table_number ? `<div style=\"font-size:11px;\">Table: <strong>${order.table_number}</strong></div>` : ''}\r\n      ${customerHtml}\r\n      \r\n      <div class=\"double-divider\"></div>\r\n      \r\n      <table>\r\n        <tr style=\"font-weight:bold; font-size:11px; border-bottom:1px solid #000;\">\r\n          <td>Item</td>\r\n          <td class=\"text-right\">Qty</td>\r\n          <td class=\"text-right\">Amt</td>\r\n        </tr>\r\n      </table>\r\n      ${itemsHtml}\r\n      \r\n      <div class=\"divider\"></div>\r\n      \r\n      ${subtotalRow}${taxRow}${deliveryRow}${containerRow}${discountRow}\r\n      \r\n      <div class=\"double-divider\"></div>\r\n      \r\n      <div class=\"total-row\">\r\n        <span>TOTAL</span>\r\n        <span style=\"font-size:16px;\">${cs}${(order.total_amount || 0).toFixed(2)}</span>\r\n      </div>\r\n      \r\n      ${paymentRow}\r\n      ${qrHtml}\r\n      \r\n      <div class=\"divider\" style=\"margin-top:6px;\"></div>\r\n      <div class=\"subheader\" style=\"font-weight:500;\">${order.receiptFooter || 'Thank You!'}</div>\r\n      <div class=\"subheader\" style=\"font-size:9px; margin-top:3px; color:#888;\">Powered by ZapBill POS</div>\r\n    `;\r\n  }\r\n\r\n  //  KOT HTML \r\n  generateKOTHtml(order, items, kotNumber = null, stationName = null, isReprint = false) {\r\n    const reprintBadge = isReprint\r\n      ? '<div class=\"reprint-badge\">*** REPRINT KOT ***</div>' : '';\r\n\r\n    const stationBadge = stationName\r\n      ? `<div class=\"station-name\"> ${stationName.toUpperCase()}</div>` : '';\r\n\r\n    const kotNumberLine = kotNumber\r\n      ? `<div style=\"font-size:16px; font-weight:bold; text-align:center;\">KOT #${kotNumber}</div>` : '';\r\n\r\n    // Items\r\n    const itemsHtml = (items || []).map(item => {\r\n      let details = '';\r\n      if (item.variant) {\r\n        try {\r\n          const v = typeof item.variant === 'string' ? JSON.parse(item.variant) : item.variant;\r\n          if (v && v.name) details += `<div style=\"font-size:12px; padding-left:12px;\"> ${v.name}</div>`;\r\n        } catch (_) {}\r\n      }\r\n      if (item.addons) {\r\n        try {\r\n          const a = typeof item.addons === 'string' ? JSON.parse(item.addons) : item.addons;\r\n          if (Array.isArray(a)) {\r\n            a.forEach(addon => {\r\n              details += `<div style=\"font-size:12px; padding-left:12px;\">+ ${addon.name}</div>`;\r\n            });\r\n          }\r\n        } catch (_) {}\r\n      }\r\n      if (item.special_instructions) {\r\n        details += `<div class=\"kot-note\"> ${item.special_instructions}</div>`;\r\n      }\r\n\r\n      return `\r\n        <div class=\"kot-item\">\r\n          <div style=\"font-size:15px;\">${item.quantity}  ${item.item_name}</div>\r\n          ${details}\r\n        </div>`;\r\n    }).join('');\r\n\r\n    // Urgency banner\r\n    const urgency = order.urgency || 'normal';\r\n    const urgencyBadge = (urgency === 'urgent' || urgency === 'critical')\r\n      ? `<div style=\"text-align:center; background:#000; color:#fff; font-weight:bold; padding:5px; font-size:14px; letter-spacing:2px; margin-bottom:4px;\"> ${urgency.toUpperCase()} </div>`\r\n      : '';\r\n\r\n    return `\r\n      ${urgencyBadge}\r\n      ${reprintBadge}\r\n      ${stationBadge}\r\n      \r\n      <div class=\"kot-header\">KITCHEN ORDER TICKET</div>\r\n      ${kotNumberLine}\r\n      <div style=\"text-align:center; font-size:13px; font-weight:bold;\">${(order.order_type || '').replace('_', ' ').toUpperCase()}</div>\r\n      \r\n      <div class=\"divider\"></div>\r\n      \r\n      <div style=\"display:flex; justify-content:space-between; font-size:13px;\">\r\n        <span>Order #: <strong>${order.order_number || 'N/A'}</strong></span>\r\n        <span>${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>\r\n      </div>\r\n      ${order.table_number ? `<div style=\"font-size:18px; font-weight:bold; text-align:center; margin:5px 0; background:#eee; padding:4px;\">TABLE ${order.table_number}</div>` : ''}\r\n      \r\n      <div class=\"double-divider\"></div>\r\n      \r\n      ${itemsHtml}\r\n      \r\n      ${order.chef_instructions ? `\r\n        <div style=\"margin-top:6px; padding:5px; border:2px solid #000; font-weight:bold; font-size:13px;\">\r\n           CHEF: ${order.chef_instructions}\r\n        </div>\r\n      ` : ''}\r\n      \r\n      <div class=\"divider\" style=\"margin-top:10px;\"></div>\r\n      <div class=\"text-center\" style=\"font-size:10px;\">--- Kitchen Copy ---</div>\r\n    `;\r\n  }\r\n\r\n  //  Void KOT HTML \r\n  generateVoidKOTHtml(order, items, reason, kotNumber = null) {\r\n    const itemsHtml = (items || []).map(item => `\r\n      <div style=\"font-size:14px; font-weight:bold; margin-bottom:4px; text-decoration:line-through;\">\r\n        ${item.quantity || 1}  ${item.item_name || item.name || 'Item'}\r\n      </div>\r\n    `).join('');\r\n\r\n    return `\r\n      <div class=\"void-badge\"> VOID KOT </div>\r\n      \r\n      ${kotNumber ? `<div style=\"font-size:14px; font-weight:bold; text-align:center;\">KOT #${kotNumber}</div>` : ''}\r\n      \r\n      <div class=\"divider\"></div>\r\n      \r\n      <div style=\"display:flex; justify-content:space-between; font-size:12px;\">\r\n        <span>Order #: <strong>${order.order_number || 'N/A'}</strong></span>\r\n        <span>${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>\r\n      </div>\r\n      ${order.table_number ? `<div style=\"font-size:16px; font-weight:bold; text-align:center; margin:4px 0;\">TABLE ${order.table_number}</div>` : ''}\r\n      \r\n      <div class=\"divider\"></div>\r\n      \r\n      <div style=\"font-weight:bold; margin-bottom:6px; font-size:13px;\">CANCELLED ITEMS:</div>\r\n      ${itemsHtml}\r\n      \r\n      ${reason ? `\r\n        <div class=\"divider\"></div>\r\n        <div style=\"font-weight:bold; font-size:12px;\">Reason: ${reason}</div>\r\n      ` : ''}\r\n      \r\n      <div class=\"divider\" style=\"margin-top:10px;\"></div>\r\n      <div class=\"text-center\" style=\"font-size:10px;\">--- Void Copy ---</div>\r\n    `;\r\n  }\r\n\r\n  //  Mini-Bill HTML (condensed bill summary for KOT attachment) \r\n  generateMiniBillHtml(order, allItems) {\r\n    const currencySymbol = order.currencySymbol || '';\r\n    \r\n    const itemsHtml = (allItems || []).map(item => {\r\n      const price = parseFloat(item.price || 0) * parseInt(item.quantity || 1);\r\n      return `\r\n        <div style=\"display:flex; justify-content:space-between; font-size:11px; padding:1px 0;\">\r\n          <span>${item.quantity}  ${item.item_name}</span>\r\n          <span>${currencySymbol}${price.toFixed(2)}</span>\r\n        </div>`;\r\n    }).join('');\r\n\r\n    return `\r\n      <div style=\"margin-bottom:8px; padding-bottom:6px;\">\r\n        <div style=\"text-align:center; font-size:13px; font-weight:bold; margin-bottom:4px;\">\r\n          ${order.restaurantName || 'BILL SUMMARY'}\r\n        </div>\r\n        <div style=\"display:flex; justify-content:space-between; font-size:11px; margin-bottom:2px;\">\r\n          <span>Order #: <strong>${order.order_number || 'N/A'}</strong></span>\r\n          <span>${new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'})}</span>\r\n        </div>\r\n        ${order.table_number ? `<div style=\"font-size:11px; margin-bottom:2px;\">Table: <strong>${order.table_number}</strong></div>` : ''}\r\n        ${order.customer_name ? `<div style=\"font-size:11px; margin-bottom:2px;\">Customer: ${order.customer_name}</div>` : ''}\r\n        \r\n        <div style=\"border-top:1px solid #000; margin:4px 0;\"></div>\r\n        ${itemsHtml}\r\n        <div style=\"border-top:1px solid #000; margin:4px 0;\"></div>\r\n        \r\n        ${order.subtotal ? `\r\n        <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\r\n          <span>Subtotal</span><span>${currencySymbol}${parseFloat(order.subtotal).toFixed(2)}</span>\r\n        </div>` : ''}\r\n        ${order.tax_amount ? `\r\n        <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\r\n          <span>Tax</span><span>${currencySymbol}${parseFloat(order.tax_amount).toFixed(2)}</span>\r\n        </div>` : ''}\r\n        ${order.discount_amount ? `\r\n        <div style=\"display:flex; justify-content:space-between; font-size:11px;\">\r\n          <span>Discount</span><span>-${currencySymbol}${parseFloat(order.discount_amount).toFixed(2)}</span>\r\n        </div>` : ''}\r\n        <div style=\"display:flex; justify-content:space-between; font-size:13px; font-weight:bold; border-top:1px solid #000; padding-top:3px; margin-top:3px;\">\r\n          <span>TOTAL</span><span>${currencySymbol}${parseFloat(order.total || order.grand_total || 0).toFixed(2)}</span>\r\n        </div>\r\n        \r\n        <div style=\"text-align:center; font-size:9px; margin-top:6px; color:#555; margin-bottom:4px;\">--- Bill Copy (Kitchen Ref) ---</div>\r\n        \r\n        <div style=\"text-align:center; font-size:10px; font-weight:bold; letter-spacing:1px; margin-bottom:4px;\">\r\n           - - - - - - TEAR HERE - - - - - - \r\n        </div>\r\n        <div style=\"border-bottom:2px dashed #000; margin-bottom:8px;\"></div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  //  Print KOT with attached mini-bill \r\n  async printKOTWithBill(order, kotItems, allItems, printerName, stationName = null) {\r\n    try {\r\n      const kotHtml = this.generateKOTHtml(order, kotItems, null, stationName);\r\n      const miniBillHtml = this.generateMiniBillHtml(order, allItems);\r\n      const combinedHtml = miniBillHtml + kotHtml;\r\n      return await this.printHtml(combinedHtml, printerName, '80');\r\n    } catch (error) {\r\n      log.error('Print KOT with bill error:', error);\r\n      return { success: false, error: error.message };\r\n    }\r\n  }\r\n\r\n  //  Station-Wise KOT Routing \r\n  /**\r\n   * Routes items to correct station printers based on category-station mapping.\r\n   * @param {Object} order - The order object (enriched with restaurant info for mini-bill)\r\n   * @param {Array} items - Array of order items with category_id\r\n   * @param {Array} stationMap - Array of {category_id, station_id, station_name, printer_name}\r\n   * @param {string} defaultPrinterName - Fallback KOT printer for unmapped categories\r\n   * @param {boolean} attachBill - Whether to attach a mini-bill to each KOT\r\n   * @returns {Promise} - Results of all station prints\r\n   */\r\n  async printStationKOTs(order, items, stationMap, defaultPrinterName, attachBill = false) {\r\n    // Group items by station\r\n    const stationGroups = {};\r\n    const unmappedItems = [];\r\n\r\n    for (const item of items) {\r\n      const mapping = stationMap.find(m => m.category_id === item.category_id);\r\n      if (mapping) {\r\n        const key = mapping.station_id;\r\n        if (!stationGroups[key]) {\r\n          stationGroups[key] = {\r\n            stationId: mapping.station_id,\r\n            stationName: mapping.station_name,\r\n            printerName: mapping.printer_name,\r\n            items: []\r\n          };\r\n        }\r\n        stationGroups[key].items.push(item);\r\n      } else {\r\n        unmappedItems.push(item);\r\n      }\r\n    }\r\n\r\n    // Print to each station concurrently\r\n    const printJobs = [];\r\n\r\n    for (const [, group] of Object.entries(stationGroups)) {\r\n      if (attachBill) {\r\n        printJobs.push(\r\n          this.printKOTWithBill(order, group.items, items, group.printerName, group.stationName)\r\n            .catch(err => ({ success: false, error: err.message, station: group.stationName }))\r\n        );\r\n      } else {\r\n        printJobs.push(\r\n          this.printKOT(order, group.items, group.printerName, null, group.stationName)\r\n            .catch(err => ({ success: false, error: err.message, station: group.stationName }))\r\n        );\r\n      }\r\n    }\r\n\r\n    // Print unmapped items to default KOT printer\r\n    if (unmappedItems.length > 0) {\r\n      if (attachBill) {\r\n        printJobs.push(\r\n          this.printKOTWithBill(order, unmappedItems, items, defaultPrinterName)\r\n            .catch(err => ({ success: false, error: err.message, station: 'Default' }))\r\n        );\r\n      } else {\r\n        printJobs.push(\r\n          this.printKOT(order, unmappedItems, defaultPrinterName)\r\n            .catch(err => ({ success: false, error: err.message, station: 'Default' }))\r\n        );\r\n      }\r\n    }\r\n\r\n    const results = await Promise.allSettled(printJobs);\r\n    const failures = results.filter(r => r.status === 'rejected' || (r.value && !r.value.success));\r\n    \r\n    if (failures.length > 0) {\r\n      log.warn('Some station KOTs failed:', failures);\r\n    }\r\n\r\n    return { success: true, stationCount: Object.keys(stationGroups).length + (unmappedItems.length > 0 ? 1 : 0) };\r\n  }\r\n\r\n  //  Cleanup \r\n  destroy() {\r\n    for (const win of this.printPool) {\r\n      if (!win.isDestroyed()) win.close();\r\n    }\r\n    this.printPool = [];\r\n    for (const win of this.activePrints) {\r\n      if (!win.isDestroyed()) win.close();\r\n    }\r\n    this.activePrints.clear();\r\n  }\r\n}\r\n\r\nmodule.exports = PrinterService;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\electron\\services\\sync.service.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\App.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { HashRouter as Router, Routes, Route, Navigate } from 'react-router-dom';\r\nimport { useAuthStore } from './stores/authStore';\r\n\r\n// Pages\r\nimport LoginPage from './pages/LoginPage';\r\nimport DashboardPage from './pages/DashboardPage';\r\nimport POSPage from './pages/POSPage';\r\nimport MenuPage from './pages/MenuPage';\r\nimport OrdersPage from './pages/OrdersPage';\r\nimport InventoryPage from './pages/InventoryPage';\r\nimport KOTPage from './pages/KOTPage';\r\nimport ReportsPage from './pages/ReportsPage';\r\n// import UsersPage from './pages/UsersPage';\r\nimport UsersPage from './pages/UsersPage';\r\nimport SettingsPage from './pages/SettingsPage';\r\nimport PrintersPage from './pages/PrintersPage';\r\nimport ExpensesPage from './pages/ExpensesPage';\r\nimport DiscountsPage from './pages/DiscountsPage';\r\n\r\n// Components\r\nimport Layout from './components/common/Layout';\r\n\r\n// Protected Route wrapper\r\nconst ProtectedRoute = ({ children, allowedRoles = [] }) => {\r\n  const { user, isAuthenticated } = useAuthStore();\r\n  \r\n  if (!isAuthenticated) {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n  \r\n  // Debug role check - Case insensitive\r\n  const normalizeRole = (r) => r?.toLowerCase() || '';\r\n  const userRole = normalizeRole(user?.role);\r\n  const normalizedAllowed = allowedRoles.map(normalizeRole);\r\n\r\n  if (allowedRoles.length > 0 && !normalizedAllowed.includes(userRole)) {\r\n    // console.log('Access denied. User role:', user?.role, 'Allowed:', allowedRoles);\r\n    return <Navigate to=\"/dashboard\" replace />;\r\n  }\r\n  \r\n  return children;\r\n};\r\n\r\nimport { ShiftProvider, useShift } from './context/ShiftContext';\r\nimport ShiftModal from './components/common/ShiftModal';\r\nimport DayOpeningModal from './components/common/DayOpeningModal';\r\n\r\n// Component to handle shift logic and modal\r\nconst ShiftManager = ({ children }) => {\r\n  const { showStartModal, setShowStartModal, showDayModal, setShowDayModal } = useShift();\r\n  \r\n  return (\r\n    <>\r\n      {children}\r\n      <DayOpeningModal \r\n        isOpen={showDayModal} \r\n        onClose={() => setShowDayModal(false)}\r\n      />\r\n      <ShiftModal \r\n        isOpen={showStartModal} \r\n        type=\"start\" \r\n        onClose={() => setShowStartModal(false)} // Optional: force start?\r\n      />\r\n    </>\r\n  );\r\n};\r\n\r\nfunction App() {\r\n  return (\r\n    <ShiftProvider>\r\n      <Router>\r\n        <ShiftManager>\r\n          <Routes>\r\n            {/* Public routes */}\r\n            <Route path=\"/login\" element={<LoginPage />} />\r\n            \r\n            {/* Protected routes */}\r\n            <Route path=\"/\" element={\r\n              <ProtectedRoute>\r\n                <Layout />\r\n              </ProtectedRoute>\r\n            }>\r\n              <Route index element={<Navigate to=\"/dashboard\" replace />} />\r\n              <Route path=\"dashboard\" element={<DashboardPage />} />\r\n              <Route path=\"pos\" element={<POSPage />} />\r\n              <Route path=\"menu\" element={\r\n                <ProtectedRoute allowedRoles={['admin']}>\r\n                  <MenuPage />\r\n                </ProtectedRoute>\r\n              } />\r\n              <Route path=\"inventory\" element={\r\n                <ProtectedRoute allowedRoles={['admin', 'biller', 'cashier']}>\r\n                  <InventoryPage />\r\n                </ProtectedRoute>\r\n              } />\r\n              <Route path=\"orders\" element={<OrdersPage />} />\r\n              <Route path=\"kot\" element={<KOTPage />} />\r\n              <Route path=\"reports\" element={\r\n                <ProtectedRoute allowedRoles={['admin']}>\r\n                  <ReportsPage />\r\n                </ProtectedRoute>\r\n              } />\r\n              <Route path=\"users\" element={\r\n                <ProtectedRoute allowedRoles={['admin']}>\r\n                  <UsersPage />\r\n                </ProtectedRoute>\r\n              } />\r\n              <Route path=\"printers\" element={\r\n                <ProtectedRoute allowedRoles={['admin', 'biller', 'cashier']}>\r\n                  <PrintersPage />\r\n                </ProtectedRoute>\r\n              } />\r\n              <Route path=\"settings\" element={\r\n                <ProtectedRoute allowedRoles={['admin']}>\r\n                  <SettingsPage />\r\n                </ProtectedRoute>\r\n              } />\r\n              <Route path=\"discounts\" element={\r\n                <ProtectedRoute allowedRoles={['admin']}>\r\n                  <DiscountsPage />\r\n                </ProtectedRoute>\r\n              } />\r\n              <Route path=\"expenses\" element={\r\n                <ProtectedRoute allowedRoles={['admin', 'biller', 'cashier']}>\r\n                  <ExpensesPage />\r\n                </ProtectedRoute>\r\n              } />\r\n            </Route>\r\n            \r\n            {/* Catch all */}\r\n            <Route path=\"*\" element={<Navigate to=\"/login\" replace />} />\r\n          </Routes>\r\n        </ShiftManager>\r\n      </Router>\r\n    </ShiftProvider>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\components\\common\\DayOpeningModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":8,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useShift } from '../../context/ShiftContext';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { Sun, AlertCircle, Calendar, ArrowRight, Wallet } from 'lucide-react';\r\n\r\nconst DayOpeningModal = ({ isOpen, onClose }) => {\r\n  const { openDay, error } = useShift();\r\n  const { user } = useAuthStore();\r\n  const [openingBalance, setOpeningBalance] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [animate, setAnimate] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setTimeout(() => setAnimate(true), 50);\r\n    } else {\r\n      setAnimate(false);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    \r\n    const result = await openDay(openingBalance || 0);\r\n\r\n    setLoading(false);\r\n    if (result.success) {\r\n      setOpeningBalance('');\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const today = new Date();\r\n  const dayName = today.toLocaleDateString('en-IN', { weekday: 'long' });\r\n  const dateStr = today.toLocaleDateString('en-IN', {\r\n    day: '2-digit',\r\n    month: 'long',\r\n    year: 'numeric'\r\n  });\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" style={{ \r\n      backdropFilter: 'blur(8px)',\r\n      backgroundColor: 'rgba(255, 255, 255, 0.3)',\r\n      transition: 'opacity 0.3s ease',\r\n      opacity: animate ? 1 : 0\r\n    }}>\r\n      <div className=\"modal-content\" style={{ \r\n        maxWidth: '460px', \r\n        padding: 0, \r\n        overflow: 'hidden',\r\n        border: 'none',\r\n        boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)',\r\n        transform: animate ? 'translateY(0) scale(1)' : 'translateY(20px) scale(0.95)',\r\n        transition: 'all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)'\r\n      }}>\r\n        {/* Premium Header with Gradient */}\r\n        <div style={{\r\n          background: 'linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%)',\r\n          padding: 'var(--spacing-8) var(--spacing-6)',\r\n          textAlign: 'center',\r\n          position: 'relative',\r\n          color: 'white'\r\n        }}>\r\n          {/* Decorative Elements */}\r\n          <div style={{\r\n            position: 'absolute',\r\n            top: '-20px',\r\n            right: '-20px',\r\n            width: '120px',\r\n            height: '120px',\r\n            background: 'rgba(255, 255, 255, 0.1)',\r\n            borderRadius: '50%',\r\n          }} />\r\n          \r\n          <div style={{\r\n            width: '80px',\r\n            height: '80px',\r\n            borderRadius: '24px',\r\n            background: 'rgba(255, 255, 255, 0.2)',\r\n            backdropFilter: 'blur(4px)',\r\n            border: '1px solid rgba(255, 255, 255, 0.3)',\r\n            color: 'white',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            margin: '0 auto var(--spacing-6)',\r\n            boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)',\r\n            animation: 'pulse 2s infinite ease-in-out'\r\n          }}>\r\n            <Sun size={40} strokeWidth={1.5} />\r\n          </div>\r\n\r\n          <h2 style={{ \r\n            fontSize: '1.75rem', \r\n            fontWeight: '800', \r\n            marginBottom: 'var(--spacing-2)',\r\n            letterSpacing: '-0.025em'\r\n          }}>\r\n            Welcome Back!\r\n          </h2>\r\n          \r\n          <div style={{ \r\n            display: 'inline-flex', \r\n            alignItems: 'center', \r\n            gap: '8px', \r\n            padding: '6px 16px',\r\n            background: 'rgba(255, 255, 255, 0.15)',\r\n            borderRadius: '100px',\r\n            fontSize: '0.875rem',\r\n            fontWeight: '600'\r\n          }}>\r\n            <Calendar size={14} />\r\n            <span>{dayName}, {dateStr}</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <div style={{ padding: 'var(--spacing-8) var(--spacing-6)' }}>\r\n          <form onSubmit={handleSubmit}>\r\n            <div style={{ marginBottom: 'var(--spacing-8)' }}>\r\n              <h3 style={{ \r\n                fontSize: '1.125rem', \r\n                fontWeight: '700', \r\n                color: 'var(--gray-900)',\r\n                marginBottom: 'var(--spacing-2)'\r\n              }}>\r\n                Start New Business Day\r\n              </h3>\r\n              <p style={{ color: 'var(--gray-500)', fontSize: '0.925rem', lineHeight: '1.5' }}>\r\n                Initializing the system for a fresh day of operations. Please confirm the opening outlet balance.\r\n              </p>\r\n            </div>\r\n\r\n            {error && (\r\n              <div style={{\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: 'var(--spacing-3)',\r\n                padding: 'var(--spacing-4)',\r\n                background: '#fef2f2',\r\n                border: '1px solid #fee2e2',\r\n                color: '#b91c1c',\r\n                borderRadius: '16px',\r\n                marginBottom: 'var(--spacing-6)',\r\n                fontSize: '0.875rem',\r\n              }}>\r\n                <AlertCircle size={18} />\r\n                <span style={{ fontWeight: '500' }}>{error}</span>\r\n              </div>\r\n            )}\r\n\r\n            <div style={{\r\n              background: 'var(--gray-50)',\r\n              padding: 'var(--spacing-5)',\r\n              borderRadius: '20px',\r\n              border: '1px solid var(--gray-200)',\r\n              marginBottom: 'var(--spacing-8)'\r\n            }}>\r\n              <label style={{ \r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: '8px',\r\n                fontWeight: '700',\r\n                fontSize: '0.875rem',\r\n                color: 'var(--gray-700)',\r\n                marginBottom: 'var(--spacing-3)'\r\n              }}>\r\n                <Wallet size={16} />\r\n                Outlet Opening Balance\r\n              </label>\r\n              \r\n              <div style={{ position: 'relative' }}>\r\n                <div style={{ \r\n                  position: 'absolute', \r\n                  left: '16px', \r\n                  top: '50%', \r\n                  transform: 'translateY(-50%)',\r\n                  color: 'var(--gray-900)',\r\n                  fontWeight: '700',\r\n                  fontSize: '1.25rem'\r\n                }}></div>\r\n                <input\r\n                  type=\"number\"\r\n                  value={openingBalance}\r\n                  onChange={(e) => setOpeningBalance(e.target.value)}\r\n                  placeholder=\"0.00\"\r\n                  style={{ \r\n                    width: '100%',\r\n                    height: '60px', \r\n                    padding: '0 16px 0 44px',\r\n                    fontSize: '1.5rem',\r\n                    fontWeight: '800',\r\n                    background: 'white',\r\n                    border: '2px solid var(--gray-200)',\r\n                    borderRadius: '16px',\r\n                    outline: 'none',\r\n                    transition: 'all 0.2s ease',\r\n                    color: 'var(--gray-900)'\r\n                  }}\r\n                  onFocus={(e) => {\r\n                    e.target.style.borderColor = '#2563eb';\r\n                    e.target.style.boxShadow = '0 0 0 4px rgba(37, 99, 235, 0.1)';\r\n                  }}\r\n                  onBlur={(e) => {\r\n                    e.target.style.borderColor = 'var(--gray-200)';\r\n                    e.target.style.boxShadow = 'none';\r\n                  }}\r\n                  min=\"0\"\r\n                  step=\"0.01\"\r\n                  autoFocus\r\n                />\r\n              </div>\r\n              <p style={{ fontSize: '0.75rem', color: 'var(--gray-400)', marginTop: '8px', paddingLeft: '4px' }}>\r\n                * Leaves blank or enter 0 if no starting cash is present.\r\n              </p>\r\n            </div>\r\n\r\n            <button \r\n              type=\"submit\" \r\n              className=\"btn btn-primary\"\r\n              style={{ \r\n                width: '100%', \r\n                height: '60px', \r\n                fontSize: '1.125rem', \r\n                fontWeight: '700',\r\n                borderRadius: '18px',\r\n                background: 'linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%)',\r\n                border: 'none',\r\n                boxShadow: '0 10px 20px -5px rgba(37, 99, 235, 0.4)',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                gap: '12px',\r\n                transition: 'all 0.3s ease',\r\n                cursor: loading ? 'not-allowed' : 'pointer',\r\n                opacity: loading ? 0.8 : 1\r\n              }}\r\n              onMouseEnter={(e) => {\r\n                if (!loading) {\r\n                  e.currentTarget.style.transform = 'translateY(-2px)';\r\n                  e.currentTarget.style.boxShadow = '0 15px 25px -5px rgba(37, 99, 235, 0.5)';\r\n                }\r\n              }}\r\n              onMouseLeave={(e) => {\r\n                if (!loading) {\r\n                  e.currentTarget.style.transform = 'translateY(0)';\r\n                  e.currentTarget.style.boxShadow = '0 10px 20px -5px rgba(37, 99, 235, 0.4)';\r\n                }\r\n              }}\r\n              disabled={loading}\r\n            >\r\n              {loading ? (\r\n                <>Opening...</>\r\n              ) : (\r\n                <>\r\n                  Start Business Day\r\n                  <ArrowRight size={20} />\r\n                </>\r\n              )}\r\n            </button>\r\n          </form>\r\n        </div>\r\n      </div>\r\n      \r\n      <style>{`\r\n        @keyframes pulse {\r\n          0% { transform: scale(1); opacity: 1; }\r\n          50% { transform: scale(1.05); opacity: 0.9; }\r\n          100% { transform: scale(1); opacity: 1; }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DayOpeningModal;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\components\\common\\Layout.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":1,"column":17,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { Outlet, useNavigate } from 'react-router-dom';\r\nimport Sidebar from '../layout/Sidebar';\r\nimport TopNav from '../layout/TopNav';\r\n\r\nconst Layout = () => {\r\n  const navigate = useNavigate();\r\n\r\n  const handleNewOrder = () => {\r\n    navigate('/pos');\r\n  };\r\n\r\n  return (\r\n    <div className=\"app-layout\">\r\n      <Sidebar />\r\n      <div className=\"main-wrapper\">\r\n        <TopNav onNewOrder={handleNewOrder} />\r\n        <main className=\"main-content\">\r\n          <Outlet />\r\n        </main>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Layout;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\components\\common\\ShiftModal.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useShift } from '../../context/ShiftContext'; // Adjust path if needed\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { DollarSign, Clock, AlertCircle, ArrowRight, Wallet } from 'lucide-react';\r\n\r\nconst ShiftModal = ({ isOpen, type, onClose }) => {\r\n  const { startShift, endShift, error } = useShift();\r\n  const { user } = useAuthStore();\r\n  const [amount, setAmount] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [animate, setAnimate] = useState(false);\r\n  const [expectedCash, setExpectedCash] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (isOpen) {\r\n      setTimeout(() => setAnimate(true), 50);\r\n      \r\n      const fetchExpectedCash = async () => {\r\n        try {\r\n          const today = new Date().toLocaleDateString('en-CA');\r\n          const todayReport = await window.electronAPI.invoke('reports:daily', { date: today });\r\n          if (todayReport && todayReport.sales) {\r\n            const cashSales = todayReport.sales.cash_amount !== undefined ? todayReport.sales.cash_amount : \r\n                             (todayReport.sales.cash_sales !== undefined ? todayReport.sales.cash_sales : 0);\r\n            const cash = (todayReport.sales.opening_balance || 0) + cashSales - (todayReport.sales.total_expenses || 0);\r\n            setExpectedCash(cash);\r\n          }\r\n        } catch (err) {\r\n          console.error('Failed to fetch expected cash:', err);\r\n        }\r\n      };\r\n      \r\n      fetchExpectedCash();\r\n    } else {\r\n      setAnimate(false);\r\n      setExpectedCash(null);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setLoading(true);\r\n    \r\n    let result;\r\n    if (type === 'start') {\r\n      result = await startShift(amount || 0);\r\n    } else {\r\n      result = await endShift(amount || 0);\r\n    }\r\n\r\n    setLoading(false);\r\n    if (result.success) {\r\n      setAmount('');\r\n      onClose();\r\n    }\r\n  };\r\n\r\n  const isStart = type === 'start';\r\n  const themeColor = isStart ? '#10b981' : '#f59e0b';\r\n  const themeGradient = isStart ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)' : 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)';\r\n  const shadowColor = isStart ? 'rgba(16, 185, 129, 0.4)' : 'rgba(245, 158, 11, 0.4)';\r\n\r\n  const today = new Date();\r\n  const timeStr = today.toLocaleTimeString('en-IN', {\r\n    hour: '2-digit',\r\n    minute: '2-digit',\r\n    hour12: true\r\n  });\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" style={{ \r\n      backdropFilter: 'blur(8px)',\r\n      backgroundColor: 'rgba(255, 255, 255, 0.3)',\r\n      transition: 'opacity 0.3s ease',\r\n      opacity: animate ? 1 : 0\r\n    }}>\r\n      <div className=\"modal-content\" style={{ \r\n        maxWidth: '460px', \r\n        padding: 0, \r\n        overflow: 'hidden',\r\n        border: 'none',\r\n        boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)',\r\n        transform: animate ? 'translateY(0) scale(1)' : 'translateY(20px) scale(0.95)',\r\n        transition: 'all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1)'\r\n      }}>\r\n        {/* Premium Header with Gradient */}\r\n        <div style={{\r\n          background: themeGradient,\r\n          padding: 'var(--spacing-8) var(--spacing-6)',\r\n          textAlign: 'center',\r\n          position: 'relative',\r\n          color: 'white'\r\n        }}>\r\n          {/* Decorative Elements */}\r\n          <div style={{\r\n            position: 'absolute',\r\n            top: '-20px',\r\n            right: '-20px',\r\n            width: '120px',\r\n            height: '120px',\r\n            background: 'rgba(255, 255, 255, 0.1)',\r\n            borderRadius: '50%',\r\n          }} />\r\n          \r\n          <div style={{\r\n            width: '80px',\r\n            height: '80px',\r\n            borderRadius: '24px',\r\n            background: 'rgba(255, 255, 255, 0.2)',\r\n            backdropFilter: 'blur(4px)',\r\n            border: '1px solid rgba(255, 255, 255, 0.3)',\r\n            color: 'white',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            margin: '0 auto var(--spacing-6)',\r\n            boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)',\r\n            animation: 'pulse 2s infinite ease-in-out'\r\n          }}>\r\n            {isStart ? <Clock size={40} strokeWidth={1.5} /> : <DollarSign size={40} strokeWidth={1.5} />}\r\n          </div>\r\n\r\n          <h2 style={{ \r\n            fontSize: '1.75rem', \r\n            fontWeight: '800', \r\n            marginBottom: 'var(--spacing-2)',\r\n            letterSpacing: '-0.025em'\r\n          }}>\r\n            {isStart ? 'Start Shift' : 'End Shift'}\r\n          </h2>\r\n          \r\n          <div style={{ \r\n            display: 'inline-flex', \r\n            alignItems: 'center', \r\n            gap: '8px', \r\n            padding: '6px 16px',\r\n            background: 'rgba(255, 255, 255, 0.15)',\r\n            borderRadius: '100px',\r\n            fontSize: '0.875rem',\r\n            fontWeight: '600'\r\n          }}>\r\n            <Clock size={14} />\r\n            <span>{timeStr}</span>\r\n          </div>\r\n        </div>\r\n        \r\n        <div style={{ padding: 'var(--spacing-8) var(--spacing-6)' }}>\r\n          <form onSubmit={handleSubmit}>\r\n            <div style={{ marginBottom: 'var(--spacing-8)' }}>\r\n              <h3 style={{ \r\n                fontSize: '1.125rem', \r\n                fontWeight: '700', \r\n                color: 'var(--gray-900)',\r\n                marginBottom: 'var(--spacing-2)'\r\n              }}>\r\n                Hello, {user?.full_name || user?.username || 'User'}!\r\n              </h3>\r\n              <p style={{ color: 'var(--gray-500)', fontSize: '0.925rem', lineHeight: '1.5' }}>\r\n                {isStart \r\n                  ? 'Please enter the starting cash amount in your drawer to begin your shift.'\r\n                  : 'Please enter the final cash amount in your drawer to close your shift.'}\r\n              </p>\r\n\r\n              {expectedCash !== null && (\r\n                <div style={{ marginTop: '16px', padding: '12px 16px', background: 'rgba(16, 185, 129, 0.1)', color: '#059669', borderRadius: '12px', border: '1px solid rgba(16, 185, 129, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\r\n                  <span style={{ fontWeight: '600', fontSize: '14px', display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                     <Wallet size={16} /> Expected Cash in Drawer:\r\n                  </span>\r\n                  <span style={{ fontWeight: '800', fontSize: '16px' }}>{expectedCash.toLocaleString()}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {error && (\r\n              <div style={{\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: 'var(--spacing-3)',\r\n                padding: 'var(--spacing-4)',\r\n                background: '#fef2f2',\r\n                border: '1px solid #fee2e2',\r\n                color: '#b91c1c',\r\n                borderRadius: '16px',\r\n                marginBottom: 'var(--spacing-6)',\r\n                fontSize: '0.875rem',\r\n              }}>\r\n                <AlertCircle size={18} />\r\n                <span style={{ fontWeight: '500' }}>{error}</span>\r\n              </div>\r\n            )}\r\n\r\n            <div style={{\r\n              background: 'var(--gray-50)',\r\n              padding: 'var(--spacing-5)',\r\n              borderRadius: '20px',\r\n              border: '1px solid var(--gray-200)',\r\n              marginBottom: 'var(--spacing-8)'\r\n            }}>\r\n              <label style={{ \r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: '8px',\r\n                fontWeight: '700',\r\n                fontSize: '0.875rem',\r\n                color: 'var(--gray-700)',\r\n                marginBottom: 'var(--spacing-3)'\r\n              }}>\r\n                <Wallet size={16} />\r\n                {isStart ? 'Starting Cash Amount' : 'Closing Cash Amount'}\r\n              </label>\r\n              \r\n              <div style={{ position: 'relative' }}>\r\n                <div style={{ \r\n                  position: 'absolute', \r\n                  left: '16px', \r\n                  top: '50%', \r\n                  transform: 'translateY(-50%)',\r\n                  color: 'var(--gray-900)',\r\n                  fontWeight: '700',\r\n                  fontSize: '1.25rem'\r\n                }}></div>\r\n                <input\r\n                  type=\"number\"\r\n                  value={amount}\r\n                  onChange={(e) => setAmount(e.target.value)}\r\n                  placeholder=\"0.00\"\r\n                  style={{ \r\n                    width: '100%',\r\n                    height: '60px', \r\n                    padding: '0 16px 0 44px',\r\n                    fontSize: '1.5rem',\r\n                    fontWeight: '800',\r\n                    background: 'white',\r\n                    border: '2px solid var(--gray-200)',\r\n                    borderRadius: '16px',\r\n                    outline: 'none',\r\n                    transition: 'all 0.2s ease',\r\n                    color: 'var(--gray-900)'\r\n                  }}\r\n                  onFocus={(e) => {\r\n                    e.target.style.borderColor = themeColor;\r\n                    e.target.style.boxShadow = `0 0 0 4px ${shadowColor.replace('0.4', '0.1')}`;\r\n                  }}\r\n                  onBlur={(e) => {\r\n                    e.target.style.borderColor = 'var(--gray-200)';\r\n                    e.target.style.boxShadow = 'none';\r\n                  }}\r\n                  min=\"0\"\r\n                  step=\"0.01\"\r\n                  autoFocus\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{ display: 'flex', gap: '12px' }}>\r\n              <button \r\n                type=\"button\"\r\n                className=\"btn btn-ghost\"\r\n                onClick={onClose}\r\n                style={{ \r\n                  flex: 1, \r\n                  height: '60px', \r\n                  borderRadius: '18px',\r\n                  fontSize: '1.125rem',\r\n                  fontWeight: '700'\r\n                }}\r\n                disabled={loading}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button \r\n                type=\"submit\" \r\n                style={{ \r\n                  flex: 2, \r\n                  height: '60px', \r\n                  fontSize: '1.125rem', \r\n                  fontWeight: '700',\r\n                  borderRadius: '18px',\r\n                  background: themeGradient,\r\n                  color: 'white',\r\n                  border: 'none',\r\n                  boxShadow: `0 10px 20px -5px ${shadowColor}`,\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  gap: '12px',\r\n                  transition: 'all 0.3s ease',\r\n                  cursor: loading ? 'not-allowed' : 'pointer',\r\n                  opacity: loading ? 0.8 : 1\r\n                }}\r\n                onMouseEnter={(e) => {\r\n                  if (!loading) {\r\n                    e.currentTarget.style.transform = 'translateY(-2px)';\r\n                    e.currentTarget.style.boxShadow = `0 15px 25px -5px ${shadowColor.replace('0.4', '0.5')}`;\r\n                  }\r\n                }}\r\n                onMouseLeave={(e) => {\r\n                  if (!loading) {\r\n                    e.currentTarget.style.transform = 'translateY(0)';\r\n                    e.currentTarget.style.boxShadow = `0 10px 20px -5px ${shadowColor}`;\r\n                  }\r\n                }}\r\n                disabled={loading}\r\n              >\r\n                {loading ? (\r\n                  <>Processing...</>\r\n                ) : (\r\n                  <>\r\n                    {isStart ? 'Start Shift' : 'End Shift'}\r\n                    <ArrowRight size={20} />\r\n                  </>\r\n                )}\r\n              </button>\r\n            </div>\r\n          </form>\r\n        </div>\r\n      </div>\r\n      \r\n      <style>{`\r\n        @keyframes pulse {\r\n          0% { transform: scale(1); opacity: 1; }\r\n          50% { transform: scale(1.05); opacity: 0.9; }\r\n          100% { transform: scale(1); opacity: 1; }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ShiftModal;\r\n\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\components\\layout\\MainSidebar.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'endShift' is assigned a value but never used.","line":27,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":27,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'isActive' is assigned a value but never used.","line":140,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":140,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { NavLink, useNavigate, useLocation } from 'react-router-dom';\r\nimport {\r\n  LayoutDashboard,\r\n  ShoppingCart,\r\n  UtensilsCrossed,\r\n  ClipboardList,\r\n  Package,\r\n  BarChart3,\r\n  Users,\r\n  Settings,\r\n  ChefHat,\r\n  X,\r\n  LogOut,\r\n  RefreshCw,\r\n  Wallet,\r\n  Printer,\r\n  Tag\r\n} from 'lucide-react';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { useShift } from '../../context/ShiftContext';\r\nimport ShiftModal from '../common/ShiftModal';\r\nimport logoImg from '../../assets/logo.png';\r\n\r\nconst MainSidebar = ({ isOpen, onClose }) => {\r\n  const { user, logout } = useAuthStore();\r\n  const { endShift } = useShift();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const [showEndShiftModal, setShowEndShiftModal] = React.useState(false);\r\n  const [expandedMenu, setExpandedMenu] = React.useState(null);\r\n\r\n  const [activeOrdersCount, setActiveOrdersCount] = React.useState(0);\r\n\r\n  React.useEffect(() => {\r\n    const fetchCount = async () => {\r\n      try {\r\n        const count = await window.electronAPI.invoke('order:getActiveCount');\r\n        setActiveOrdersCount(count);\r\n      } catch (err) {\r\n        console.error('Failed to fetch active order count', err);\r\n      }\r\n    };\r\n\r\n    if (isOpen) {\r\n      fetchCount();\r\n      // Poll only when open\r\n      const interval = setInterval(fetchCount, 5000);\r\n      return () => clearInterval(interval);\r\n    }\r\n  }, [isOpen]);\r\n\r\n  const isAdmin = user?.role === 'admin';\r\n\r\n  // All nav items with role restrictions\r\n  const allNavItems = [\r\n    { path: '/dashboard', icon: LayoutDashboard, label: 'Dashboard', adminOnly: false },\r\n    { path: '/pos', icon: ShoppingCart, label: 'POS / Billing', adminOnly: false },\r\n    { path: '/orders', icon: ClipboardList, label: 'Orders', badge: activeOrdersCount > 0 ? activeOrdersCount : null, adminOnly: false },\r\n    { path: '/menu', icon: UtensilsCrossed, label: 'Menu', adminOnly: true },\r\n    { path: '/discounts', icon: Tag, label: 'Discounts', adminOnly: true },\r\n    { path: '/kot', icon: ChefHat, label: 'Kitchen (KOT)', adminOnly: false },\r\n    { path: '/inventory', icon: Package, label: 'Inventory', adminOnly: false },\r\n    { \r\n      path: '/reports', \r\n      icon: BarChart3, \r\n      label: 'Reports', \r\n      adminOnly: true,\r\n      children: [\r\n        { path: '/reports?category=sales', label: 'Sales Reports' },\r\n        { path: '/reports?category=inventory', label: 'Inventory Reports' },\r\n        { path: '/reports?category=crm', label: 'CRM Reports' },\r\n        { path: '/reports?category=staff', label: 'Staff Reports' },\r\n        { path: '/reports?category=payment', label: 'Payment Reports' },\r\n      ]\r\n    },\r\n    { path: '/expenses', icon: Wallet, label: 'Expenses', adminOnly: false },\r\n    { path: '/users', icon: Users, label: 'Users', adminOnly: true },\r\n    { path: '/printers', icon: Printer, label: 'Printers', adminOnly: false },\r\n    { path: '/settings', icon: Settings, label: 'Settings', adminOnly: true },\r\n  ];\r\n\r\n  // Filter based on role\r\n  const navItems = isAdmin \r\n    ? allNavItems \r\n    : allNavItems.filter(item => !item.adminOnly);\r\n\r\n  const handleSwitchUser = async () => {\r\n    await logout();\r\n    onClose();\r\n    navigate('/login');\r\n  };\r\n\r\n  const handleLogout = async () => {\r\n    await logout();\r\n    onClose();\r\n    navigate('/login');\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* Overlay */}\r\n      <div \r\n        className={`pos-drawer-overlay ${isOpen ? 'active' : ''}`} \r\n        onClick={onClose}\r\n        style={{ zIndex: 1000 }}\r\n      ></div>\r\n\r\n      {/* Sidebar Drawer */}\r\n      <aside \r\n        className={`pos-main-sidebar ${isOpen ? 'active' : ''}`}\r\n        style={{\r\n            position: 'fixed',\r\n            top: 0,\r\n            left: isOpen ? 0 : '-280px',\r\n            width: '280px',\r\n            height: '100vh',\r\n            background: '#1A2327',\r\n            color: 'white',\r\n            zIndex: 1001,\r\n            transition: 'left 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            boxShadow: '2px 0 10px rgba(0,0,0,0.3)'\r\n        }}\r\n      >\r\n        {/* Header */}\r\n        <div style={{ padding: '20px', borderBottom: '1px solid #37474F', position: 'relative', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n            <img src={logoImg} alt=\"ZapBill Logo\" style={{ maxWidth: '100px', height: 'auto', objectFit: 'contain', filter: 'brightness(0) invert(1)' }} />\r\n            <button onClick={onClose} style={{ position: 'absolute', right: '12px', top: '12px', background: 'rgba(255,255,255,0.05)', borderRadius: '50%', padding: '6px', border: 'none', color: '#90A4AE', cursor: 'pointer', display: 'flex', transition: 'background 0.2s' }} onMouseOver={(e) => e.target.style.background = 'rgba(255,255,255,0.1)'} onMouseOut={(e) => e.target.style.background = 'rgba(255,255,255,0.05)'}>\r\n                <X size={20} />\r\n            </button>\r\n        </div>\r\n\r\n        {/* Nav Items */}\r\n        <nav className=\"sidebar-nav\" style={{ flex: 1, padding: '16px 0', overflowY: 'auto' }}>\r\n            {navItems.map((item) => {\r\n              if (item.children) {\r\n                const isExpanded = expandedMenu === item.path;\r\n                const isActive = location.pathname.startsWith(item.path);\r\n                return (\r\n                  <div key={item.path}>\r\n                  <NavLink\r\n                    to={item.path}\r\n                    onClick={() => setExpandedMenu(isExpanded ? null : item.path)}\r\n                    style={({ isActive }) => ({\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      justifyContent: 'space-between',\r\n                      padding: '14px 24px',\r\n                      color: (isActive || isExpanded) ? 'white' : '#B0BEC5',\r\n                      background: (isActive || isExpanded) ? 'rgba(0, 150, 255, 0.1)' : 'transparent',\r\n                      cursor: 'pointer',\r\n                      transition: 'all 0.2s',\r\n                      borderLeft: isActive ? '4px solid #0096FF' : '4px solid transparent',\r\n                      textDecoration: 'none'\r\n                    })}\r\n                  >\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>\r\n                      <item.icon size={24} />\r\n                      <span style={{ fontSize: '15px', fontWeight: 600 }}>{item.label}</span>\r\n                    </div>\r\n                    <span style={{ fontSize: '10px', transform: isExpanded ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.2s', opacity: 0.5 }}></span>\r\n                  </NavLink>\r\n                    {isExpanded && (\r\n                      <div style={{ background: 'rgba(0,0,0,0.2)', paddingBottom: '4px' }}>\r\n                        {item.children.map((child) => (\r\n                          <NavLink\r\n                            key={child.path}\r\n                            to={child.path}\r\n                            onClick={onClose}\r\n                            style={({ isActive }) => ({\r\n                              display: 'flex',\r\n                              alignItems: 'center',\r\n                              padding: '12px 24px 12px 64px',\r\n                              color: isActive ? 'white' : '#B0BEC5',\r\n                              textDecoration: 'none',\r\n                              fontSize: '14px',\r\n                              background: isActive ? 'rgba(0, 150, 255, 0.15)' : 'transparent',\r\n                              transition: 'all 0.2s'\r\n                            })}\r\n                          >\r\n                            <span>{child.label}</span>\r\n                          </NavLink>\r\n                        ))}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                );\r\n              }\r\n\r\n              return (\r\n                <NavLink\r\n                    key={item.path}\r\n                    to={item.path}\r\n                    onClick={onClose}\r\n                    style={({ isActive }) => ({\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        gap: '16px',\r\n                        padding: '14px 24px',\r\n                        color: isActive ? 'white' : '#B0BEC5',\r\n                        textDecoration: 'none',\r\n                        background: isActive ? 'rgba(0, 150, 255, 0.15)' : 'transparent',\r\n                        borderLeft: isActive ? '4px solid #0096FF' : '4px solid transparent',\r\n                        transition: 'all 0.2s'\r\n                    })}\r\n                >\r\n                    <item.icon size={24} />\r\n                    <span style={{ fontSize: '15px', fontWeight: 600 }}>{item.label}</span>\r\n                    {item.badge && (\r\n                    <span style={{ marginLeft: 'auto', background: '#0096FF', color: 'white', padding: '2px 8px', borderRadius: '10px', fontSize: '11px', fontWeight: 'bold' }}>\r\n                        {item.badge}\r\n                    </span>\r\n                    )}\r\n                </NavLink>\r\n              );\r\n            })}\r\n\r\n            {/* End Day Button */}\r\n            <button\r\n              onClick={() => {\r\n                setShowEndShiftModal(true);\r\n              }}\r\n              style={{ \r\n                width: '100%', \r\n                border: 'none', \r\n                background: 'none', \r\n                cursor: 'pointer',\r\n                marginTop: '12px',\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: '16px',\r\n                padding: '14px 24px',\r\n                color: '#B0BEC5',\r\n                transition: 'all 0.2s'\r\n              }}\r\n              onMouseOver={e => e.currentTarget.style.color = 'white'}\r\n              onMouseOut={e => e.currentTarget.style.color = '#B0BEC5'}\r\n            >\r\n              <LogOut size={24} />\r\n              <span style={{ fontSize: '15px', fontWeight: 600 }}>End Day</span>\r\n            </button>\r\n        </nav>\r\n\r\n        <ShiftModal \r\n          isOpen={showEndShiftModal} \r\n          type=\"end\" \r\n          onClose={() => setShowEndShiftModal(false)} \r\n        />\r\n\r\n        {/* User Footer */}\r\n        <div style={{ padding: '16px', borderTop: '1px solid #37474F', background: '#263238' }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '12px' }}>\r\n                <div style={{ width: '40px', height: '40px', borderRadius: '50%', background: '#455A64', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 'bold' }}>\r\n                    {user?.fullName?.charAt(0).toUpperCase() || user?.username?.charAt(0).toUpperCase() || 'U'}\r\n                </div>\r\n                <div style={{ flex: 1 }}>\r\n                    <div style={{ fontWeight: '600' }}>{user?.fullName || user?.username || 'User'}</div>\r\n                    <div style={{ fontSize: '12px', color: '#B0BEC5', textTransform: 'capitalize' }}>{user?.role || 'Staff'}</div>\r\n                </div>\r\n            </div>\r\n            <div style={{ display: 'flex', gap: '8px' }}>\r\n                <button \r\n                    onClick={handleSwitchUser}\r\n                    style={{ flex: 1, padding: '10px', background: '#37474F', border: 'none', borderRadius: '4px', color: '#CFD8DC', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '6px', fontSize: '13px', transition: 'background 0.2s' }}\r\n                    onMouseOver={e => e.currentTarget.style.background = '#455A64'}\r\n                    onMouseOut={e => e.currentTarget.style.background = '#37474F'}\r\n                    title=\"Switch to another biller\"\r\n                >\r\n                    <RefreshCw size={14} /> Switch User\r\n                </button>\r\n                <button \r\n                    onClick={handleLogout}\r\n                    style={{ padding: '10px 14px', background: '#0096FF', border: 'none', borderRadius: '4px', color: 'white', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '6px', fontSize: '13px', transition: 'background 0.2s' }}\r\n                    onMouseOver={e => e.currentTarget.style.background = '#0284c7'}\r\n                    onMouseOut={e => e.currentTarget.style.background = '#0096FF'}\r\n                    title=\"Logout\"\r\n                >\r\n                    <LogOut size={14} />\r\n                </button>\r\n            </div>\r\n        </div>\r\n      </aside>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default MainSidebar;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\components\\layout\\Sidebar.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'endShift' is assigned a value but never used.","line":26,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":26,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'setActiveOrdersCount' is assigned a value but never used.","line":35,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":35,"endColumn":49},{"ruleId":"no-unused-vars","severity":1,"message":"'isActive' is assigned a value but never used.","line":106,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":106,"endColumn":28}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React from 'react';\r\nimport { NavLink, useNavigate, useLocation } from 'react-router-dom';\r\nimport {\r\n  LayoutDashboard,\r\n  ShoppingCart,\r\n  UtensilsCrossed,\r\n  ClipboardList,\r\n  Package,\r\n  BarChart3,\r\n  Users,\r\n  Settings,\r\n  Printer,\r\n  LogOut,\r\n  ChefHat,\r\n  RefreshCw,\r\n  Wallet,\r\n  Tag\r\n} from 'lucide-react';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { useShift } from '../../context/ShiftContext';\r\nimport ShiftModal from '../common/ShiftModal';\r\nimport logoImg from '../../assets/logo.png';\r\n\r\nconst Sidebar = () => {\r\n  const { user, logout } = useAuthStore();\r\n  const { endShift } = useShift();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const [showEndShiftModal, setShowEndShiftModal] = React.useState(false);\r\n  // Changed from hover to toggle\r\n  const [expandedMenu, setExpandedMenu] = React.useState(null);\r\n\r\n  const isAdmin = user?.role === 'admin';\r\n\r\n  const [activeOrdersCount, setActiveOrdersCount] = React.useState(0);\r\n\r\n  // ... useEffect for order count\r\n\r\n  const allNavItems = [\r\n    { path: '/dashboard', icon: LayoutDashboard, label: 'Dashboard', adminOnly: false },\r\n    { path: '/pos', icon: ShoppingCart, label: 'POS / Billing', adminOnly: false },\r\n    { path: '/orders', icon: ClipboardList, label: 'Orders', badge: activeOrdersCount > 0 ? activeOrdersCount : null, adminOnly: false },\r\n    { path: '/menu', icon: UtensilsCrossed, label: 'Menu', adminOnly: true },\r\n    { path: '/kot', icon: ChefHat, label: 'Kitchen (KOT)', adminOnly: false },\r\n    { path: '/inventory', icon: Package, label: 'Inventory', adminOnly: false },\r\n    { \r\n      path: '/reports', \r\n      icon: BarChart3, \r\n      label: 'Reports', \r\n      adminOnly: true,\r\n      children: [\r\n        { path: '/reports?category=sales', label: 'Sales Reports' },\r\n        { path: '/reports?category=inventory', label: 'Inventory Reports' },\r\n        { path: '/reports?category=crm', label: 'CRM Reports' },\r\n        { path: '/reports?category=staff', label: 'Staff Reports' },\r\n        { path: '/reports?category=payment', label: 'Payment Reports' },\r\n      ]\r\n    },\r\n    { path: '/expenses', icon: Wallet, label: 'Expenses', adminOnly: false },\r\n    { path: '/discounts', icon: Tag, label: 'Discounts', adminOnly: true },\r\n    { path: '/users', icon: Users, label: 'Users', adminOnly: true },\r\n    { path: '/printers', icon: Printer, label: 'Printers', adminOnly: false },\r\n    { path: '/settings', icon: Settings, label: 'Settings', adminOnly: true },\r\n  ];\r\n\r\n  const navItems = isAdmin\r\n    ? allNavItems\r\n    : allNavItems.filter(item => !item.adminOnly);\r\n\r\n  const handleSwitchUser = async () => {\r\n    await logout();\r\n    navigate('/login');\r\n  };\r\n\r\n  const handleLogout = async () => {\r\n    await logout();\r\n    navigate('/login');\r\n  };\r\n\r\n\r\n\r\n  return (\r\n    <aside className=\"sidebar\" style={{\r\n      width: '280px',\r\n      height: '100vh',\r\n      background: '#1A2327',\r\n      color: 'white',\r\n      display: 'flex',\r\n      flexDirection: 'column',\r\n      boxShadow: '2px 0 10px rgba(0,0,0,0.3)',\r\n      position: 'fixed',\r\n      left: 0,\r\n      top: 0,\r\n      zIndex: 100\r\n    }}>\r\n      {/* Logo Section */}\r\n      <div style={{ padding: '20px', borderBottom: '1px solid #37474F', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n        <img src={logoImg} alt=\"ZapBill Logo\" style={{ maxWidth: '100px', height: 'auto', objectFit: 'contain', filter: 'brightness(0) invert(1)' }} />\r\n      </div>\r\n\r\n      {/* Navigation */}\r\n      <nav className=\"sidebar-nav\" style={{ flex: 1, padding: '16px 0', overflowY: 'auto' }}>\r\n        {navItems.map((item) => {\r\n           if (item.children) {\r\n             const isExpanded = expandedMenu === item.path;\r\n             const isActive = location.pathname.startsWith(item.path);\r\n\r\n              return (\r\n                <div key={item.path}>\r\n                  <NavLink\r\n                    to={item.path}\r\n                    onClick={() => setExpandedMenu(expandedMenu === item.path ? null : item.path)}\r\n                    style={({ isActive }) => ({\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      justifyContent: 'space-between',\r\n                      padding: '14px 24px',\r\n                      color: isActive ? 'white' : '#B0BEC5',\r\n                      background: isActive ? 'rgba(0, 150, 255, 0.1)' : 'transparent',\r\n                      cursor: 'pointer',\r\n                      transition: 'all 0.2s',\r\n                      borderLeft: isActive ? '4px solid #0096FF' : '4px solid transparent',\r\n                      textDecoration: 'none'\r\n                    })}\r\n                  >\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>\r\n                      <item.icon size={24} />\r\n                      <span style={{ fontSize: '15px', fontWeight: 600 }}>{item.label}</span>\r\n                    </div>\r\n                    <span style={{ fontSize: '10px', transform: isExpanded ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.2s', opacity: 0.5 }}></span>\r\n                  </NavLink>\r\n\r\n                 {isExpanded && (\r\n                   <div style={{ background: 'rgba(0,0,0,0.2)', paddingBottom: '4px' }}>\r\n                     {item.children.map((child) => (\r\n                       <NavLink\r\n                         key={child.path}\r\n                         to={child.path}\r\n                         className={({ isActive }) =>isActive ? 'active-nav-link' : ''}\r\n                         style={({ isActive }) => ({\r\n                           display: 'flex',\r\n                           alignItems: 'center',\r\n                           padding: '12px 24px 12px 64px',\r\n                           color: isActive ? 'white' : '#B0BEC5',\r\n                           textDecoration: 'none',\r\n                           fontSize: '14px',\r\n                           background: isActive ? 'rgba(0, 150, 255, 0.15)' : 'transparent',\r\n                           transition: 'all 0.2s'\r\n                         })}\r\n                       >\r\n                         <span>{child.label}</span>\r\n                       </NavLink>\r\n                     ))}\r\n                   </div>\r\n                 )}\r\n               </div>\r\n             );\r\n           }\r\n\r\n           return (\r\n            <NavLink\r\n              key={item.path}\r\n              to={item.path}\r\n              className={({ isActive }) => isActive ? 'active-nav-link' : ''}\r\n              style={({ isActive }) => ({\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                gap: '16px',\r\n                padding: '14px 24px',\r\n                color: isActive ? 'white' : '#B0BEC5',\r\n                textDecoration: 'none',\r\n                background: isActive ? 'rgba(0, 150, 255, 0.15)' : 'transparent',\r\n                borderLeft: isActive ? '4px solid #0096FF' : '4px solid transparent',\r\n                transition: 'all 0.2s'\r\n              })}\r\n            >\r\n              <item.icon size={24} />\r\n              <span style={{ fontSize: '15px', fontWeight: 600 }}>{item.label}</span>\r\n              {item.badge && (\r\n                <span style={{ marginLeft: 'auto', background: '#0096FF', color: 'white', padding: '2px 8px', borderRadius: '10px', fontSize: '11px', fontWeight: 'bold' }}>\r\n                  {item.badge}\r\n                </span>\r\n              )}\r\n            </NavLink>\r\n          );\r\n        })}\r\n\r\n        {/* End Shift Button for Billers */}\r\n        <button\r\n          onClick={() => setShowEndShiftModal(true)}\r\n          style={{ \r\n            width: '100%', \r\n            border: 'none', \r\n            background: 'none', \r\n            cursor: 'pointer',\r\n            marginTop: 'auto',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            gap: '16px',\r\n            padding: '14px 24px',\r\n            color: '#B0BEC5',\r\n            transition: 'all 0.2s'\r\n          }}\r\n          onMouseOver={e => e.currentTarget.style.color = 'white'}\r\n          onMouseOut={e => e.currentTarget.style.color = '#B0BEC5'}\r\n        >\r\n          <LogOut size={24} />\r\n          <span style={{ fontSize: '15px', fontWeight: 600 }}>End Day</span>\r\n        </button>\r\n      </nav>\r\n\r\n      <ShiftModal \r\n        isOpen={showEndShiftModal} \r\n        type=\"end\" \r\n        onClose={() => setShowEndShiftModal(false)} \r\n      />\r\n\r\n      {/* User Section - Unified with MainSidebar */}\r\n      <div style={{ padding: '16px', borderTop: '1px solid #37474F', background: '#263238' }}>\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '12px' }}>\r\n          <div style={{ \r\n            width: '40px', \r\n            height: '40px', \r\n            borderRadius: '50%', \r\n            background: '#455A64', \r\n            display: 'flex', \r\n            alignItems: 'center', \r\n            justifyContent: 'center', \r\n            fontWeight: 'bold',\r\n            color: 'white',\r\n            fontSize: '16px'\r\n          }}>\r\n            {user?.fullName?.charAt(0).toUpperCase() || user?.username?.charAt(0).toUpperCase() || 'U'}\r\n          </div>\r\n          <div style={{ flex: 1 }}>\r\n            <div style={{ fontWeight: '600', color: 'white', fontSize: '14px' }}>{user?.fullName || user?.username || 'User'}</div>\r\n            <div style={{ fontSize: '12px', color: '#B0BEC5', textTransform: 'capitalize' }}>{user?.role || 'Staff'}</div>\r\n          </div>\r\n        </div>\r\n        <div style={{ display: 'flex', gap: '8px' }}>\r\n          <button \r\n            onClick={handleSwitchUser}\r\n            style={{ \r\n              flex: 1, \r\n              padding: '10px', \r\n              background: '#37474F', \r\n              border: 'none', \r\n              borderRadius: '6px', \r\n              color: '#CFD8DC', \r\n              cursor: 'pointer', \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              justifyContent: 'center', \r\n              gap: '6px', \r\n              fontSize: '13px', \r\n              transition: 'background 0.2s',\r\n              fontWeight: '500'\r\n            }}\r\n            onMouseOver={e => e.currentTarget.style.background = '#455A64'}\r\n            onMouseOut={e => e.currentTarget.style.background = '#37474F'}\r\n            title=\"Switch User\"\r\n          >\r\n            <RefreshCw size={14} /> Switch User\r\n          </button>\r\n          <button \r\n            onClick={handleLogout}\r\n            style={{ \r\n              padding: '10px 14px', \r\n              background: '#0096FF', \r\n              border: 'none', \r\n              borderRadius: '6px', \r\n              color: 'white', \r\n              cursor: 'pointer', \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              justifyContent: 'center', \r\n              gap: '6px', \r\n              fontSize: '13px', \r\n              transition: 'background 0.2s' \r\n            }}\r\n            onMouseOver={e => e.currentTarget.style.background = '#0284c7'}\r\n            onMouseOut={e => e.currentTarget.style.background = '#0096FF'}\r\n            title=\"Logout\"\r\n          >\r\n            <LogOut size={14} />\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </aside>\r\n  );\r\n};\r\n\r\nexport default Sidebar;","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\components\\layout\\TopNav.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'setIsOnline' is assigned a value but never used.","line":15,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":31}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Plus,\r\n  Clock,\r\n  Wifi,\r\n  WifiOff,\r\n  Search\r\n} from 'lucide-react';\r\nimport { useAuthStore } from '../../stores/authStore';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst TopNav = ({ onNewOrder }) => {\r\n  const { user } = useAuthStore();\r\n  const navigate = useNavigate();\r\n  const [isOnline, setIsOnline] = useState(true);\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [currentTime, setCurrentTime] = useState(new Date());\r\n\r\n  const handleSearch = (e) => {\r\n    e.preventDefault();\r\n    if (searchTerm.trim()) {\r\n      navigate('/orders', { state: { search: searchTerm } });\r\n      setSearchTerm(''); // clear after search\r\n    }\r\n  };\r\n\r\n  // Update time every minute\r\n  useEffect(() => {\r\n    const timer = setInterval(() => {\r\n      setCurrentTime(new Date());\r\n    }, 60000);\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n\r\n  const formatDate = (date) => {\r\n    return date.toLocaleDateString('en-IN', {\r\n      weekday: 'short',\r\n      day: 'numeric',\r\n      month: 'short',\r\n      year: 'numeric'\r\n    });\r\n  };\r\n\r\n  const formatTime = (date) => {\r\n    return date.toLocaleTimeString('en-IN', {\r\n      hour: '2-digit',\r\n      minute: '2-digit',\r\n      hour12: true\r\n    });\r\n  };\r\n\r\n  return (\r\n    <header className=\"top-nav\">\r\n      {/* Search Section */}\r\n      <form className=\"top-nav-search\" onSubmit={handleSearch}>\r\n        <Search size={18} className=\"top-nav-search-icon\" />\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"Search orders, items, customers...\"\r\n          className=\"top-nav-search-input\"\r\n          value={searchTerm}\r\n          onChange={(e) => setSearchTerm(e.target.value)}\r\n        />\r\n      </form>\r\n\r\n      {/* Right Section */}\r\n      <div className=\"top-nav-right\">\r\n        {/* Quick Action */}\r\n        <button className=\"top-nav-btn primary\" onClick={onNewOrder}>\r\n          <Plus size={18} />\r\n          <span>New Order</span>\r\n        </button>\r\n\r\n        {/* Date/Time */}\r\n        <div className=\"top-nav-datetime\">\r\n          <Clock size={14} />\r\n          <span>{formatDate(currentTime)}</span>\r\n          <span className=\"top-nav-time\">{formatTime(currentTime)}</span>\r\n        </div>\r\n\r\n        {/* Status Indicator */}\r\n        <div className={`top-nav-status ${isOnline ? 'online' : 'offline'}`}>\r\n          {isOnline ? <Wifi size={16} /> : <WifiOff size={16} />}\r\n          <span>{isOnline ? 'Online' : 'Offline'}</span>\r\n        </div>\r\n\r\n        {/* User Avatar */}\r\n        <button className=\"top-nav-avatar\">\r\n          <span>{user?.fullName?.charAt(0).toUpperCase() || user?.username?.charAt(0).toUpperCase() || 'U'}</span>\r\n        </button>\r\n      </div>\r\n    </header>\r\n  );\r\n};\r\n\r\nexport default TopNav;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\components\\ui\\CustomAlert.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useEffect } from 'react';\r\nimport { CheckCircle, AlertTriangle, Info, XCircle } from 'lucide-react';\r\n\r\nconst CustomAlert = ({ isOpen, message, type = 'info', onClose, onConfirm }) => {\r\n  useEffect(() => {\r\n    if (isOpen && type !== 'confirm') {\r\n      const timer = setTimeout(() => {\r\n        onClose();\r\n      }, 2000);\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [isOpen, type, onClose]);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  // Config based on type\r\n  const config = {\r\n    success: {\r\n      icon: <CheckCircle size={48} color=\"#2E7D32\" />,\r\n      bg: '#E8F5E9',\r\n      borderColor: '#A5D6A7',\r\n      title: 'Success',\r\n      titleColor: '#2E7D32'\r\n    },\r\n    error: {\r\n      icon: <XCircle size={48} color=\"#C62828\" />,\r\n      bg: '#FFEBEE',\r\n      borderColor: '#EF9A9A',\r\n      title: 'Error',\r\n      titleColor: '#C62828'\r\n    },\r\n    warning: {\r\n      icon: <AlertTriangle size={48} color=\"#EF6C00\" />,\r\n      bg: '#FFF3E0',\r\n      borderColor: '#FFCC80',\r\n      title: 'Warning',\r\n      titleColor: '#EF6C00'\r\n    },\r\n    info: {\r\n      icon: <Info size={48} color=\"#1565C0\" />,\r\n      bg: '#E3F2FD',\r\n      borderColor: '#90CAF9',\r\n      title: 'Information',\r\n      titleColor: '#1565C0'\r\n    },\r\n    confirm: {\r\n      icon: <Info size={48} color=\"#1565C0\" />,\r\n      bg: '#E3F2FD',\r\n      borderColor: '#90CAF9',\r\n      title: 'Confirm',\r\n      titleColor: '#1565C0'\r\n    }\r\n  };\r\n\r\n  const currentConfig = config[type] || config.info;\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" style={{ zIndex: 3000, background: 'rgba(0,0,0,0.4)', backdropFilter: 'blur(2px)' }}>\r\n      <div \r\n        className=\"custom-alert-modal\"\r\n        onClick={(e) => e.stopPropagation()}\r\n        style={{\r\n          background: 'white',\r\n          borderRadius: '16px',\r\n          padding: '24px',\r\n          width: '400px',\r\n          maxWidth: '90%',\r\n          textAlign: 'center',\r\n          boxShadow: '0 20px 60px rgba(0,0,0,0.2)',\r\n          animation: 'scaleIn 0.2s ease-out',\r\n          borderTop: `4px solid ${currentConfig.titleColor}`\r\n        }}\r\n      >\r\n        <div style={{ marginBottom: '16px', display: 'flex', justifyContent: 'center' }}>\r\n          <div style={{ \r\n            background: currentConfig.bg, \r\n            padding: '16px', \r\n            borderRadius: '50%',\r\n            display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n          }}>\r\n            {currentConfig.icon}\r\n          </div>\r\n        </div>\r\n\r\n        <h3 style={{ margin: '0 0 8px 0', color: '#37474F', fontSize: '20px' }}>\r\n          {currentConfig.title}\r\n        </h3>\r\n        \r\n        <p style={{ margin: '0 0 24px 0', color: '#546E7A', fontSize: '15px', lineHeight: '1.5' }}>\r\n          {message}\r\n        </p>\r\n\r\n        <div style={{ display: 'flex', gap: '12px', justifyContent: 'center' }}>\r\n          {type === 'confirm' ? (\r\n            <>\r\n              <button\r\n                onClick={onClose}\r\n                style={{\r\n                  flex: 1, padding: '10px 20px', borderRadius: '8px', border: '1px solid #CFD8DC',\r\n                  background: 'white', color: '#546E7A', fontWeight: '600', cursor: 'pointer'\r\n                }}\r\n              >\r\n                Cancel\r\n              </button>\r\n              <button\r\n                onClick={() => { onConfirm && onConfirm(); onClose(); }}\r\n                style={{\r\n                  flex: 1, padding: '10px 20px', borderRadius: '8px', border: 'none',\r\n                  background: currentConfig.titleColor, color: 'white', fontWeight: '600', cursor: 'pointer'\r\n                }}\r\n              >\r\n                Confirm\r\n              </button>\r\n            </>\r\n          ) : (\r\n            <button\r\n              onClick={onClose}\r\n              style={{\r\n                width: '100%', padding: '10px 20px', borderRadius: '8px', border: 'none',\r\n                background: currentConfig.titleColor, color: 'white', fontWeight: '600', cursor: 'pointer'\r\n              }}\r\n            >\r\n              OK\r\n            </button>\r\n          )}\r\n        </div>\r\n      </div>\r\n      <style>{`\r\n        @keyframes scaleIn {\r\n          from { transform: scale(0.9); opacity: 0; }\r\n          to { transform: scale(1); opacity: 1; }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CustomAlert;\r\n\r\n\r\n/* pping tray creation\r\n[1] [12364:0222/214753.850:ERROR:net\\disk_cache\\cache_util_win.cc:25] Unable to move the cache: Access is denied. (0x5)\r\n[1] [12364:0222/214753.851:ERROR:net\\disk_cache\\disk_cache.cc:236] Unable to create cache\r\n[1] [12364:0222/214753.851:ERROR:gpu\\ipc\\host\\gpu_disk_cache.cc:724] Gpu Cache Creation failed: -2\r\n[1] [12364:0222/214753.850:ERROR:net\\disk_cache\\cache_util_win.cc:25] Unable to move the cache: Access is denied. (0x5)\r\n[1] [12364:0222/214753.851:ERROR:net\\disk_cache\\disk_cache.cc:236] Unable to create cache\r\n[1] [12364:0222/214753.851:ERROR:gpu\\ipc\\host\\gpu_disk_cache.cc:724] Gpu Cache Creation failed: -2\r\n[1] [12364:0222/214753.850:ERROR:net\\disk_cache\\cache_util_win.cc:25] Unable to move the cache: Access is denied. (0x5)\r\n[1] [12364:0222/214753.851:ERROR:net\\disk_cache\\disk_cache.cc:236] Unable to create cache\r\n[1] [12364:0222/214753.851:ERROR:gpu\\ipc\\host\\gpu_disk_cache.cc:724] Gpu Cache Creation failed: -2\r\n[1] 21:48:16.263 > Login attempt for user: admin */","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\context\\ShiftContext.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkActiveShift'. Either include it or remove the dependency array.","line":33,"column":6,"nodeType":"ArrayExpression","endLine":33,"endColumn":29,"suggestions":[{"desc":"Update the dependencies array to be: [checkActiveShift, isAuthenticated, user]","fix":{"range":[1098,1121],"text":"[checkActiveShift, isAuthenticated, user]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'checkActiveShift'. Either include it or remove the dependency array.","line":54,"column":6,"nodeType":"ArrayExpression","endLine":54,"endColumn":40,"suggestions":[{"desc":"Update the dependencies array to be: [isAuthenticated, user, dayStatus, checkActiveShift]","fix":{"range":[1766,1800],"text":"[isAuthenticated, user, dayStatus, checkActiveShift]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { createContext, useContext, useState, useEffect } from 'react';\r\nimport { useAuthStore } from '../stores/authStore';\r\n\r\nconst ShiftContext = createContext(null);\r\n\r\nexport const useShift = () => {\r\n  const context = useContext(ShiftContext);\r\n  if (!context) {\r\n    throw new Error('useShift must be used within a ShiftProvider');\r\n  }\r\n  return context;\r\n};\r\n\r\nexport const ShiftProvider = ({ children }) => {\r\n  const { user, isAuthenticated } = useAuthStore();\r\n  const [activeShift, setActiveShift] = useState(null);\r\n  const [dayStatus, setDayStatus] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState(null);\r\n  const [showStartModal, setShowStartModal] = useState(false);\r\n  const [showDayModal, setShowDayModal] = useState(false);\r\n\r\n  // Check for active shift when user logs in or mounts\r\n  useEffect(() => {\r\n    if (isAuthenticated && user) {\r\n      checkActiveShift();\r\n    } else {\r\n      setActiveShift(null);\r\n      setDayStatus(null);\r\n      setShowStartModal(false);\r\n      setShowDayModal(false);\r\n    }\r\n  }, [isAuthenticated, user]);\r\n\r\n  // Periodic check for day change (midnight transition)\r\n  useEffect(() => {\r\n    if (!isAuthenticated || !user) return;\r\n\r\n    const interval = setInterval(() => {\r\n      const today = new Date().toLocaleDateString('en-CA');\r\n      if (dayStatus && dayStatus.business_date !== today) {\r\n        checkActiveShift();\r\n      }\r\n    }, 60000); // Check every minute\r\n\r\n    // Also check when window regains focus\r\n    const handleFocus = () => checkActiveShift();\r\n    window.addEventListener('focus', handleFocus);\r\n\r\n    return () => {\r\n      clearInterval(interval);\r\n      window.removeEventListener('focus', handleFocus);\r\n    };\r\n  }, [isAuthenticated, user, dayStatus]);\r\n\r\n  const checkActiveShift = async () => {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    try {\r\n      // 1. Check Day Status FIRST\r\n      const dayResult = await window.electronAPI.invoke('day:getStatus', {});\r\n      if (dayResult.success) {\r\n        setDayStatus(dayResult.status);\r\n        if (!dayResult.status) {\r\n          // If day not opened for today, show Day Modal and wait\r\n          setShowDayModal(true);\r\n          setShowStartModal(false);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // 2. Check individual shift status\r\n      const result = await window.electronAPI.invoke('shifts:getStatus', { userId: user.id });\r\n      if (result.success) {\r\n        setActiveShift(result.shift);\r\n        if (!result.shift && (user.role === 'biller' || user.role === 'cashier' || user.role === 'admin')) {\r\n          // If no active shift and user can bill, prompt to start\r\n          setShowStartModal(true);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      console.error('Error checking shift status:', err);\r\n      setError('Failed to check shift status');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const openDay = async (openingBalance) => {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const result = await window.electronAPI.invoke('day:open', { \r\n        userId: user.id, \r\n        openingBalance: parseFloat(openingBalance || 0) \r\n      });\r\n      \r\n      if (result.success) {\r\n        setDayStatus(result.status);\r\n        setShowDayModal(false);\r\n        // After day is opened, re-check shift status to show shift modal if needed\r\n        await checkActiveShift();\r\n        return { success: true };\r\n      } else {\r\n        throw new Error(result.error || 'Failed to open day');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error opening day:', err);\r\n      setError(err.message);\r\n      return { success: false, error: err.message };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const startShift = async (startCash) => {\r\n    if (!user) return;\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const result = await window.electronAPI.invoke('shifts:start', { \r\n        userId: user.id, \r\n        startCash: parseFloat(startCash || 0) \r\n      });\r\n      \r\n      if (result.id) { // Assuming successful creation returns the shift object\r\n        setActiveShift(result);\r\n        setShowStartModal(false);\r\n        return { success: true };\r\n      } else {\r\n        throw new Error(result.error || 'Failed to start shift');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error starting shift:', err);\r\n      setError(err.message);\r\n      return { success: false, error: err.message };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const endShift = async (endCash) => {\r\n    if (!user || !activeShift) return;\r\n    setLoading(true);\r\n    setError(null);\r\n    try {\r\n      const result = await window.electronAPI.invoke('shifts:end', { \r\n        userId: user.id, \r\n        endCash: parseFloat(endCash || 0) \r\n      });\r\n      \r\n      if (result.status === 'closed') {\r\n        setActiveShift(null);\r\n        return { success: true };\r\n      } else {\r\n        throw new Error(result.error || 'Failed to end shift');\r\n      }\r\n    } catch (err) {\r\n      console.error('Error ending shift:', err);\r\n      setError(err.message);\r\n      return { success: false, error: err.message };\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    activeShift,\r\n    dayStatus,\r\n    loading,\r\n    error,\r\n    showStartModal,\r\n    showDayModal,\r\n    setShowStartModal,\r\n    setShowDayModal,\r\n    checkActiveShift,\r\n    openDay,\r\n    startShift,\r\n    endShift\r\n  };\r\n\r\n  return (\r\n    <ShiftContext.Provider value={value}>\r\n      {children}\r\n    </ShiftContext.Provider>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\DashboardPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":7,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":8},{"ruleId":"no-unused-vars","severity":1,"message":"'isNeutral' is assigned a value but never used.","line":39,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":39,"endColumn":18},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadDashboardData'. Either include it or remove the dependency array.","line":421,"column":6,"nodeType":"ArrayExpression","endLine":421,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [loadDashboardData, user]","fix":{"range":[16458,16464],"text":"[loadDashboardData, user]"}}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":596,"column":203,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[24167,24203],"text":"! Here&apos;s your restaurant's overview."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[24167,24203],"text":"! Here&lsquo;s your restaurant's overview."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[24167,24203],"text":"! Here&#39;s your restaurant's overview."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[24167,24203],"text":"! Here&rsquo;s your restaurant's overview."},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":596,"column":221,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[24167,24203],"text":"! Here's your restaurant&apos;s overview."},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[24167,24203],"text":"! Here's your restaurant&lsquo;s overview."},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[24167,24203],"text":"! Here's your restaurant&#39;s overview."},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[24167,24203],"text":"! Here's your restaurant&rsquo;s overview."},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":2,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport {\r\n  TrendingUp,\r\n  TrendingDown,\r\n  DollarSign,\r\n  ShoppingCart,\r\n  Users,\r\n  Clock,\r\n  ArrowRight,\r\n  MoreHorizontal,\r\n  CheckCircle,\r\n  AlertCircle,\r\n  XCircle,\r\n  Minus,\r\n  Wallet,\r\n  BarChart3,\r\n  ShoppingBag,\r\n  ArrowUpRight,\r\n  Plus\r\n} from 'lucide-react';\r\nimport { \r\n  AreaChart, \r\n  Area, \r\n  XAxis, \r\n  YAxis, \r\n  CartesianGrid, \r\n  Tooltip, \r\n  ResponsiveContainer \r\n} from 'recharts';\r\nimport { format, subDays } from 'date-fns';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { Link } from 'react-router-dom';\r\n\r\n// StatCard Component\r\n// StatCard Component\r\nconst StatCard = ({ title, value, trend, trendValue, icon: Icon, color }) => {\r\n  const isPositive = trend === 'up';\r\n  const isNegative = trend === 'down';\r\n  const isNeutral = trend === 'neutral';\r\n  \r\n  const colors = {\r\n    primary: { bg: '#e0f2fe', icon: '#0096FF', text: '#0369a1', glow: 'rgba(0, 150, 255, 0.15)' },\r\n    success: { bg: '#dcfce7', icon: '#10b981', text: '#15803d', glow: 'rgba(16, 185, 129, 0.15)' },\r\n    warning: { bg: '#fef3c7', icon: '#f59e0b', text: '#92400e', glow: 'rgba(245, 158, 11, 0.15)' },\r\n    danger: { bg: '#fee2e2', icon: '#ef4444', text: '#991b1b', glow: 'rgba(239, 68, 68, 0.15)' },\r\n    info: { bg: '#e0e7ff', icon: '#6366f1', text: '#3730a3', glow: 'rgba(99, 102, 241, 0.15)' }\r\n  };\r\n\r\n  const theme = colors[color] || colors.primary;\r\n\r\n  return (\r\n    <div className=\"card hover-shadow\" style={{ \r\n      padding: '20px', \r\n      borderRadius: '24px', \r\n      background: 'white',\r\n      border: '1px solid #f1f5f9',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      gap: '20px',\r\n      position: 'relative',\r\n      overflow: 'hidden',\r\n      transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)',\r\n      cursor: 'default',\r\n      minHeight: '120px'\r\n    }}>\r\n      {/* Icon Box */}\r\n      <div style={{ \r\n        width: '64px', \r\n        height: '64px', \r\n        borderRadius: '20px', \r\n        background: theme.bg,\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        color: theme.icon,\r\n        boxShadow: `0 12px 24px -6px ${theme.glow}`,\r\n        flexShrink: 0,\r\n        zIndex: 2\r\n      }}>\r\n        <Icon size={32} strokeWidth={2} />\r\n      </div>\r\n\r\n      {/* Content */}\r\n      <div style={{ flex: 1, zIndex: 2 }}>\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '4px' }}>\r\n          <span style={{ fontSize: '13px', fontWeight: '700', color: '#94a3b8', textTransform: 'uppercase', letterSpacing: '0.08em' }}>\r\n            {title}\r\n          </span>\r\n          <div style={{ \r\n            padding: '4px 10px',\r\n            borderRadius: '20px',\r\n            fontSize: '12px',\r\n            fontWeight: '800',\r\n            background: isPositive ? '#dcfce7' : isNegative ? '#fee2e2' : '#f1f5f9',\r\n            color: isPositive ? '#15803d' : isNegative ? '#b91c1c' : '#64748b',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            gap: '4px',\r\n            border: isPositive ? '1px solid #bbf7d0' : isNegative ? '1px solid #fecaca' : '1px solid #e2e8f0'\r\n          }}>\r\n            {isPositive ? <TrendingUp size={14} /> : isNegative ? <TrendingDown size={14} /> : <Minus size={14} />}\r\n            {trendValue}%\r\n          </div>\r\n        </div>\r\n        <div style={{ fontSize: '28px', fontWeight: '900', color: '#1e293b', lineHeight: '1' }}>\r\n          {value}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Background Decorator */}\r\n      <div style={{ \r\n        position: 'absolute', \r\n        right: '-10px', \r\n        bottom: '-10px', \r\n        opacity: 0.05, \r\n        transform: 'rotate(-15deg)',\r\n        color: theme.icon,\r\n        zIndex: 1\r\n      }}>\r\n        <Icon size={110} />\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\n\r\n// Order Details Modal Component\r\nconst OrderDetailsModal = ({ order, onClose }) => {\r\n  if (!order) return null;\r\n\r\n  return (\r\n    <div style={{\r\n      position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n      background: 'rgba(0,0,0,0.5)', zIndex: 9999, display: 'flex', justifyContent: 'center', alignItems: 'center'\r\n    }} onClick={onClose}>\r\n      <div \r\n        style={{\r\n          background: 'white', width: '90%', maxWidth: '500px', maxHeight: '90vh', overflowY: 'auto',\r\n          borderRadius: '8px', padding: '24px', position: 'relative', boxShadow: '0 4px 20px rgba(0,0,0,0.15)'\r\n        }} \r\n        onClick={e => e.stopPropagation()}\r\n      >\r\n        <button onClick={onClose} style={{ position: 'absolute', top: '16px', right: '16px', border: 'none', background: 'none', cursor: 'pointer' }}>\r\n          <XCircle size={24} color=\"#546E7A\" />\r\n        </button>\r\n        \r\n        <h2 style={{ margin: '0 0 20px 0', fontSize: '20px', color: '#2c3e50', borderBottom: '1px solid #eee', paddingBottom: '12px' }}>\r\n          Order #{order.order_number}\r\n        </h2>\r\n\r\n        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '20px' }}>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#7f8c8d' }}>Date & Time</div>\r\n             <div style={{ fontWeight: '500' }}>{new Date(order.created_at).toLocaleString()}</div>\r\n           </div>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#7f8c8d' }}>Order Type</div>\r\n             <div style={{ fontWeight: '500', textTransform: 'capitalize' }}>{order.order_type?.replace('_', ' ')}</div>\r\n           </div>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#7f8c8d' }}>Payment Type</div>\r\n             <div style={{ fontWeight: '500', textTransform: 'capitalize' }}>{order.payment_method || '-'}</div>\r\n           </div>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#7f8c8d' }}>Status</div>\r\n             <div style={{ fontWeight: '500', textTransform: 'capitalize' }}>{order.status}</div>\r\n           </div>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#7f8c8d' }}>Customer Name</div>\r\n             <div style={{ fontWeight: '500' }}>{order.customer_name || 'Walk-in'}</div>\r\n           </div>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#7f8c8d' }}>Phone</div>\r\n             <div style={{ fontWeight: '500' }}>{order.customer_phone || '-'}</div>\r\n           </div>\r\n        </div>\r\n\r\n        <h3 style={{ fontSize: '16px', margin: '0 0 12px 0', color: '#34495e' }}>Order Items</h3>\r\n        <div style={{ border: '1px solid #eee', borderRadius: '8px', overflow: 'hidden', marginBottom: '20px' }}>\r\n           <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '14px' }}>\r\n             <thead style={{ background: '#f8f9fa' }}>\r\n               <tr>\r\n                 <th style={{ padding: '8px 12px', textAlign: 'left', borderBottom: '1px solid #eee' }}>Item</th>\r\n                 <th style={{ padding: '8px 12px', textAlign: 'center', borderBottom: '1px solid #eee' }}>Qty</th>\r\n                 <th style={{ padding: '8px 12px', textAlign: 'right', borderBottom: '1px solid #eee' }}>Price</th>\r\n               </tr>\r\n             </thead>\r\n             <tbody>\r\n               {order.items?.map((item, idx) => (\r\n                 <tr key={idx} style={{ borderBottom: '1px solid #f5f5f5' }}>\r\n                   <td style={{ padding: '8px 12px' }}>{item.item_name || item.name}</td>\r\n                   <td style={{ padding: '8px 12px', textAlign: 'center' }}>{item.quantity}</td>\r\n                   <td style={{ padding: '8px 12px', textAlign: 'right' }}>{(item.price || item.unit_price) * item.quantity}</td>\r\n                 </tr>\r\n               ))}\r\n             </tbody>\r\n           </table>\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', fontSize: '18px', fontWeight: 'bold', borderTop: '1px solid #eee', paddingTop: '16px' }}>\r\n           <span>Total Amount</span>\r\n           <span style={{ color: '#27ae60' }}>{order.total_amount || 0}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Order Card Component\r\nconst OrderCard = ({ order, onClick }) => {\r\n  const statusColors = {\r\n    active: { bg: '#e0f2fe', text: '#0369a1', icon: Clock },\r\n    pending: { bg: '#fef3c7', text: '#d97706', icon: AlertCircle },\r\n    preparing: { bg: '#e0f2fe', text: '#0369a1', icon: Clock },\r\n    ready: { bg: '#dcfce7', text: '#15803d', icon: CheckCircle },\r\n    completed: { bg: '#dcfce7', text: '#15803d', icon: CheckCircle },\r\n    cancelled: { bg: '#fee2e2', text: '#b91c1c', icon: XCircle },\r\n    held: { bg: '#fef3c7', text: '#d97706', icon: AlertCircle }\r\n  };\r\n\r\n  const status = statusColors[order.status] || statusColors.active;\r\n  const StatusIcon = status.icon;\r\n  \r\n  const orderDate = new Date(order.created_at);\r\n  const today = new Date();\r\n  const isToday = orderDate.toDateString() === today.toDateString();\r\n  const dateDisplay = isToday ? 'Today' : orderDate.toLocaleDateString('en-IN', { day: 'numeric', month: 'short' });\r\n\r\n  return (\r\n    <div \r\n      className=\"card hover-shadow\" \r\n      onClick={() => onClick(order)}\r\n      style={{\r\n        padding: '0',\r\n        borderRadius: '16px',\r\n        border: '1px solid #f1f5f9',\r\n        overflow: 'hidden',\r\n        cursor: 'pointer',\r\n        transition: 'all 0.3s cubic-bezier(0.4, 0, 0.2, 1)'\r\n      }}\r\n    >\r\n      <div style={{ padding: '16px', borderBottom: '1px solid #f1f5f9' }}>\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '12px' }}>\r\n          <div>\r\n            <h4 style={{ margin: 0, fontSize: '16px', fontWeight: '800', color: '#1e293b' }}>#{order.order_number}</h4>\r\n            <span style={{ fontSize: '11px', color: '#64748b', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.05em' }}>\r\n              {order.order_type?.replace('_', ' ')}  {dateDisplay}\r\n            </span>\r\n          </div>\r\n          <span style={{ \r\n            padding: '4px 10px', \r\n            borderRadius: '20px', \r\n            background: status.bg, \r\n            color: status.text, \r\n            fontSize: '11px', \r\n            fontWeight: '700',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            gap: '4px',\r\n            textTransform: 'uppercase'\r\n          }}>\r\n            <StatusIcon size={12} />\r\n            {order.status}\r\n          </span>\r\n        </div>\r\n        \r\n        <div style={{ marginBottom: '12px' }}>\r\n          <div style={{ fontSize: '13px', fontWeight: '600', color: '#334155', marginBottom: '4px' }}>{order.customer_name || 'Walk-in Customer'}</div>\r\n          <div style={{ color: '#64748b', fontSize: '13px' }}>\r\n            {order.items?.slice(0, 2).map((item, idx) => (\r\n              <div key={idx} style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                <span>{item.quantity}x {item.item_name || item.name}</span>\r\n              </div>\r\n            ))}\r\n            {order.items?.length > 2 && (\r\n              <div style={{ color: '#0096FF', fontWeight: '600', marginTop: '4px', fontSize: '12px' }}>\r\n                +{order.items.length - 2} more items\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      \r\n      <div style={{ \r\n        padding: '12px 16px', \r\n        background: '#f8fafc', \r\n        display: 'flex', \r\n        justifyContent: 'space-between', \r\n        alignItems: 'center' \r\n      }}>\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '4px', fontSize: '12px', color: '#64748b' }}>\r\n          <Clock size={14} />\r\n          {new Date(order.created_at).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })}\r\n        </div>\r\n        <div style={{ fontSize: '18px', fontWeight: '900', color: '#0096FF' }}>\r\n          {order.total_amount?.toFixed(0)}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Add Balance Modal Component\r\nconst AddBalanceModal = ({ isOpen, onClose, onAdd }) => {\r\n  const [amount, setAmount] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!amount || isNaN(amount) || amount <= 0) return;\r\n    setLoading(true);\r\n    await onAdd(parseFloat(amount));\r\n    setAmount('');\r\n    setLoading(false);\r\n  };\r\n\r\n  return (\r\n    <div style={{\r\n      position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n      background: 'rgba(0,0,0,0.5)', zIndex: 9999, display: 'flex', justifyContent: 'center', alignItems: 'center'\r\n    }} onClick={onClose}>\r\n      <div \r\n        style={{\r\n          background: 'white', width: '90%', maxWidth: '400px', \r\n          borderRadius: '16px', padding: '24px', position: 'relative', boxShadow: '0 4px 20px rgba(0,0,0,0.15)'\r\n        }} \r\n        onClick={e => e.stopPropagation()}\r\n      >\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>\r\n          <h2 style={{ margin: 0, fontSize: '20px', color: '#1e293b' }}>Add Cash to Drawer</h2>\r\n          <button onClick={onClose} style={{ border: 'none', background: 'none', cursor: 'pointer', color: '#64748b' }}>\r\n            <XCircle size={24} />\r\n          </button>\r\n        </div>\r\n        \r\n        <form onSubmit={handleSubmit}>\r\n          <div style={{ marginBottom: '20px' }}>\r\n            <label style={{ display: 'block', marginBottom: '8px', fontSize: '14px', fontWeight: 'bold', color: '#475569' }}>\r\n              Amount to Add ()\r\n            </label>\r\n            <input \r\n              type=\"number\"\r\n              value={amount}\r\n              onChange={(e) => setAmount(e.target.value)}\r\n              placeholder=\"Enter amount\"\r\n              style={{\r\n                width: '100%', padding: '12px', borderRadius: '8px', border: '1px solid #cbd5e1', \r\n                fontSize: '16px', outline: 'none'\r\n              }}\r\n              autoFocus\r\n              required\r\n            />\r\n            <p style={{ fontSize: '12px', color: '#64748b', marginTop: '8px' }}>\r\n              This increments the opening balance and physical cash drawer calculation for all active shifts.\r\n            </p>\r\n          </div>\r\n          <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>\r\n            <button type=\"button\" onClick={onClose} style={{ padding: '10px 16px', borderRadius: '8px', border: '1px solid #cbd5e1', background: 'white', cursor: 'pointer', fontWeight: 'bold', color: '#64748b' }}>\r\n              Cancel\r\n            </button>\r\n            <button type=\"submit\" disabled={loading} style={{ padding: '10px 20px', borderRadius: '8px', border: 'none', background: '#0096FF', color: 'white', fontWeight: 'bold', cursor: loading ? 'not-allowed' : 'pointer' }}>\r\n              {loading ? 'Adding...' : 'Add Balance'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\nconst DashboardPage = () => {\r\n  const [stats, setStats] = useState({\r\n    todayRevenue: 0,\r\n    todayExpenses: 0,\r\n    openingBalance: 0,\r\n    netProfit: 0,\r\n    totalOrders: 0,\r\n    avgOrderValue: 0,\r\n    revenueTrend: { direction: 'neutral', value: 0 },\r\n    ordersTrend: { direction: 'neutral', value: 0 },\r\n    avgOrderTrend: { direction: 'neutral', value: 0 },\r\n    activeOrdersTrend: { direction: 'neutral', value: 0 },\r\n    cashAmount: 0,\r\n    upiAmount: 0,\r\n    cardAmount: 0,\r\n    mixedAmount: 0,\r\n    dueAmount: 0\r\n  });\r\n  const [recentOrders, setRecentOrders] = useState([]);\r\n  const [selectedOrder, setSelectedOrder] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [chartData, setChartData] = useState([]);\r\n  const [topItems, setTopItems] = useState([]);\r\n  const [showAddBalanceModal, setShowAddBalanceModal] = useState(false);\r\n\r\n  const { user } = useAuthStore();\r\n\r\n  const handleAddBalance = async (amount) => {\r\n    try {\r\n      const result = await window.electronAPI.invoke('day:addBalance', { amount });\r\n      if (result.success) {\r\n        setShowAddBalanceModal(false);\r\n        await loadDashboardData();\r\n      } else {\r\n        alert(result.error || 'Failed to add balance');\r\n      }\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert('Failed to add balance');\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (user) {\r\n      loadDashboardData();\r\n    }\r\n  }, [user]);\r\n\r\n\r\n\r\n  const loadDashboardData = async () => {\r\n    try {\r\n      setIsLoading(true);\r\n      const today = format(new Date(), 'yyyy-MM-dd');\r\n      const yesterday = format(subDays(new Date(), 1), 'yyyy-MM-dd');\r\n      \r\n      let todayReport = null;\r\n      let yesterdayReport = null;\r\n      let todaySales = {};\r\n      let yesterdaySales = {};\r\n      let revenueTrend = { direction: 'neutral', value: 0 };\r\n      let ordersTrend = { direction: 'neutral', value: 0 };\r\n\r\n      // Helper to calculate trend\r\n      const calculateTrend = (current, previous) => {\r\n        const currVal = parseFloat(current) || 0;\r\n        const prevVal = parseFloat(previous) || 0;\r\n\r\n        if (prevVal === 0) {\r\n          return { direction: currVal > 0 ? 'up' : 'neutral', value: currVal > 0 ? 100 : 0 };\r\n        }\r\n        \r\n        const change = ((currVal - prevVal) / prevVal) * 100;\r\n        return {\r\n          direction: change > 0 ? 'up' : change < 0 ? 'down' : 'neutral',\r\n          value: Math.abs(change).toFixed(1)\r\n        };\r\n      };\r\n\r\n      if (user?.role === 'biller' || user?.role === 'cashier') {\r\n        // --- BILLER VIEW ---\r\n        // Fetch active shift or last closed shift for today\r\n        const shiftStatus = await window.electronAPI.invoke('shifts:getStatus', { userId: user.id });\r\n        \r\n        if (shiftStatus.success && shiftStatus.shift) {\r\n          const reportResult = await window.electronAPI.invoke('shifts:getReport', { shiftId: shiftStatus.shift.id });\r\n          if (reportResult.success && reportResult.report) {\r\n            todayReport = reportResult.report;\r\n            todaySales = todayReport.sales || {};\r\n          }\r\n        } else {\r\n             // Try to get daily report for this biller specifically\r\n             todayReport = await window.electronAPI.invoke('reports:billerDaily', { date: today, userId: user.id });\r\n             todaySales = todayReport?.sales || todayReport || {};\r\n        }\r\n\r\n      } else {\r\n        // --- ADMIN VIEW ---\r\n        // Fetch global today's and yesterday's reports for comparison\r\n        const [todayRes, yesterdayRes] = await Promise.all([\r\n          window.electronAPI.invoke('reports:daily', { date: today }),\r\n          window.electronAPI.invoke('reports:daily', { date: yesterday })\r\n        ]);\r\n\r\n        todayReport = todayRes;\r\n        yesterdayReport = yesterdayRes;\r\n\r\n        todaySales = todayReport?.sales || {};\r\n        yesterdaySales = yesterdayReport?.sales || {};\r\n\r\n        // Calculate Trends (Only for Admin)\r\n        revenueTrend = calculateTrend(todaySales.total_revenue, yesterdaySales.total_revenue);\r\n        ordersTrend = calculateTrend(todaySales.total_orders, yesterdaySales.total_orders);\r\n      }\r\n\r\n      // Common Data: Recent Orders (Biller specific if not admin)\r\n      let recentOrdersData = [];\r\n      if (todayReport && Array.isArray(todayReport.orders)) {\r\n        recentOrdersData = todayReport.orders.slice(0, 8);\r\n      } else {\r\n        recentOrdersData = await window.electronAPI.invoke('order:getRecent', { limit: 8 });\r\n      }\r\n\r\n      // Active Orders count from recent list (approximate)\r\n      let activeCount = 0;\r\n      if (Array.isArray(recentOrdersData)) {\r\n        setRecentOrders(recentOrdersData);\r\n        activeCount = recentOrdersData.filter(o => \r\n          ['active', 'pending', 'preparing', 'ready', 'held'].includes(o.status)\r\n        ).length;\r\n      }\r\n\r\n      const cashSales = todaySales.cash_amount !== undefined ? todaySales.cash_amount : \r\n                       (todaySales.cash_sales !== undefined ? todaySales.cash_sales : 0);\r\n      const upiSales = todaySales.upi_amount !== undefined ? todaySales.upi_amount : (todaySales.upi_sales || 0);\r\n      const cardSales = todaySales.card_amount !== undefined ? todaySales.card_amount : (todaySales.card_sales || 0);\r\n      const dueSales = todaySales.due_amount !== undefined ? todaySales.due_amount : (todaySales.due_sales || 0);\r\n      \r\n      const otherSales = Math.max(0, (todaySales.total_revenue || 0) - (cashSales + upiSales + cardSales + dueSales));\r\n      \r\n      const cashInHand = (todaySales.opening_balance || 0) + cashSales - (todaySales.total_expenses || 0);\r\n\r\n      setStats({\r\n        todayRevenue: todaySales.total_revenue || 0,\r\n        todayExpenses: todaySales.total_expenses || 0,\r\n        openingBalance: todaySales.opening_balance || 0,\r\n        netProfit: todaySales.net_revenue || 0,\r\n        cashInHand: cashInHand || 0,\r\n        totalOrders: todaySales.total_orders || 0,\r\n        activeOrders: activeCount,\r\n        revenueTrend,\r\n        ordersTrend,\r\n        activeOrdersTrend: { direction: 'neutral', value: 0 },\r\n        cashAmount: cashSales,\r\n        upiAmount: upiSales,\r\n        cardAmount: cardSales,\r\n        mixedAmount: otherSales,\r\n        dueAmount: dueSales\r\n      });\r\n\r\n      // Fetch weekly trend for chart\r\n      const weekStart = format(subDays(new Date(), 6), 'yyyy-MM-dd');\r\n      const weeklyReport = await window.electronAPI.invoke('reports:weekly', { startDate: weekStart });\r\n      if (weeklyReport && weeklyReport.dailyTrend) {\r\n        setChartData(weeklyReport.dailyTrend);\r\n      }\r\n      \r\n      if (todayReport && todayReport.topItems) {\r\n        setTopItems(todayReport.topItems.slice(0, 5));\r\n      }\r\n\r\n    } catch (error) {\r\n      console.error('Failed to load dashboard data:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"page-container\">\r\n        <div className=\"page-header\">\r\n           <div className=\"skeleton\" style={{ height: '32px', width: '200px', marginBottom: '8px' }}></div>\r\n           <div className=\"skeleton\" style={{ height: '20px', width: '300px' }}></div>\r\n        </div>\r\n        \r\n        <div className=\"stats-grid\">\r\n           {[1, 2, 3, 4].map(i => (\r\n             <div key={i} className=\"stat-card\" style={{ height: '140px', display: 'flex', flexDirection: 'column', justifyContent: 'space-between' }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                   <div className=\"skeleton\" style={{ width: '40px', height: '40px', borderRadius: '8px' }}></div>\r\n                   <div className=\"skeleton\" style={{ width: '20px', height: '20px', borderRadius: '50%' }}></div>\r\n                </div>\r\n                <div>\r\n                   <div className=\"skeleton\" style={{ width: '80px', height: '16px', marginBottom: '8px' }}></div>\r\n                   <div className=\"skeleton\" style={{ width: '120px', height: '28px' }}></div>\r\n                </div>\r\n             </div>\r\n           ))}\r\n        </div>\r\n\r\n        <div className=\"dashboard-section\">\r\n           <div className=\"section-header\">\r\n              <div className=\"skeleton\" style={{ width: '150px', height: '24px' }}></div>\r\n           </div>\r\n           <div className=\"orders-grid\">\r\n              {[1, 2, 3, 4].map(i => (\r\n                <div key={i} className=\"skeleton\" style={{ height: '180px', borderRadius: '12px' }}></div>\r\n              ))}\r\n           </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"page-container\" style={{ background: '#f8fafc' }}>\r\n      {/* Page Header */}\r\n      <div className=\"page-header\" style={{ marginBottom: '32px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n        <div>\r\n          <h1 className=\"page-title\" style={{ fontSize: '28px', fontWeight: '900', color: '#1e293b' }}>Dashboard</h1>\r\n          <p className=\"page-subtitle\" style={{ color: '#64748b', fontSize: '15px' }}>Welcome back, <span style={{ color: '#0096FF', fontWeight: '700' }}>{user?.full_name || user?.username}</span>! Here's your restaurant's overview.</p>\r\n        </div>\r\n        <div style={{ display: 'flex', gap: '12px' }}>\r\n          <button className=\"btn btn-secondary\" onClick={() => setShowAddBalanceModal(true)} style={{ borderRadius: '12px', padding: '10px 16px', background: '#e0f2fe', color: '#0369a1', borderColor: '#bae6fd' }}>\r\n            <Wallet size={18} /> Add Cash\r\n          </button>\r\n          <button className=\"btn btn-secondary\" onClick={loadDashboardData} style={{ borderRadius: '12px', padding: '10px 16px' }}>\r\n            <Clock size={18} /> Refresh\r\n          </button>\r\n          <Link to=\"/pos\" className=\"btn btn-primary\" style={{ borderRadius: '12px', padding: '10px 20px', fontWeight: '700', display: 'flex', alignItems: 'center', gap: '8px', textDecoration: 'none' }}>\r\n            <Plus size={18} /> New Order\r\n          </Link>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Stats Grid */}\r\n      <div className=\"stats-grid\" style={{ \r\n        display: 'grid', \r\n        gridTemplateColumns: 'repeat(auto-fill, minmax(260px, 1fr))', \r\n        gap: '24px',\r\n        marginBottom: '32px'\r\n      }}>\r\n        <StatCard\r\n          title=\"Opening Balance\"\r\n          value={`${(stats.openingBalance || 0).toLocaleString()}`}\r\n          trend=\"neutral\"\r\n          trendValue={0}\r\n          icon={Wallet}\r\n          color=\"warning\"\r\n        />\r\n        <StatCard\r\n          title=\"Today's Sales\"\r\n          value={`${stats.todayRevenue.toLocaleString()}`}\r\n          trend={stats.revenueTrend.direction}\r\n          trendValue={stats.revenueTrend.value}\r\n          icon={ShoppingBag}\r\n          color=\"primary\"\r\n        />\r\n        <StatCard\r\n          title=\"Total Expenses\"\r\n          value={`${(stats.todayExpenses || 0).toLocaleString()}`}\r\n          trend=\"neutral\"\r\n          trendValue={0}\r\n          icon={TrendingDown}\r\n          color=\"danger\"\r\n        />\r\n        <StatCard\r\n          title=\"Cash in Hand\"\r\n          value={`${(stats.cashInHand || 0).toLocaleString()}`}\r\n          trend=\"neutral\" \r\n          trendValue={0}\r\n          icon={DollarSign}\r\n          color=\"success\"\r\n        />\r\n        <StatCard\r\n          title=\"Total Orders\"\r\n          value={stats.totalOrders}\r\n          trend={stats.ordersTrend.direction}\r\n          trendValue={stats.ordersTrend.value}\r\n          icon={BarChart3}\r\n          color=\"info\"\r\n        />\r\n        {/* New Payment Method Cards */}\r\n        {stats.cashAmount > 0 && (\r\n          <StatCard\r\n            title=\"Cash Sales\"\r\n            value={`${stats.cashAmount.toLocaleString()}`}\r\n            trend=\"neutral\"\r\n            trendValue={0}\r\n            icon={DollarSign}\r\n            color=\"success\"\r\n          />\r\n        )}\r\n        {stats.upiAmount > 0 && (\r\n          <StatCard\r\n            title=\"UPI Sales\"\r\n            value={`${stats.upiAmount.toLocaleString()}`}\r\n            trend=\"neutral\"\r\n            trendValue={0}\r\n            icon={TrendingUp}\r\n            color=\"primary\"\r\n          />\r\n        )}\r\n        {stats.cardAmount > 0 && (\r\n          <StatCard\r\n            title=\"Card Sales\"\r\n            value={`${stats.cardAmount.toLocaleString()}`}\r\n            trend=\"neutral\"\r\n            trendValue={0}\r\n            icon={CheckCircle}\r\n            color=\"warning\"\r\n          />\r\n        )}\r\n        {stats.dueAmount > 0 && (\r\n          <StatCard\r\n            title=\"Unpaid/Due\"\r\n            value={`${stats.dueAmount.toLocaleString()}`}\r\n            trend=\"neutral\"\r\n            trendValue={0}\r\n            icon={MoreHorizontal}\r\n            color=\"info\"\r\n          />\r\n        )}\r\n        {stats.mixedAmount > 0 && (\r\n          <StatCard\r\n            title=\"Other Sales\"\r\n            value={`${stats.mixedAmount.toLocaleString()}`}\r\n            trend=\"neutral\"\r\n            trendValue={0}\r\n            icon={ShoppingBag}\r\n            color=\"info\"\r\n          />\r\n        )}\r\n      </div>\r\n\r\n      <div style={{ display: 'grid', gridTemplateColumns: '1fr 350px', gap: '32px', marginBottom: '32px' }}>\r\n        {/* Sales Trend Chart */}\r\n        <div className=\"card\" style={{ padding: '24px', borderRadius: '24px', border: '1px solid #f1f5f9' }}>\r\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>\r\n            <h3 style={{ margin: 0, fontSize: '18px', fontWeight: '800', color: '#1e293b' }}>Sales Trend (Last 7 Days)</h3>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#10b981', fontWeight: '700', fontSize: '14px' }}>\r\n              <TrendingUp size={16} /> 12% increase\r\n            </div>\r\n          </div>\r\n          <div style={{ height: '300px', width: '100%' }}>\r\n            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n              <AreaChart data={chartData.length > 0 ? chartData : [\r\n                {date: 'Mon', total_revenue: 0}, {date: 'Tue', total_revenue: 0}, \r\n                {date: 'Wed', total_revenue: 0}, {date: 'Thu', total_revenue: 0}, \r\n                {date: 'Fri', total_revenue: 0}, {date: 'Sat', total_revenue: 0}, \r\n                {date: 'Sun', total_revenue: 0}\r\n              ]}>\r\n                <defs>\r\n                  <linearGradient id=\"colorRev\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                    <stop offset=\"5%\" stopColor=\"#0096FF\" stopOpacity={0.2}/>\r\n                    <stop offset=\"95%\" stopColor=\"#0096FF\" stopOpacity={0}/>\r\n                  </linearGradient>\r\n                </defs>\r\n                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#f1f5f9\" />\r\n                <XAxis \r\n                  dataKey=\"date\" \r\n                  tickFormatter={(str) => {\r\n                    try { return format(new Date(str), 'MMM d'); } \r\n                    catch(e) { return str; }\r\n                  }} \r\n                  tick={{ fontSize: 12, fill: '#94a3b8', fontWeight: '500' }} \r\n                  axisLine={false} \r\n                  tickLine={false} \r\n                />\r\n                <YAxis \r\n                  tick={{ fontSize: 12, fill: '#94a3b8', fontWeight: '500' }} \r\n                  axisLine={false} \r\n                  tickLine={false} \r\n                  tickFormatter={(v) => `${v}`} \r\n                />\r\n                <Tooltip \r\n                  contentStyle={{ \r\n                    borderRadius: '16px', \r\n                    border: 'none', \r\n                    boxShadow: '0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04)',\r\n                    padding: '12px' \r\n                  }} \r\n                  itemStyle={{ fontWeight: '800', color: '#0096FF' }}\r\n                  labelStyle={{ fontWeight: '700', marginBottom: '4px' }}\r\n                />\r\n                <Area \r\n                  type=\"monotone\" \r\n                  dataKey=\"total_revenue\" \r\n                  stroke=\"#0096FF\" \r\n                  fillOpacity={1} \r\n                  fill=\"url(#colorRev)\" \r\n                  strokeWidth={4}\r\n                  dot={{ r: 4, fill: '#0096FF', strokeWidth: 2, stroke: '#fff' }}\r\n                  activeDot={{ r: 6, strokeWidth: 0 }}\r\n                />\r\n              </AreaChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Top Items Section */}\r\n        <div className=\"card\" style={{ padding: '24px', borderRadius: '24px', border: '1px solid #f1f5f9' }}>\r\n          <h3 style={{ margin: '0 0 20px 0', fontSize: '18px', fontWeight: '800', color: '#1e293b' }}>Top Selling Items</h3>\r\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>\r\n            {topItems.length > 0 ? topItems.map((item, idx) => (\r\n              <div key={idx} style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>\r\n                <div style={{ \r\n                  width: '40px', \r\n                  height: '40px', \r\n                  borderRadius: '10px', \r\n                  background: '#f1f5f9',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  fontSize: '14px',\r\n                  fontWeight: '800',\r\n                  color: '#64748b'\r\n                }}>\r\n                  #{idx + 1}\r\n                </div>\r\n                <div style={{ flex: 1 }}>\r\n                  <div style={{ fontSize: '14px', fontWeight: '700', color: '#1e293b' }}>{item.item_name}</div>\r\n                  <div style={{ fontSize: '12px', color: '#94a3b8' }}>{item.total_quantity} units sold</div>\r\n                </div>\r\n                <div style={{ fontSize: '14px', fontWeight: '800', color: '#10b981' }}>\r\n                  {item.total_revenue?.toFixed(0)}\r\n                </div>\r\n              </div>\r\n            )) : (\r\n              <div style={{ textAlign: 'center', padding: '40px 0', color: '#94a3b8' }}>\r\n                <BarChart3 size={40} style={{ opacity: 0.3, marginBottom: '12px' }} />\r\n                <p>No data yet</p>\r\n              </div>\r\n            )}\r\n          </div>\r\n          <Link to=\"/reports?category=sales\" style={{ \r\n            display: 'flex', \r\n            alignItems: 'center', \r\n            justifyContent: 'center', \r\n            gap: '8px',\r\n            marginTop: '24px',\r\n            padding: '12px',\r\n            borderRadius: '12px',\r\n            background: '#0096FF10',\r\n            color: '#0096FF',\r\n            fontSize: '13px',\r\n            fontWeight: '700',\r\n            textDecoration: 'none'\r\n          }}>\r\n            Detailed Sales Report <ArrowUpRight size={16} />\r\n          </Link>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Recent Orders Section */}\r\n      <div className=\"dashboard-section\">\r\n        <div className=\"section-header\" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>\r\n          <h2 className=\"section-title\" style={{ fontSize: '20px', fontWeight: '900', color: '#1e293b', margin: 0 }}>Recent Orders</h2>\r\n          <Link to=\"/orders\" className=\"section-link\" style={{ \r\n            display: 'flex', \r\n            alignItems: 'center', \r\n            gap: '6px', \r\n            color: '#0096FF', \r\n            fontWeight: '700', \r\n            fontSize: '14px',\r\n            textDecoration: 'none'\r\n          }}>\r\n            View All Orders <ArrowRight size={16} />\r\n          </Link>\r\n        </div>\r\n        <div className=\"orders-grid\" style={{ \r\n          display: 'grid', \r\n          gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', \r\n          gap: '24px' \r\n        }}>\r\n          {recentOrders.length > 0 ? (\r\n            recentOrders.map(order => (\r\n              <OrderCard key={order.id} order={order} onClick={async (selected) => {\r\n                try {\r\n                  const fullOrder = await window.electronAPI.invoke('order:getById', { id: selected.id });\r\n                  setSelectedOrder(fullOrder);\r\n                } catch (error) {\r\n                  console.error('Failed to fetch full order:', error);\r\n                  setSelectedOrder(selected);\r\n                }\r\n              }} />\r\n            ))\r\n          ) : (\r\n            <div className=\"empty-state\" style={{ gridColumn: '1 / -1', padding: '60px' }}>\r\n              <ShoppingCart size={48} color=\"#cbd5e1\" />\r\n              <p style={{ marginTop: '16px', color: '#94a3b8', fontWeight: '600' }}>No orders placed today yet.</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      {/* Order Details Modal */}\r\n      <OrderDetailsModal\r\n        order={selectedOrder}\r\n        onClose={() => setSelectedOrder(null)}\r\n      />\r\n\r\n      <AddBalanceModal\r\n        isOpen={showAddBalanceModal}\r\n        onClose={() => setShowAddBalanceModal(false)}\r\n        onAdd={handleAddBalance}\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DashboardPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\DiscountsPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'Tag' is defined but never used.","line":3,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'CheckCircle' is defined but never used.","line":3,"column":36,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'XCircle' is defined but never used.","line":3,"column":49,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":56},{"ruleId":"no-unused-vars","severity":1,"message":"'user' is assigned a value but never used.","line":7,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":15},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":31,"column":6,"nodeType":"ArrayExpression","endLine":31,"endColumn":8,"suggestions":[{"desc":"Update the dependencies array to be: [loadData]","fix":{"range":[978,980],"text":"[loadData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { Tag, Plus, Edit2, Trash2, CheckCircle, XCircle } from 'lucide-react';\r\nimport CustomAlert from '../components/ui/CustomAlert';\r\n\r\nconst DiscountsPage = () => {\r\n  const { user } = useAuthStore();\r\n  const [discounts, setDiscounts] = useState([]);\r\n  const [menuItems, setMenuItems] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  \r\n  // Modal State\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [editingDiscount, setEditingDiscount] = useState(null);\r\n  \r\n  // Form State\r\n  const [formData, setFormData] = useState({\r\n    menu_item_id: '',\r\n    variant_name: '',\r\n    discount_type: 'percentage',\r\n    discount_value: '',\r\n    start_date: '',\r\n    end_date: '',\r\n    is_active: true\r\n  });\r\n\r\n  const [alert, setAlert] = useState({ show: false, message: '', type: 'info' });\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n  }, []);\r\n\r\n  const loadData = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const dbDiscounts = await window.electronAPI.invoke('discounts:getAll');\r\n      const items = await window.electronAPI.invoke('menu:getItems', {});\r\n      \r\n      setDiscounts(dbDiscounts || []);\r\n      setMenuItems(items || []);\r\n    } catch (err) {\r\n      console.error(err);\r\n      showAlert('Failed to load discounts', 'error');\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const showAlert = (message, type = 'info', onConfirm = null) => {\r\n    setAlert({ show: true, message, type, onConfirm });\r\n  };\r\n\r\n  const closeAlert = () => setAlert({ ...alert, show: false });\r\n\r\n  const handleOpenModal = (discount = null) => {\r\n    if (discount) {\r\n      setEditingDiscount(discount);\r\n      setFormData({\r\n        menu_item_id: discount.menu_item_id || '',\r\n        variant_name: discount.variant_name || '',\r\n        discount_type: discount.discount_type || 'percentage',\r\n        discount_value: discount.discount_value || '',\r\n        start_date: discount.start_date ? discount.start_date.split('T')[0] : '',\r\n        end_date: discount.end_date ? discount.end_date.split('T')[0] : '',\r\n        is_active: discount.is_active === 1\r\n      });\r\n    } else {\r\n      setEditingDiscount(null);\r\n      setFormData({\r\n        menu_item_id: '',\r\n        variant_name: '',\r\n        discount_type: 'percentage',\r\n        discount_value: '',\r\n        start_date: '',\r\n        end_date: '',\r\n        is_active: true\r\n      });\r\n    }\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    \r\n    if (!formData.menu_item_id || !formData.discount_value) {\r\n      return showAlert('Please fill out required fields', 'error');\r\n    }\r\n\r\n    try {\r\n      const payload = {\r\n        menu_item_id: formData.menu_item_id,\r\n        variant_name: formData.variant_name || null,\r\n        discount_type: formData.discount_type,\r\n        discount_value: parseFloat(formData.discount_value),\r\n        start_date: formData.start_date ? new Date(formData.start_date).toISOString() : null,\r\n        end_date: formData.end_date ? new Date(formData.end_date).toISOString() : null,\r\n        is_active: formData.is_active ? 1 : 0\r\n      };\r\n\r\n      if (editingDiscount) {\r\n        await window.electronAPI.invoke('discounts:update', { id: editingDiscount.id, updates: payload });\r\n        showAlert('Discount Updated Successfully', 'success');\r\n      } else {\r\n        await window.electronAPI.invoke('discounts:add', payload);\r\n        showAlert('Discount Added Successfully', 'success');\r\n      }\r\n      setShowModal(false);\r\n      loadData();\r\n    } catch (error) {\r\n      console.error('Save error', error);\r\n      showAlert('Failed to save discount: ' + error.message, 'error');\r\n    }\r\n  };\r\n\r\n  const handleDelete = (id) => {\r\n    showAlert('Are you sure you want to delete this discount?', 'confirm', async () => {\r\n      try {\r\n        await window.electronAPI.invoke('discounts:delete', { id });\r\n        showAlert('Discount Deleted', 'success');\r\n        loadData();\r\n      } catch (err) {\r\n        showAlert('Failed to delete', 'error');\r\n      }\r\n    });\r\n  };\r\n\r\n  if (isLoading) {\r\n    return <div className=\"page-container\" style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100vh' }}>Loading...</div>;\r\n  }\r\n\r\n  // Get selected item's variants to populate the variant dropdown\r\n  const selectedItem = menuItems.find(i => i.id === formData.menu_item_id);\r\n  let itemVariants = [];\r\n  if (selectedItem && selectedItem.variants) {\r\n    try {\r\n      itemVariants = JSON.parse(selectedItem.variants);\r\n    } catch (e) {\r\n      itemVariants = [];\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"page-container\" style={{ background: '#f8fafc', padding: '32px' }}>\r\n      <div className=\"page-header\" style={{ marginBottom: '32px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n        <div>\r\n          <h1 className=\"page-title\" style={{ fontSize: '28px', fontWeight: '900', color: '#1e293b' }}>Discounts</h1>\r\n          <p className=\"page-subtitle\" style={{ color: '#64748b', fontSize: '15px' }}>Manage automated item and variant-level discounts.</p>\r\n        </div>\r\n        <button className=\"btn btn-primary\" onClick={() => handleOpenModal()} style={{ borderRadius: '12px', padding: '10px 20px', fontWeight: '700' }}>\r\n          <Plus size={18} /> Add Discount\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"card\" style={{ background: 'white', borderRadius: '16px', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)', overflow: 'hidden' }}>\r\n        <table className=\"table\" style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n          <thead style={{ background: '#f8fafc', borderBottom: '1px solid #e2e8f0' }}>\r\n            <tr>\r\n              <th style={{ padding: '16px', textAlign: 'left', color: '#475569', fontWeight: '600' }}>Item Name</th>\r\n              <th style={{ padding: '16px', textAlign: 'left', color: '#475569', fontWeight: '600' }}>Variant</th>\r\n              <th style={{ padding: '16px', textAlign: 'left', color: '#475569', fontWeight: '600' }}>Discount</th>\r\n              <th style={{ padding: '16px', textAlign: 'left', color: '#475569', fontWeight: '600' }}>Duration</th>\r\n              <th style={{ padding: '16px', textAlign: 'center', color: '#475569', fontWeight: '600' }}>Status</th>\r\n              <th style={{ padding: '16px', textAlign: 'right', color: '#475569', fontWeight: '600' }}>Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {discounts.length === 0 ? (\r\n              <tr>\r\n                <td colSpan=\"6\" style={{ textAlign: 'center', padding: '32px', color: '#64748b' }}>No discounts configured.</td>\r\n              </tr>\r\n            ) : (\r\n              discounts.map(d => (\r\n                <tr key={d.id} style={{ borderBottom: '1px solid #f1f5f9' }}>\r\n                  <td style={{ padding: '16px', fontWeight: '500' }}>{d.item_name || 'Unknown Item'}</td>\r\n                  <td style={{ padding: '16px', color: '#64748b' }}>{d.variant_name || 'All Variants'}</td>\r\n                  <td style={{ padding: '16px', fontWeight: 'bold', color: '#0096FF' }}>\r\n                    {d.discount_type === 'percentage' ? `${d.discount_value}%` : `${d.discount_value}`} OFF\r\n                  </td>\r\n                  <td style={{ padding: '16px', color: '#475569', fontSize: '14px' }}>\r\n                    {(!d.start_date && !d.end_date) ? 'Always Active' : \r\n                     `${d.start_date ? new Date(d.start_date).toLocaleDateString() : 'Forever'} - ${d.end_date ? new Date(d.end_date).toLocaleDateString() : 'Forever'}`\r\n                    }\r\n                  </td>\r\n                  <td style={{ padding: '16px', textAlign: 'center' }}>\r\n                    {d.is_active ? \r\n                      <span style={{ display: 'inline-block', padding: '4px 8px', borderRadius: '12px', background: '#dcfce7', color: '#166534', fontSize: '12px', fontWeight: 'bold' }}>Active</span> : \r\n                      <span style={{ display: 'inline-block', padding: '4px 8px', borderRadius: '12px', background: '#fee2e2', color: '#991b1b', fontSize: '12px', fontWeight: 'bold' }}>Inactive</span>\r\n                    }\r\n                  </td>\r\n                  <td style={{ padding: '16px', textAlign: 'right' }}>\r\n                    <button className=\"btn btn-ghost btn-icon\" onClick={() => handleOpenModal(d)} style={{ color: '#0096FF', marginRight: '8px' }}>\r\n                      <Edit2 size={16} />\r\n                    </button>\r\n                    <button className=\"btn btn-ghost btn-icon\" onClick={() => handleDelete(d.id)} style={{ color: '#ef4444' }}>\r\n                      <Trash2 size={16} />\r\n                    </button>\r\n                  </td>\r\n                </tr>\r\n              ))\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {showModal && (\r\n        <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', zIndex: 9999, display: 'flex', justifyContent: 'center', alignItems: 'center' }} onClick={() => setShowModal(false)}>\r\n          <div style={{ background: 'white', width: '90%', maxWidth: '500px', borderRadius: '16px', padding: '24px', position: 'relative', boxShadow: '0 4px 20px rgba(0,0,0,0.15)' }} onClick={e => e.stopPropagation()}>\r\n            <h2 style={{ margin: '0 0 20px 0', fontSize: '20px', color: '#1e293b' }}>\r\n              {editingDiscount ? 'Edit Discount' : 'Add New Discount'}\r\n            </h2>\r\n            <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>\r\n              \r\n              <div>\r\n                <label style={{ display: 'block', marginBottom: '8px', fontWeight: '600', color: '#475569', fontSize: '14px' }}>Menu Item *</label>\r\n                <select \r\n                  className=\"input\" \r\n                  value={formData.menu_item_id} \r\n                  onChange={(e) => setFormData({ ...formData, menu_item_id: e.target.value, variant_name: '' })} \r\n                  required\r\n                  style={{ width: '100%', padding: '10px', borderRadius: '8px', border: '1px solid #cbd5e1' }}\r\n                >\r\n                  <option value=\"\">Select an Item</option>\r\n                  {menuItems.map(item => (\r\n                    <option key={item.id} value={item.id}>{item.name}</option>\r\n                  ))}\r\n                </select>\r\n              </div>\r\n\r\n              {itemVariants.length > 0 && (\r\n                <div>\r\n                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '600', color: '#475569', fontSize: '14px' }}>Specific Variant (Optional)</label>\r\n                  <select \r\n                    className=\"input\" \r\n                    value={formData.variant_name} \r\n                    onChange={(e) => setFormData({ ...formData, variant_name: e.target.value })} \r\n                    style={{ width: '100%', padding: '10px', borderRadius: '8px', border: '1px solid #cbd5e1' }}\r\n                  >\r\n                    <option value=\"\">Apply to ALL Variants</option>\r\n                    {itemVariants.map(v => (\r\n                      <option key={v.name} value={v.name}>{v.name} ({v.price})</option>\r\n                    ))}\r\n                  </select>\r\n                </div>\r\n              )}\r\n\r\n              <div style={{ display: 'flex', gap: '16px' }}>\r\n                <div style={{ flex: 1 }}>\r\n                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '600', color: '#475569', fontSize: '14px' }}>Discount Type</label>\r\n                  <select \r\n                    className=\"input\" \r\n                    value={formData.discount_type} \r\n                    onChange={(e) => setFormData({ ...formData, discount_type: e.target.value })} \r\n                    style={{ width: '100%', padding: '10px', borderRadius: '8px', border: '1px solid #cbd5e1' }}\r\n                  >\r\n                    <option value=\"percentage\">Percentage (%)</option>\r\n                    <option value=\"flat\">Flat Amount ()</option>\r\n                  </select>\r\n                </div>\r\n                <div style={{ flex: 1 }}>\r\n                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '600', color: '#475569', fontSize: '14px' }}>Discount Value *</label>\r\n                  <input \r\n                    type=\"number\" \r\n                    className=\"input\" \r\n                    value={formData.discount_value} \r\n                    onChange={(e) => setFormData({ ...formData, discount_value: e.target.value })} \r\n                    required min=\"0\" step=\"0.01\" \r\n                    placeholder={formData.discount_type === 'percentage' ? 'e.g., 10 for 10%' : 'e.g., 50 for 50'}\r\n                    style={{ width: '100%', padding: '10px', borderRadius: '8px', border: '1px solid #cbd5e1' }}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div style={{ display: 'flex', gap: '16px' }}>\r\n                <div style={{ flex: 1 }}>\r\n                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '600', color: '#475569', fontSize: '14px' }}>Start Date (Optional)</label>\r\n                  <input \r\n                    type=\"date\" \r\n                    className=\"input\" \r\n                    value={formData.start_date} \r\n                    onChange={(e) => setFormData({ ...formData, start_date: e.target.value })} \r\n                    style={{ width: '100%', padding: '10px', borderRadius: '8px', border: '1px solid #cbd5e1' }}\r\n                  />\r\n                </div>\r\n                <div style={{ flex: 1 }}>\r\n                  <label style={{ display: 'block', marginBottom: '8px', fontWeight: '600', color: '#475569', fontSize: '14px' }}>End Date (Optional)</label>\r\n                  <input \r\n                    type=\"date\" \r\n                    className=\"input\" \r\n                    value={formData.end_date} \r\n                    onChange={(e) => setFormData({ ...formData, end_date: e.target.value })} \r\n                    style={{ width: '100%', padding: '10px', borderRadius: '8px', border: '1px solid #cbd5e1' }}\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', marginTop: '8px' }}>\r\n                <input \r\n                  type=\"checkbox\" \r\n                  checked={formData.is_active} \r\n                  onChange={(e) => setFormData({ ...formData, is_active: e.target.checked })} \r\n                  style={{ width: '18px', height: '18px', accentColor: '#0096FF' }}\r\n                />\r\n                <span style={{ fontWeight: '600', color: '#475569' }}>Active</span>\r\n              </label>\r\n\r\n              <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px', marginTop: '20px' }}>\r\n                <button type=\"button\" onClick={() => setShowModal(false)} style={{ padding: '10px 16px', borderRadius: '8px', border: '1px solid #cbd5e1', background: 'white', cursor: 'pointer', fontWeight: 'bold', color: '#64748b' }}>\r\n                  Cancel\r\n                </button>\r\n                <button type=\"submit\" style={{ padding: '10px 20px', borderRadius: '8px', border: 'none', background: '#0096FF', color: 'white', fontWeight: 'bold', cursor: 'pointer' }}>\r\n                  Save Discount\r\n                </button>\r\n              </div>\r\n            </form>\r\n          </div>\r\n        </div>\r\n      )}\r\n\r\n      {alert.show && (\r\n        <CustomAlert\r\n          message={alert.message}\r\n          type={alert.type}\r\n          onClose={closeAlert}\r\n          onConfirm={alert.onConfirm}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DiscountsPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\ExpensesPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'loading' is assigned a value but never used.","line":12,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchExistingExpenses'. Either include it or remove the dependency array.","line":34,"column":6,"nodeType":"ArrayExpression","endLine":34,"endColumn":23,"suggestions":[{"desc":"Update the dependencies array to be: [date, employees, fetchExistingExpenses]","fix":{"range":[1180,1197],"text":"[date, employees, fetchExistingExpenses]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { ArrowLeft, Plus, Trash2, Save, Calendar, AlertCircle } from 'lucide-react';\r\nimport { useAuthStore } from '../stores/authStore';\r\n\r\nconst ExpensesPage = () => {\r\n  const navigate = useNavigate();\r\n  const { user } = useAuthStore();\r\n  \r\n  const [date, setDate] = useState(new Date().toISOString().split('T')[0]);\r\n  const [employees, setEmployees] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [saving, setSaving] = useState(false);\r\n\r\n  // Initial empty rows\r\n  const [rows, setRows] = useState([]);\r\n\r\n  const reasons = [\r\n    \"Milk\", \"Vegetables\", \"Groceries\", \"Staff-Expense\", \"Electricity bill\",\r\n    \"Gas\", \"Maintenance\", \"Other\", \"Cold Drink\", \"Paneer\", \"Momos\",\r\n    \"Disposable\", \"Ice Cream\", \"Buns\", \"Void\", \"Home\", \"Raw material\",\r\n    \"Mozzarella cheese\", \"Blend\"\r\n  ];\r\n\r\n  useEffect(() => {\r\n    fetchEmployees();\r\n  }, []);\r\n\r\n  // Initialize rows once employees are loaded (to get current user ID) or when date changes\r\n  useEffect(() => {\r\n    if (employees.length > 0) {\r\n        fetchExistingExpenses(date);\r\n    }\r\n  }, [date, employees]);\r\n\r\n  const fetchEmployees = async () => {\r\n    try {\r\n      const users = await window.electronAPI.invoke('users:getAll');\r\n      setEmployees(users || []);\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch employees\", error);\r\n    }\r\n  };\r\n\r\n  const createEmptyRow = () => ({\r\n    reason: '',\r\n    amount: '',\r\n    explanation: '',\r\n    employee_id: user?.id || '', // Auto-select current user\r\n    paid_from: 'cash'\r\n  });\r\n\r\n  const fetchExistingExpenses = async (selectedDate) => {\r\n    setLoading(true);\r\n    try {\r\n      const existing = await window.electronAPI.invoke('expenses:getByDate', { date: selectedDate });\r\n      \r\n      if (existing && existing.length > 0) {\r\n        const mapped = existing.map(e => ({\r\n          id: e.id,\r\n          reason: e.reason,\r\n          amount: e.amount,\r\n          explanation: e.explanation,\r\n          employee_id: e.employee_id,\r\n          paid_from: e.paid_from\r\n        }));\r\n        \r\n        const padding = Math.max(0, 10 - mapped.length);\r\n        const emptyRows = Array(padding).fill().map(createEmptyRow);\r\n        \r\n        setRows([...mapped, ...emptyRows]);\r\n      } else {\r\n        setRows(Array(10).fill().map(createEmptyRow));\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Failed to fetch expenses\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleAddRows = () => {\r\n    const newRows = Array(10).fill().map(createEmptyRow);\r\n    setRows(prev => [...prev, ...newRows]);\r\n  };\r\n\r\n  const handleChange = (index, field, value) => {\r\n    const newRows = [...rows];\r\n    newRows[index] = { ...newRows[index], [field]: value };\r\n    setRows(newRows);\r\n  };\r\n\r\n  const handleDeleteRow = async (index) => {\r\n    const row = rows[index];\r\n    if (row.id) {\r\n        if (!window.confirm(\"Are you sure you want to delete this saved expense?\")) return;\r\n        try {\r\n            await window.electronAPI.invoke('expenses:delete', { id: row.id });\r\n        } catch (error) {\r\n            console.error(\"Failed to delete expense\", error);\r\n            alert(\"Failed to delete expense\");\r\n            return;\r\n        }\r\n    }\r\n    \r\n    const newRows = rows.filter((_, i) => i !== index);\r\n    setRows(newRows);\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    const validRows = rows.filter(r => r.reason && r.amount);\r\n    \r\n    if (validRows.length === 0) {\r\n        alert(\"Please enter at least one expense with Reason and Amount.\");\r\n        return;\r\n    }\r\n\r\n    setSaving(true);\r\n    try {\r\n        const newRows = validRows.filter(r => !r.id);\r\n        \r\n        if (newRows.length === 0) {\r\n            setSaving(false);\r\n            return;\r\n        }\r\n\r\n        const expensesToSave = newRows.map(r => ({\r\n            ...r,\r\n            date: date,\r\n            employee_name: employees.find(e => e.id === r.employee_id)?.full_name || ''\r\n        }));\r\n\r\n        await window.electronAPI.invoke('expenses:create', { expenses: expensesToSave });\r\n        \r\n        // Silent success\r\n        fetchExistingExpenses(date);\r\n    } catch (error) {\r\n        console.error(\"Failed to save expenses\", error);\r\n        alert(\"Failed to save: \" + error.message);\r\n    } finally {\r\n        setSaving(false);\r\n    }\r\n  };\r\n\r\n  const totalExpenses = rows.reduce((sum, row) => sum + (parseFloat(row.amount) || 0), 0);\r\n\r\n  return (\r\n    <div className=\"page-content\" style={{ animation: 'fadeIn 0.3s ease-out' }}>\r\n      \r\n      {/* Header */}\r\n      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 'var(--spacing-6)' }}>\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 'var(--spacing-3)' }}>\r\n          <button \r\n            onClick={() => navigate(-1)}\r\n            className=\"btn btn-ghost btn-icon\"\r\n            style={{ borderRadius: '50%' }}\r\n          >\r\n            <ArrowLeft size={24} />\r\n          </button>\r\n          <div>\r\n            <h1 style={{ fontSize: 'var(--font-size-2xl)', marginBottom: 'var(--spacing-1)' }}>Expense Details</h1>\r\n            <p style={{ color: 'var(--gray-500)' }}>Manage daily store expenses</p>\r\n          </div>\r\n        </div>\r\n        \r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 'var(--spacing-3)' }}>\r\n            {/* Total Badge */}\r\n            <div className=\"card\" style={{ padding: 'var(--spacing-2) var(--spacing-4)', display: 'flex', alignItems: 'center', gap: 'var(--spacing-2)', background: 'var(--primary-50)', border: '1px solid var(--primary-100)' }}>\r\n                <span style={{ color: 'var(--primary-700)', fontWeight: 600 }}>Total:</span>\r\n                <span style={{ fontSize: 'var(--font-size-lg)', fontWeight: 700, color: 'var(--primary-700)' }}>{totalExpenses.toFixed(2)}</span>\r\n            </div>\r\n\r\n            {/* Date Picker */}\r\n            <div className=\"card\" style={{ padding: 'var(--spacing-2) var(--spacing-4)', display: 'flex', alignItems: 'center', gap: 'var(--spacing-2)' }}>\r\n                <Calendar size={18} style={{ color: 'var(--gray-500)' }} />\r\n                <input \r\n                    type=\"date\" \r\n                    value={date}\r\n                    onChange={(e) => setDate(e.target.value)}\r\n                    style={{ border: 'none', outline: 'none', fontSize: 'var(--font-size-sm)', fontWeight: 500, color: 'var(--gray-700)', fontFamily: 'inherit' }}\r\n                />\r\n            </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Info Warning */}\r\n      <div style={{ marginBottom: 'var(--spacing-6)', padding: 'var(--spacing-3) var(--spacing-4)', background: 'var(--info-50)', border: '1px solid var(--info-100)', borderRadius: 'var(--radius-lg)', display: 'flex', alignItems: 'center', gap: 'var(--spacing-3)', color: 'var(--info-700)', fontSize: 'var(--font-size-sm)' }}>\r\n        <AlertCircle size={18} />\r\n        <span>Only rows with both <strong>Reason</strong> & <strong>Amount</strong> will be saved. Empty rows are ignored.</span>\r\n      </div>\r\n\r\n      {/* Table Container */}\r\n      <div className=\"table-container\">\r\n        <table className=\"table\">\r\n          <thead>\r\n            <tr>\r\n              <th style={{ width: '60px', textAlign: 'center' }}>#</th>\r\n              <th style={{ width: '20%' }}>Reason</th>\r\n              <th style={{ width: '15%' }}>Amount ()</th>\r\n              <th style={{ width: '25%' }}>Explanation</th>\r\n              <th style={{ width: '15%' }}>Employee</th>\r\n              <th style={{ width: '15%' }}>Paid From</th>\r\n              <th style={{ width: '80px', textAlign: 'center' }}>Action</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {rows.map((row, index) => (\r\n              <tr key={index} style={{ backgroundColor: row.id ? 'var(--success-50)' : 'white' }}>\r\n                {/* Serial # */}\r\n                <td style={{ textAlign: 'center', color: 'var(--gray-400)', fontSize: 'var(--font-size-xs)' }}>\r\n                  {index + 1}\r\n                </td>\r\n\r\n                {/* Reason */}\r\n                <td style={{ padding: 'var(--spacing-2) var(--spacing-3)' }}>\r\n                    {row.id ? (\r\n                        <div style={{ fontWeight: 500 }}>{row.reason}</div>\r\n                    ) : (\r\n                        <select \r\n                            className=\"input select\"\r\n                            value={row.reason}\r\n                            onChange={(e) => handleChange(index, 'reason', e.target.value)}\r\n                            style={{ width: '100%' }}\r\n                        >\r\n                            <option value=\"\">Select Reason</option>\r\n                            {reasons.map(r => <option key={r} value={r}>{r}</option>)}\r\n                        </select>\r\n                    )}\r\n                </td>\r\n\r\n                {/* Amount */}\r\n                <td style={{ padding: 'var(--spacing-2) var(--spacing-3)' }}>\r\n                    {row.id ? (\r\n                        <div style={{ fontFamily: 'monospace', fontWeight: 600 }}>{row.amount}</div>\r\n                    ) : (\r\n                        <input \r\n                            type=\"number\" \r\n                            placeholder=\"0.00\"\r\n                            className=\"input\"\r\n                            value={row.amount}\r\n                            onChange={(e) => handleChange(index, 'amount', e.target.value)}\r\n                            style={{ width: '100%' }}\r\n                        />\r\n                    )}\r\n                </td>\r\n\r\n                {/* Explanation */}\r\n                <td style={{ padding: 'var(--spacing-2) var(--spacing-3)' }}>\r\n                    {row.id ? (\r\n                        <div style={{ color: 'var(--gray-600)', fontSize: 'var(--font-size-sm)' }}>{row.explanation || '-'}</div>\r\n                    ) : (\r\n                        <input \r\n                            type=\"text\" \r\n                            placeholder=\"Optional explanation...\"\r\n                            className=\"input\"\r\n                            value={row.explanation}\r\n                            onChange={(e) => handleChange(index, 'explanation', e.target.value)}\r\n                            style={{ width: '100%' }}\r\n                        />\r\n                    )}\r\n                </td>\r\n\r\n                {/* Employee */}\r\n                <td style={{ padding: 'var(--spacing-2) var(--spacing-3)' }}>\r\n                    {row.id ? (\r\n                        <div style={{ fontSize: 'var(--font-size-sm)' }}>\r\n                             {employees.find(e => e.id === row.employee_id)?.full_name || 'Unknown'}\r\n                        </div>\r\n                    ) : (\r\n                        <select \r\n                            className=\"input select\"\r\n                            value={row.employee_id}\r\n                            onChange={(e) => handleChange(index, 'employee_id', e.target.value)}\r\n                            style={{ width: '100%' }}\r\n                        >\r\n                            <option value=\"\">Select Employee</option>\r\n                            {employees.map(emp => (\r\n                                <option key={emp.id} value={emp.id}>{emp.full_name}</option>\r\n                            ))}\r\n                        </select>\r\n                    )}\r\n                </td>\r\n\r\n                {/* Paid From */}\r\n                <td style={{ padding: 'var(--spacing-2) var(--spacing-3)' }}>\r\n                     {row.id ? (\r\n                        <div style={{ textTransform: 'capitalize' }}>{row.paid_from}</div>\r\n                    ) : (\r\n                        <select \r\n                            className=\"input select\"\r\n                            value={row.paid_from}\r\n                            onChange={(e) => handleChange(index, 'paid_from', e.target.value)}\r\n                            style={{ width: '100%' }}\r\n                        >\r\n                            <option value=\"cash\">Cash</option>\r\n                            <option value=\"card\">Card</option>\r\n                            <option value=\"upi\">UPI</option>\r\n                        </select>\r\n                    )}\r\n                </td>\r\n\r\n                {/* Action */}\r\n                <td style={{ textAlign: 'center' }}>\r\n                   <button \r\n                      onClick={() => handleDeleteRow(index)}\r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      style={{ color: 'var(--error-500)' }}\r\n                      title=\"Delete Row\"\r\n                  >\r\n                      <Trash2 size={16} />\r\n                  </button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {/* Footer Actions */}\r\n      <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: 'var(--spacing-6)', paddingBottom: 'var(--spacing-10)' }}>\r\n        <button \r\n            onClick={handleAddRows}\r\n            className=\"btn btn-secondary\"\r\n        >\r\n            <Plus size={16} />\r\n            Add 10 Rows\r\n        </button>\r\n\r\n        <div style={{ display: 'flex', gap: 'var(--spacing-3)' }}>\r\n            <button \r\n                onClick={() => navigate(-1)}\r\n                className=\"btn btn-secondary\"\r\n            >\r\n                Cancel\r\n            </button>\r\n            <button \r\n                onClick={handleSave}\r\n                disabled={saving}\r\n                className=\"btn btn-primary\"\r\n                style={{ minWidth: '150px' }}\r\n            >\r\n                <Save size={16} />\r\n                {saving ? 'Saving...' : 'Save Expenses'}\r\n            </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ExpensesPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\InventoryPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'Save' is defined but never used.","line":8,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":8,"endColumn":7},{"ruleId":"no-unused-vars","severity":1,"message":"'TrendingDown' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":15}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Package, \r\n  Plus, \r\n  AlertTriangle,\r\n  Search,\r\n  X,\r\n  Save,\r\n  TrendingDown,\r\n  TrendingUp,\r\n  History,\r\n  Trash2,\r\n  MoreVertical\r\n} from 'lucide-react';\r\n\r\nconst InventoryPage = () => {\r\n  const [inventory, setInventory] = useState([]);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [showStockModal, setShowStockModal] = useState(false);\r\n  const [showHistoryModal, setShowHistoryModal] = useState(false);\r\n  const [editingItem, setEditingItem] = useState(null);\r\n  const [stockUpdateItem, setStockUpdateItem] = useState(null);\r\n  const [historyItem, setHistoryItem] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [showLowStock, setShowLowStock] = useState(false);\r\n\r\n  useEffect(() => {\r\n    loadInventory();\r\n  }, []);\r\n\r\n  const loadInventory = async () => {\r\n    try {\r\n      const result = await window.electronAPI.invoke('inventory:getAll');\r\n      setInventory(result);\r\n    } catch (error) {\r\n      console.error('Failed to load inventory:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const filteredInventory = inventory.filter(item => {\r\n    const matchesSearch = !searchQuery || \r\n      item.name.toLowerCase().includes(searchQuery.toLowerCase());\r\n    const matchesLowStock = !showLowStock || item.current_stock <= item.minimum_stock;\r\n    return matchesSearch && matchesLowStock;\r\n  });\r\n\r\n  const lowStockCount = inventory.filter(i => i.current_stock <= i.minimum_stock).length;\r\n  const totalValue = inventory.reduce((sum, item) => sum + (item.current_stock * (item.cost_per_unit || 0)), 0);\r\n\r\n  const handleEdit = (item) => {\r\n    setEditingItem(item);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleDelete = async (item) => {\r\n    if (window.confirm(`Are you sure you want to delete \"${item.name}\"?`)) {\r\n      try {\r\n        await window.electronAPI.invoke('inventory:delete', { id: item.id });\r\n        loadInventory();\r\n      } catch (error) {\r\n        console.error('Delete failed:', error);\r\n        alert('Failed to delete item');\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleStockUpdate = (item) => {\r\n    setStockUpdateItem(item);\r\n    setShowStockModal(true);\r\n  };\r\n\r\n  const handleHistory = (item) => {\r\n    setHistoryItem(item);\r\n    setShowHistoryModal(true);\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{ padding: 'var(--spacing-6)', textAlign: 'center' }}>\r\n        <p>Loading inventory...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"page-content\" style={{ animation: 'fadeIn 0.3s ease-out' }}>\r\n      {/* Header */}\r\n      <div style={{ \r\n        display: 'flex', \r\n        justifyContent: 'space-between', \r\n        alignItems: 'center', \r\n        marginBottom: 'var(--spacing-6)' \r\n      }}>\r\n        <div>\r\n          <h1 style={{ fontSize: 'var(--font-size-2xl)', marginBottom: 'var(--spacing-1)' }}>Inventory Management</h1>\r\n          <p style={{ color: 'var(--gray-500)' }}>Track stock levels, value, and history</p>\r\n        </div>\r\n        <button \r\n          className=\"btn btn-primary\"\r\n          onClick={() => {\r\n            setEditingItem(null);\r\n            setShowModal(true);\r\n          }}\r\n        >\r\n          <Plus size={18} />\r\n          Add Item\r\n        </button>\r\n      </div>\r\n\r\n      {/* Stats Grid */}\r\n      <div style={{ \r\n        display: 'grid', \r\n        gridTemplateColumns: 'repeat(auto-fit, minmax(240px, 1fr))', \r\n        gap: 'var(--spacing-4)', \r\n        marginBottom: 'var(--spacing-6)' \r\n      }}>\r\n        {/* Total Items */}\r\n        <div className=\"card\" style={{ padding: 'var(--spacing-4)', display: 'flex', alignItems: 'center', gap: 'var(--spacing-4)' }}>\r\n          <div style={{ \r\n            padding: 'var(--spacing-3)', \r\n            borderRadius: 'var(--radius-full)', \r\n            background: 'var(--info-50)', \r\n            color: 'var(--info-600)' \r\n          }}>\r\n            <Package size={24} />\r\n          </div>\r\n          <div>\r\n            <div style={{ fontSize: 'var(--font-size-2xl)', fontWeight: 'bold' }}>{inventory.length}</div>\r\n            <div style={{ fontSize: 'var(--font-size-sm)', color: 'var(--gray-500)' }}>Total Items</div>\r\n          </div>\r\n        </div>\r\n        \r\n        {/* Low Stock */}\r\n        <div \r\n          className=\"card\" \r\n          style={{ \r\n            padding: 'var(--spacing-4)', \r\n            display: 'flex', \r\n            alignItems: 'center', \r\n            gap: 'var(--spacing-4)',\r\n            cursor: 'pointer',\r\n            border: showLowStock ? '2px solid var(--warning-500)' : '1px solid var(--gray-200)'\r\n          }}\r\n          onClick={() => setShowLowStock(!showLowStock)}\r\n        >\r\n          <div style={{ \r\n            padding: 'var(--spacing-3)', \r\n            borderRadius: 'var(--radius-full)', \r\n            background: 'var(--warning-50)', \r\n            color: 'var(--warning-600)' \r\n          }}>\r\n            <AlertTriangle size={24} />\r\n          </div>\r\n          <div>\r\n            <div style={{ fontSize: 'var(--font-size-2xl)', fontWeight: 'bold', color: 'var(--warning-600)' }}>{lowStockCount}</div>\r\n            <div style={{ fontSize: 'var(--font-size-sm)', color: 'var(--gray-500)' }}>Low Stock Items</div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Total Value */}\r\n        <div className=\"card\" style={{ padding: 'var(--spacing-4)', display: 'flex', alignItems: 'center', gap: 'var(--spacing-4)' }}>\r\n          <div style={{ \r\n            padding: 'var(--spacing-3)', \r\n            borderRadius: 'var(--radius-full)', \r\n            background: 'var(--success-50)', \r\n            color: 'var(--success-600)',\r\n            width: '48px', height: '48px', display: 'flex', alignItems: 'center', justifyContent: 'center'\r\n          }}>\r\n            <span style={{ fontSize: 'var(--font-size-xl)', fontWeight: 'bold' }}></span>\r\n          </div>\r\n          <div>\r\n            <div style={{ fontSize: 'var(--font-size-2xl)', fontWeight: 'bold' }}>{totalValue.toLocaleString()}</div>\r\n            <div style={{ fontSize: 'var(--font-size-sm)', color: 'var(--gray-500)' }}>Total Stock Value</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div style={{ display: 'flex', gap: 'var(--spacing-4)', marginBottom: 'var(--spacing-4)', alignItems: 'center' }}>\r\n        <div style={{ position: 'relative', flex: 1, maxWidth: '400px' }}>\r\n          <Search \r\n            size={18} \r\n            style={{ \r\n              position: 'absolute', \r\n              left: '12px', \r\n              top: '50%', \r\n              transform: 'translateY(-50%)', \r\n              color: 'var(--gray-400)' \r\n            }}\r\n          />\r\n          <input\r\n            type=\"text\"\r\n            className=\"input\"\r\n            style={{ paddingLeft: '40px' }}\r\n            placeholder=\"Search by item name...\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n          />\r\n        </div>\r\n        \r\n        {showLowStock && (\r\n          <button\r\n            className=\"btn btn-ghost\"\r\n            style={{ color: 'var(--warning-600)' }}\r\n            onClick={() => setShowLowStock(false)}\r\n          >\r\n            <X size={16} />\r\n            Clear Filter\r\n          </button>\r\n        )}\r\n      </div>\r\n\r\n      {/* Table */}\r\n      <div className=\"table-container\">\r\n        <table className=\"table\">\r\n          <thead>\r\n            <tr>\r\n              <th>Item Name</th>\r\n              <th>Status</th>\r\n              <th>Stock Level</th>\r\n              <th>Unit Cost</th>\r\n              <th>Total Value</th>\r\n              <th style={{ textAlign: 'right' }}>Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {filteredInventory.map(item => {\r\n              const stockPercentage = Math.min(100, (item.current_stock / (item.minimum_stock * 3)) * 100);\r\n              const isLow = item.current_stock <= item.minimum_stock;\r\n              \r\n              return (\r\n                <tr key={item.id}>\r\n                  <td>\r\n                    <div style={{ fontWeight: 500 }}>{item.name}</div>\r\n                    <div style={{ fontSize: 'var(--font-size-xs)', color: 'var(--gray-500)' }}>{item.supplier}</div>\r\n                  </td>\r\n                  <td>\r\n                    {isLow ? (\r\n                      <span className=\"badge badge-warning\">Low Stock</span>\r\n                    ) : (\r\n                      <span className=\"badge badge-success\">In Stock</span>\r\n                    )}\r\n                  </td>\r\n                  <td style={{ minWidth: '200px' }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 'var(--spacing-3)' }}>\r\n                      <div style={{ flex: 1, height: '8px', background: 'var(--gray-200)', borderRadius: 'var(--radius-full)', overflow: 'hidden' }}>\r\n                        <div \r\n                          style={{ \r\n                            height: '100%', \r\n                            width: `${stockPercentage}%`, \r\n                            background: isLow ? 'var(--warning-500)' : 'var(--success-500)',\r\n                            borderRadius: 'var(--radius-full)'\r\n                          }}\r\n                        />\r\n                      </div>\r\n                      <span style={{ fontSize: 'var(--font-size-sm)', fontWeight: 500 }}>\r\n                        {item.current_stock} <span style={{ color: 'var(--gray-500)', fontSize: 'var(--font-size-xs)' }}>{item.unit}</span>\r\n                      </span>\r\n                    </div>\r\n                  </td>\r\n                  <td>{item.cost_per_unit || 0}</td>\r\n                  <td>{((item.cost_per_unit || 0) * item.current_stock).toFixed(2)}</td>\r\n                  <td style={{ textAlign: 'right' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'flex-end', gap: 'var(--spacing-2)' }}>\r\n                      <button \r\n                        className=\"btn btn-sm btn-ghost\"\r\n                        onClick={() => handleStockUpdate(item)}\r\n                        title=\"Update Stock\"\r\n                        style={{ color: 'var(--info-600)' }}\r\n                      >\r\n                        <TrendingUp size={16} />\r\n                      </button>\r\n                      <button \r\n                        className=\"btn btn-sm btn-ghost\"\r\n                        onClick={() => handleHistory(item)}\r\n                        title=\"View History\"\r\n                      >\r\n                        <History size={16} />\r\n                      </button>\r\n                      <button \r\n                        className=\"btn btn-sm btn-ghost\"\r\n                        onClick={() => handleEdit(item)}\r\n                        title=\"Edit Item\"\r\n                      >\r\n                        <MoreVertical size={16} />\r\n                      </button>\r\n                    </div>\r\n                  </td>\r\n                </tr>\r\n              );\r\n            })}\r\n            \r\n            {filteredInventory.length === 0 && (\r\n              <tr>\r\n                <td colSpan=\"6\" style={{ textAlign: 'center', padding: 'var(--spacing-8)' }}>\r\n                  <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', color: 'var(--gray-500)' }}>\r\n                    <Package size={48} style={{ marginBottom: 'var(--spacing-2)', color: 'var(--gray-300)' }} />\r\n                    <p style={{ fontWeight: 500 }}>No items found</p>\r\n                    <p style={{ fontSize: 'var(--font-size-sm)' }}>Try adjusting your search or add a new item.</p>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            )}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n\r\n      {/* Modals */}\r\n      {showModal && (\r\n        <InventoryModal\r\n          item={editingItem}\r\n          onClose={() => {\r\n            setShowModal(false);\r\n            setEditingItem(null);\r\n          }}\r\n          onSave={() => {\r\n            setShowModal(false);\r\n            setEditingItem(null);\r\n            loadInventory();\r\n          }}\r\n          onDelete={editingItem ? () => handleDelete(editingItem) : null}\r\n        />\r\n      )}\r\n\r\n      {showStockModal && stockUpdateItem && (\r\n        <StockUpdateModal\r\n          item={stockUpdateItem}\r\n          onClose={() => {\r\n            setShowStockModal(false);\r\n            setStockUpdateItem(null);\r\n          }}\r\n          onSave={() => {\r\n            setShowStockModal(false);\r\n            setStockUpdateItem(null);\r\n            loadInventory();\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {showHistoryModal && historyItem && (\r\n        <HistoryModal\r\n          item={historyItem}\r\n          onClose={() => {\r\n            setShowHistoryModal(false);\r\n            setHistoryItem(null);\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// --- Subcomponents ---\r\n\r\nconst InventoryModal = ({ item, onClose, onSave, onDelete }) => {\r\n  const [formData, setFormData] = useState({\r\n    name: item?.name || '',\r\n    unit: item?.unit || 'kg',\r\n    current_stock: item?.current_stock || 0,\r\n    minimum_stock: item?.minimum_stock || 0,\r\n    cost_per_unit: item?.cost_per_unit || '',\r\n    supplier: item?.supplier || '',\r\n  });\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  const units = ['kg', 'g', 'liters', 'ml', 'pieces', 'packets', 'boxes', 'bottles'];\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSaving(true);\r\n    try {\r\n      await window.electronAPI.invoke('inventory:save', {\r\n        item: {\r\n          ...formData,\r\n          id: item?.id,\r\n          current_stock: parseFloat(formData.current_stock),\r\n          minimum_stock: parseFloat(formData.minimum_stock),\r\n          cost_per_unit: parseFloat(formData.cost_per_unit) || 0,\r\n        }\r\n      });\r\n      onSave();\r\n    } catch (error) {\r\n      console.error('Save failed:', error);\r\n      alert('Failed to save item');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" style={{ height: 'auto', maxHeight: '90vh', display: 'flex', flexDirection: 'column' }} onClick={e => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <h3 className=\"modal-title\">{item ? 'Edit Item' : 'Add New Item'}</h3>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}><X size={20} /></button>\r\n        </div>\r\n        <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>\r\n          <div className=\"modal-body\" style={{ overflowY: 'auto' }}>\r\n            <div className=\"input-group mb-3\">\r\n              <label className=\"input-label\">Item Name</label>\r\n              <input \r\n                className=\"input\" \r\n                required \r\n                value={formData.name}\r\n                onChange={e => setFormData({...formData, name: e.target.value})}\r\n                placeholder=\"e.g., Tomatoes, Milk, Cups\"\r\n              />\r\n            </div>\r\n\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 'var(--spacing-3)', marginBottom: 'var(--spacing-3)' }}>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Unit Type</label>\r\n                <select \r\n                  className=\"input select\"\r\n                  value={formData.unit}\r\n                  onChange={e => setFormData({...formData, unit: e.target.value})}\r\n                >\r\n                  {units.map(u => <option key={u} value={u}>{u}</option>)}\r\n                </select>\r\n              </div>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Current Stock</label>\r\n                <input \r\n                  type=\"number\" \r\n                  step=\"0.01\" \r\n                  className=\"input\" \r\n                  value={formData.current_stock}\r\n                  onChange={e => setFormData({...formData, current_stock: e.target.value})}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 'var(--spacing-3)', marginBottom: 'var(--spacing-3)' }}>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Min. Stock Alert</label>\r\n                <input \r\n                  type=\"number\" \r\n                  step=\"0.01\" \r\n                  className=\"input\" \r\n                  value={formData.minimum_stock}\r\n                  onChange={e => setFormData({...formData, minimum_stock: e.target.value})}\r\n                />\r\n              </div>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Cost per Unit ()</label>\r\n                <input \r\n                  type=\"number\" \r\n                  step=\"0.01\" \r\n                  className=\"input\" \r\n                  value={formData.cost_per_unit}\r\n                  onChange={e => setFormData({...formData, cost_per_unit: e.target.value})}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"input-group\">\r\n              <label className=\"input-label\">Supplier Name</label>\r\n              <input \r\n                className=\"input\" \r\n                value={formData.supplier}\r\n                onChange={e => setFormData({...formData, supplier: e.target.value})}\r\n                placeholder=\"Optional\"\r\n              />\r\n            </div>\r\n          </div>\r\n          <div className=\"modal-footer\" style={{ justifyContent: 'space-between' }}>\r\n            {onDelete ? (\r\n              <button type=\"button\" className=\"btn btn-danger\" onClick={onDelete}>\r\n                <Trash2 size={16} /> Delete\r\n              </button>\r\n            ) : <div />}\r\n            <div style={{ display: 'flex', gap: 'var(--spacing-2)' }}>\r\n              <button type=\"button\" className=\"btn btn-secondary\" onClick={onClose}>Cancel</button>\r\n              <button type=\"submit\" className=\"btn btn-primary\" disabled={isSaving}>\r\n                {isSaving ? 'Saving...' : 'Save Item'}\r\n              </button>\r\n            </div>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst StockUpdateModal = ({ item, onClose, onSave }) => {\r\n  const [operation, setOperation] = useState('add');\r\n  const [quantity, setQuantity] = useState('');\r\n  const [reason, setReason] = useState('Purchase');\r\n  const [notes, setNotes] = useState('');\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  const reasons = {\r\n    add: ['Purchase', 'Return', 'Correction', 'Other'],\r\n    subtract: ['Usage', 'Waste', 'Expired', 'Theft', 'Correction', 'Other'],\r\n    set: ['Stock Take', 'Correction']\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    if (!quantity) return;\r\n    setIsSaving(true);\r\n    try {\r\n      await window.electronAPI.invoke('inventory:updateStock', {\r\n        id: item.id,\r\n        quantity: parseFloat(quantity),\r\n        operation,\r\n        reason,\r\n        notes\r\n      });\r\n      onSave();\r\n    } catch (error) {\r\n      alert('Failed to update stock');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const calculatedStock = operation === 'add' ? item.current_stock + parseFloat(quantity || 0) :\r\n                         operation === 'subtract' ? item.current_stock - parseFloat(quantity || 0) :\r\n                         parseFloat(quantity || 0);\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" style={{ maxWidth: '400px', height: 'auto', maxHeight: '90vh', display: 'flex', flexDirection: 'column' }} onClick={e => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <h3 className=\"modal-title\">Update Stock: {item.name}</h3>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}><X size={20} /></button>\r\n        </div>\r\n        <form onSubmit={handleSubmit} style={{ display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>\r\n          <div className=\"modal-body\" style={{ overflowY: 'auto' }}>\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 'var(--spacing-2)', marginBottom: 'var(--spacing-4)' }}>\r\n              <button \r\n                type=\"button\" \r\n                className={`btn ${operation === 'add' ? 'btn-success' : 'btn-secondary'}`}\r\n                onClick={() => { setOperation('add'); setReason('Purchase'); }}\r\n              >\r\n                Add (+)\r\n              </button>\r\n              <button \r\n                type=\"button\"\r\n                className={`btn ${operation === 'subtract' ? 'btn-danger' : 'btn-secondary'}`}\r\n                onClick={() => { setOperation('subtract'); setReason('Waste'); }}\r\n              >\r\n                Remove (-)\r\n              </button>\r\n            </div>\r\n\r\n            <div className=\"input-group mb-3\">\r\n              <label className=\"input-label\">Quantity ({item.unit})</label>\r\n              <input \r\n                type=\"number\" \r\n                step=\"0.01\" \r\n                className=\"input\"\r\n                style={{ fontSize: 'var(--font-size-lg)', fontWeight: 'bold' }}\r\n                autoFocus\r\n                required\r\n                value={quantity}\r\n                onChange={e => setQuantity(e.target.value)}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"input-group mb-3\">\r\n              <label className=\"input-label\">Reason</label>\r\n              <select \r\n                className=\"input select\"\r\n                value={reason}\r\n                onChange={e => setReason(e.target.value)}\r\n              >\r\n                {reasons[operation].map(r => <option key={r} value={r}>{r}</option>)}\r\n              </select>\r\n            </div>\r\n\r\n            <div className=\"input-group mb-3\">\r\n              <label className=\"input-label\">Notes (Optional)</label>\r\n              <input \r\n                className=\"input\" \r\n                value={notes} \r\n                onChange={e => setNotes(e.target.value)} \r\n                placeholder=\"e.g. Invoice #123\"\r\n              />\r\n            </div>\r\n\r\n            <div style={{ \r\n              padding: 'var(--spacing-3)', \r\n              background: 'var(--gray-50)', \r\n              borderRadius: 'var(--radius-lg)',\r\n              display: 'flex', \r\n              justifyContent: 'space-between',\r\n              alignItems: 'center'\r\n            }}>\r\n              <span style={{ color: 'var(--gray-500)' }}>New Stock Level:</span>\r\n              <span style={{ \r\n                fontWeight: 'bold',\r\n                color: operation === 'subtract' ? 'var(--danger-600)' : 'var(--success-600)'\r\n              }}>\r\n                {isNaN(calculatedStock) ? '...' : calculatedStock.toFixed(2)} {item.unit}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div className=\"modal-footer\">\r\n            <button type=\"button\" className=\"btn btn-secondary\" onClick={onClose}>Cancel</button>\r\n            <button type=\"submit\" className=\"btn btn-primary\" disabled={isSaving}>Update Stock</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst HistoryModal = ({ item, onClose }) => {\r\n  const [history, setHistory] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const load = async () => {\r\n      try {\r\n        const data = await window.electronAPI.invoke('inventory:getHistory', { id: item.id });\r\n        setHistory(data);\r\n      } catch (e) {\r\n        console.error(e);\r\n      } finally {\r\n        setIsLoading(false);\r\n      }\r\n    };\r\n    load();\r\n  }, [item.id]);\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" style={{ maxWidth: '700px' }} onClick={e => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <div>\r\n            <h3 className=\"modal-title\">{item.name} - History</h3>\r\n            <p style={{ fontSize: 'var(--font-size-xs)', color: 'var(--gray-500)' }}>Transaction log</p>\r\n          </div>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}><X size={20} /></button>\r\n        </div>\r\n        <div className=\"modal-body\" style={{ padding: 0 }}>\r\n          <div style={{ maxHeight: '60vh', overflowY: 'auto' }}>\r\n            <table className=\"table\">\r\n              <thead style={{ position: 'sticky', top: 0, background: 'var(--gray-50)', zIndex: 1 }}>\r\n                <tr>\r\n                  <th>Date</th>\r\n                  <th>Type</th>\r\n                  <th>Change</th>\r\n                  <th>Stock After</th>\r\n                  <th>Reason</th>\r\n                  <th>Notes</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {isLoading ? (\r\n                  <tr><td colSpan=\"6\" style={{ textAlign: 'center', padding: 'var(--spacing-4)' }}>Loading...</td></tr>\r\n                ) : history.length === 0 ? (\r\n                  <tr><td colSpan=\"6\" style={{ textAlign: 'center', padding: 'var(--spacing-4)', color: 'var(--gray-500)' }}>No history found.</td></tr>\r\n                ) : (\r\n                  history.map(record => (\r\n                    <tr key={record.id}>\r\n                      <td style={{ color: 'var(--gray-600)' }}>\r\n                        {new Date(record.created_at).toLocaleString()}\r\n                      </td>\r\n                      <td>\r\n                        <span className={`badge badge-${\r\n                          record.type === 'add' ? 'success' : \r\n                          record.type === 'subtract' ? 'error' : \r\n                          'info'\r\n                        }`}>\r\n                          {record.type.toUpperCase()}\r\n                        </span>\r\n                      </td>\r\n                      <td style={{ \r\n                        fontWeight: 500, \r\n                        color: record.type === 'add' ? 'var(--success-600)' : 'var(--danger-600)' \r\n                      }}>\r\n                        {record.type === 'add' ? '+' : '-'}{record.quantity}\r\n                      </td>\r\n                      <td>{record.current_stock_snapshot}</td>\r\n                      <td>{record.reason}</td>\r\n                      <td style={{ maxWidth: '150px', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }} title={record.notes}>\r\n                        {record.notes || '-'}\r\n                      </td>\r\n                    </tr>\r\n                  ))\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n        <div className=\"modal-footer\">\r\n          <button className=\"btn btn-secondary\" onClick={onClose} style={{ width: '100%' }}>Close</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InventoryPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\KOTPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'Users' is defined but never used.","line":11,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":8},{"ruleId":"no-unused-vars","severity":1,"message":"'Phone' is defined but never used.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":8},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":148,"column":29,"nodeType":"BlockStatement","messageId":"unexpected","endLine":148,"endColumn":31,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6578,6578],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":154,"column":29,"nodeType":"BlockStatement","messageId":"unexpected","endLine":154,"endColumn":31,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[6855,6855],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":529,"column":33,"nodeType":"BlockStatement","messageId":"unexpected","endLine":529,"endColumn":35,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[24450,24450],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":535,"column":33,"nodeType":"BlockStatement","messageId":"unexpected","endLine":535,"endColumn":35,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[24751,24751],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]}],"suppressedMessages":[],"errorCount":4,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { \r\n  ChefHat, \r\n  Clock, \r\n  Check,\r\n  RefreshCw,\r\n  Printer,\r\n  Eye,\r\n  X,\r\n  AlertTriangle,\r\n  Users,\r\n  Utensils,\r\n  MapPin,\r\n  Phone,\r\n  User,\r\n  FileText\r\n} from 'lucide-react';\r\n\r\n// KOT Preview Modal  Receipt-style view for printing\r\nconst KOTPreviewModal = ({ order, onClose, onPrint, getTimeSinceOrder }) => {\r\n  if (!order) return null;\r\n\r\n  const formatDate = (dateStr) => {\r\n    return new Date(dateStr).toLocaleString('en-IN', {\r\n      day: '2-digit',\r\n      month: 'short',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose} style={{ zIndex: 1001, alignItems: 'center', justifyContent: 'center', display: 'flex' }}>\r\n      <div className=\"modal\" onClick={(e) => e.stopPropagation()} style={{ \r\n        maxWidth: '400px', \r\n        width: '90%',\r\n        maxHeight: '85vh', \r\n        height: 'auto',\r\n        display: 'flex', \r\n        flexDirection: 'column',\r\n        borderRadius: '12px',\r\n        overflow: 'hidden',\r\n        boxShadow: '0 20px 60px rgba(0,0,0,0.3)'\r\n      }}>\r\n        <div className=\"modal-header\" style={{ background: '#263238', color: 'white', padding: '12px 16px', borderBottom: '1px solid #37474F' }}>\r\n          <h3 className=\"modal-title\" style={{ color: 'white', fontSize: '16px', fontWeight: 600, display: 'flex', alignItems: 'center' }}>\r\n            <ChefHat size={18} style={{ marginRight: '8px', color: '#FFB74D' }} />\r\n            Kitchen Order Ticket\r\n          </h3>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose} style={{ color: 'white', opacity: 0.8 }}>\r\n            <X size={18} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"modal-body\" style={{ padding: '0', overflowY: 'auto', background: '#F5F5F5' }}>\r\n          <div style={{\r\n            background: '#FFFDE7',\r\n            padding: '20px',\r\n            margin: '16px',\r\n            borderRadius: '4px',\r\n            boxShadow: '0 2px 8px rgba(0,0,0,0.05)',\r\n            fontFamily: \"'Courier New', monospace\",\r\n            position: 'relative'\r\n          }}>\r\n            {/* Dashed Border Top Effect */}\r\n            <div style={{ position: 'absolute', top: '-6px', left: '0', right: '0', height: '12px', background: 'radial-gradient(circle, #F5F5F5 4px, transparent 5px) repeat-x', backgroundSize: '12px 12px', transform: 'rotate(180deg)' }}></div>\r\n\r\n            {/* KOT Header */}\r\n            <div style={{ textAlign: 'center', marginBottom: '16px', borderBottom: '2px dashed #BDBDBD', paddingBottom: '12px' }}>\r\n              <div style={{ fontSize: '24px', fontWeight: 900, letterSpacing: '2px', color: '#263238' }}>KOT</div>\r\n              <div style={{ fontSize: '11px', color: '#78909C', textTransform: 'uppercase', letterSpacing: '1px', marginTop: '4px' }}>Kitchen Order Ticket</div>\r\n              \r\n              {/* Urgency Badge in Receipt */}\r\n              {order.urgency && order.urgency !== 'normal' && (\r\n                <div style={{ \r\n                  marginTop: '8px', \r\n                  display: 'inline-block',\r\n                  padding: '4px 12px', \r\n                  background: order.urgency === 'critical' ? '#FFEBEE' : '#FFF3E0',\r\n                  color: order.urgency === 'critical' ? '#C62828' : '#E65100',\r\n                  border: order.urgency === 'critical' ? '2px solid #EF9A9A' : '2px solid #FFB74D',\r\n                  borderRadius: '4px',\r\n                  fontWeight: 800,\r\n                  fontSize: '12px',\r\n                  textTransform: 'uppercase',\r\n                  letterSpacing: '0.5px'\r\n                }}>\r\n                  {order.urgency} ORDER\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Order Info */}\r\n            <div style={{ marginBottom: '16px', fontSize: '13px', lineHeight: '1.6' }}>\r\n              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>\r\n                <span style={{ fontWeight: 800, fontSize: '18px', color: '#263238' }}>#{order.order_number}</span>\r\n                <span style={{ \r\n                  background: '#ECEFF1', \r\n                  padding: '2px 8px', \r\n                  borderRadius: '4px', \r\n                  fontSize: '12px', \r\n                  fontWeight: 600, \r\n                  color: '#455A64' \r\n                }}>\r\n                  {getTimeSinceOrder(order.order_time)}\r\n                </span>\r\n              </div>\r\n              \r\n              <div style={{ display: 'grid', gridTemplateColumns: 'auto 1fr', gap: '8px 16px', color: '#37474F' }}>\r\n                <span style={{ color: '#78909C' }}>Type:</span>\r\n                <span style={{ fontWeight: 700, textTransform: 'uppercase' }}>{order.order_type?.replace('_', ' ')}</span>\r\n                \r\n                {order.table_number && (\r\n                  <>\r\n                    <span style={{ color: '#78909C' }}>Table:</span>\r\n                    <span style={{ fontWeight: 800, color: '#D32F2F' }}>{order.table_number}</span>\r\n                  </>\r\n                )}\r\n                \r\n                {order.customer_name && (\r\n                  <>\r\n                    <span style={{ color: '#78909C' }}>Customer:</span>\r\n                    <span style={{ fontWeight: 600 }}>{order.customer_name}</span>\r\n                  </>\r\n                )}\r\n                \r\n                <span style={{ color: '#78909C' }}>Time:</span>\r\n                <span>{formatDate(order.order_time)}</span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Items */}\r\n            <div style={{ borderTop: '2px dashed #BDBDBD', borderBottom: '2px dashed #BDBDBD', padding: '12px 0', marginBottom: '12px' }}>\r\n              <div style={{ display: 'flex', justifyContent: 'space-between', fontWeight: 700, fontSize: '11px', marginBottom: '10px', color: '#78909C', textTransform: 'uppercase', letterSpacing: '1px' }}>\r\n                <span>Qty</span>\r\n                <span style={{ flex: 1, marginLeft: '12px' }}>Item Details</span>\r\n              </div>\r\n              \r\n              {order.items.map((item, idx) => {\r\n                let variantInfo = null;\r\n                let addonsInfo = [];\r\n                try {\r\n                  if (item.variant) {\r\n                    const v = typeof item.variant === 'string' ? JSON.parse(item.variant) : item.variant;\r\n                    if (v && v.name) variantInfo = v.name;\r\n                  }\r\n                } catch (e) {}\r\n                try {\r\n                  if (item.addons) {\r\n                    const a = typeof item.addons === 'string' ? JSON.parse(item.addons) : item.addons;\r\n                    if (Array.isArray(a)) addonsInfo = a;\r\n                  }\r\n                } catch (e) {}\r\n\r\n                return (\r\n                  <div key={idx} style={{ marginBottom: '12px', borderBottom: idx === order.items.length - 1 ? 'none' : '1px dotted #E0E0E0', paddingBottom: idx === order.items.length - 1 ? 0 : '8px' }}>\r\n                    <div style={{ display: 'flex', alignItems: 'flex-start' }}>\r\n                      <span style={{ minWidth: '32px', fontWeight: 800, fontSize: '15px', color: '#263238', paddingTop: '1px' }}>{item.quantity}</span>\r\n                      <div style={{ flex: 1 }}>\r\n                        <div style={{ fontWeight: 700, fontSize: '15px', color: '#263238' }}>{item.item_name}</div>\r\n                        \r\n                        {variantInfo && (\r\n                          <div style={{ fontSize: '12px', color: '#0277BD', marginTop: '2px' }}>\r\n                            Size: {variantInfo}\r\n                          </div>\r\n                        )}\r\n                        \r\n                        {addonsInfo.length > 0 && (\r\n                          <div style={{ fontSize: '12px', color: '#546E7A', marginTop: '1px' }}>\r\n                            + {addonsInfo.map(a => a.name).join(', ')}\r\n                          </div>\r\n                        )}\r\n                        \r\n                        {item.special_instructions && (\r\n                          <div style={{ \r\n                            marginTop: '4px',\r\n                            background: '#FFF3E0',\r\n                            border: '1px solid #FFE0B2',\r\n                            padding: '4px 8px',\r\n                            borderRadius: '4px',\r\n                            fontSize: '12px', \r\n                            color: '#E65100', \r\n                            fontWeight: 600,\r\n                            display: 'inline-block'\r\n                          }}>\r\n                            Note: {item.special_instructions}\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n            \r\n            {/* Chef Instructions (Order Level) */}\r\n            {order.chef_instructions && (\r\n              <div style={{ \r\n                background: '#FCE4EC', \r\n                border: '2px solid #F48FB1', \r\n                borderRadius: '6px', \r\n                padding: '10px', \r\n                marginTop: '16px',\r\n                textAlign: 'left'\r\n              }}>\r\n                <div style={{ \r\n                  textTransform: 'uppercase', \r\n                  fontSize: '11px', \r\n                  fontWeight: 800, \r\n                  color: '#C62828', \r\n                  marginBottom: '4px',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  gap: '4px'\r\n                }}>\r\n                  <ChefHat size={14} /> Chef Instructions\r\n                </div>\r\n                <div style={{ fontSize: '13px', fontWeight: 700, color: '#880E4F', lineHeight: '1.4' }}>\r\n                  {order.chef_instructions}\r\n                </div>\r\n              </div>\r\n            )}\r\n            \r\n            <div style={{ textAlign: 'center', marginTop: '20px', color: '#90A4AE', fontSize: '11px', fontStyle: 'italic' }}>\r\n              --- Kitchen Copy ---\r\n            </div>\r\n            \r\n            {/* Dashed Border Bottom Effect */}\r\n            <div style={{ position: 'absolute', bottom: '-6px', left: '0', right: '0', height: '12px', background: 'radial-gradient(circle, #F5F5F5 4px, transparent 5px) repeat-x', backgroundSize: '12px 12px' }}></div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"modal-footer\" style={{ padding: '12px 16px', borderTop: '1px solid #E0E0E0', background: 'white', display: 'flex', gap: '8px' }}>\r\n          <button className=\"btn btn-secondary\" style={{ flex: 1, padding: '10px' }} onClick={onClose}>\r\n            Close\r\n          </button>\r\n          <button className=\"btn btn-primary\" style={{ flex: 1, padding: '10px', background: '#D32F2F', borderColor: '#D32F2F' }} onClick={() => onPrint(order)}>\r\n            <Printer size={18} style={{ marginRight: '6px' }} /> Print KOT\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\nconst KOTPage = () => {\r\n  const [orders, setOrders] = useState([]);\r\n  const [filter, setFilter] = useState('all');\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [lastRefresh, setLastRefresh] = useState(new Date());\r\n  const [previewOrder, setPreviewOrder] = useState(null);\r\n\r\n  useEffect(() => {\r\n    loadOrders();\r\n    // Auto-refresh every 30 seconds\r\n    const interval = setInterval(loadOrders, 30000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  const loadOrders = async () => {\r\n    try {\r\n      const result = await window.electronAPI.invoke('kot:getPending');\r\n      // Group by order\r\n      const grouped = result.reduce((acc, item) => {\r\n        if (!acc[item.order_id]) {\r\n          acc[item.order_id] = {\r\n            order_id: item.order_id,\r\n            order_number: item.order_number,\r\n            table_number: item.table_number,\r\n            order_type: item.order_type,\r\n            order_time: item.order_time,\r\n            customer_name: item.customer_name || null,\r\n            customer_phone: item.customer_phone || null,\r\n            notes: item.notes || null,\r\n            items: []\r\n          };\r\n        }\r\n        // Capture urgency and chef_instructions from first item row (same for all items in an order)\r\n        if (item.urgency) acc[item.order_id].urgency = item.urgency;\r\n        if (item.chef_instructions) acc[item.order_id].chef_instructions = item.chef_instructions;\r\n        acc[item.order_id].items.push(item);\r\n        return acc;\r\n      }, {});\r\n      setOrders(Object.values(grouped));\r\n      setLastRefresh(new Date());\r\n    } catch (error) {\r\n      console.error('Failed to load KOTs:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleStatusUpdate = async (orderItemId, status) => {\r\n    try {\r\n      await window.electronAPI.invoke('kot:updateStatus', { orderItemId, status });\r\n      loadOrders();\r\n    } catch (error) {\r\n      console.error('Failed to update status:', error);\r\n    }\r\n  };\r\n\r\n  const handlePrintKOT = async (order) => {\r\n    try {\r\n      await window.electronAPI.invoke('print:kotRouted', { \r\n        order, \r\n        items: order.items \r\n      });\r\n      alert('KOT sent to printer!');\r\n    } catch (error) {\r\n      console.error('Print failed:', error);\r\n      alert('Print failed: ' + error.message);\r\n    }\r\n  };\r\n\r\n  const filteredOrders = orders.filter(order => {\r\n    if (filter === 'all') return true;\r\n    return order.items.some(item => item.kot_status === filter);\r\n  });\r\n\r\n  const getOrderStatus = (items) => {\r\n    const statuses = items.map(i => i.kot_status);\r\n    if (statuses.every(s => s === 'ready')) return 'ready';\r\n    if (statuses.some(s => s === 'preparing')) return 'preparing';\r\n    return 'pending';\r\n  };\r\n\r\n  const getTimeSinceOrder = (orderTime) => {\r\n    const diff = Math.floor((Date.now() - new Date(orderTime).getTime()) / 60000);\r\n    if (diff < 1) return 'Just now';\r\n    if (diff < 60) return `${diff}m ago`;\r\n    return `${Math.floor(diff / 60)}h ${diff % 60}m ago`;\r\n  };\r\n\r\n  const getTimeUrgency = (orderTime) => {\r\n    const diff = Math.floor((Date.now() - new Date(orderTime).getTime()) / 60000);\r\n    if (diff < 10) return { color: '#2E7D32', bg: '#E8F5E9', label: 'Fresh' };\r\n    if (diff < 20) return { color: '#E65100', bg: '#FFF3E0', label: 'Waiting' };\r\n    return { color: '#C62828', bg: '#FFEBEE', label: 'Urgent!' };\r\n  };\r\n\r\n  // Stats\r\n  const pendingCount = orders.filter(o => getOrderStatus(o.items) === 'pending').length;\r\n  const preparingCount = orders.filter(o => getOrderStatus(o.items) === 'preparing').length;\r\n  const readyCount = orders.filter(o => getOrderStatus(o.items) === 'ready').length;\r\n  const totalItems = orders.reduce((s, o) => s + o.items.length, 0);\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: '100vh', background: '#f8fafc' }}>\r\n        <div className=\"loading-spinner\" style={{ width: '48px', height: '48px', borderWidth: '4px' }} />\r\n        <p style={{ marginTop: '16px', fontWeight: 600, fontSize: '18px', color: '#546E7A' }}>Loading kitchen orders...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ padding: '24px 28px', background: '#f8fafc', minHeight: 'calc(100vh - 60px)', overflowY: 'auto' }}>\r\n\r\n      {/* Header */}\r\n      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>\r\n        <div>\r\n          <h1 style={{ fontSize: '24px', fontWeight: 800, color: '#263238', display: 'flex', alignItems: 'center', gap: '10px', margin: 0 }}>\r\n            <ChefHat size={28} color=\"#D32F2F\" /> Kitchen Display (KOT)\r\n          </h1>\r\n          <p style={{ color: '#78909C', fontSize: '13px', margin: '4px 0 0 0' }}>\r\n            Last updated: {lastRefresh.toLocaleTimeString()}  Auto-refreshes every 30s\r\n          </p>\r\n        </div>\r\n        <button \r\n          className=\"btn btn-secondary\" \r\n          onClick={loadOrders}\r\n          style={{ display: 'flex', alignItems: 'center', gap: '6px', padding: '8px 16px', fontWeight: 600 }}\r\n        >\r\n          <RefreshCw size={16} /> Refresh\r\n        </button>\r\n      </div>\r\n\r\n      {/* Stat Cards */}\r\n      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px', marginBottom: '20px' }}>\r\n        {[\r\n          { label: 'Pending', count: pendingCount, gradient: 'linear-gradient(135deg, #FF9800, #F57C00)', icon: Clock },\r\n          { label: 'Preparing', count: preparingCount, gradient: 'linear-gradient(135deg, #2196F3, #1976D2)', icon: Utensils },\r\n          { label: 'Ready', count: readyCount, gradient: 'linear-gradient(135deg, #4CAF50, #388E3C)', icon: Check },\r\n          { label: 'Total Items', count: totalItems, gradient: 'linear-gradient(135deg, #78909C, #546E7A)', icon: FileText },\r\n        ].map((stat, idx) => (\r\n          <div key={idx} style={{ background: 'white', borderRadius: '12px', padding: '16px', display: 'flex', alignItems: 'center', gap: '14px', boxShadow: '0 1px 3px rgba(0,0,0,0.08)' }}>\r\n            <div style={{ width: '44px', height: '44px', borderRadius: '10px', background: stat.gradient, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', flexShrink: 0 }}>\r\n              <stat.icon size={22} />\r\n            </div>\r\n            <div>\r\n              <div style={{ fontSize: '24px', fontWeight: 800, color: '#263238' }}>{stat.count}</div>\r\n              <div style={{ fontSize: '12px', color: '#78909C', fontWeight: 500 }}>{stat.label}</div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {/* Filters */}\r\n      <div style={{ display: 'flex', gap: '8px', marginBottom: '20px', background: 'white', padding: '10px 16px', borderRadius: '10px', boxShadow: '0 1px 3px rgba(0,0,0,0.06)' }}>\r\n        {[\r\n          { value: 'all', label: 'All Orders', bg: '#37474F' },\r\n          { value: 'pending', label: 'Pending', bg: '#FF9800' },\r\n          { value: 'preparing', label: 'Preparing', bg: '#2196F3' },\r\n          { value: 'ready', label: 'Ready', bg: '#4CAF50' },\r\n        ].map(f => (\r\n          <button\r\n            key={f.value}\r\n            onClick={() => setFilter(f.value)}\r\n            style={{\r\n              padding: '8px 18px',\r\n              borderRadius: '8px',\r\n              border: 'none',\r\n              fontWeight: 600,\r\n              fontSize: '13px',\r\n              cursor: 'pointer',\r\n              transition: 'all 0.2s',\r\n              background: filter === f.value ? f.bg : '#F5F5F5',\r\n              color: filter === f.value ? 'white' : '#546E7A'\r\n            }}\r\n          >\r\n            {f.label}\r\n            {f.value !== 'all' && (\r\n              <span style={{ marginLeft: '6px', background: filter === f.value ? 'rgba(255,255,255,0.3)' : '#E0E0E0', padding: '1px 7px', borderRadius: '10px', fontSize: '11px' }}>\r\n                {f.value === 'pending' ? pendingCount : f.value === 'preparing' ? preparingCount : readyCount}\r\n              </span>\r\n            )}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* KOT Grid */}\r\n      {filteredOrders.length > 0 ? (\r\n        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(320px, 1fr))', gap: '18px' }}>\r\n          {filteredOrders.map(order => {\r\n            const status = getOrderStatus(order.items);\r\n            const urgency = getTimeUrgency(order.order_time);\r\n            const statusColors = {\r\n              pending: { border: '#FF9800', headerBg: '#FFF8E1' },\r\n              preparing: { border: '#2196F3', headerBg: '#E3F2FD' },\r\n              ready: { border: '#4CAF50', headerBg: '#E8F5E9' }\r\n            };\r\n            const sc = statusColors[status];\r\n            const hasInstructions = order.items.some(i => i.special_instructions);\r\n\r\n            return (\r\n              <div key={order.order_id} style={{\r\n                background: 'white',\r\n                borderRadius: '12px',\r\n                overflow: 'hidden',\r\n                boxShadow: '0 2px 8px rgba(0,0,0,0.08)',\r\n                borderTop: `4px solid ${sc.border}`,\r\n                transition: 'box-shadow 0.2s',\r\n              }}>\r\n                {/* Card Header */}\r\n                <div style={{ padding: '14px 16px', background: sc.headerBg, display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n                  <div>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                      <span style={{ fontSize: '20px', fontWeight: 800, color: '#263238' }}>#{order.order_number}</span>\r\n                      <span style={{\r\n                        padding: '2px 10px',\r\n                        borderRadius: '12px',\r\n                        fontSize: '11px',\r\n                        fontWeight: 700,\r\n                        textTransform: 'uppercase',\r\n                        letterSpacing: '0.5px',\r\n                        background: sc.border,\r\n                        color: 'white'\r\n                      }}>\r\n                        {status}\r\n                      </span>\r\n                    </div>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginTop: '4px', flexWrap: 'wrap' }}>\r\n                      {order.table_number ? (\r\n                        <span style={{ fontSize: '13px', fontWeight: 700, color: '#D32F2F', display: 'flex', alignItems: 'center', gap: '3px' }}>\r\n                          <MapPin size={13} /> {order.table_number}\r\n                        </span>\r\n                      ) : (\r\n                        <span style={{ fontSize: '12px', color: '#546E7A', fontWeight: 600, textTransform: 'uppercase' }}>\r\n                          {order.order_type?.replace('_', ' ')}\r\n                        </span>\r\n                      )}\r\n                      {order.customer_name && (\r\n                        <span style={{ fontSize: '12px', color: '#37474F', display: 'flex', alignItems: 'center', gap: '3px' }}>\r\n                          <User size={12} /> {order.customer_name}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                    {/* Urgency Badge */}\r\n                    {order.urgency && order.urgency !== 'normal' && (\r\n                      <div style={\r\n                        order.urgency === 'critical'\r\n                          ? { marginTop: '4px', padding: '2px 8px', borderRadius: '4px', fontSize: '11px', fontWeight: 700, background: '#FFEBEE', color: '#C62828', border: '1px solid #EF9A9A', display: 'flex', alignItems: 'center', gap: '3px' }\r\n                          : { marginTop: '4px', padding: '2px 8px', borderRadius: '4px', fontSize: '11px', fontWeight: 700, background: '#FFF3E0', color: '#E65100', border: '1px solid #FFB74D', display: 'flex', alignItems: 'center', gap: '3px' }\r\n                      }>\r\n                        <AlertTriangle size={11} /> {order.urgency.toUpperCase()}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                  <div style={{ textAlign: 'right' }}>\r\n                    <div style={{\r\n                      display: 'inline-flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                      padding: '3px 8px',\r\n                      borderRadius: '8px',\r\n                      fontSize: '12px',\r\n                      fontWeight: 700,\r\n                      background: urgency.bg,\r\n                      color: urgency.color,\r\n                    }}>\r\n                      <Clock size={13} />\r\n                      {getTimeSinceOrder(order.order_time)}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Items List */}\r\n                <div style={{ padding: '12px 16px' }}>\r\n                  {order.items.map((item, idx) => {\r\n                    let variantInfo = null;\r\n                    let addonsInfo = [];\r\n                    try {\r\n                      if (item.variant) {\r\n                        const v = typeof item.variant === 'string' ? JSON.parse(item.variant) : item.variant;\r\n                        if (v && v.name) variantInfo = v.name;\r\n                      }\r\n                    } catch (e) {}\r\n                    try {\r\n                      if (item.addons) {\r\n                        const a = typeof item.addons === 'string' ? JSON.parse(item.addons) : item.addons;\r\n                        if (Array.isArray(a)) addonsInfo = a;\r\n                      }\r\n                    } catch (e) {}\r\n\r\n                    return (\r\n                      <div key={item.id} style={{\r\n                        padding: '10px 0',\r\n                        borderBottom: idx < order.items.length - 1 ? '1px dashed #E0E0E0' : 'none',\r\n                        display: 'flex',\r\n                        justifyContent: 'space-between',\r\n                        alignItems: 'flex-start'\r\n                      }}>\r\n                        <div style={{ flex: 1 }}>\r\n                          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                            <span style={{ \r\n                              fontWeight: 800, \r\n                              fontSize: '16px', \r\n                              color: '#D32F2F', \r\n                              background: '#FFEBEE', \r\n                              width: '32px', \r\n                              height: '32px', \r\n                              display: 'flex', \r\n                              alignItems: 'center', \r\n                              justifyContent: 'center', \r\n                              borderRadius: '6px', \r\n                              flexShrink: 0 \r\n                            }}>\r\n                              {item.quantity}x\r\n                            </span>\r\n                            <span style={{ fontWeight: 700, fontSize: '14px', color: '#263238' }}>{item.item_name}</span>\r\n                          </div>\r\n                          {variantInfo && (\r\n                            <div style={{ fontSize: '12px', color: '#1565C0', marginLeft: '40px', marginTop: '2px', fontWeight: 500 }}>\r\n                              Size: {variantInfo}\r\n                            </div>\r\n                          )}\r\n                          {addonsInfo.length > 0 && (\r\n                            <div style={{ fontSize: '12px', color: '#546E7A', marginLeft: '40px', marginTop: '2px' }}>\r\n                              {addonsInfo.map(a => `+ ${a.name}`).join(', ')}\r\n                            </div>\r\n                          )}\r\n                          {item.special_instructions && (\r\n                            <div style={{\r\n                              marginLeft: '40px',\r\n                              marginTop: '4px',\r\n                              padding: '5px 10px',\r\n                              background: '#FFF3E0',\r\n                              border: '1px solid #FFE0B2',\r\n                              borderRadius: '6px',\r\n                              fontSize: '13px',\r\n                              fontWeight: 700,\r\n                              color: '#BF360C',\r\n                              display: 'flex',\r\n                              alignItems: 'center',\r\n                              gap: '4px'\r\n                            }}>\r\n                              <AlertTriangle size={14} color=\"#E65100\" />\r\n                              {item.special_instructions}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        <div style={{ flexShrink: 0, marginLeft: '8px' }}>\r\n                          {item.kot_status !== 'ready' ? (\r\n                            <button\r\n                              onClick={() => handleStatusUpdate(\r\n                                item.id, \r\n                                item.kot_status === 'pending' ? 'preparing' : 'ready'\r\n                              )}\r\n                              style={{\r\n                                padding: '5px 12px',\r\n                                border: 'none',\r\n                                borderRadius: '6px',\r\n                                fontWeight: 600,\r\n                                fontSize: '12px',\r\n                                cursor: 'pointer',\r\n                                color: 'white',\r\n                                background: item.kot_status === 'pending' ? '#2196F3' : '#4CAF50',\r\n                                transition: 'all 0.2s'\r\n                              }}\r\n                            >\r\n                              {item.kot_status === 'pending' ? 'Start' : 'Done'}\r\n                            </button>\r\n                          ) : (\r\n                            <div style={{ \r\n                              width: '28px', \r\n                              height: '28px', \r\n                              borderRadius: '50%', \r\n                              background: '#E8F5E9', \r\n                              display: 'flex', \r\n                              alignItems: 'center', \r\n                              justifyContent: 'center' \r\n                            }}>\r\n                              <Check size={16} color=\"#2E7D32\" />\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                    );\r\n                  })}\r\n\r\n                  {/* Chef Notes Block */}\r\n                  {hasInstructions && (\r\n                    <div style={{\r\n                      marginTop: '10px',\r\n                      padding: '10px 12px',\r\n                      background: '#FFF8E1',\r\n                      borderRadius: '8px',\r\n                      border: '2px solid #FFE082',\r\n                    }}>\r\n                      <div style={{ fontWeight: 800, fontSize: '11px', color: '#E65100', textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: '6px', display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                        <AlertTriangle size={13} /> Chef Notes\r\n                      </div>\r\n                      {order.items.filter(i => i.special_instructions).map((i, idx) => (\r\n                        <div key={idx} style={{ fontSize: '13px', color: '#BF360C', fontWeight: 600, marginBottom: '2px' }}>\r\n                          <strong>{i.item_name}:</strong> {i.special_instructions}\r\n                        </div>\r\n                      ))}\r\n                    </div>\r\n                  )}\r\n\r\n                  {/* Order-level Chef Instructions */}\r\n                  {order.chef_instructions && (\r\n                    <div style={{\r\n                      marginTop: '8px',\r\n                      padding: '8px 12px',\r\n                      background: '#FCE4EC',\r\n                      borderRadius: '8px',\r\n                      border: '2px solid #F48FB1',\r\n                    }}>\r\n                      <div style={{ fontWeight: 800, fontSize: '11px', color: '#C62828', textTransform: 'uppercase', letterSpacing: '0.5px', marginBottom: '4px', display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                        <ChefHat size={13} /> Chef Instructions\r\n                      </div>\r\n                      <div style={{ fontSize: '13px', color: '#880E4F', fontWeight: 600 }}>\r\n                        {order.chef_instructions}\r\n                      </div>\r\n                    </div>\r\n                  )}\r\n                </div>\r\n\r\n                {/* Card Footer */}\r\n                <div style={{ padding: '10px 16px', background: '#FAFAFA', display: 'flex', gap: '8px', borderTop: '1px solid #EEEEEE' }}>\r\n                  <button\r\n                    onClick={() => setPreviewOrder(order)}\r\n                    style={{\r\n                      padding: '7px 14px',\r\n                      border: '1px solid #CFD8DC',\r\n                      borderRadius: '6px',\r\n                      background: 'white',\r\n                      color: '#37474F',\r\n                      cursor: 'pointer',\r\n                      fontWeight: 600,\r\n                      fontSize: '12px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                      transition: 'all 0.2s'\r\n                    }}\r\n                  >\r\n                    <Eye size={14} /> View\r\n                  </button>\r\n                  <button\r\n                    onClick={() => handlePrintKOT(order)}\r\n                    style={{\r\n                      padding: '7px 14px',\r\n                      border: '1px solid #CFD8DC',\r\n                      borderRadius: '6px',\r\n                      background: 'white',\r\n                      color: '#37474F',\r\n                      cursor: 'pointer',\r\n                      fontWeight: 600,\r\n                      fontSize: '12px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '4px',\r\n                      transition: 'all 0.2s'\r\n                    }}\r\n                  >\r\n                    <Printer size={14} /> Print\r\n                  </button>\r\n                  {status !== 'ready' && (\r\n                    <button\r\n                      onClick={() => {\r\n                        order.items.forEach(item => {\r\n                          if (item.kot_status !== 'ready') {\r\n                            handleStatusUpdate(item.id, 'ready');\r\n                          }\r\n                        });\r\n                      }}\r\n                      style={{\r\n                        flex: 1,\r\n                        padding: '7px 14px',\r\n                        border: 'none',\r\n                        borderRadius: '6px',\r\n                        background: '#4CAF50',\r\n                        color: 'white',\r\n                        cursor: 'pointer',\r\n                        fontWeight: 700,\r\n                        fontSize: '12px',\r\n                        display: 'flex',\r\n                        alignItems: 'center',\r\n                        justifyContent: 'center',\r\n                        gap: '4px',\r\n                        transition: 'all 0.2s'\r\n                      }}\r\n                    >\r\n                      <Check size={14} /> Mark All Ready\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n        </div>\r\n      ) : (\r\n        <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', padding: '80px 20px', textAlign: 'center', color: '#90A4AE' }}>\r\n          <ChefHat size={72} style={{ opacity: 0.4, marginBottom: '16px' }} />\r\n          <p style={{ fontSize: '20px', fontWeight: 700, color: '#546E7A', margin: '0 0 8px 0' }}>No pending orders</p>\r\n          <p style={{ fontSize: '14px', color: '#90A4AE', margin: 0 }}>\r\n            {filter !== 'all' \r\n              ? `No orders with status \"${filter}\"` \r\n              : 'Kitchen is all caught up! '}\r\n          </p>\r\n        </div>\r\n      )}\r\n\r\n      {/* KOT Preview Modal */}\r\n      {previewOrder && (\r\n        <KOTPreviewModal\r\n          order={previewOrder}\r\n          onClose={() => setPreviewOrder(null)}\r\n          onPrint={handlePrintKOT}\r\n          getTimeSinceOrder={getTimeSinceOrder}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default KOTPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\LoginPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'UtensilsCrossed' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":25}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { UtensilsCrossed, User, Lock, Eye, EyeOff, AlertCircle } from 'lucide-react';\r\nimport logoImg from '../assets/logo.png';\r\n\r\nconst LoginPage = () => {\r\n  const [username, setUsername] = useState('');\r\n  const [password, setPassword] = useState('');\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [loginMode, setLoginMode] = useState('password'); // 'password' or 'pin'\r\n  const [pin, setPin] = useState('');\r\n  \r\n  const { login, loginWithPin, isLoading, error, clearError } = useAuthStore();\r\n  const navigate = useNavigate();\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    clearError();\r\n    \r\n    let result;\r\n    if (loginMode === 'password') {\r\n      result = await login(username, password);\r\n    } else {\r\n      result = await loginWithPin(pin);\r\n    }\r\n    \r\n    if (result.success) {\r\n      navigate('/pos');\r\n    }\r\n  };\r\n\r\n  const handlePinInput = (digit) => {\r\n    if (pin.length < 4) {\r\n      setPin(prev => prev + digit);\r\n    }\r\n  };\r\n\r\n  const handlePinClear = () => {\r\n    setPin('');\r\n  };\r\n\r\n  const handlePinBackspace = () => {\r\n    setPin(prev => prev.slice(0, -1));\r\n  };\r\n\r\n  return (\r\n    <div style={{\r\n      minHeight: '100vh',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      background: 'linear-gradient(135deg, var(--primary-900) 0%, var(--gray-900) 100%)',\r\n      padding: 'var(--spacing-4)',\r\n    }}>\r\n      <div className=\"card\" style={{ \r\n        width: '100%', \r\n        maxWidth: '420px',\r\n        animation: 'slideUp 0.3s ease'\r\n      }}>\r\n        {/* Header */}\r\n        <div style={{\r\n          padding: 'var(--spacing-8)',\r\n          textAlign: 'center',\r\n          background: 'linear-gradient(135deg, var(--primary-600), var(--primary-700))',\r\n          color: 'white',\r\n        }}>\r\n          <div style={{\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            margin: '0 auto var(--spacing-4)',\r\n          }}>\r\n            <img src={logoImg} alt=\"ZapBill Logo\" style={{ width: '120px', height: '120px', objectFit: 'contain' }} />\r\n          </div>\r\n          <h1 style={{ fontSize: 'var(--font-size-2xl)', marginBottom: 'var(--spacing-2)' }}>\r\n            ZapBill POS\r\n          </h1>\r\n          <p style={{ opacity: 0.9, fontSize: 'var(--font-size-sm)' }}>\r\n            Sign in to continue\r\n          </p>\r\n        </div>\r\n\r\n        {/* Login Mode Tabs */}\r\n        <div style={{\r\n          display: 'flex',\r\n          borderBottom: '1px solid var(--gray-200)',\r\n        }}>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => { setLoginMode('password'); clearError(); }}\r\n            style={{\r\n              flex: 1,\r\n              padding: 'var(--spacing-3)',\r\n              border: 'none',\r\n              background: loginMode === 'password' ? 'var(--primary-50)' : 'transparent',\r\n              color: loginMode === 'password' ? 'var(--primary-700)' : 'var(--gray-500)',\r\n              fontWeight: 600,\r\n              cursor: 'pointer',\r\n              borderBottom: loginMode === 'password' ? '2px solid var(--primary-600)' : '2px solid transparent',\r\n            }}\r\n          >\r\n            Password Login\r\n          </button>\r\n          <button\r\n            type=\"button\"\r\n            onClick={() => { setLoginMode('pin'); clearError(); }}\r\n            style={{\r\n              flex: 1,\r\n              padding: 'var(--spacing-3)',\r\n              border: 'none',\r\n              background: loginMode === 'pin' ? 'var(--primary-50)' : 'transparent',\r\n              color: loginMode === 'pin' ? 'var(--primary-700)' : 'var(--gray-500)',\r\n              fontWeight: 600,\r\n              cursor: 'pointer',\r\n              borderBottom: loginMode === 'pin' ? '2px solid var(--primary-600)' : '2px solid transparent',\r\n            }}\r\n          >\r\n            Quick PIN\r\n          </button>\r\n        </div>\r\n\r\n        {/* Form */}\r\n        <div className=\"card-body\">\r\n          {/* Error Message */}\r\n          {error && (\r\n            <div style={{\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: 'var(--spacing-2)',\r\n              padding: 'var(--spacing-3)',\r\n              background: 'var(--error-50)',\r\n              color: 'var(--error-700)',\r\n              borderRadius: 'var(--radius-lg)',\r\n              marginBottom: 'var(--spacing-4)',\r\n              fontSize: 'var(--font-size-sm)',\r\n            }}>\r\n              <AlertCircle size={18} />\r\n              <span>{error}</span>\r\n            </div>\r\n          )}\r\n\r\n          {loginMode === 'password' ? (\r\n            <form onSubmit={handleSubmit}>\r\n              <div className=\"input-group\" style={{ marginBottom: 'var(--spacing-4)' }}>\r\n                <label className=\"input-label\">Username</label>\r\n                <div style={{ position: 'relative' }}>\r\n                  <User \r\n                    size={18} \r\n                    style={{ \r\n                      position: 'absolute', \r\n                      left: '12px', \r\n                      top: '50%', \r\n                      transform: 'translateY(-50%)',\r\n                      color: 'var(--gray-400)'\r\n                    }} \r\n                  />\r\n                  <input\r\n                    type=\"text\"\r\n                    className=\"input\"\r\n                    value={username}\r\n                    onChange={(e) => setUsername(e.target.value)}\r\n                    placeholder=\"Enter username\"\r\n                    style={{ paddingLeft: '40px' }}\r\n                    required\r\n                  />\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"input-group\" style={{ marginBottom: 'var(--spacing-6)' }}>\r\n                <label className=\"input-label\">Password</label>\r\n                <div style={{ position: 'relative' }}>\r\n                  <Lock \r\n                    size={18} \r\n                    style={{ \r\n                      position: 'absolute', \r\n                      left: '12px', \r\n                      top: '50%', \r\n                      transform: 'translateY(-50%)',\r\n                      color: 'var(--gray-400)'\r\n                    }} \r\n                  />\r\n                  <input\r\n                    type={showPassword ? 'text' : 'password'}\r\n                    className=\"input\"\r\n                    value={password}\r\n                    onChange={(e) => setPassword(e.target.value)}\r\n                    placeholder=\"Enter password\"\r\n                    style={{ paddingLeft: '40px', paddingRight: '40px' }}\r\n                    required\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowPassword(!showPassword)}\r\n                    style={{\r\n                      position: 'absolute',\r\n                      right: '8px',\r\n                      top: '50%',\r\n                      transform: 'translateY(-50%)',\r\n                      background: 'none',\r\n                      border: 'none',\r\n                      cursor: 'pointer',\r\n                      color: 'var(--gray-400)',\r\n                      padding: '4px',\r\n                    }}\r\n                  >\r\n                    {showPassword ? <EyeOff size={18} /> : <Eye size={18} />}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <button \r\n                type=\"submit\" \r\n                className=\"btn btn-primary btn-lg w-full\"\r\n                disabled={isLoading}\r\n              >\r\n                {isLoading ? 'Signing in...' : 'Sign In'}\r\n              </button>\r\n            </form>\r\n          ) : (\r\n            <div>\r\n              {/* PIN Display */}\r\n              <div style={{\r\n                display: 'flex',\r\n                justifyContent: 'center',\r\n                gap: 'var(--spacing-3)',\r\n                marginBottom: 'var(--spacing-6)',\r\n              }}>\r\n                {[0, 1, 2, 3].map((i) => (\r\n                  <div\r\n                    key={i}\r\n                    style={{\r\n                      width: '48px',\r\n                      height: '48px',\r\n                      borderRadius: 'var(--radius-lg)',\r\n                      border: '2px solid var(--gray-300)',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      justifyContent: 'center',\r\n                      fontSize: 'var(--font-size-2xl)',\r\n                      fontWeight: 700,\r\n                      background: pin[i] ? 'var(--primary-50)' : 'white',\r\n                      borderColor: pin[i] ? 'var(--primary-500)' : 'var(--gray-300)',\r\n                    }}\r\n                  >\r\n                    {pin[i] ? '' : ''}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              {/* PIN Keypad */}\r\n              <div style={{\r\n                display: 'grid',\r\n                gridTemplateColumns: 'repeat(3, 1fr)',\r\n                gap: 'var(--spacing-2)',\r\n                maxWidth: '260px',\r\n                margin: '0 auto',\r\n              }}>\r\n                {[1, 2, 3, 4, 5, 6, 7, 8, 9, 'C', 0, ''].map((key) => (\r\n                  <button\r\n                    key={key}\r\n                    type=\"button\"\r\n                    onClick={() => {\r\n                      if (key === 'C') handlePinClear();\r\n                      else if (key === '') handlePinBackspace();\r\n                      else handlePinInput(key.toString());\r\n                    }}\r\n                    style={{\r\n                      padding: 'var(--spacing-4)',\r\n                      fontSize: 'var(--font-size-xl)',\r\n                      fontWeight: 600,\r\n                      border: 'none',\r\n                      borderRadius: 'var(--radius-lg)',\r\n                      background: typeof key === 'number' ? 'var(--gray-100)' : 'var(--gray-200)',\r\n                      cursor: 'pointer',\r\n                      transition: 'all var(--transition-fast)',\r\n                    }}\r\n                    onMouseOver={(e) => e.target.style.background = 'var(--gray-200)'}\r\n                    onMouseOut={(e) => e.target.style.background = typeof key === 'number' ? 'var(--gray-100)' : 'var(--gray-200)'}\r\n                  >\r\n                    {key}\r\n                  </button>\r\n                ))}\r\n              </div>\r\n\r\n              {/* Submit PIN */}\r\n              <button \r\n                type=\"button\"\r\n                className=\"btn btn-primary btn-lg w-full\"\r\n                style={{ marginTop: 'var(--spacing-6)' }}\r\n                disabled={isLoading || pin.length !== 4}\r\n                onClick={handleSubmit}\r\n              >\r\n                {isLoading ? 'Signing in...' : 'Sign In with PIN'}\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div style={{\r\n          padding: 'var(--spacing-4)',\r\n          textAlign: 'center',\r\n          fontSize: 'var(--font-size-xs)',\r\n          color: 'var(--gray-500)',\r\n          borderTop: '1px solid var(--gray-200)',\r\n        }}>\r\n          Default credentials: admin / admin123 (PIN: 1234)\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoginPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\MenuPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'handleEditAddon' is assigned a value but never used.","line":92,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":92,"endColumn":24},{"ruleId":"no-unused-vars","severity":1,"message":"'handleEditMasterAddon' is assigned a value but never used.","line":105,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":105,"endColumn":30},{"ruleId":"no-unused-vars","severity":1,"message":"'activeTab' is assigned a value but never used.","line":711,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":711,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'setActiveTab' is assigned a value but never used.","line":711,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":711,"endColumn":33}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport {\r\n  Plus,\r\n  Edit2,\r\n  Trash2,\r\n  Search,\r\n  X,\r\n  Save,\r\n  FolderOpen,\r\n  Leaf,\r\n  RefreshCw,\r\n  List,\r\n  Layers, // New icon\r\n  ArrowLeft\r\n} from 'lucide-react';\r\nimport './MenuPage.css'; // Added import\r\n\r\nconst MenuPage = () => {\r\n  const [categories, setCategories] = useState([]);\r\n  const [menuItems, setMenuItems] = useState([]);\r\n  const [selectedCategory, setSelectedCategory] = useState(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [showItemModal, setShowItemModal] = useState(false);\r\n  const [showCategoryModal, setShowCategoryModal] = useState(false);\r\n  const [showGlobalAddonsModal, setShowGlobalAddonsModal] = useState(false); // New modal state\r\n  const [editingItem, setEditingItem] = useState(null);\r\n  const [editingCategory, setEditingCategory] = useState(null);\r\n  const [addons, setAddons] = useState([]);\r\n  const [masterAddons, setMasterAddons] = useState([]); // New state for Master Add-ons\r\n  const [showAddonModal, setShowAddonModal] = useState(false);\r\n  const [showMasterAddonsModal, setShowMasterAddonsModal] = useState(false); // New modal state\r\n  const [editingAddon, setEditingAddon] = useState(null);\r\n  const [editingMasterAddon, setEditingMasterAddon] = useState(null); // New editing state\r\n  const [editingMasterAddonModalOpen, setEditingMasterAddonModalOpen] = useState(false); // New modal opening state\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [menus, setMenus] = useState([]);\r\n  const [activeMenu, setActiveMenu] = useState(null);\r\n  const [showMenuManager, setShowMenuManager] = useState(false);\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n  }, []);\r\n\r\n  const loadData = async () => {\r\n    try {\r\n      const [cats, items, addonsList, masterAddonsList, menusList, active] = await Promise.all([\r\n        window.electronAPI.invoke('menu:getCategories'),\r\n        window.electronAPI.invoke('menu:getItems', {}),\r\n        window.electronAPI.invoke('menu:getAddons'),\r\n        window.electronAPI.invoke('menu:getMasterAddons'),\r\n        window.electronAPI.invoke('menu:getMenus'),\r\n        window.electronAPI.invoke('menu:getActiveMenu')\r\n      ]);\r\n      setCategories(cats);\r\n      setMenuItems(items);\r\n      setAddons(addonsList || []);\r\n      setMasterAddons(masterAddonsList || []);\r\n      setMenus(menusList || []);\r\n      setActiveMenu(active);\r\n    } catch (error) {\r\n      console.error('Failed to load data:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const filteredItems = menuItems.filter(item => {\r\n    const matchesCategory = !selectedCategory || item.category_id === selectedCategory;\r\n    const matchesSearch = !searchQuery ||\r\n      item.name.toLowerCase().includes(searchQuery.toLowerCase());\r\n    return matchesCategory && matchesSearch;\r\n  });\r\n\r\n  const handleEditItem = (item) => {\r\n    setEditingItem(item);\r\n    setShowItemModal(true);\r\n  };\r\n\r\n  const handleDeleteItem = async (id) => {\r\n    if (window.confirm('Are you sure you want to delete this item?')) {\r\n      await window.electronAPI.invoke('menu:deleteItem', { id });\r\n      loadData();\r\n    }\r\n  };\r\n\r\n  const handleEditCategory = (category) => {\r\n    setEditingCategory(category);\r\n    setShowCategoryModal(true);\r\n  };\r\n\r\n  // Helper for Global Addons List Modal\r\n  const handleEditAddon = (addon) => {\r\n    setEditingAddon(addon);\r\n    setShowAddonModal(true);\r\n  };\r\n\r\n  const handleDeleteAddon = async (id) => {\r\n    if (window.confirm('Are you sure you want to delete this add-on?')) {\r\n      await window.electronAPI.invoke('menu:deleteAddon', { id });\r\n      loadData();\r\n    }\r\n  };\r\n\r\n  // Master Addon Handlers\r\n  const handleEditMasterAddon = (masterAddon) => {\r\n    setEditingMasterAddon(masterAddon);\r\n    // Logic for MasterAddonEditModal\r\n  };\r\n\r\n  const handleDeleteMasterAddon = async (id) => {\r\n    if (window.confirm('Are you sure you want to delete this Master Add-on group?')) {\r\n      await window.electronAPI.invoke('menu:deleteMasterAddon', { id });\r\n      loadData();\r\n    }\r\n  };\r\n\r\n  const handleDeleteCategory = async (id) => {\r\n    if (window.confirm('Are you sure you want to delete this category?')) {\r\n      const result = await window.electronAPI.invoke('menu:deleteCategory', { id });\r\n      if (result.success) {\r\n        loadData();\r\n        if (selectedCategory === id) setSelectedCategory(null);\r\n      } else {\r\n        alert(result.error);\r\n      }\r\n    }\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"empty-state\">\r\n        <div className=\"loading-spinner\" />\r\n        <p className=\"mt-4\">Loading menu...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (showItemModal) {\r\n    return (\r\n      <ItemModal\r\n        item={editingItem}\r\n        categories={categories}\r\n        onClose={() => {\r\n          setShowItemModal(false);\r\n          setEditingItem(null);\r\n        }}\r\n        onSave={() => {\r\n          setShowItemModal(false);\r\n          setEditingItem(null);\r\n          loadData();\r\n        }}\r\n        onAddCategory={() => {\r\n          setEditingCategory(null);\r\n          setShowCategoryModal(true);\r\n        }}\r\n        globalAddons={addons}\r\n        masterAddons={masterAddons}\r\n        onRefreshAddons={loadData}\r\n      />\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"page-container\" style={{ height: 'calc(100vh - 65px)', overflow: 'hidden', display: 'flex', flexDirection: 'column' }}>\r\n      {/* Header */}\r\n      <div style={{\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        background: 'white',\r\n        padding: '16px 24px',\r\n        margin: '0',\r\n        zIndex: 20,\r\n        borderBottom: '1px solid var(--gray-200)',\r\n        flexShrink: 0\r\n      }}>\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>\r\n          <div>\r\n            <h1 style={{ fontSize: '1.5rem', margin: 0 }}>Menu Management</h1>\r\n            <p className=\"text-muted\" style={{ fontSize: '0.875rem', margin: '4px 0 0 0' }}>Manage items, categories & add-ons</p>\r\n          </div>\r\n          \r\n          {/* Menu Profile Selector */}\r\n          <div \r\n            onClick={() => setShowMenuManager(true)}\r\n            style={{ \r\n              background: 'var(--primary-50)', \r\n              padding: '6px 14px', \r\n              borderRadius: '20px', \r\n              border: '1px solid var(--primary-200)',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '8px',\r\n              cursor: 'pointer',\r\n              marginLeft: '12px'\r\n            }}\r\n          >\r\n            <div style={{ width: '8px', height: '8px', borderRadius: '50%', background: 'var(--primary-500)' }} />\r\n            <span style={{ fontSize: '0.85rem', fontWeight: '600', color: 'var(--primary-700)' }}>\r\n              Menu: {activeMenu?.name || 'Loading...'}\r\n            </span>\r\n            <RefreshCw size={14} style={{ color: 'var(--primary-400)' }} />\r\n          </div>\r\n        </div>\r\n        <div style={{ display: 'flex', gap: '12px' }}>\r\n          <button\r\n            className=\"btn btn-secondary\"\r\n            onClick={() => setShowGlobalAddonsModal(true)}\r\n          >\r\n            <List size={18} />\r\n            Global Add-ons\r\n          </button>\r\n          <button className=\"btn btn-secondary\" onClick={() => setShowMasterAddonsModal(true)}>\r\n            <Layers size={18} /> Master Add-ons\r\n          </button>\r\n          <button\r\n            className=\"btn btn-secondary\"\r\n            onClick={() => {\r\n              setEditingCategory(null);\r\n              setShowCategoryModal(true);\r\n            }}\r\n          >\r\n            <Plus size={18} />\r\n            Add Category\r\n          </button>\r\n          <button\r\n            className=\"btn btn-primary\"\r\n            onClick={() => {\r\n              setEditingItem(null);\r\n              setShowItemModal(true);\r\n            }}\r\n            style={{ background: '#D32F2F', border: 'none' }}\r\n          >\r\n            <Plus size={18} />\r\n            Add Item\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{ flex: 1, overflowY: 'auto', padding: '24px' }}>\r\n      <div style={{ marginBottom: 'var(--spacing-4)' }}>\r\n        <h4 style={{ marginBottom: 'var(--spacing-2)' }}>Categories</h4>\r\n        <div style={{ display: 'flex', gap: 'var(--spacing-2)', flexWrap: 'wrap' }}>\r\n          <button\r\n            className={`category-tab ${!selectedCategory ? 'active' : ''}`}\r\n            onClick={() => setSelectedCategory(null)}\r\n          >\r\n            All ({menuItems.length})\r\n          </button>\r\n          {categories.map(cat => (\r\n            <div key={cat.id} style={{ display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n              <button\r\n                className={`category-tab ${selectedCategory === cat.id ? 'active' : ''}`}\r\n                onClick={() => setSelectedCategory(cat.id)}\r\n              >\r\n                {cat.name} ({menuItems.filter(i => i.category_id === cat.id).length})\r\n              </button>\r\n              <button\r\n                className=\"btn btn-ghost btn-icon btn-sm\"\r\n                onClick={() => handleEditCategory(cat)}\r\n                style={{ padding: '4px' }}\r\n              >\r\n                <Edit2 size={14} />\r\n              </button>\r\n              <button\r\n                className=\"btn btn-ghost btn-icon btn-sm\"\r\n                onClick={() => handleDeleteCategory(cat.id)}\r\n                style={{ padding: '4px', color: 'var(--danger-500)' }}\r\n                title=\"Delete Category\"\r\n              >\r\n                <Trash2 size={14} />\r\n              </button>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n\r\n      {/* Search */}\r\n      <div style={{ marginBottom: 'var(--spacing-4)', maxWidth: '400px' }}>\r\n        <div style={{ position: 'relative' }}>\r\n          <Search\r\n            size={18}\r\n            style={{\r\n              position: 'absolute',\r\n              left: '12px',\r\n              top: '50%',\r\n              transform: 'translateY(-50%)',\r\n              color: 'var(--gray-400)'\r\n            }}\r\n          />\r\n          <input\r\n            type=\"text\"\r\n            className=\"input\"\r\n            placeholder=\"Search menu items...\"\r\n            value={searchQuery}\r\n            onChange={(e) => setSearchQuery(e.target.value)}\r\n            style={{ paddingLeft: '40px' }}\r\n          />\r\n        </div>\r\n      </div>\r\n\r\n      {/* Items Table */}\r\n      <div className=\"table-container\">\r\n        <table className=\"table\">\r\n          <thead>\r\n            <tr>\r\n              <th>Name</th>\r\n              <th>Category</th>\r\n              <th>Price</th>\r\n              <th>Tax</th>\r\n              <th>Type</th>\r\n              <th>Status</th>\r\n              <th style={{ width: '100px' }}>Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {filteredItems.map(item => (\r\n              <tr key={item.id}>\r\n                <td>\r\n                  <div style={{ fontWeight: 500 }}>{item.name}</div>\r\n                  {item.description && (\r\n                    <div className=\"text-xs text-muted\">{item.description}</div>\r\n                  )}\r\n                </td>\r\n                <td>{item.category_name}</td>\r\n                <td style={{ fontWeight: 600 }}>{item.price.toFixed(2)}</td>\r\n                <td>{item.tax_rate}%</td>\r\n                <td>\r\n                  {item.is_vegetarian ? (\r\n                    <span className=\"badge badge-success\">\r\n                      <Leaf size={12} style={{ marginRight: '4px' }} />\r\n                      Veg\r\n                    </span>\r\n                  ) : (\r\n                    <span className=\"badge badge-error\">Non-Veg</span>\r\n                  )}\r\n                </td>\r\n                <td>\r\n                  <span className={`badge ${item.is_available ? 'badge-success' : 'badge-gray'}`}>\r\n                    {item.is_available ? 'Available' : 'Unavailable'}\r\n                  </span>\r\n                </td>\r\n                <td>\r\n                  <div style={{ display: 'flex', gap: 'var(--spacing-1)' }}>\r\n                    <button\r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => handleEditItem(item)}\r\n                    >\r\n                      <Edit2 size={16} />\r\n                    </button>\r\n                    <button\r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => handleDeleteItem(item.id)}\r\n                      style={{ color: 'var(--error-500)' }}\r\n                    >\r\n                      <Trash2 size={16} />\r\n                    </button>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n\r\n        {filteredItems.length === 0 && (\r\n          <div className=\"empty-state\">\r\n            <FolderOpen size={48} />\r\n            <p className=\"empty-state-title\">No items found</p>\r\n            <p className=\"text-muted\">Add your first menu item to get started</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Category Modal */}\r\n      {showCategoryModal && (\r\n        <CategoryModal\r\n          category={editingCategory}\r\n          onClose={() => {\r\n            setShowCategoryModal(false);\r\n            setEditingCategory(null);\r\n          }}\r\n          onSave={() => {\r\n            setShowCategoryModal(false);\r\n            setEditingCategory(null);\r\n            loadData();\r\n          }}\r\n        />\r\n      )}\r\n\r\n\r\n\r\n      {/* Global Add-ons List Modal */}\r\n      {showGlobalAddonsModal && (\r\n        <GlobalAddonsListModal\r\n          addons={addons}\r\n          onClose={() => setShowGlobalAddonsModal(false)}\r\n          onAdd={() => {\r\n            setEditingAddon(null);\r\n            setShowAddonModal(true);\r\n            // We keep GlobalAddonsListModal open, AddonModal opens on top\r\n          }}\r\n          onEdit={(addon) => {\r\n            setEditingAddon(addon);\r\n            setShowAddonModal(true);\r\n          }}\r\n          onDelete={handleDeleteAddon}\r\n        />\r\n      )}\r\n\r\n      {/* Addon Modal - Rendered Last to be on Top */}\r\n      {showAddonModal && (\r\n        <AddonModal\r\n          addon={editingAddon}\r\n          onClose={() => {\r\n            setShowAddonModal(false);\r\n            setEditingAddon(null);\r\n          }}\r\n          onSave={() => {\r\n            setShowAddonModal(false);\r\n            setEditingAddon(null);\r\n            loadData();\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* Menu Manager Modal */}\r\n      {showMenuManager && (\r\n        <MenuManagerModal \r\n          menus={menus}\r\n          activeMenu={activeMenu}\r\n          onClose={() => setShowMenuManager(false)}\r\n          onRefresh={loadData}\r\n        />\r\n      )}\r\n\r\n      {/* Master Add-ons List Modal */}\r\n      {showMasterAddonsModal && (\r\n        <MasterAddonsModal\r\n          masterAddons={masterAddons}\r\n          onClose={() => setShowMasterAddonsModal(false)}\r\n          onAdd={() => {\r\n            setEditingMasterAddon(null);\r\n            setShowMasterAddonsModal(false);\r\n            setEditingMasterAddonModalOpen(true);\r\n          }}\r\n          onEdit={(ma) => {\r\n            setEditingMasterAddon(ma);\r\n            setShowMasterAddonsModal(false);\r\n            setEditingMasterAddonModalOpen(true);\r\n          }}\r\n          onDelete={handleDeleteMasterAddon}\r\n        />\r\n      )}\r\n\r\n      {/* Master Add-on Edit Modal */}\r\n      {editingMasterAddonModalOpen && (\r\n        <MasterAddonEditModal\r\n          masterAddon={editingMasterAddon}\r\n          globalAddons={addons}\r\n          onClose={() => {\r\n            setEditingMasterAddonModalOpen(false);\r\n            setEditingMasterAddon(null);\r\n            setShowMasterAddonsModal(true);\r\n          }}\r\n          onSave={() => {\r\n            setEditingMasterAddonModalOpen(false);\r\n            setEditingMasterAddon(null);\r\n            setShowMasterAddonsModal(true);\r\n            loadData();\r\n          }}\r\n        />\r\n      )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Global Add-ons List Modal\r\nconst GlobalAddonsListModal = ({ addons, onClose, onAdd, onEdit, onDelete }) => {\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" style={{ maxWidth: '600px', height: '70vh', display: 'flex', flexDirection: 'column' }} onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\" style={{ borderBottom: '1px solid var(--gray-200)' }}>\r\n          <div>\r\n            <h3 className=\"modal-title\">Global Add-ons</h3>\r\n            <p className=\"text-muted text-sm\">Manage add-ons available for all items</p>\r\n          </div>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}>\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"modal-body\" style={{ flex: 1, overflowY: 'auto', padding: '24px' }}>\r\n          <div style={{ display: 'flex', justifyContent: 'flex-end', marginBottom: '16px' }}>\r\n            <button className=\"btn btn-secondary\" onClick={onAdd}>\r\n              <Plus size={16} /> New Add-on\r\n            </button>\r\n          </div>\r\n\r\n          {addons.length === 0 ? (\r\n            <div className=\"empty-state\" style={{ padding: '40px 0' }}>\r\n              <p className=\"text-muted\">No global add-ons found.</p>\r\n            </div>\r\n          ) : (\r\n            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px' }}>\r\n              {addons.map(addon => (\r\n                <div key={addon.id} style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'space-between',\r\n                  padding: '12px 16px',\r\n                  background: 'white',\r\n                  border: '1px solid var(--gray-200)',\r\n                  borderRadius: '8px'\r\n                }}>\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>\r\n                    <div style={{\r\n                      width: '32px',\r\n                      height: '32px',\r\n                      borderRadius: '50%',\r\n                      background: addon.type === 'veg' ? '#dcfce7' : '#fef2f2',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      justifyContent: 'center'\r\n                    }}>\r\n                      <div style={{\r\n                        width: '12px',\r\n                        height: '12px',\r\n                        borderRadius: '50%',\r\n                        background: addon.type === 'veg' ? '#16a34a' : '#dc2626'\r\n                      }} />\r\n                    </div>\r\n                    <div>\r\n                      <div style={{ fontWeight: 500 }}>{addon.name}</div>\r\n                      <div className=\"text-sm text-muted\">{addon.price}</div>\r\n                    </div>\r\n                  </div>\r\n                  <div style={{ display: 'flex', gap: '8px' }}>\r\n                    <button\r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => onEdit(addon)}\r\n                    >\r\n                      <Edit2 size={16} />\r\n                    </button>\r\n                    <button\r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => onDelete(addon.id)}\r\n                      style={{ color: 'var(--error-500)' }}\r\n                    >\r\n                      <Trash2 size={16} />\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"modal-footer\" style={{ borderTop: '1px solid var(--gray-200)' }}>\r\n          <button className=\"btn btn-primary\" onClick={onClose} style={{ width: '100%' }}>Close</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Category Modal - Redesigned\r\nconst CategoryModal = ({ category, onClose, onSave }) => {\r\n  const [name, setName] = useState(category?.name || '');\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSaving(true);\r\n    try {\r\n      if (category?.id) {\r\n        await window.electronAPI.invoke('menu:saveCategory', { category: { id: category.id, name } });\r\n      } else {\r\n        await window.electronAPI.invoke('menu:saveCategory', { category: { name } });\r\n      }\r\n      onSave();\r\n    } catch (error) {\r\n      console.error(error);\r\n      alert('Failed to save category');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal modal-sm\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <div className=\"modal-title\">\r\n            <div style={{\r\n              width: '40px',\r\n              height: '40px',\r\n              borderRadius: '12px',\r\n              background: '#FFEBEE',\r\n              color: '#D32F2F',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center'\r\n            }}>\r\n              <FolderOpen size={24} />\r\n            </div>\r\n            <div>\r\n              <div>{category ? 'Edit Category' : 'New Category'}</div>\r\n              <div style={{ fontSize: '0.875rem', color: 'var(--gray-500)', fontWeight: 400, marginTop: '2px' }}>\r\n                Organize your menu items\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}>\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"modal-body\">\r\n            <div className=\"input-group\">\r\n              <label className=\"input-label\">Category Name</label>\r\n              <div style={{ position: 'relative' }}>\r\n                <div style={{\r\n                  position: 'absolute',\r\n                  left: '12px',\r\n                  top: '50%',\r\n                  transform: 'translateY(-50%)',\r\n                  color: 'var(--gray-400)',\r\n                  pointerEvents: 'none'\r\n                }}>\r\n                  <FolderOpen size={18} />\r\n                </div>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"input\"\r\n                  placeholder=\"e.g. Pizzas, Drinks, Desserts\"\r\n                  value={name}\r\n                  onChange={(e) => setName(e.target.value)}\r\n                  required\r\n                  autoFocus\r\n                  style={{ paddingLeft: '40px' }}\r\n                />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"modal-footer\">\r\n            <button type=\"button\" className=\"btn btn-secondary\" onClick={onClose}>\r\n              Cancel\r\n            </button>\r\n            <button type=\"submit\" className=\"btn btn-primary\" disabled={isSaving}>\r\n              {isSaving ? 'Saving...' : 'Save Category'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Menu Item Modal\r\nconst ItemModal = ({ item, categories, onClose, onSave, globalAddons, onRefreshAddons, masterAddons, onAddCategory }) => {\r\n  const [formData, setFormData] = useState({\r\n    name: item?.name || '',\r\n    description: item?.description || '',\r\n    category_id: item?.category_id || (categories[0]?.id || ''),\r\n    price: item?.price || '',\r\n    cost_price: item?.cost_price || '',\r\n    tax_rate: item?.tax_rate || 5,\r\n    is_vegetarian: item?.is_vegetarian ?? true,\r\n    is_available: item?.is_available ?? true,\r\n    preparation_time: item?.preparation_time || '',\r\n    variants: [],\r\n    addons: [],\r\n    master_addon_ids: []\r\n  });\r\n\r\n  // Safe init\r\n  useEffect(() => {\r\n    let initialVariants = [];\r\n    let initialAddons = [];\r\n    try {\r\n      if (item?.variants) {\r\n        initialVariants = typeof item.variants === 'string' ? JSON.parse(item.variants) : item.variants;\r\n      }\r\n    } catch (e) { console.error('Error parsing variants', e) }\r\n\r\n    try {\r\n      if (item?.addons) {\r\n        initialAddons = typeof item.addons === 'string' ? JSON.parse(item.addons) : item.addons;\r\n      }\r\n    } catch (e) { console.error('Error parsing addons', e) }\r\n\r\n    let initialMasterAddonIds = [];\r\n    try {\r\n      if (item?.master_addon_ids) {\r\n        initialMasterAddonIds = typeof item.master_addon_ids === 'string' ? JSON.parse(item.master_addon_ids) : item.master_addon_ids;\r\n      }\r\n    } catch (e) { console.error('Error parsing master_addon_ids', e) }\r\n\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      variants: initialVariants || [],\r\n      addons: initialAddons || [],\r\n      master_addon_ids: initialMasterAddonIds || []\r\n    }));\r\n  }, [item]);\r\n\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [activeTab, setActiveTab] = useState('basic'); // basic, variants, addons\r\n\r\n  // Variant Selection State\r\n  const [variantType, setVariantType] = useState('Small'); // Small, Medium, Large, Custom\r\n  const [customVariantName, setCustomVariantName] = useState('');\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSaving(true);\r\n\r\n    try {\r\n      const saveData = {\r\n        ...formData,\r\n        price: parseFloat(formData.price),\r\n        cost_price: formData.cost_price ? parseFloat(formData.cost_price) : null,\r\n        tax_rate: parseFloat(formData.tax_rate),\r\n        preparation_time: formData.preparation_time ? parseInt(formData.preparation_time) : null,\r\n        is_vegetarian: formData.is_vegetarian ? 1 : 0,\r\n        is_available: formData.is_available ? 1 : 0,\r\n        master_addon_ids: formData.master_addon_ids,\r\n      };\r\n\r\n      if (item?.id) {\r\n        saveData.id = item.id;\r\n      }\r\n\r\n      await window.electronAPI.invoke('menu:saveItem', { item: saveData });\r\n      onSave();\r\n    } catch (error) {\r\n      console.error('Save failed:', error);\r\n      alert('Failed to save item');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const addVariant = (name) => {\r\n    // Check dupes\r\n    if (formData.variants.some(v => v.name === name)) {\r\n      alert('Variant already exists');\r\n      return;\r\n    }\r\n\r\n    setFormData(prev => ({\r\n      ...prev,\r\n      variants: [...prev.variants, { name: name, price: '' }]\r\n    }));\r\n  };\r\n\r\n  const handleAddVariant = () => {\r\n    let nameToAdd = variantType;\r\n    if (variantType === 'Custom') {\r\n      if (!customVariantName.trim()) {\r\n        alert('Please enter a variant name');\r\n        return;\r\n      }\r\n      nameToAdd = customVariantName;\r\n    }\r\n\r\n    addVariant(nameToAdd);\r\n\r\n    // Reset\r\n    if (variantType === 'Custom') setCustomVariantName('');\r\n  };\r\n\r\n  const updateVariant = (index, field, value) => {\r\n    const newVariants = [...formData.variants];\r\n    newVariants[index][field] = value;\r\n    setFormData({ ...formData, variants: newVariants });\r\n  };\r\n\r\n  const removeVariant = (index) => {\r\n    setFormData({\r\n      ...formData,\r\n      variants: formData.variants.filter((_, i) => i !== index)\r\n    });\r\n  };\r\n\r\n  const addGlobalAddon = (globalAddon) => {\r\n    if (formData.addons.some(a => a.name === globalAddon.name)) {\r\n      alert('This add-on is already added');\r\n      return;\r\n    }\r\n    setFormData({\r\n      ...formData,\r\n      addons: [...formData.addons, {\r\n        name: globalAddon.name,\r\n        price: globalAddon.price,\r\n        type: globalAddon.type\r\n      }]\r\n    });\r\n  };\r\n\r\n  const addAddon = () => {\r\n    setFormData({\r\n      ...formData,\r\n      addons: [...formData.addons, { name: '', price: '', type: 'veg' }]\r\n    });\r\n  };\r\n\r\n  const updateAddon = (index, field, value) => {\r\n    const newAddons = [...formData.addons];\r\n    newAddons[index][field] = value;\r\n    setFormData({ ...formData, addons: newAddons });\r\n  };\r\n\r\n  const removeAddon = (index) => {\r\n    setFormData({\r\n      ...formData,\r\n      addons: formData.addons.filter((_, i) => i !== index)\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"page-container\" style={{ height: 'calc(100vh - 65px)', overflow: 'hidden', display: 'flex', flexDirection: 'column', background: '#f9fafb' }}>\r\n      <div style={{\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        background: 'white',\r\n        padding: '16px 24px',\r\n        margin: '0',\r\n        zIndex: 20,\r\n        borderBottom: '1px solid var(--gray-200)',\r\n        flexShrink: 0\r\n      }}>\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>\r\n          <button \r\n            onClick={onClose} \r\n            style={{ \r\n              background: 'white', \r\n              border: '1px solid #e5e7eb', \r\n              borderRadius: '8px', \r\n              width: '36px', \r\n              height: '36px', \r\n              display: 'flex', \r\n              alignItems: 'center', \r\n              justifyContent: 'center', \r\n              cursor: 'pointer',\r\n              color: '#374151',\r\n              transition: 'all 0.2s',\r\n            }}\r\n            onMouseOver={e => e.currentTarget.style.background = '#f3f4f6'}\r\n            onMouseOut={e => e.currentTarget.style.background = 'white'}\r\n          >\r\n            <ArrowLeft size={18} />\r\n          </button>\r\n          <div>\r\n            <h1 style={{ fontSize: '1.5rem', margin: 0, color: '#111827' }}>{item ? 'Edit Item' : 'New Menu Item'}</h1>\r\n            <p className=\"text-muted\" style={{ fontSize: '0.875rem', margin: '4px 0 0 0' }}>Fill in the details for your menu item.</p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n        <form onSubmit={handleSubmit} style={{ flex: 1, overflow: 'hidden', display: 'flex', flexDirection: 'column' }}>\r\n          <div className=\"modal-body\" style={{ flex: 1, overflowY: 'auto', padding: '24px 32px', maxWidth: '1400px', margin: '0 auto', width: '100%' }}>\r\n            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(480px, 1fr))', gap: '48px', alignItems: 'start' }}>\r\n              \r\n              {/* Left Column: Basic Info & Variants */}\r\n              <div style={{ display: 'flex', flexDirection: 'column', gap: '32px' }}>\r\n                {/* Basic Info Section */}\r\n                <div>\r\n              <h2 style={{ fontSize: '1.25rem', color: '#111827', marginBottom: '20px', borderBottom: '1px solid #e5e7eb', paddingBottom: '12px' }}>Basic Info</h2>\r\n              <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'minmax(0, 1.5fr) minmax(0, 1fr)', gap: '16px', alignItems: 'flex-end' }}>\r\n                  <div className=\"input-group\" style={{ margin: 0 }}>\r\n                    <label className=\"input-label\">Item Name *</label>\r\n                    <input\r\n                      type=\"text\"\r\n                      className=\"input\"\r\n                      value={formData.name}\r\n                      onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                      required\r\n                      style={{ padding: '10px', fontSize: '1rem' }}\r\n                    />\r\n                  </div>\r\n                  <div className=\"input-group\" style={{ margin: 0 }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '4px' }}>\r\n                      <label className=\"input-label\" style={{ margin: 0 }}>Category *</label>\r\n                      <button type=\"button\" onClick={onAddCategory} style={{ background: 'none', border: 'none', color: '#D32F2F', fontSize: '0.85rem', fontWeight: 600, cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                        <Plus size={14} /> New Category\r\n                      </button>\r\n                    </div>\r\n                    <select\r\n                      className=\"input select\"\r\n                      value={formData.category_id}\r\n                      onChange={(e) => setFormData({ ...formData, category_id: e.target.value })}\r\n                      required\r\n                      style={{ padding: '10px' }}\r\n                    >\r\n                      {categories.map(cat => (\r\n                        <option key={cat.id} value={cat.id}>{cat.name}</option>\r\n                      ))}\r\n                    </select>\r\n                  </div>\r\n                </div>\r\n\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'minmax(0, 1fr) minmax(0, 1fr) auto auto', gap: '16px', alignItems: 'center' }}>\r\n                  <div className=\"input-group\" style={{ margin: 0 }}>\r\n                    <label className=\"input-label\">Price () *</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      step=\"0.01\"\r\n                      className=\"input\"\r\n                      value={formData.price}\r\n                      onChange={(e) => setFormData({ ...formData, price: e.target.value })}\r\n                      required\r\n                      style={{ padding: '10px', fontWeight: 600 }}\r\n                    />\r\n                  </div>\r\n                  <div className=\"input-group\" style={{ margin: 0 }}>\r\n                    <label className=\"input-label\">Tax Rate (%)</label>\r\n                    <input\r\n                      type=\"number\"\r\n                      step=\"0.01\"\r\n                      className=\"input\"\r\n                      value={formData.tax_rate}\r\n                      onChange={(e) => setFormData({ ...formData, tax_rate: e.target.value })}\r\n                      style={{ padding: '10px' }}\r\n                    />\r\n                  </div>\r\n\r\n                  {/* Veg/Non-Veg Toggle - Styled */}\r\n                  <div style={{ display: 'flex', background: '#f3f4f6', padding: '4px', borderRadius: '8px', gap: '4px' }}>\r\n                    <div\r\n                      onClick={() => setFormData({ ...formData, is_vegetarian: true })}\r\n                      style={{\r\n                        padding: '6px 12px',\r\n                        borderRadius: '6px',\r\n                        background: formData.is_vegetarian ? 'white' : 'transparent',\r\n                        color: formData.is_vegetarian ? '#15803d' : '#6b7280',\r\n                        fontWeight: 500,\r\n                        boxShadow: formData.is_vegetarian ? '0 1px 2px rgba(0,0,0,0.1)' : 'none',\r\n                        cursor: 'pointer',\r\n                        display: 'flex', alignItems: 'center', gap: '6px'\r\n                      }}\r\n                    >\r\n                      <div style={{ width: '8px', height: '8px', borderRadius: '50%', background: '#15803d' }}></div> Veg\r\n                    </div>\r\n                    <div\r\n                      onClick={() => setFormData({ ...formData, is_vegetarian: false })}\r\n                      style={{\r\n                        padding: '6px 12px',\r\n                        borderRadius: '6px',\r\n                        background: !formData.is_vegetarian ? 'white' : 'transparent',\r\n                        color: !formData.is_vegetarian ? '#b91c1c' : '#6b7280',\r\n                        fontWeight: 500,\r\n                        boxShadow: !formData.is_vegetarian ? '0 1px 2px rgba(0,0,0,0.1)' : 'none',\r\n                        cursor: 'pointer',\r\n                        display: 'flex', alignItems: 'center', gap: '6px'\r\n                      }}\r\n                    >\r\n                      <div style={{ width: '8px', height: '8px', borderRadius: '50%', background: '#b91c1c' }}></div> Non-Veg\r\n                    </div>\r\n                  </div>\r\n\r\n                  <label style={{ display: 'flex', alignItems: 'center', gap: '8px', cursor: 'pointer', padding: '0 8px' }}>\r\n                    <input\r\n                      type=\"checkbox\"\r\n                      checked={formData.is_available}\r\n                      onChange={(e) => setFormData({ ...formData, is_available: e.target.checked })}\r\n                      style={{ width: '16px', height: '16px' }}\r\n                    />\r\n                    <span style={{ fontWeight: 500, whiteSpace: 'nowrap' }}>Available for Sale</span>\r\n                  </label>\r\n                </div>\r\n\r\n                <div className=\"input-group\" style={{ margin: 0 }}>\r\n                  <label className=\"input-label\">Description</label>\r\n                  <textarea\r\n                    className=\"input\"\r\n                    value={formData.description}\r\n                    onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                    rows={1}\r\n                    style={{ padding: '8px 10px', resize: 'vertical', minHeight: '40px' }}\r\n                  />\r\n                </div>\r\n              </div>\r\n            </div>\r\n            {/* Variants Section */}\r\n            <div>\r\n              <h2 style={{ fontSize: '1.25rem', color: '#111827', marginBottom: '20px', borderBottom: '1px solid #e5e7eb', paddingBottom: '12px' }}>Variants</h2>\r\n              <div style={{ background: '#f9fafb', padding: '16px', borderRadius: '12px', marginBottom: '24px', display: 'flex', gap: '12px', alignItems: 'flex-end', border: '1px solid #e5e7eb' }}>\r\n                  <div style={{ flex: 1, padding: '8px' }}>\r\n                    <label className=\"input-label\" style={{ marginBottom: '12px', display: 'block', fontSize: '1rem', fontWeight: 600 }}>Create New Variant</label>\r\n                    <div style={{ display: 'flex', gap: '16px' }}>\r\n                      <select\r\n                        className=\"input select\"\r\n                        value={variantType}\r\n                        onChange={(e) => setVariantType(e.target.value)}\r\n                        style={{ padding: '14px', fontSize: '1rem', flex: 1 }}\r\n                      >\r\n                        <option value=\"Small\">Small</option>\r\n                        <option value=\"Medium\">Medium</option>\r\n                        <option value=\"Large\">Large</option>\r\n                        <option value=\"Half\">Half</option>\r\n                        <option value=\"Full\">Full</option>\r\n                        <option value=\"Custom\">Custom...</option>\r\n                      </select>\r\n                      {variantType === 'Custom' && (\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"input\"\r\n                          placeholder=\"Type custom variant name...\"\r\n                          value={customVariantName}\r\n                          onChange={(e) => setCustomVariantName(e.target.value)}\r\n                          style={{ padding: '14px', fontSize: '1rem', flex: 2 }}\r\n                        />\r\n                      )}\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"btn btn-primary\"\r\n                        onClick={handleAddVariant}\r\n                        style={{ whiteSpace: 'nowrap', padding: '14px 24px', fontSize: '1rem' }}\r\n                      >\r\n                        <Plus size={20} /> Add\r\n                      </button>\r\n                    </div>\r\n                    <div style={{ marginTop: '8px', display: 'flex', gap: '8px', flexWrap: 'wrap' }}>\r\n                      {['Small', 'Medium', 'Large', 'Half', 'Full'].map(size => (\r\n                        <button\r\n                          key={size}\r\n                          type=\"button\"\r\n                          className=\"btn btn-xs btn-outline\"\r\n                          onClick={() => addVariant(size)}\r\n                          style={{\r\n                            fontSize: '0.75rem',\r\n                            padding: '4px 8px',\r\n                            borderRadius: '4px',\r\n                            background: 'white',\r\n                            border: '1px solid #e5e7eb',\r\n                            cursor: 'pointer'\r\n                          }}\r\n                        >\r\n                          + {size}\r\n                        </button>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\r\n                  {formData.variants.length === 0 && (\r\n                    <div style={{ textAlign: 'center', padding: '40px', color: '#9ca3af', background: '#f9fafb', borderRadius: '12px', border: '1px dashed #e5e7eb' }}>\r\n                      <p>No variants added yet.</p>\r\n                      <p style={{ fontSize: '0.875rem' }}>Add variants like Small, Medium, Large to offer options.</p>\r\n                    </div>\r\n                  )}\r\n                  {formData.variants.map((variant, index) => (\r\n                    <div key={index} style={{ display: 'flex', gap: '12px', alignItems: 'center', background: 'white', padding: '12px', borderRadius: '12px', border: '1px solid #e5e7eb', boxShadow: '0 1px 2px rgba(0,0,0,0.05)' }}>\r\n                      <div style={{ flex: 1 }}>\r\n                        <label style={{ fontSize: '0.75rem', color: '#6b7280', display: 'block', marginBottom: '4px' }}>Variant Name</label>\r\n                        <input\r\n                          type=\"text\"\r\n                          className=\"input\"\r\n                          value={variant.name}\r\n                          onChange={(e) => updateVariant(index, 'name', e.target.value)}\r\n                          placeholder=\"Name\"\r\n                          style={{ padding: '8px', fontSize: '0.9rem' }}\r\n                        />\r\n                      </div>\r\n                      <div style={{ width: '120px' }}>\r\n                        <label style={{ fontSize: '0.75rem', color: '#6b7280', display: 'block', marginBottom: '4px' }}>Price ()</label>\r\n                        <input\r\n                          type=\"number\"\r\n                          className=\"input\"\r\n                          value={variant.price}\r\n                          onChange={(e) => updateVariant(index, 'price', e.target.value)}\r\n                          placeholder=\"0.00\"\r\n                          style={{ padding: '8px', fontWeight: 600, fontSize: '0.9rem' }}\r\n                        />\r\n                      </div>\r\n                      <div style={{ width: '150px' }}>\r\n                        <label style={{ fontSize: '0.75rem', color: '#6b7280', display: 'block', marginBottom: '4px' }}>Master Add-on</label>\r\n                        <select\r\n                          className=\"input select\"\r\n                          value={variant.master_addon_id || ''}\r\n                          onChange={(e) => updateVariant(index, 'master_addon_id', e.target.value)}\r\n                          style={{ padding: '8px', fontSize: '0.85rem' }}\r\n                        >\r\n                          <option value=\"\">None</option>\r\n                          {masterAddons?.map(ma => (\r\n                            <option key={ma.id} value={ma.id}>{ma.name}</option>\r\n                          ))}\r\n                        </select>\r\n                      </div>\r\n                      <button\r\n                        type=\"button\"\r\n                        className=\"btn btn-ghost btn-icon\"\r\n                        onClick={() => removeVariant(index)}\r\n                        title=\"Remove Variant\"\r\n                        style={{ marginTop: '16px', color: '#ef4444' }}\r\n                      >\r\n                        <Trash2 size={18} />\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n              </div> {/* End Left Column */}\r\n\r\n              {/* Right Column: Add-ons */}\r\n              <div style={{ display: 'flex', flexDirection: 'column', gap: '32px' }}>\r\n                {/* Add-ons Section */}\r\n                <div style={{ background: 'white', padding: '24px', borderRadius: '16px', border: '1px solid #e5e7eb', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)' }}>\r\n              <h2 style={{ fontSize: '1.25rem', color: '#111827', marginBottom: '20px', borderBottom: '1px solid #e5e7eb', paddingBottom: '12px' }}>Add-ons</h2>\r\n              <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>\r\n                {/* Global Add-ons Selector */}\r\n                <div style={{ background: '#f0fdf4', padding: '16px', borderRadius: '12px', marginBottom: '24px', border: '1px solid #dcfce7' }}>\r\n                  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '12px' }}>\r\n                    <h4 style={{ fontSize: '0.9rem', color: '#166534', margin: 0 }}>Import from Global Add-ons</h4>\r\n                    <button type=\"button\" className=\"btn btn-sm btn-ghost\" onClick={onRefreshAddons} style={{ color: '#166534' }}>\r\n                      <RefreshCw size={14} /> Refresh\r\n                    </button>\r\n                  </div>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, minmax(0, 1fr))', gap: '8px', maxHeight: '110px', overflowY: 'auto', paddingRight: '4px', paddingBottom: '4px' }}>\r\n                    {globalAddons.length === 0 && <p style={{ fontSize: '0.875rem', color: '#166534', gridColumn: 'span 3' }}>No global add-ons found.</p>}\r\n                    {globalAddons.map(ga => (\r\n                      <button\r\n                        key={ga.id}\r\n                        type=\"button\"\r\n                        onClick={() => addGlobalAddon(ga)}\r\n                        style={{\r\n                          padding: '6px 12px',\r\n                          background: 'white',\r\n                          border: '1px solid #bbf7d0',\r\n                          borderRadius: '20px',\r\n                          fontSize: '0.875rem',\r\n                          color: '#166534',\r\n                          cursor: 'pointer',\r\n                          display: 'flex',\r\n                          alignItems: 'center',\r\n                          gap: '6px',\r\n                          boxShadow: '0 1px 2px rgba(0,0,0,0.05)',\r\n                          overflow: 'hidden'\r\n                        }}\r\n                        title={`${ga.name} (${ga.price})`}\r\n                      >\r\n                        <Plus size={14} style={{ flexShrink: 0 }} /> \r\n                        <span style={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap', textAlign: 'left' }}>\r\n                          {ga.name} ({ga.price})\r\n                        </span>\r\n                      </button>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Master Add-ons Selector */}\r\n                <div style={{ background: '#f5f3ff', padding: '16px', borderRadius: '12px', marginBottom: '24px', border: '1px solid #ede9fe' }}>\r\n                  <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '12px' }}>\r\n                    <h4 style={{ fontSize: '0.9rem', color: '#5b21b6', margin: 0 }}>Assign Master Add-on Groups</h4>\r\n                  </div>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, minmax(0, 1fr))', gap: '8px', maxHeight: '110px', overflowY: 'auto', paddingRight: '4px', paddingBottom: '4px' }}>\r\n                    {(!masterAddons || masterAddons.length === 0) && <p style={{ fontSize: '0.875rem', color: '#5b21b6', gridColumn: 'span 3' }}>No master add-on groups found.</p>}\r\n                    {masterAddons?.map(ma => {\r\n                      const isAssigned = formData.master_addon_ids.includes(ma.id);\r\n                      return (\r\n                        <button\r\n                          key={ma.id}\r\n                          type=\"button\"\r\n                          onClick={() => {\r\n                            if (isAssigned) {\r\n                              setFormData({ ...formData, master_addon_ids: formData.master_addon_ids.filter(id => id !== ma.id) });\r\n                            } else {\r\n                              setFormData({ ...formData, master_addon_ids: [...formData.master_addon_ids, ma.id] });\r\n                            }\r\n                          }}\r\n                          style={{\r\n                            padding: '6px 12px',\r\n                            background: isAssigned ? '#5b21b6' : 'white',\r\n                            border: `1px solid ${isAssigned ? '#5b21b6' : '#ddd6fe'}`,\r\n                            borderRadius: '20px',\r\n                            fontSize: '0.875rem',\r\n                            color: isAssigned ? 'white' : '#5b21b6',\r\n                            cursor: 'pointer',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            gap: '6px',\r\n                            boxShadow: '0 1px 2px rgba(0,0,0,0.05)',\r\n                            transition: 'all 0.2s',\r\n                            overflow: 'hidden'\r\n                          }}\r\n                          title={ma.name}\r\n                        >\r\n                          {isAssigned ? <X size={14} style={{ flexShrink: 0 }} /> : <Plus size={14} style={{ flexShrink: 0 }} />} \r\n                          <span style={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap', textAlign: 'left' }}>\r\n                            {ma.name}\r\n                          </span>\r\n                        </button>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>\r\n                  <p className=\"text-muted text-sm\">Add-ons for this item</p>\r\n                  <button type=\"button\" className=\"btn btn-sm btn-secondary\" onClick={addAddon}>\r\n                    <Plus size={14} /> Custom Add-on\r\n                  </button>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\r\n                  {formData.addons.length === 0 && (\r\n                    <div style={{ textAlign: 'center', padding: '40px', color: '#9ca3af', background: '#f9fafb', borderRadius: '12px', border: '1px dashed #e5e7eb' }}>\r\n                      <p>No add-ons added yet.</p>\r\n                    </div>\r\n                  )}\r\n                  {formData.addons.map((addon, index) => (\r\n                    <div key={index} style={{ display: 'flex', gap: '12px', alignItems: 'center', background: 'white', padding: '12px', borderRadius: '12px', border: '1px solid #e5e7eb', boxShadow: '0 1px 2px rgba(0,0,0,0.05)' }}>\r\n                      <div style={{ flex: 1 }}>\r\n                        <label style={{ fontSize: '0.75rem', color: '#6b7280', display: 'block', marginBottom: '4px' }}>Add-on Name</label>\r\n                        <input type=\"text\" className=\"input\" value={addon.name} onChange={(e) => updateAddon(index, 'name', e.target.value)} placeholder=\"Name\" style={{ padding: '8px', fontSize: '0.9rem' }} />\r\n                      </div>\r\n                      <div style={{ width: '100px' }}>\r\n                        <label style={{ fontSize: '0.75rem', color: '#6b7280', display: 'block', marginBottom: '4px' }}>Price ()</label>\r\n                        <input type=\"number\" className=\"input\" value={addon.price} onChange={(e) => updateAddon(index, 'price', e.target.value)} placeholder=\"0.00\" style={{ padding: '8px', fontWeight: 600, fontSize: '0.9rem' }} />\r\n                      </div>\r\n                      <div style={{ width: '110px' }}>\r\n                        <label style={{ fontSize: '0.75rem', color: '#6b7280', display: 'block', marginBottom: '4px' }}>Type</label>\r\n                        <select className=\"input select\" value={addon.type} onChange={(e) => updateAddon(index, 'type', e.target.value)} style={{ padding: '8px', fontSize: '0.9rem' }}>\r\n                          <option value=\"veg\">Veg</option>\r\n                          <option value=\"non-veg\">Non-Veg</option>\r\n                        </select>\r\n                      </div>\r\n                      <button type=\"button\" className=\"btn btn-ghost btn-icon\" onClick={() => removeAddon(index)} title=\"Remove Add-on\" style={{ marginTop: '16px', color: '#ef4444' }}>\r\n                        <Trash2 size={18} />\r\n                      </button>\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n              </div>\r\n              </div> {/* End Right Column */}\r\n\r\n            </div> {/* End Grid Wrapper */}\r\n          </div>\r\n\r\n          <div className=\"modal-footer\" style={{ borderTop: '1px solid var(--gray-200)', paddingTop: '16px' }}>\r\n            <button type=\"button\" className=\"btn btn-secondary\" onClick={onClose}>\r\n              Cancel\r\n            </button>\r\n            <button type=\"submit\" className=\"btn btn-primary\" disabled={isSaving}>\r\n              <Save size={18} />\r\n              {isSaving ? 'Saving...' : 'Save Item'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n    </div>\r\n  );\r\n};\r\n\r\n\r\n// Menu Manager Modal\r\nconst MenuManagerModal = ({ menus, activeMenu, onClose, onRefresh }) => {\r\n  const [newMenuName, setNewMenuName] = useState('');\r\n  const [isCreating, setIsCreating] = useState(false);\r\n\r\n  const handleCreateMenu = async (e) => {\r\n    e.preventDefault();\r\n    if (!newMenuName.trim()) return;\r\n    setIsCreating(true);\r\n    try {\r\n      await window.electronAPI.invoke('menu:saveMenu', { menu: { name: newMenuName } });\r\n      setNewMenuName('');\r\n      onRefresh();\r\n    } catch (error) {\r\n      alert('Failed to create menu profile');\r\n    } finally {\r\n      setIsCreating(false);\r\n    }\r\n  };\r\n\r\n  const handleSwitchMenu = async (id) => {\r\n    try {\r\n      await window.electronAPI.invoke('menu:setActiveMenu', { id });\r\n      onRefresh();\r\n    } catch (error) {\r\n      alert('Failed to switch menu profile');\r\n    }\r\n  };\r\n\r\n  const handleDuplicate = async (id, name) => {\r\n    const newName = window.prompt('Enter name for the duplicate menu profile:', `${name} (Copy)`);\r\n    if (!newName) return;\r\n    try {\r\n      await window.electronAPI.invoke('menu:duplicateMenu', { id, name: newName });\r\n      onRefresh();\r\n    } catch (error) {\r\n      alert('Failed to duplicate menu profile');\r\n    }\r\n  };\r\n\r\n  const handleDelete = async (id, name, isActive) => {\r\n    if (isActive) {\r\n      alert('Cannot delete the active menu profile.');\r\n      return;\r\n    }\r\n    if (window.confirm(`Are you sure you want to delete the menu profile \"${name}\"? This will delete all its categories and items.`)) {\r\n      try {\r\n        await window.electronAPI.invoke('menu:deleteMenu', { id });\r\n        onRefresh();\r\n      } catch (error) {\r\n        alert('Failed to delete menu profile');\r\n      }\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" style={{ maxWidth: '600px', maxHeight: '80vh', display: 'flex', flexDirection: 'column' }} onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <div>\r\n            <h3 className=\"modal-title\">Menu Management Profiles</h3>\r\n            <p className=\"text-muted text-sm\">Switch between different menu setups (e.g., Breakfast, Lunch, Special)</p>\r\n          </div>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}>\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"modal-body\" style={{ overflowY: 'auto' }}>\r\n          {/* Create New Profile */}\r\n          <form onSubmit={handleCreateMenu} style={{ display: 'flex', gap: '8px', marginBottom: '24px', padding: '16px', background: 'var(--gray-50)', borderRadius: '12px' }}>\r\n            <input \r\n              type=\"text\" \r\n              className=\"input\" \r\n              placeholder=\"Enter new menu profile name...\" \r\n              value={newMenuName}\r\n              onChange={(e) => setNewMenuName(e.target.value)}\r\n              style={{ flex: 1 }}\r\n            />\r\n            <button type=\"submit\" className=\"btn btn-primary\" disabled={isCreating || !newMenuName.trim()}>\r\n              <Plus size={18} /> Create Profile\r\n            </button>\r\n          </form>\r\n\r\n          {/* List Profile */}\r\n          <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>\r\n            {menus.map(menu => {\r\n              const isActive = activeMenu?.id === menu.id;\r\n              return (\r\n                <div key={menu.id} style={{ \r\n                  padding: '16px', \r\n                  border: `1px solid ${isActive ? 'var(--primary-300)' : 'var(--gray-200)'}`, \r\n                  borderRadius: '12px',\r\n                  background: isActive ? 'var(--primary-50)' : 'white',\r\n                  display: 'flex',\r\n                  justifyContent: 'space-between',\r\n                  alignItems: 'center',\r\n                  transition: 'all 0.2s'\r\n                }}>\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>\r\n                    <div style={{ \r\n                      width: '40px', \r\n                      height: '40px', \r\n                      borderRadius: '10px', \r\n                      background: isActive ? 'var(--primary-500)' : 'var(--gray-100)',\r\n                      color: isActive ? 'white' : 'var(--gray-500)',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      justifyContent: 'center'\r\n                    }}>\r\n                      <List size={20} />\r\n                    </div>\r\n                    <div>\r\n                      <div style={{ fontWeight: 600, color: isActive ? 'var(--primary-700)' : 'var(--gray-700)', display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                        {menu.name}\r\n                        {isActive && <span className=\"badge badge-success\" style={{ fontSize: '10px', padding: '2px 8px' }}>Active</span>}\r\n                      </div>\r\n                      <div style={{ fontSize: '11px', color: 'var(--gray-400)', marginTop: '2px' }}>\r\n                        Created: {new Date(menu.created_at).toLocaleDateString()}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div style={{ display: 'flex', gap: '8px' }}>\r\n                    {!isActive && (\r\n                      <button className=\"btn btn-primary btn-sm\" onClick={() => handleSwitchMenu(menu.id)}>\r\n                        Switch To\r\n                      </button>\r\n                    )}\r\n                    <button className=\"btn btn-secondary btn-icon btn-sm\" title=\"Duplicate Profile\" onClick={() => handleDuplicate(menu.id, menu.name)}>\r\n                      <RefreshCw size={14} />\r\n                    </button>\r\n                    {!isActive && (\r\n                      <button className=\"btn btn-secondary btn-icon btn-sm\" style={{ color: 'var(--danger-500)' }} title=\"Delete Profile\" onClick={() => handleDelete(menu.id, menu.name, isActive)}>\r\n                        <Trash2 size={14} />\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"modal-footer\">\r\n          <button className=\"btn btn-secondary\" style={{ width: '100%' }} onClick={onClose}>Close</button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MenuPage;\r\n\r\n// Addon Modal\r\nconst AddonModal = ({ addon, onClose, onSave }) => {\r\n  const [formData, setFormData] = useState({\r\n    name: addon?.name || '',\r\n    price: addon?.price || '',\r\n    type: addon?.type || 'veg',\r\n    is_available: addon?.is_available ?? true,\r\n  });\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSaving(true);\r\n\r\n    try {\r\n      const saveData = {\r\n        ...formData,\r\n        price: parseFloat(formData.price),\r\n        is_available: formData.is_available ? 1 : 0,\r\n      };\r\n\r\n      if (addon?.id) {\r\n        saveData.id = addon.id;\r\n      }\r\n\r\n      await window.electronAPI.invoke('menu:saveAddon', { addon: saveData });\r\n      onSave();\r\n    } catch (error) {\r\n      console.error('Save failed:', error);\r\n      alert('Failed to save add-on');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal modal-sm\" style={{ maxWidth: '400px', borderRadius: '16px', border: 'none', boxShadow: '0 25px 50px -12px rgba(0, 0, 0, 0.25)' }} onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\" style={{ borderBottom: 'none', padding: '16px 20px 0 20px' }}>\r\n          <div>\r\n            <h3 className=\"modal-title\" style={{ fontSize: '1.25rem', color: '#111827' }}>{addon ? 'Edit Add-on' : 'New Add-on'}</h3>\r\n            <p className=\"text-muted\" style={{ fontSize: '0.875rem', marginTop: '2px', marginBottom: 0 }}>Global add-on for menu items.</p>\r\n          </div>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose} style={{ borderRadius: '50%' }}>\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"modal-body\" style={{ padding: '16px 20px' }}>\r\n\r\n            {/* Type Selection Pills */}\r\n            <div style={{ display: 'flex', gap: '8px', marginBottom: '16px' }}>\r\n              <div\r\n                onClick={() => setFormData({ ...formData, type: 'veg' })}\r\n                style={{\r\n                  flex: 1,\r\n                  padding: '8px',\r\n                  borderRadius: '10px',\r\n                  border: `1px solid ${formData.type === 'veg' ? '#22c55e' : '#e5e7eb'}`,\r\n                  background: formData.type === 'veg' ? '#f0fdf4' : 'white',\r\n                  cursor: 'pointer',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  gap: '6px',\r\n                  transition: 'all 0.2s ease'\r\n                }}\r\n              >\r\n                <div style={{ width: '12px', height: '12px', border: '1.5px solid #22c55e', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                  <div style={{ width: '6px', height: '6px', borderRadius: '50%', background: '#22c55e' }} />\r\n                </div>\r\n                <span style={{ fontWeight: 600, fontSize: '0.9rem', color: formData.type === 'veg' ? '#15803d' : '#6b7280' }}>Veg</span>\r\n              </div>\r\n\r\n              <div\r\n                onClick={() => setFormData({ ...formData, type: 'non-veg' })}\r\n                style={{\r\n                  flex: 1,\r\n                  padding: '8px',\r\n                  borderRadius: '10px',\r\n                  border: `1px solid ${formData.type === 'non-veg' ? '#ef4444' : '#e5e7eb'}`,\r\n                  background: formData.type === 'non-veg' ? '#fef2f2' : 'white',\r\n                  cursor: 'pointer',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  gap: '6px',\r\n                  transition: 'all 0.2s ease'\r\n                }}\r\n              >\r\n                <div style={{ width: '12px', height: '12px', border: '1.5px solid #ef4444', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                  <div style={{ width: '6px', height: '6px', borderRadius: '50%', background: '#ef4444' }} />\r\n                </div>\r\n                <span style={{ fontWeight: 600, fontSize: '0.9rem', color: formData.type === 'non-veg' ? '#b91c1c' : '#6b7280' }}>Non-Veg</span>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"input-group\" style={{ marginBottom: '12px' }}>\r\n              <label className=\"input-label\" style={{ marginBottom: '4px', fontSize: '0.8rem' }}>Add-on Name</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"input\"\r\n                placeholder=\"e.g. Extra Cheese\"\r\n                value={formData.name}\r\n                onChange={(e) => setFormData({ ...formData, name: e.target.value })}\r\n                required\r\n                style={{ padding: '8px 10px', fontSize: '0.95rem' }}\r\n              />\r\n            </div>\r\n\r\n            <div className=\"input-group\" style={{ marginBottom: '12px' }}>\r\n              <label className=\"input-label\" style={{ marginBottom: '4px', fontSize: '0.8rem' }}>Price ()</label>\r\n              <input\r\n                type=\"number\"\r\n                step=\"0.01\"\r\n                className=\"input\"\r\n                placeholder=\"0.00\"\r\n                value={formData.price}\r\n                onChange={(e) => setFormData({ ...formData, price: e.target.value })}\r\n                required\r\n                style={{ padding: '8px 10px', fontSize: '0.95rem', fontWeight: 600 }}\r\n              />\r\n            </div>\r\n\r\n            <div style={{ marginTop: '16px', padding: '10px 12px', background: '#f9fafb', borderRadius: '10px' }}>\r\n              <label style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer', margin: 0 }}>\r\n                <div style={{\r\n                  width: '32px',\r\n                  height: '18px',\r\n                  background: formData.is_available ? '#22c55e' : '#e5e7eb',\r\n                  borderRadius: '20px',\r\n                  position: 'relative',\r\n                  transition: 'background 0.2s'\r\n                }}>\r\n                  <div style={{\r\n                    width: '14px',\r\n                    height: '14px',\r\n                    background: 'white',\r\n                    borderRadius: '50%',\r\n                    position: 'absolute',\r\n                    top: '2px',\r\n                    left: formData.is_available ? '16px' : '2px',\r\n                    transition: 'left 0.2s',\r\n                    boxShadow: '0 1px 2px rgba(0,0,0,0.2)'\r\n                  }} />\r\n                </div>\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={formData.is_available}\r\n                  onChange={(e) => setFormData({ ...formData, is_available: e.target.checked })}\r\n                  style={{ display: 'none' }}\r\n                />\r\n                <span style={{ fontWeight: 500, fontSize: '0.85rem', color: '#374151' }}>Available for sale</span>\r\n              </label>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"modal-footer\" style={{ borderTop: 'none', background: 'transparent', padding: '0 20px 20px 20px', justifyContent: 'flex-end', marginTop: 0 }}>\r\n            <button type=\"button\" className=\"btn btn-ghost btn-sm\" onClick={onClose} style={{ fontWeight: 600 }}>\r\n              Cancel\r\n            </button>\r\n            <button type=\"submit\" className=\"btn btn-primary btn-sm\" disabled={isSaving} style={{\r\n              padding: '6px 16px',\r\n              background: '#D32F2F',\r\n              boxShadow: '0 2px 4px -1px rgba(211, 47, 47, 0.4)'\r\n            }}>\r\n              {isSaving ? 'Saving...' : 'Save Add-on'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Master Add-ons List Modal\r\nconst MasterAddonsModal = ({ masterAddons, onClose, onAdd, onEdit, onDelete }) => {\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" style={{ maxWidth: '700px', height: '80vh', display: 'flex', flexDirection: 'column' }} onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\" style={{ borderBottom: '1px solid var(--gray-200)' }}>\r\n          <div>\r\n            <h3 className=\"modal-title\">Master Add-on Groups</h3>\r\n            <p className=\"text-muted text-sm\">Create collections of add-ons to apply to variants</p>\r\n          </div>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}>\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"modal-body\" style={{ flex: 1, overflowY: 'auto', padding: '24px' }}>\r\n          <div style={{ display: 'flex', justifyContent: 'flex-end', marginBottom: '16px' }}>\r\n            <button className=\"btn btn-secondary\" onClick={onAdd}>\r\n              <Plus size={16} /> New Group\r\n            </button>\r\n          </div>\r\n\r\n          {masterAddons.length === 0 ? (\r\n            <div className=\"empty-state\" style={{ padding: '60px 0' }}>\r\n              <Layers size={48} className=\"text-muted\" style={{ marginBottom: '12px', opacity: 0.5 }} />\r\n              <p className=\"text-muted\">No master add-on groups found.</p>\r\n              <button className=\"btn btn-link\" onClick={onAdd}>Create your first group</button>\r\n            </div>\r\n          ) : (\r\n            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(300px, 1fr))', gap: '16px' }}>\r\n              {masterAddons.map(ma => {\r\n                let addonIds = [];\r\n                try {\r\n                  addonIds = typeof ma.addon_ids === 'string' ? JSON.parse(ma.addon_ids || '[]') : (ma.addon_ids || []);\r\n                } catch (e) { console.error('Error parsing addon_ids', e); }\r\n                \r\n                return (\r\n                  <div key={ma.id} style={{\r\n                    padding: '16px',\r\n                    background: 'white',\r\n                    border: '1px solid var(--gray-200)',\r\n                    borderRadius: '12px',\r\n                    display: 'flex',\r\n                    flexDirection: 'column',\r\n                    gap: '12px',\r\n                    boxShadow: '0 1px 3px rgba(0,0,0,0.05)'\r\n                  }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n                      <h4 style={{ margin: 0, fontSize: '1rem', fontWeight: 600 }}>{ma.name}</h4>\r\n                      <div style={{ display: 'flex', gap: '4px' }}>\r\n                        <button className=\"btn btn-ghost btn-icon btn-sm\" onClick={() => onEdit(ma)}>\r\n                          <Edit2 size={14} />\r\n                        </button>\r\n                        <button className=\"btn btn-ghost btn-icon btn-sm text-danger\" onClick={() => onDelete(ma.id)}>\r\n                          <Trash2 size={14} />\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>\r\n                      <span className=\"badge badge-secondary\" style={{ fontSize: '0.75rem' }}>\r\n                        {addonIds.length} Add-ons\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Master Add-on Edit Modal\r\nconst MasterAddonEditModal = ({ masterAddon, globalAddons, onClose, onSave }) => {\r\n  const [name, setName] = useState(masterAddon?.name || '');\r\n  const [selectedAddonIds, setSelectedAddonIds] = useState([]);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [search, setSearch] = useState('');\r\n  const [selectionType, setSelectionType] = useState(masterAddon?.selection_type || 'multi');\r\n  const [isMandatory, setIsMandatory] = useState(masterAddon?.is_mandatory ? true : false);\r\n\r\n  useEffect(() => {\r\n    if (masterAddon?.addon_ids) {\r\n      try {\r\n        const ids = typeof masterAddon.addon_ids === 'string' ? JSON.parse(masterAddon.addon_ids) : masterAddon.addon_ids;\r\n        setSelectedAddonIds(ids || []);\r\n      } catch (e) {\r\n        console.error('Error parsing addon_ids', e);\r\n        setSelectedAddonIds([]);\r\n      }\r\n    }\r\n  }, [masterAddon]);\r\n\r\n  const handleSave = async (e) => {\r\n    e.preventDefault();\r\n    if (!name.trim()) {\r\n      alert('Please enter a group name');\r\n      return;\r\n    }\r\n    \r\n    setIsSaving(true);\r\n    try {\r\n      await window.electronAPI.invoke('menu:saveMasterAddon', {\r\n        data: {\r\n          id: masterAddon?.id,\r\n          name,\r\n          addon_ids: selectedAddonIds,\r\n          selection_type: selectionType,\r\n          is_mandatory: isMandatory\r\n        }\r\n      });\r\n      onSave();\r\n    } catch (error) {\r\n      alert('Failed to save Master Add-on: ' + error.message);\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const toggleAddon = (id) => {\r\n    if (selectedAddonIds.includes(id)) {\r\n      setSelectedAddonIds(selectedAddonIds.filter(i => i !== id));\r\n    } else {\r\n      setSelectedAddonIds([...selectedAddonIds, id]);\r\n    }\r\n  };\r\n\r\n  const filteredGlobalAddons = globalAddons.filter(a => \r\n    a.name.toLowerCase().includes(search.toLowerCase())\r\n  );\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose} style={{ zIndex: 1100 }}>\r\n      <div className=\"modal\" style={{ maxWidth: '500px' }} onClick={(e) => e.stopPropagation()}>\r\n        <form onSubmit={handleSave}>\r\n          <div className=\"modal-header\">\r\n            <h3 className=\"modal-title\">{masterAddon ? 'Edit Master Add-on' : 'New Master Add-on'}</h3>\r\n            <button type=\"button\" className=\"btn btn-ghost btn-icon\" onClick={onClose}><X size={20} /></button>\r\n          </div>\r\n          \r\n          <div className=\"modal-body\" style={{ padding: '20px' }}>\r\n            <div className=\"input-group\">\r\n              <label className=\"input-label\">Group Name *</label>\r\n              <input\r\n                type=\"text\"\r\n                className=\"input\"\r\n                placeholder=\"e.g. Pizza Toppings, Burger Add-ons\"\r\n                value={name}\r\n                onChange={(e) => setName(e.target.value)}\r\n                required\r\n              />\r\n            </div>\r\n\r\n            <div style={{ marginTop: '20px' }}>\r\n              <label className=\"input-label\">Select Add-ons</label>\r\n              <div style={{ position: 'relative', marginBottom: '12px' }}>\r\n                <Search size={14} style={{ position: 'absolute', left: '10px', top: '50%', transform: 'translateY(-50%)', color: '#9ca3af' }} />\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"input\"\r\n                  placeholder=\"Search global add-ons...\"\r\n                  value={search}\r\n                  onChange={(e) => setSearch(e.target.value)}\r\n                  style={{ paddingLeft: '32px', height: '36px', fontSize: '0.875rem' }}\r\n                />\r\n              </div>\r\n              \r\n              <div style={{ \r\n                maxHeight: '250px', \r\n                overflowY: 'auto', \r\n                border: '1px solid var(--gray-200)', \r\n                borderRadius: '8px',\r\n                padding: '4px'\r\n              }}>\r\n                {filteredGlobalAddons.length === 0 && (\r\n                  <p style={{ padding: '20px', textAlign: 'center', color: '#9ca3af', fontSize: '0.875rem' }}>No add-ons found</p>\r\n                )}\r\n                {filteredGlobalAddons.map(addon => (\r\n                  <div \r\n                    key={addon.id}\r\n                    onClick={() => toggleAddon(addon.id)}\r\n                    style={{\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      gap: '10px',\r\n                      padding: '8px 12px',\r\n                      cursor: 'pointer',\r\n                      borderRadius: '6px',\r\n                      background: selectedAddonIds.includes(addon.id) ? 'var(--primary-50)' : 'transparent',\r\n                      transition: 'all 0.1s'\r\n                    }}\r\n                  >\r\n                    <div style={{\r\n                      width: '18px',\r\n                      height: '18px',\r\n                      border: `2px solid ${selectedAddonIds.includes(addon.id) ? 'var(--primary-600)' : '#d1d5db'}`,\r\n                      borderRadius: '4px',\r\n                      display: 'flex',\r\n                      alignItems: 'center',\r\n                      justifyContent: 'center',\r\n                      background: selectedAddonIds.includes(addon.id) ? 'var(--primary-600)' : 'white'\r\n                    }}>\r\n                      {selectedAddonIds.includes(addon.id) && <Plus size={14} color=\"white\" />}\r\n                    </div>\r\n                    <span style={{ fontSize: '0.9rem', flex: 1 }}>{addon.name}</span>\r\n                    <span style={{ fontSize: '0.8rem', color: '#6b7280' }}>{addon.price}</span>\r\n                  </div>\r\n                ))}\r\n              </div>\r\n              <p className=\"text-muted text-xs mt-2\">{selectedAddonIds.length} add-ons selected</p>\r\n            </div>\r\n\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginTop: '16px' }}>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Selection Type</label>\r\n                <select\r\n                  className=\"input\"\r\n                  value={selectionType}\r\n                  onChange={(e) => setSelectionType(e.target.value)}\r\n                  style={{ cursor: 'pointer' }}\r\n                >\r\n                  <option value=\"single\">Single Choice (Radio)</option>\r\n                  <option value=\"multi\">Multiple Choice (Checkboxes)</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div className=\"input-group\" style={{ display: 'flex', alignItems: 'flex-end' }}>\r\n                <label style={{ display: 'flex', alignItems: 'center', gap: '10px', cursor: 'pointer', height: '38px', margin: 0 }}>\r\n                  <div style={{\r\n                    width: '36px',\r\n                    height: '20px',\r\n                    background: isMandatory ? 'var(--primary-500)' : '#e5e7eb',\r\n                    borderRadius: '20px',\r\n                    position: 'relative',\r\n                    transition: 'background 0.2s'\r\n                  }}>\r\n                    <div style={{\r\n                      width: '16px',\r\n                      height: '16px',\r\n                      background: 'white',\r\n                      borderRadius: '50%',\r\n                      position: 'absolute',\r\n                      top: '2px',\r\n                      left: isMandatory ? '18px' : '2px',\r\n                      transition: 'left 0.2s',\r\n                      boxShadow: '0 1px 2px rgba(0,0,0,0.2)'\r\n                    }} />\r\n                  </div>\r\n                  <input\r\n                    type=\"checkbox\"\r\n                    checked={isMandatory}\r\n                    onChange={(e) => setIsMandatory(e.target.checked)}\r\n                    style={{ display: 'none' }}\r\n                  />\r\n                  <span style={{ fontWeight: 500, fontSize: '0.9rem', color: '#374151' }}>Is Mandatory?</span>\r\n                </label>\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"modal-footer\">\r\n            <button type=\"button\" className=\"btn btn-secondary\" onClick={onClose}>Cancel</button>\r\n            <button type=\"submit\" className=\"btn btn-primary\" disabled={isSaving}>\r\n              {isSaving ? 'Saving...' : 'Save Group'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\OrdersPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'Download' is defined but never used.","line":13,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":13,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'TrendingUp' is defined but never used.","line":19,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'applyFilters'. Either include it or remove the dependency array.","line":51,"column":6,"nodeType":"ArrayExpression","endLine":51,"endColumn":41,"suggestions":[{"desc":"Update the dependencies array to be: [applyFilters, orders, searchQuery, statusFilter]","fix":{"range":[1420,1455],"text":"[applyFilters, orders, searchQuery, statusFilter]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { \r\n  Search, \r\n  Eye, \r\n  Edit2, \r\n  Trash2, \r\n  X,\r\n  Printer,\r\n  FileText,\r\n  Calendar,\r\n  Filter,\r\n  Download,\r\n  Check,\r\n  Clock,\r\n  XCircle,\r\n  ShoppingCart,\r\n  DollarSign,\r\n  TrendingUp,\r\n  CheckCircle\r\n} from 'lucide-react';\r\n\r\nconst OrdersPage = () => {\r\n  const location = useLocation();\r\n  const [orders, setOrders] = useState([]);\r\n  const [filteredOrders, setFilteredOrders] = useState([]);\r\n  const [searchQuery, setSearchQuery] = useState(location.state?.search || '');\r\n  const [dateFilter, setDateFilter] = useState('today');\r\n  const [statusFilter, setStatusFilter] = useState('all');\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [selectedOrder, setSelectedOrder] = useState(null);\r\n  const [showViewModal, setShowViewModal] = useState(false);\r\n  const [showEditModal, setShowEditModal] = useState(false);\r\n  const [showCompleteModal, setShowCompleteModal] = useState(false);\r\n\r\n  // When location state changes (global search), update query and show all dates\r\n  useEffect(() => {\r\n    if (location.state?.search) {\r\n      setSearchQuery(location.state.search);\r\n      setDateFilter('all');\r\n      setStatusFilter('all');\r\n    }\r\n  }, [location.state?.search]);\r\n\r\n  useEffect(() => {\r\n    loadOrders();\r\n  }, [dateFilter]);\r\n\r\n  useEffect(() => {\r\n    applyFilters();\r\n  }, [orders, searchQuery, statusFilter]);\r\n\r\n  const loadOrders = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await window.electronAPI.invoke('order:getAll', {});\r\n      setOrders(result || []);\r\n    } catch (error) {\r\n      console.error('Failed to load orders:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const applyFilters = () => {\r\n    let filtered = [...orders];\r\n\r\n    // Apply search\r\n    if (searchQuery) {\r\n      const query = searchQuery.toLowerCase();\r\n      filtered = filtered.filter(order => \r\n        order.order_number?.toString().includes(query) ||\r\n        order.customer_name?.toLowerCase().includes(query) ||\r\n        order.customer_phone?.includes(query)\r\n      );\r\n    }\r\n\r\n    // Apply status filter\r\n    if (statusFilter !== 'all') {\r\n      if (statusFilter === 'due') {\r\n        filtered = filtered.filter(order => order.payment_status !== 'completed' && order.status !== 'cancelled');\r\n      } else {\r\n        filtered = filtered.filter(order => order.status === statusFilter);\r\n      }\r\n    }\r\n\r\n    // Apply date filter\r\n    const today = new Date().toISOString().split('T')[0];\r\n    if (dateFilter === 'today') {\r\n      filtered = filtered.filter(order => \r\n        order.created_at?.startsWith(today)\r\n      );\r\n    } else if (dateFilter === 'week') {\r\n      const weekAgo = new Date();\r\n      weekAgo.setDate(weekAgo.getDate() - 7);\r\n      filtered = filtered.filter(order => \r\n        new Date(order.created_at) >= weekAgo\r\n      );\r\n    } else if (dateFilter === 'month') {\r\n      const monthAgo = new Date();\r\n      monthAgo.setMonth(monthAgo.getMonth() - 1);\r\n      filtered = filtered.filter(order => \r\n        new Date(order.created_at) >= monthAgo\r\n      );\r\n    }\r\n\r\n    setFilteredOrders(filtered);\r\n  };\r\n\r\n  const handleViewOrder = async (order) => {\r\n    try {\r\n      const fullOrder = await window.electronAPI.invoke('order:getById', { id: order.id });\r\n      setSelectedOrder(fullOrder);\r\n      setShowViewModal(true);\r\n    } catch (error) {\r\n      console.error('Failed to load order:', error);\r\n    }\r\n  };\r\n\r\n  const handleEditOrder = async (order) => {\r\n    try {\r\n      const fullOrder = await window.electronAPI.invoke('order:getById', { id: order.id });\r\n      setSelectedOrder(fullOrder);\r\n      setShowEditModal(true);\r\n    } catch (error) {\r\n      console.error('Failed to load order:', error);\r\n    }\r\n  };\r\n\r\n  const handleCompleteOrderInput = (order) => {\r\n    setSelectedOrder(order);\r\n    setShowCompleteModal(true);\r\n  };\r\n\r\n  const handleDeleteOrder = async (order) => {\r\n    if (window.confirm(`Are you sure you want to delete Order #${order.order_number}? This cannot be undone.`)) {\r\n      try {\r\n        await window.electronAPI.invoke('order:delete', { id: order.id });\r\n        loadOrders();\r\n      } catch (error) {\r\n        console.error('Failed to delete order:', error);\r\n        alert('Failed to delete order: ' + error.message);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handlePrintBill = async (order) => {\r\n    try {\r\n      const fullOrder = await window.electronAPI.invoke('order:getById', { id: order.id });\r\n      await window.electronAPI.invoke('print:receipt', { order: fullOrder });\r\n      alert('Bill printed successfully!');\r\n    } catch (error) {\r\n      console.error('Failed to print:', error);\r\n      alert('Failed to print: ' + error.message);\r\n    }\r\n  };\r\n\r\n  const formatDate = (dateStr) => {\r\n    if (!dateStr) return '-';\r\n    return new Date(dateStr).toLocaleString('en-IN', {\r\n      day: '2-digit',\r\n      month: 'short',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  const getStatusBadge = (status) => {\r\n    const badges = {\r\n      active: { class: 'badge-warning', icon: Clock, text: 'Active' },\r\n      completed: { class: 'badge-success', icon: Check, text: 'Completed' },\r\n      cancelled: { class: 'badge-error', icon: XCircle, text: 'Cancelled' },\r\n    };\r\n    const badge = badges[status] || badges.active;\r\n    const Icon = badge.icon;\r\n    return (\r\n      <span className={`badge ${badge.class}`}>\r\n        <Icon size={12} style={{ marginRight: '4px' }} />\r\n        {badge.text}\r\n      </span>\r\n    );\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: 'calc(100vh - 64px)', marginTop: '64px' }}>\r\n        <div className=\"loading-spinner\" />\r\n        <p className=\"mt-4\" style={{ marginLeft: '12px' }}>Loading orders...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ padding: '24px 28px', marginTop: '64px', height: 'calc(100vh - 64px)', overflowY: 'auto', background: '#f8fafc' }}>\r\n      {/* Header */}\r\n      <div style={{ \r\n        display: 'flex', \r\n        justifyContent: 'space-between', \r\n        alignItems: 'center',\r\n        marginBottom: 'var(--spacing-6)'\r\n      }}>\r\n        <div>\r\n          <h1>Bills & Orders</h1>\r\n          <p className=\"text-muted\">View, edit, and manage all orders</p>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Filters Row */}\r\n      <div style={{ \r\n        display: 'flex', \r\n        gap: 'var(--spacing-4)', \r\n        marginBottom: 'var(--spacing-4)',\r\n        flexWrap: 'wrap'\r\n      }}>\r\n        {/* Search */}\r\n        <div style={{ flex: 1, minWidth: '250px', maxWidth: '350px' }}>\r\n          <div style={{ position: 'relative' }}>\r\n            <Search \r\n              size={18} \r\n              style={{ \r\n                position: 'absolute', \r\n                left: '12px', \r\n                top: '50%', \r\n                transform: 'translateY(-50%)',\r\n                color: 'var(--gray-400)'\r\n              }} \r\n            />\r\n            <input\r\n              type=\"text\"\r\n              className=\"input\"\r\n              placeholder=\"Search by order #, customer...\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n              style={{ paddingLeft: '40px' }}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Date Filter */}\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 'var(--spacing-2)' }}>\r\n          <Calendar size={18} style={{ color: 'var(--gray-500)' }} />\r\n          <select\r\n            className=\"input select\"\r\n            value={dateFilter}\r\n            onChange={(e) => setDateFilter(e.target.value)}\r\n            style={{ width: 'auto' }}\r\n          >\r\n            <option value=\"today\">Today</option>\r\n            <option value=\"week\">This Week</option>\r\n            <option value=\"month\">This Month</option>\r\n            <option value=\"all\">All Time</option>\r\n          </select>\r\n        </div>\r\n\r\n        {/* Status Filter */}\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 'var(--spacing-2)' }}>\r\n          <Filter size={18} style={{ color: 'var(--gray-500)' }} />\r\n          <select\r\n            className=\"input select\"\r\n            value={statusFilter}\r\n            onChange={(e) => setStatusFilter(e.target.value)}\r\n            style={{ width: 'auto' }}\r\n          >\r\n            <option value=\"all\">All Status</option>\r\n            <option value=\"active\">Active</option>\r\n            <option value=\"completed\">Completed</option>\r\n            <option value=\"cancelled\">Cancelled</option>\r\n            <option value=\"due\">Due Payment</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Stats Row */}\r\n      <div style={{ \r\n        display: 'grid', \r\n        gridTemplateColumns: 'repeat(4, 1fr)', \r\n        gap: '16px',\r\n        marginBottom: '20px'\r\n      }}>\r\n        <div style={{ background: 'linear-gradient(135deg, #6366f1 0%, #818cf8 100%)', borderRadius: '14px', padding: '20px', color: 'white', boxShadow: '0 8px 24px rgba(99,102,241,0.25)', display: 'flex', alignItems: 'center', gap: '16px' }}>\r\n          <div style={{ width: 48, height: 48, borderRadius: '12px', background: 'rgba(255,255,255,0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}><ShoppingCart size={24} /></div>\r\n          <div>\r\n            <div style={{ fontSize: '28px', fontWeight: 700, lineHeight: 1 }}>{filteredOrders.length}</div>\r\n            <div style={{ fontSize: '13px', color: 'rgba(255,255,255,0.8)', marginTop: '4px' }}>Total Orders</div>\r\n          </div>\r\n        </div>\r\n        <div style={{ background: 'linear-gradient(135deg, #10b981 0%, #34d399 100%)', borderRadius: '14px', padding: '20px', color: 'white', boxShadow: '0 8px 24px rgba(16,185,129,0.25)', display: 'flex', alignItems: 'center', gap: '16px' }}>\r\n          <div style={{ width: 48, height: 48, borderRadius: '12px', background: 'rgba(255,255,255,0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}><DollarSign size={24} /></div>\r\n          <div>\r\n            <div style={{ fontSize: '28px', fontWeight: 700, lineHeight: 1 }}>{filteredOrders.reduce((sum, o) => sum + (o.total_amount || 0), 0).toFixed(0)}</div>\r\n            <div style={{ fontSize: '13px', color: 'rgba(255,255,255,0.8)', marginTop: '4px' }}>Total Revenue</div>\r\n          </div>\r\n        </div>\r\n        <div style={{ background: 'linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%)', borderRadius: '14px', padding: '20px', color: 'white', boxShadow: '0 8px 24px rgba(245,158,11,0.25)', display: 'flex', alignItems: 'center', gap: '16px' }}>\r\n          <div style={{ width: 48, height: 48, borderRadius: '12px', background: 'rgba(255,255,255,0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}><Clock size={24} /></div>\r\n          <div>\r\n            <div style={{ fontSize: '28px', fontWeight: 700, lineHeight: 1 }}>{filteredOrders.filter(o => o.status === 'active').length}</div>\r\n            <div style={{ fontSize: '13px', color: 'rgba(255,255,255,0.8)', marginTop: '4px' }}>Active Orders</div>\r\n          </div>\r\n        </div>\r\n        <div style={{ background: 'linear-gradient(135deg, #64748b 0%, #94a3b8 100%)', borderRadius: '14px', padding: '20px', color: 'white', boxShadow: '0 8px 24px rgba(100,116,139,0.25)', display: 'flex', alignItems: 'center', gap: '16px' }}>\r\n          <div style={{ width: 48, height: 48, borderRadius: '12px', background: 'rgba(255,255,255,0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}><CheckCircle size={24} /></div>\r\n          <div>\r\n            <div style={{ fontSize: '28px', fontWeight: 700, lineHeight: 1 }}>{filteredOrders.filter(o => o.status === 'completed').length}</div>\r\n            <div style={{ fontSize: '13px', color: 'rgba(255,255,255,0.8)', marginTop: '4px' }}>Completed</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Orders Table */}\r\n      <div className=\"table-container\" style={{ background: 'white', borderRadius: '12px', boxShadow: '0 2px 12px rgba(0,0,0,0.06)', overflow: 'auto', maxHeight: 'calc(100vh - 380px)' }}>\r\n        <table className=\"table\">\r\n          <thead>\r\n            <tr>\r\n              <th>Order #</th>\r\n              <th>Date & Time</th>\r\n              <th>Customer</th>\r\n              <th>Type</th>\r\n              <th>Total</th>\r\n              <th>Payment</th>\r\n              <th>Status</th>\r\n              <th style={{ width: '150px' }}>Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {filteredOrders.map(order => (\r\n              <tr key={order.id}>\r\n                <td>\r\n                  <strong>#{order.order_number}</strong>\r\n                </td>\r\n                <td>{formatDate(order.created_at)}</td>\r\n                <td>\r\n                  <div>{order.customer_name || '-'}</div>\r\n                  {order.customer_phone && (\r\n                    <div className=\"text-xs text-muted\">{order.customer_phone}</div>\r\n                  )}\r\n                </td>\r\n                <td>\r\n                  <span className=\"badge badge-gray\">\r\n                    {order.order_type?.replace('_', ' ').toUpperCase() || 'DINE IN'}\r\n                  </span>\r\n                </td>\r\n                <td style={{ fontWeight: 600 }}>{(order.total_amount || 0).toFixed(2)}</td>\r\n                <td>\r\n                  {order.payment_method && (\r\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: '2px' }}>\r\n                      <span className={`badge ${order.payment_status === 'completed' ? 'badge-success' : 'badge-warning'}`}>\r\n                        {order.payment_method.toUpperCase()}\r\n                      </span>\r\n                      {order.payment_status !== 'completed' && order.status !== 'cancelled' && (\r\n                        <span style={{ fontSize: '10px', color: '#e53935', fontWeight: 'bold' }}>\r\n                          DUE: {(order.total_amount - (order.customer_paid || 0)).toFixed(2)}\r\n                        </span>\r\n                      )}\r\n                    </div>\r\n                  )}\r\n                </td>\r\n                <td>\r\n                  <div style={{ display: 'flex', flexDirection: 'column', gap: '2px' }}>\r\n                    {getStatusBadge(order.status)}\r\n                    {order.payment_status === 'partial' && (\r\n                      <span className=\"badge badge-info\" style={{ fontSize: '10px' }}>PARTIAL</span>\r\n                    )}\r\n                  </div>\r\n                </td>\r\n                <td>\r\n                  <div style={{ display: 'flex', gap: 'var(--spacing-1)' }}>\r\n                    <button \r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => handleViewOrder(order)}\r\n                      title=\"View Bill\"\r\n                    >\r\n                      <Eye size={16} />\r\n                    </button>\r\n                    {order.status === 'active' && (\r\n                      <button \r\n                        className=\"btn btn-ghost btn-icon btn-sm\"\r\n                        onClick={() => handleCompleteOrderInput(order)}\r\n                        title=\"Complete Order\"\r\n                        style={{ color: 'var(--success-600)' }}\r\n                      >\r\n                        <CheckCircle size={16} />\r\n                      </button>\r\n                    )}\r\n                    {order.payment_status !== 'completed' && order.status === 'completed' && (\r\n                      <button \r\n                        className=\"btn btn-ghost btn-icon btn-sm\"\r\n                        onClick={() => handleCompleteOrderInput(order)}\r\n                        title=\"Settle Payment\"\r\n                        style={{ color: 'var(--primary-600)' }}\r\n                      >\r\n                        <DollarSign size={16} />\r\n                      </button>\r\n                    )}\r\n                    <button \r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => handleEditOrder(order)}\r\n                      title=\"Edit Order\"\r\n                    >\r\n                      <Edit2 size={16} />\r\n                    </button>\r\n                    <button \r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => handlePrintBill(order)}\r\n                      title=\"Print Bill\"\r\n                    >\r\n                      <Printer size={16} />\r\n                    </button>\r\n                    <button \r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => handleDeleteOrder(order)}\r\n                      title=\"Delete Order\"\r\n                      style={{ color: 'var(--error-500)' }}\r\n                    >\r\n                      <Trash2 size={16} />\r\n                    </button>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n\r\n        {filteredOrders.length === 0 && (\r\n          <div className=\"empty-state\">\r\n            <FileText size={48} />\r\n            <p className=\"empty-state-title\">No orders found</p>\r\n            <p className=\"text-muted\">Adjust your filters or create a new order</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* View Modal */}\r\n      {showViewModal && selectedOrder && (\r\n        <BillViewModal \r\n          order={selectedOrder} \r\n          onClose={() => setShowViewModal(false)}\r\n          onPrint={() => handlePrintBill(selectedOrder)}\r\n        />\r\n      )}\r\n\r\n      {/* Edit Modal */}\r\n      {showEditModal && selectedOrder && (\r\n        <OrderEditModal \r\n          order={selectedOrder} \r\n          onClose={() => setShowEditModal(false)}\r\n          onSave={() => {\r\n            setShowEditModal(false);\r\n            loadOrders();\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* Complete Modal */}\r\n      {showCompleteModal && selectedOrder && (\r\n        <CompleteOrderModal \r\n          order={selectedOrder}\r\n          onClose={() => setShowCompleteModal(false)}\r\n          onComplete={() => {\r\n            setShowCompleteModal(false);\r\n            loadOrders();\r\n          }}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Complete Order Modal\r\nconst CompleteOrderModal = ({ order, onClose, onComplete }) => {\r\n  const [paymentMethod, setPaymentMethod] = useState('cash');\r\n  const [isSubmitting, setIsSubmitting] = useState(false);\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSubmitting(true);\r\n    try {\r\n      await window.electronAPI.invoke('order:complete', { \r\n        id: order.id, \r\n        paymentMethod \r\n      });\r\n      onComplete();\r\n    } catch (error) {\r\n      console.error('Failed to complete order:', error);\r\n      alert('Failed to complete order: ' + error.message);\r\n    } finally {\r\n      setIsSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" onClick={e => e.stopPropagation()} style={{ maxWidth: '400px', height: 'auto' }}>\r\n        <div className=\"modal-header\">\r\n          <h3 className=\"modal-title\">Complete Order #{order.order_number}</h3>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}><X size={20} /></button>\r\n        </div>\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"modal-body\">\r\n            <p style={{ marginBottom: '16px', color: 'var(--gray-600)' }}>\r\n              Total Amount: <strong>{(order.total_amount || 0).toFixed(2)}</strong>\r\n            </p>\r\n            <div className=\"input-group\">\r\n              <label className=\"input-label\">Payment Method</label>\r\n              <select \r\n                className=\"input select\"\r\n                value={paymentMethod}\r\n                onChange={e => setPaymentMethod(e.target.value)}\r\n              >\r\n                <option value=\"cash\">Cash</option>\r\n                <option value=\"card\">Card</option>\r\n                <option value=\"upi\">UPI</option>\r\n              </select>\r\n            </div>\r\n          </div>\r\n          <div className=\"modal-footer\">\r\n            <button type=\"button\" className=\"btn btn-secondary\" onClick={onClose}>Cancel</button>\r\n            <button type=\"submit\" className=\"btn btn-success\" disabled={isSubmitting}>\r\n              {isSubmitting ? 'Completing...' : 'Complete Order'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Bill View Modal\r\nconst BillViewModal = ({ order, onClose, onPrint }) => {\r\n  const formatDate = (dateStr) => {\r\n    return new Date(dateStr).toLocaleString('en-IN', {\r\n      day: '2-digit',\r\n      month: 'short',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', zIndex: 9999, display: 'flex', alignItems: 'center', justifyContent: 'center', backdropFilter: 'blur(4px)' }} onClick={onClose}>\r\n      <div onClick={(e) => e.stopPropagation()} style={{ background: 'white', borderRadius: '16px', width: '420px', maxHeight: '90vh', display: 'flex', flexDirection: 'column', boxShadow: '0 20px 60px rgba(0,0,0,0.2)', animation: 'fadeInUp 0.25s ease' }}>\r\n        {/* Header */}\r\n        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '16px 20px', borderBottom: '1px solid #f1f5f9' }}>\r\n          <h3 style={{ margin: 0, fontSize: '16px', fontWeight: 700, color: '#1e293b' }}>Bill #{order.order_number}</h3>\r\n          <button onClick={onClose} style={{ background: '#f1f5f9', border: 'none', borderRadius: '8px', width: 32, height: 32, display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', color: '#64748b' }}>\r\n            <X size={16} />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Bill Content  scrollable */}\r\n        <div style={{ overflowY: 'auto', padding: '16px 20px', flex: '1 1 auto' }}>\r\n          <div style={{ background: '#fafafa', padding: '20px', border: '1px dashed #d1d5db', borderRadius: '10px', fontFamily: \"'Courier New', monospace\", fontSize: '13px' }}>\r\n            {/* Restaurant header */}\r\n            <div style={{ textAlign: 'center', marginBottom: '14px', paddingBottom: '14px', borderBottom: '1px dashed #9ca3af' }}>\r\n              <div style={{ fontWeight: 700, fontSize: '16px', letterSpacing: '1px' }}>Restaurant POS</div>\r\n              <div style={{ fontSize: '11px', color: '#6b7280', marginTop: '4px' }}>{formatDate(order.created_at)}</div>\r\n            </div>\r\n\r\n            {/* Order details */}\r\n            <div style={{ marginBottom: '12px', paddingBottom: '12px', borderBottom: '1px dashed #d1d5db', lineHeight: 1.8 }}>\r\n              <div style={{ display: 'flex', justifyContent: 'space-between' }}><span style={{ color: '#6b7280' }}>Bill No:</span><strong>#{order.order_number}</strong></div>\r\n              {order.table_number && <div style={{ display: 'flex', justifyContent: 'space-between' }}><span style={{ color: '#6b7280' }}>Table:</span><span>{order.table_number}</span></div>}\r\n              <div style={{ display: 'flex', justifyContent: 'space-between' }}><span style={{ color: '#6b7280' }}>Type:</span><span>{order.order_type?.replace('_', ' ').toUpperCase()}</span></div>\r\n              {order.customer_name && <div style={{ display: 'flex', justifyContent: 'space-between' }}><span style={{ color: '#6b7280' }}>Customer:</span><span>{order.customer_name}</span></div>}\r\n              {order.customer_phone && <div style={{ display: 'flex', justifyContent: 'space-between' }}><span style={{ color: '#6b7280' }}>Phone:</span><span>{order.customer_phone}</span></div>}\r\n            </div>\r\n\r\n            {/* Items */}\r\n            <div style={{ marginBottom: '12px', paddingBottom: '12px', borderBottom: '1px dashed #d1d5db' }}>\r\n              {order.items?.map((item, idx) => (\r\n                <div key={idx} style={{ display: 'flex', justifyContent: 'space-between', padding: '5px 0', lineHeight: 1.4 }}>\r\n                  <span>{item.item_name}  {item.quantity}</span>\r\n                  <span style={{ fontWeight: 600 }}>{(item.item_total || 0).toFixed(2)}</span>\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Totals */}\r\n            <div style={{ lineHeight: 1.8 }}>\r\n              <div style={{ display: 'flex', justifyContent: 'space-between' }}><span style={{ color: '#6b7280' }}>Subtotal:</span><span>{(order.subtotal || 0).toFixed(2)}</span></div>\r\n              {order.tax_amount > 0 && <div style={{ display: 'flex', justifyContent: 'space-between' }}><span style={{ color: '#6b7280' }}>Tax:</span><span>{(order.tax_amount || 0).toFixed(2)}</span></div>}\r\n              {order.discount_amount > 0 && <div style={{ display: 'flex', justifyContent: 'space-between', color: '#16a34a' }}><span>Discount:</span><span>-{(order.discount_amount || 0).toFixed(2)}</span></div>}\r\n              <div style={{ display: 'flex', justifyContent: 'space-between', fontWeight: 800, fontSize: '17px', marginTop: '8px', paddingTop: '10px', borderTop: '2px solid #111827' }}>\r\n                <span>TOTAL:</span><span>{(order.total_amount || 0).toFixed(2)}</span>\r\n              </div>\r\n            </div>\r\n\r\n            {order.payment_method && (\r\n              <div style={{ textAlign: 'center', marginTop: '14px', paddingTop: '12px', borderTop: '1px dashed #d1d5db', color: '#6b7280', fontSize: '12px', letterSpacing: '0.5px' }}>\r\n                Paid via <strong style={{ color: '#1e293b' }}>{order.payment_method.toUpperCase()}</strong>\r\n              </div>\r\n            )}\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer  always visible */}\r\n        <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '10px', padding: '14px 20px', borderTop: '1px solid #f1f5f9' }}>\r\n          <button onClick={onClose} style={{ padding: '8px 20px', borderRadius: '8px', border: '1px solid #e2e8f0', background: 'white', color: '#475569', cursor: 'pointer', fontWeight: 500, fontSize: '14px' }}>Close</button>\r\n          <button onClick={onPrint} style={{ padding: '8px 20px', borderRadius: '8px', border: 'none', background: '#dc2626', color: 'white', cursor: 'pointer', fontWeight: 500, fontSize: '14px', display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n            <Printer size={16} /> Print Bill\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Order Edit Modal with full items editing\r\nconst OrderEditModal = ({ order, onClose, onSave }) => {\r\n  const [formData, setFormData] = useState({\r\n    customer_name: order.customer_name || '',\r\n    customer_phone: order.customer_phone || '',\r\n    order_type: order.order_type || 'dine_in',\r\n    table_number: order.table_number || '',\r\n    status: order.status || 'active',\r\n    discount_amount: order.discount_amount || 0,\r\n    notes: order.notes || '',\r\n  });\r\n  const [items, setItems] = useState(order.items?.map(item => ({\r\n    ...item,\r\n    unit_price: item.unit_price || (item.item_total / item.quantity),\r\n    quantity: item.quantity || 1\r\n  })) || []);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n\r\n  // Calculate totals\r\n  const subtotal = items.reduce((sum, item) => sum + (item.unit_price * item.quantity), 0);\r\n  const taxAmount = items.reduce((sum, item) => sum + ((item.unit_price * item.quantity) * (item.tax_rate || 0) / 100), 0);\r\n  const totalAmount = subtotal + taxAmount - (parseFloat(formData.discount_amount) || 0);\r\n\r\n  const handleItemChange = (index, field, value) => {\r\n    const updatedItems = [...items];\r\n    updatedItems[index] = {\r\n      ...updatedItems[index],\r\n      [field]: field === 'quantity' || field === 'unit_price' ? parseFloat(value) || 0 : value,\r\n      item_total: field === 'quantity' \r\n        ? (parseFloat(value) || 0) * updatedItems[index].unit_price\r\n        : field === 'unit_price'\r\n        ? (parseFloat(value) || 0) * updatedItems[index].quantity\r\n        : updatedItems[index].item_total\r\n    };\r\n    setItems(updatedItems);\r\n  };\r\n\r\n  const handleRemoveItem = (index) => {\r\n    if (items.length > 1) {\r\n      setItems(items.filter((_, i) => i !== index));\r\n    } else {\r\n      alert('Order must have at least one item');\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setIsSaving(true);\r\n\r\n    try {\r\n      // Update order details and totals only (no individual item updates)\r\n      await window.electronAPI.invoke('order:update', {\r\n        id: order.id,\r\n        updates: {\r\n          ...formData,\r\n          subtotal: subtotal,\r\n          tax_amount: taxAmount,\r\n          total_amount: totalAmount,\r\n          discount_amount: parseFloat(formData.discount_amount) || 0\r\n        }\r\n      });\r\n      \r\n      onSave();\r\n    } catch (error) {\r\n      console.error('Update failed:', error);\r\n      alert('Failed to update order: ' + error.message);\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '650px', maxHeight: '90vh', overflow: 'auto' }}>\r\n        <div className=\"modal-header\">\r\n          <h3 className=\"modal-title\">Edit Order #{order.order_number}</h3>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}>\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"modal-body\">\r\n            {/* Customer Info */}\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 'var(--spacing-4)', marginBottom: 'var(--spacing-4)' }}>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Customer Name</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"input\"\r\n                  value={formData.customer_name}\r\n                  onChange={(e) => setFormData({ ...formData, customer_name: e.target.value })}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Customer Phone</label>\r\n                <input\r\n                  type=\"tel\"\r\n                  className=\"input\"\r\n                  value={formData.customer_phone}\r\n                  onChange={(e) => setFormData({ ...formData, customer_phone: e.target.value })}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: 'var(--spacing-4)', marginBottom: 'var(--spacing-4)' }}>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Order Type</label>\r\n                <select\r\n                  className=\"input select\"\r\n                  value={formData.order_type}\r\n                  onChange={(e) => setFormData({ ...formData, order_type: e.target.value })}\r\n                >\r\n                  <option value=\"dine_in\">Dine In</option>\r\n                  <option value=\"takeaway\">Takeaway</option>\r\n                  <option value=\"delivery\">Delivery</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Table Number</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"input\"\r\n                  value={formData.table_number}\r\n                  onChange={(e) => setFormData({ ...formData, table_number: e.target.value })}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Status</label>\r\n                <select\r\n                  className=\"input select\"\r\n                  value={formData.status}\r\n                  onChange={(e) => setFormData({ ...formData, status: e.target.value })}\r\n                >\r\n                  <option value=\"active\">Active</option>\r\n                  <option value=\"completed\">Completed</option>\r\n                  <option value=\"cancelled\">Cancelled</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Order Items */}\r\n            <div style={{ \r\n              background: 'var(--gray-50)', \r\n              borderRadius: 'var(--radius-md)', \r\n              padding: 'var(--spacing-3)',\r\n              marginBottom: 'var(--spacing-4)'\r\n            }}>\r\n              <h4 style={{ marginBottom: 'var(--spacing-3)', fontSize: 'var(--font-size-sm)', color: 'var(--gray-600)' }}>\r\n                Order Items\r\n              </h4>\r\n              {items.map((item, idx) => (\r\n                <div key={item.id || idx} style={{ \r\n                  display: 'grid', \r\n                  gridTemplateColumns: '2fr 80px 100px 100px auto', \r\n                  gap: 'var(--spacing-2)',\r\n                  alignItems: 'center',\r\n                  marginBottom: 'var(--spacing-2)',\r\n                  padding: 'var(--spacing-2)',\r\n                  background: 'white',\r\n                  borderRadius: 'var(--radius-sm)',\r\n                  border: '1px solid var(--gray-200)'\r\n                }}>\r\n                  <div style={{ fontWeight: 500, fontSize: 'var(--font-size-sm)' }}>{item.item_name}</div>\r\n                  <div>\r\n                    <input\r\n                      type=\"number\"\r\n                      min=\"1\"\r\n                      className=\"input\"\r\n                      value={item.quantity}\r\n                      onChange={(e) => handleItemChange(idx, 'quantity', e.target.value)}\r\n                      style={{ textAlign: 'center', padding: '6px' }}\r\n                    />\r\n                  </div>\r\n                  <div>\r\n                    <input\r\n                      type=\"number\"\r\n                      step=\"0.01\"\r\n                      className=\"input\"\r\n                      value={item.unit_price}\r\n                      onChange={(e) => handleItemChange(idx, 'unit_price', e.target.value)}\r\n                      style={{ padding: '6px' }}\r\n                    />\r\n                  </div>\r\n                  <div style={{ fontWeight: 600, textAlign: 'right' }}>\r\n                    {(item.unit_price * item.quantity).toFixed(2)}\r\n                  </div>\r\n                  <button\r\n                    type=\"button\"\r\n                    className=\"btn btn-ghost btn-icon btn-sm\"\r\n                    onClick={() => handleRemoveItem(idx)}\r\n                    style={{ color: 'var(--error-500)' }}\r\n                  >\r\n                    <Trash2 size={14} />\r\n                  </button>\r\n                </div>\r\n              ))}\r\n              \r\n              {/* Labels row */}\r\n              <div style={{ \r\n                display: 'grid', \r\n                gridTemplateColumns: '2fr 80px 100px 100px auto', \r\n                gap: 'var(--spacing-2)',\r\n                fontSize: 'var(--font-size-xs)',\r\n                color: 'var(--gray-500)',\r\n                paddingLeft: 'var(--spacing-2)'\r\n              }}>\r\n                <span>Item</span>\r\n                <span style={{ textAlign: 'center' }}>Qty</span>\r\n                <span>Price</span>\r\n                <span style={{ textAlign: 'right' }}>Total</span>\r\n                <span></span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Totals */}\r\n            <div style={{ \r\n              display: 'grid', \r\n              gridTemplateColumns: '1fr 1fr', \r\n              gap: 'var(--spacing-4)',\r\n              marginBottom: 'var(--spacing-4)'\r\n            }}>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\">Discount Amount</label>\r\n                <input\r\n                  type=\"number\"\r\n                  step=\"0.01\"\r\n                  className=\"input\"\r\n                  value={formData.discount_amount}\r\n                  onChange={(e) => setFormData({ ...formData, discount_amount: e.target.value })}\r\n                />\r\n              </div>\r\n              \r\n              <div style={{ \r\n                background: 'var(--primary-50)', \r\n                borderRadius: 'var(--radius-md)', \r\n                padding: 'var(--spacing-3)',\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                justifyContent: 'center'\r\n              }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 'var(--font-size-sm)' }}>\r\n                  <span>Subtotal:</span>\r\n                  <span>{subtotal.toFixed(2)}</span>\r\n                </div>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 'var(--font-size-sm)' }}>\r\n                  <span>Tax:</span>\r\n                  <span>{taxAmount.toFixed(2)}</span>\r\n                </div>\r\n                {parseFloat(formData.discount_amount) > 0 && (\r\n                  <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 'var(--font-size-sm)', color: 'var(--success-600)' }}>\r\n                    <span>Discount:</span>\r\n                    <span>-{parseFloat(formData.discount_amount).toFixed(2)}</span>\r\n                  </div>\r\n                )}\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', fontWeight: 700, marginTop: 'var(--spacing-2)', paddingTop: 'var(--spacing-2)', borderTop: '1px solid var(--primary-200)' }}>\r\n                  <span>Total:</span>\r\n                  <span>{totalAmount.toFixed(2)}</span>\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"input-group\">\r\n              <label className=\"input-label\">Notes</label>\r\n              <textarea\r\n                className=\"input\"\r\n                value={formData.notes}\r\n                onChange={(e) => setFormData({ ...formData, notes: e.target.value })}\r\n                rows={2}\r\n              />\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"modal-footer\">\r\n            <button type=\"button\" className=\"btn btn-secondary\" onClick={onClose}>\r\n              Cancel\r\n            </button>\r\n            <button type=\"submit\" className=\"btn btn-primary\" disabled={isSaving}>\r\n              {isSaving ? 'Saving...' : 'Save Changes'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default OrdersPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\POSPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'Leaf' is defined but never used.","line":18,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":18,"endColumn":7},{"ruleId":"no-unused-vars","severity":1,"message":"'Keyboard' is defined but never used.","line":25,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'Percent' is defined but never used.","line":33,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":33,"endColumn":10},{"ruleId":"no-unused-vars","severity":1,"message":"'Save' is defined but never used.","line":34,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":34,"endColumn":7},{"ruleId":"no-unused-vars","severity":1,"message":"'Wine' is defined but never used.","line":40,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":40,"endColumn":7},{"ruleId":"no-unused-vars","severity":1,"message":"'Edit2' is defined but never used.","line":44,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":8},{"ruleId":"no-unused-vars","severity":1,"message":"'recentOrders' is assigned a value but never used.","line":239,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":239,"endColumn":22},{"ruleId":"no-unused-vars","severity":1,"message":"'setRecentOrders' is assigned a value but never used.","line":239,"column":24,"nodeType":"Identifier","messageId":"unusedVar","endLine":239,"endColumn":39},{"ruleId":"no-unused-vars","severity":1,"message":"'showCustomerForm' is assigned a value but never used.","line":250,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":250,"endColumn":26},{"ruleId":"no-unused-vars","severity":1,"message":"'setShowCustomerForm' is assigned a value but never used.","line":250,"column":28,"nodeType":"Identifier","messageId":"unusedVar","endLine":250,"endColumn":47},{"ruleId":"no-unused-vars","severity":1,"message":"'showTableDropdown' is assigned a value but never used.","line":262,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":262,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'setShowTableDropdown' is assigned a value but never used.","line":262,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":262,"endColumn":49},{"ruleId":"no-unused-vars","severity":1,"message":"'showOrderInfo' is assigned a value but never used.","line":263,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":263,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'setShowOrderInfo' is assigned a value but never used.","line":263,"column":25,"nodeType":"Identifier","messageId":"unusedVar","endLine":263,"endColumn":41},{"ruleId":"no-unused-vars","severity":1,"message":"'triggerOrderConfirmation' is assigned a value but never used.","line":272,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":272,"endColumn":33},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":452,"column":16,"nodeType":"BlockStatement","messageId":"unexpected","endLine":452,"endColumn":18,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[18828,18828],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'handleSaveAndKOT' is assigned a value but never used.","line":598,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":598,"endColumn":25},{"ruleId":"no-unused-vars","severity":1,"message":"'calculateTotal' is assigned a value but never used.","line":712,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":712,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":834,"column":40,"nodeType":"Identifier","messageId":"unusedVar","endLine":834,"endColumn":45},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":1763,"column":20,"nodeType":"BlockStatement","messageId":"unexpected","endLine":1763,"endColumn":22,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[81243,81243],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'paymentMethod' is assigned a value but never used.","line":2409,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2409,"endColumn":23},{"ruleId":"no-unused-vars","severity":1,"message":"'showHistory' is assigned a value but never used.","line":2424,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2424,"endColumn":21},{"ruleId":"no-unused-vars","severity":1,"message":"'setShowHistory' is assigned a value but never used.","line":2424,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":2424,"endColumn":37},{"ruleId":"no-unused-vars","severity":1,"message":"'loadingHistory' is assigned a value but never used.","line":2425,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2425,"endColumn":24},{"ruleId":"no-undef","severity":2,"message":"'showMainSidebar' is not defined.","line":2970,"column":17,"nodeType":"Identifier","messageId":"undef","endLine":2970,"endColumn":32},{"ruleId":"no-undef","severity":2,"message":"'setShowMainSidebar' is not defined.","line":2971,"column":24,"nodeType":"Identifier","messageId":"undef","endLine":2971,"endColumn":42},{"ruleId":"no-undef","severity":2,"message":"'showDiscountModal' is not defined.","line":2974,"column":8,"nodeType":"Identifier","messageId":"undef","endLine":2974,"endColumn":25},{"ruleId":"no-undef","severity":2,"message":"'setShowDiscountModal' is not defined.","line":2981,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":2981,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'setShowDiscountModal' is not defined.","line":2985,"column":13,"nodeType":"Identifier","messageId":"undef","endLine":2985,"endColumn":33},{"ruleId":"no-undef","severity":2,"message":"'setShowDiscountModal' is not defined.","line":2987,"column":26,"nodeType":"Identifier","messageId":"undef","endLine":2987,"endColumn":46}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":22,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { useAuthStore } from '../stores/authStore';\r\nimport { useCartStore } from '../stores/cartStore';\r\nimport {\r\n  ShoppingCart,\r\n  Trash2,\r\n  Plus,\r\n  Minus,\r\n  CreditCard,\r\n  Banknote,\r\n  Smartphone,\r\n  X,\r\n  Printer,\r\n  Check,\r\n  CheckCircle,\r\n  Search,\r\n\r\n  Leaf,\r\n  FileText,\r\n  PauseCircle,\r\n  PlayCircle,\r\n  Clock,\r\n  User,\r\n  RefreshCw,\r\n  Keyboard,\r\n  Split,\r\n  ClipboardList,\r\n  Pizza,\r\n  Coffee,\r\n  IceCream,\r\n  Sandwich,\r\n  Soup,\r\n  Percent,\r\n  Save,\r\n  ChefHat,\r\n  Carrot,\r\n  Beef,\r\n  Cake,\r\n  Beer,\r\n  Wine,\r\n  Utensils,\r\n  Menu,\r\n  ChevronDown,\r\n  Edit2,\r\n  AlertTriangle,\r\n  UtensilsCrossed,\r\n  MapPin,\r\n  Star\r\n} from 'lucide-react';\r\nimport MainSidebar from '../components/layout/MainSidebar';\r\nimport CustomAlert from '../components/ui/CustomAlert';\r\nimport logoImg from '../assets/logo.png';\r\nimport '../styles/pos-sheet.css';\r\n\r\nconst CustomerHistoryModal = ({ isOpen, onClose, history, customerName, customerPhone }) => {\r\n  if (!isOpen) return null;\r\n\r\n  const maxOrderValue = history.length > 0 ? Math.max(...history.map(o => o.total_amount || 0)) : 0;\r\n  const totalSpent = history.reduce((sum, o) => sum + (o.total_amount || 0), 0);\r\n  const avgBill = history.length > 0 ? totalSpent / history.length : 0;\r\n\r\n  return (\r\n    <div style={{\r\n      position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n      background: 'rgba(0,0,0,0.5)', zIndex: 9999, display: 'flex', justifyContent: 'flex-end'\r\n    }} onClick={onClose}>\r\n      <div\r\n        style={{\r\n          background: 'white', width: '600px', height: '100%',\r\n          display: 'flex', flexDirection: 'column', boxShadow: '-4px 0 15px rgba(0,0,0,0.1)',\r\n          animation: 'slideInRight 0.3s ease-out'\r\n        }}\r\n        onClick={e => e.stopPropagation()}\r\n      >\r\n        <div style={{ padding: '20px', borderBottom: '1px solid #eee', display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: '#f8f9fa' }}>\r\n          <div>\r\n            <h3 style={{ margin: 0, fontSize: '18px', color: '#2c3e50' }}>Customer History</h3>\r\n            <div style={{ fontSize: '13px', color: '#7f8c8d', marginTop: '4px' }}>{customerName || 'Unknown'} - {customerPhone}</div>\r\n          </div>\r\n          <button onClick={onClose} style={{ border: 'none', background: 'none', cursor: 'pointer', padding: '4px' }}><X size={24} color=\"#546E7A\" /></button>\r\n        </div>\r\n\r\n        <div style={{ padding: '16px', display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '12px', borderBottom: '1px solid #eee', background: '#fff' }}>\r\n          <div style={{ background: '#e3f2fd', padding: '12px', borderRadius: '8px', textAlign: 'center' }}>\r\n            <div style={{ fontSize: '11px', color: '#546e7a', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Orders</div>\r\n            <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#0288d1' }}>{history.length}</div>\r\n          </div>\r\n          <div style={{ background: '#e8f5e9', padding: '12px', borderRadius: '8px', textAlign: 'center' }}>\r\n            <div style={{ fontSize: '11px', color: '#546e7a', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Max Order</div>\r\n            <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#388e3c' }}>{maxOrderValue.toFixed(0)}</div>\r\n          </div>\r\n          <div style={{ background: '#fff3e0', padding: '12px', borderRadius: '8px', textAlign: 'center' }}>\r\n            <div style={{ fontSize: '11px', color: '#546e7a', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Avg Order</div>\r\n            <div style={{ fontSize: '20px', fontWeight: 'bold', color: '#f57c00' }}>{avgBill.toFixed(0)}</div>\r\n          </div>\r\n        </div>\r\n\r\n        <div style={{ flex: 1, overflowY: 'auto', padding: '0', background: '#fff' }}>\r\n          {history.length === 0 ? (\r\n            <div style={{ textAlign: 'center', padding: '40px 20px', color: '#90a4ae' }}>\r\n              <Clock size={48} style={{ marginBottom: '16px', opacity: 0.5 }} />\r\n              <p>No order history found for this customer.</p>\r\n            </div>\r\n          ) : (\r\n            <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '13px', textAlign: 'left' }}>\r\n              <thead style={{ position: 'sticky', top: 0, background: '#f8f9fa', color: '#546E7A', fontWeight: '600', zIndex: 1, boxShadow: '0 1px 2px rgba(0,0,0,0.05)' }}>\r\n                <tr>\r\n                  <th style={{ padding: '12px', borderBottom: '1px solid #eee' }}>Order No</th>\r\n                  <th style={{ padding: '12px', borderBottom: '1px solid #eee' }}>Date</th>\r\n                  <th style={{ padding: '12px', borderBottom: '1px solid #eee' }}>Type</th>\r\n                  <th style={{ padding: '12px', borderBottom: '1px solid #eee' }}>Items</th>\r\n                  <th style={{ padding: '12px', borderBottom: '1px solid #eee' }}>Payment Type</th>\r\n                  <th style={{ padding: '12px', borderBottom: '1px solid #eee', textAlign: 'right' }}>Amount</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {history.map((order, idx) => (\r\n                  <tr key={order.id} style={{ borderBottom: '1px solid #f5f5f5', background: idx % 2 === 0 ? '#fff' : '#fafafa' }}>\r\n                    <td style={{ padding: '12px', fontWeight: '500', color: '#37474F' }}>#{order.order_number}</td>\r\n                    <td style={{ padding: '12px', color: '#78909C' }}>{new Date(order.created_at).toLocaleDateString()}</td>\r\n                    <td style={{ padding: '12px' }}>\r\n                      <span style={{\r\n                        background: order.order_type === 'dine_in' ? '#E3F2FD' : order.order_type === 'delivery' ? '#FFF3E0' : '#E8F5E9',\r\n                        color: order.order_type === 'dine_in' ? '#1565C0' : order.order_type === 'delivery' ? '#EF6C00' : '#2E7D32',\r\n                        padding: '2px 8px', borderRadius: '4px', fontSize: '11px', textTransform: 'capitalize'\r\n                      }}>\r\n                        {order.order_type?.replace('_', ' ')}\r\n                      </span>\r\n                    </td>\r\n                    <td style={{ padding: '12px', maxWidth: '150px', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis', color: '#546E7A' }} title={order.items?.map(i => `${i.quantity} x ${i.item_name}`).join(', ')}>\r\n                      {order.items?.map(i => `${i.quantity} x ${i.item_name}`).join(', ')}\r\n                    </td>\r\n                    <td style={{ padding: '12px', color: '#546E7A', textTransform: 'capitalize' }}>\r\n                      <div style={{ display: 'flex', flexDirection: 'column', gap: '2px' }}>\r\n                        <span>\r\n                          {order.payment_method === 'upi' ? 'UPI' :\r\n                           order.payment_method === 'card' ? 'Card' :\r\n                           order.payment_method === 'due' ? 'Pay Later' :\r\n                           (order.payment_method === 'split' || order.payment_method === 'mixed') ? 'Split' :\r\n                           order.payment_method === 'cash' ? 'Cash' : '-'}\r\n                        </span>\r\n                        {order.payment_status !== 'completed' && order.status !== 'cancelled' && (\r\n                          <span style={{ fontSize: '10px', color: '#f44336', fontWeight: 'bold' }}>\r\n                            (DUE)\r\n                          </span>\r\n                        )}\r\n                      </div>\r\n                    </td>\r\n                    <td style={{ padding: '12px', textAlign: 'right', fontWeight: 'bold', color: '#263238' }}>{order.total_amount}</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          )}\r\n        </div>\r\n      </div>\r\n      <style>{`\r\n        @keyframes slideInRight {\r\n          from { transform: translateX(100%); }\r\n          to { transform: translateX(0); }\r\n        }\r\n      `}</style>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst ConfirmOrderModal = ({ isOpen, onClose, onConfirm, total, itemsCount }) => {\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose} style={{ zIndex: 2000 }}>\r\n      {/* Added animate-scale-in for smooth entry */}\r\n      <div \r\n        className=\"modal\" \r\n        onClick={e => e.stopPropagation()} \r\n        style={{ \r\n          width: '400px', \r\n          maxWidth: '90%',\r\n          height: 'auto',        // Force auto height\r\n          minHeight: 'auto',     // Override any min-height\r\n          textAlign: 'center', \r\n          padding: '24px',       // Reduced padding slightly\r\n          borderRadius: '16px',  // Softer corners\r\n          boxShadow: '0 10px 25px rgba(0,0,0,0.15)', // Better shadow\r\n          background: 'white',\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          justifyContent: 'center'\r\n        }}\r\n      >\r\n        <div style={{ \r\n          width: '80px', height: '80px', background: '#E8F5E9', borderRadius: '50%', \r\n          display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 20px auto' \r\n        }}>\r\n          <Check size={40} color=\"#2E7D32\" strokeWidth={3} />\r\n        </div>\r\n        \r\n        <h3 style={{ fontSize: '20px', color: '#1A2327', marginBottom: '8px' }}>Confirm Order?</h3>\r\n        <p style={{ color: '#546E7A', marginBottom: '24px', fontSize: '15px' }}>\r\n          Send <strong>{itemsCount} items</strong> to kitchen?<br/>\r\n          Total Amount: <strong>{total.toFixed(2)}</strong>\r\n        </p>\r\n\r\n        <div style={{ display: 'flex', gap: '12px', justifyContent: 'center' }}>\r\n          <button \r\n            onClick={onClose}\r\n            style={{ \r\n              padding: '12px 24px', borderRadius: '8px', border: '1px solid #CFD8DC', \r\n              background: 'white', color: '#546E7A', fontWeight: '600', cursor: 'pointer', flex: 1\r\n            }}\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button \r\n            onClick={() => { onConfirm(); onClose(); }}\r\n            style={{ \r\n              padding: '12px 24px', borderRadius: '8px', border: 'none', \r\n              background: '#2E7D32', color: 'white', fontWeight: '600', cursor: 'pointer', flex: 1,\r\n              boxShadow: '0 4px 12px rgba(46, 125, 50, 0.2)'\r\n            }}\r\n          >\r\n            Confirm & Print\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst POSPage = () => {\r\n  const [categories, setCategories] = useState([]);\r\n  const [menuItems, setMenuItems] = useState([]);\r\n  const [selectedCategory, setSelectedCategory] = useState(null);\r\n  const [searchQuery, setSearchQuery] = useState('');\r\n  const [showPayment, setShowPayment] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [masterAddons, setMasterAddons] = useState([]);\r\n  const [globalAddons, setGlobalAddons] = useState([]);\r\n  const [recentOrders, setRecentOrders] = useState([]);\r\n  const [activeItemDiscounts, setActiveItemDiscounts] = useState([]);\r\n\r\n  // UI States for Add-ons and Hold Order\r\n  const [showAddonModal, setShowAddonModal] = useState(false);\r\n  const [selectedItemForAddon, setSelectedItemForAddon] = useState(null);\r\n  const [showHeldOrders, setShowHeldOrders] = useState(false);\r\n  // heldOrders are now in cart store\r\n  const [showDiscountModal, setShowDiscountModal] = useState(false);\r\n\r\n  // Strict Design Match State\r\n  const [showCustomerForm, setShowCustomerForm] = useState(false);\r\n  const [showHistoryDrawer, setShowHistoryDrawer] = useState(false);\r\n  const [showBillSheet, setShowBillSheet] = useState(false);\r\n  const [showMainSidebar, setShowMainSidebar] = useState(false);\r\n\r\n  // Customer Autocomplete & History\r\n  const [customerSuggestions, setCustomerSuggestions] = useState([]);\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [historyData, setHistoryData] = useState([]);\r\n  const [showHistoryModal, setShowHistoryModal] = useState(false);\r\n  const [customerAddress, setCustomerAddress] = useState('');\r\n  const [customerDue, setCustomerDue] = useState({ hasDue: false, totalDue: 0 });\r\n  const [showTableDropdown, setShowTableDropdown] = useState(false);\r\n  const [showOrderInfo, setShowOrderInfo] = useState(false);\r\n\r\n  const [activeCartTab, setActiveCartTab] = useState(null); // 'table', 'user', 'chef', 'summary'\r\n  const [activeMenu, setActiveMenu] = useState(null);\r\n  \r\n  // Custom Confirm Modal State\r\n  const [showConfirmModal, setShowConfirmModal] = useState(false);\r\n  const [pendingOrderAction, setPendingOrderAction] = useState(null); // function to execute on confirm\r\n\r\n  const triggerOrderConfirmation = (action) => {\r\n    setPendingOrderAction(() => action);\r\n    setShowConfirmModal(true);\r\n  };\r\n\r\n  // Split Payment State\r\n  const [showSplitPaymentSheet, setShowSplitPaymentSheet] = useState(false);\r\n  const [splitPayments, setSplitPayments] = useState([{ method: 'cash', amount: '' }, { method: 'upi', amount: '' }]);\r\n\r\n  const handleSplitPaymentChange = (index, field, value) => {\r\n    const newSplits = [...splitPayments];\r\n    newSplits[index][field] = value;\r\n    setSplitPayments(newSplits);\r\n  };\r\n  const addSplitPaymentMethod = () => setSplitPayments([...splitPayments, { method: 'card', amount: '' }]);\r\n  const removeSplitPaymentMethod = (index) => setSplitPayments(splitPayments.filter((_, i) => i !== index));\r\n\r\n  // Custom Alert State\r\n  const [alertState, setAlertState] = useState({\r\n    isOpen: false,\r\n    message: '',\r\n    type: 'info', // success, error, info, warning, confirm\r\n    onConfirm: null\r\n  });\r\n\r\n  const showAlert = (message, type = 'info', onConfirm = null) => {\r\n    setAlertState({\r\n      isOpen: true,\r\n      message,\r\n      type,\r\n      onConfirm\r\n    });\r\n  };\r\n\r\n  const closeAlert = () => {\r\n    setAlertState(prev => ({ ...prev, isOpen: false }));\r\n  };\r\n\r\n  const checkCustomerDue = async (phone) => {\r\n    if (phone && phone.length >= 10) {\r\n      try {\r\n        const dueInfo = await window.electronAPI.invoke('customer:getDueStatus', { phone });\r\n        setCustomerDue(dueInfo);\r\n      } catch (err) {\r\n        console.error(err);\r\n      }\r\n    } else {\r\n      setCustomerDue({ hasDue: false, totalDue: 0 });\r\n    }\r\n  };\r\n\r\n  const handlePhoneInput = async (e) => {\r\n    const val = e.target.value;\r\n    cart.setCustomerPhone(val);\r\n\r\n    if (val.length >= 10) {\r\n      checkCustomerDue(val);\r\n    } else {\r\n      setCustomerDue({ hasDue: false, totalDue: 0 });\r\n    }\r\n\r\n    if (val.length > 2) {\r\n      try {\r\n        const suggestions = await window.electronAPI.invoke('customer:search', { query: val });\r\n        setCustomerSuggestions(suggestions);\r\n        setShowSuggestions(true);\r\n      } catch (err) {\r\n        console.error(err);\r\n      }\r\n    } else {\r\n      setCustomerSuggestions([]);\r\n      setShowSuggestions(false);\r\n    }\r\n  };\r\n\r\n  const selectCustomer = (cust) => {\r\n    cart.setCustomerName(cust.customer_name);\r\n    cart.setCustomerPhone(cust.customer_phone);\r\n    checkCustomerDue(cust.customer_phone);\r\n    setShowSuggestions(false);\r\n  };\r\n\r\n  const fetchHistory = async () => {\r\n    if (!cart.customerPhone) return showAlert(\"Please enter mobile number first\", \"warning\");\r\n    try {\r\n      const history = await window.electronAPI.invoke('customer:getHistory', { phone: cart.customerPhone });\r\n      setHistoryData(history);\r\n      setShowHistoryModal(true);\r\n    } catch (err) {\r\n      showAlert(\"Failed to fetch history\", \"error\");\r\n    }\r\n  };\r\n\r\n  const { user } = useAuthStore();\r\n  const cart = useCartStore();\r\n\r\n  // Load categories and menu items\r\n  useEffect(() => {\r\n    loadData();\r\n  }, []);\r\n\r\n  const loadData = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const [cats, items, active, ma, ga, discounts] = await Promise.all([\r\n        window.electronAPI.invoke('menu:getCategories'),\r\n        window.electronAPI.invoke('menu:getItems', {}),\r\n        window.electronAPI.invoke('menu:getActiveMenu'),\r\n        window.electronAPI.invoke('menu:getMasterAddons'),\r\n        window.electronAPI.invoke('menu:getAddons'),\r\n        window.electronAPI.invoke('discounts:getActive')\r\n      ]);\r\n      \r\n      console.log('POS Data Loaded:', { cats: cats.length, items: items.length, activeMenu: active?.name, discounts: discounts?.length });\r\n      \r\n      setCategories(cats);\r\n      setMenuItems(items);\r\n      setActiveMenu(active);\r\n      setMasterAddons(ma || []);\r\n      setGlobalAddons(ga || []);\r\n      setActiveItemDiscounts(discounts || []);\r\n\r\n      // Default to All Items\r\n      setSelectedCategory(null);\r\n    } catch (error) {\r\n      console.error('Failed to load data:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const toggleFavorite = async (e, item) => {\r\n    e.stopPropagation();\r\n    const newStatus = !item.is_favorite;\r\n    \r\n    // Optimistic update\r\n    setMenuItems(prev => prev.map(i => \r\n      i.id === item.id ? { ...i, is_favorite: newStatus } : i\r\n    ));\r\n\r\n    try {\r\n      await window.electronAPI.invoke('menu:toggleFavorite', { id: item.id, isFavorite: newStatus });\r\n    } catch (error) {\r\n      console.error('Failed to toggle favorite:', error);\r\n      // Revert on failure\r\n      setMenuItems(prev => prev.map(i => \r\n        i.id === item.id ? { ...i, is_favorite: !newStatus } : i\r\n      ));\r\n    }\r\n  };\r\n\r\n  const filteredItems = menuItems.filter(item => {\r\n    // Favorites Category Logic\r\n    if (selectedCategory === 'favorites') {\r\n      return item.is_favorite && (!searchQuery || item.name.toLowerCase().includes(searchQuery.toLowerCase()));\r\n    }\r\n\r\n    const matchesCategory = !selectedCategory || item.category_id === selectedCategory;\r\n    const matchesSearch = !searchQuery ||\r\n      item.name.toLowerCase().includes(searchQuery.toLowerCase());\r\n    return matchesCategory && matchesSearch && item.is_available;\r\n  });\r\n\r\n  const handleAddToCart = (item) => {\r\n    // Parse variants/addons if they are strings\r\n    const variants = item.variants ? (typeof item.variants === 'string' ? JSON.parse(item.variants) : item.variants) : [];\r\n    const addons = item.addons ? (typeof item.addons === 'string' ? JSON.parse(item.addons) : item.addons) : [];\r\n\r\n    // Find if there's an active discount for this specific item (all variants)\r\n    const itemDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && (!d.variant_name));\r\n    \r\n    // Attach discount to the item object so it can be used in AddonModal or CartStore\r\n    const itemWithPossibleDiscount = { ...item, appliedDiscount: itemDiscount };\r\n\r\n    // Parse master_addon_ids\r\n    let masterAddonIds = [];\r\n    try {\r\n      if (item.master_addon_ids) {\r\n        masterAddonIds = typeof item.master_addon_ids === 'string' ? JSON.parse(item.master_addon_ids) : item.master_addon_ids;\r\n      }\r\n    } catch(e) {}\r\n\r\n    if (variants.length > 0 || addons.length > 0 || masterAddonIds.length > 0) {\r\n      setSelectedItemForAddon({ ...itemWithPossibleDiscount, parsedVariants: variants, parsedAddons: addons, activeItemDiscounts });\r\n      setShowAddonModal(true);\r\n    } else {\r\n      cart.addItem(itemWithPossibleDiscount);\r\n    }\r\n  };\r\n\r\n  const validatePhone = () => {\r\n    if (cart.customerPhone && cart.customerPhone.trim() !== '') {\r\n      const phone = cart.customerPhone.trim();\r\n      if (!/^\\d{10}$/.test(phone)) {\r\n        showAlert('Customer Mobile Number must be exactly 10 digits.', 'error');\r\n        return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  const handleCheckout = async () => {\r\n    if (!validatePhone()) return;\r\n    // IMMEDIATE ACTION: Create Order -> KOT -> Print\r\n    try {\r\n      const result = await cart.createOrder(user?.id);\r\n      if (result.success) {\r\n        // 1. KOT\r\n        // 2. Print Receipt\r\n        // 3. Clear Cart (done in createOrder)\r\n        // 4. Alert/Notify\r\n        const order = await window.electronAPI.invoke('order:getById', { id: result.id });\r\n        await window.electronAPI.invoke('print:kotRouted', { order: order, items: order.items });\r\n        showAlert(`Order #${result.orderNumber} Placed Successfully!`, \"success\");\r\n        loadData();\r\n      } else {\r\n        showAlert('Order Failed: ' + result.error, \"error\");\r\n      }\r\n    } catch (error) {\r\n      console.error(error);\r\n      showAlert('Error processing order', \"error\");\r\n    }\r\n  };\r\n\r\n  const handleNewOrder = () => {\r\n    if (cart.items.length > 0) {\r\n      if (window.confirm('Clear current order?')) {\r\n        cart.clearCart();\r\n      }\r\n    } else {\r\n      cart.clearCart();\r\n    }\r\n  };\r\n\r\n  const handleHoldOrder = () => {\r\n    if (cart.items.length === 0) {\r\n      // Logic for empty cart: check held orders\r\n      if (cart.heldOrders.length === 0) {\r\n        showAlert('Cart is empty and no held orders.', \"info\");\r\n      } else if (cart.heldOrders.length === 1) {\r\n        // Auto-resume if only 1\r\n        const order = cart.heldOrders[0];\r\n        showAlert(`Resume held order #${order.orderNumber}?`, \"confirm\", () => {\r\n           cart.resumeOrder(order);\r\n        });\r\n      } else {\r\n        // Show modal if > 1\r\n        setShowHeldOrders(true);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Logic for non-empty cart: Hold it IMMEDIATELY without confirmation\r\n    const result = cart.holdOrder();\r\n    if (result.success) {\r\n       showAlert('Order Held Successfully', \"success\");\r\n    } else {\r\n      showAlert('Failed to hold order: ' + result.error, \"error\");\r\n    }\r\n  };\r\n\r\n  const handleResumeOrder = (order) => {\r\n    if (cart.items.length > 0) {\r\n      showAlert('Current cart will be cleared to resume order. Continue?', \"confirm\", () => {\r\n         cart.resumeOrder(order);\r\n         setShowHeldOrders(false);\r\n      });\r\n      return;\r\n    }\r\n\r\n    cart.resumeOrder(order);\r\n    setShowHeldOrders(false);\r\n  };\r\n\r\n  const handleDeleteHeldOrder = (orderId) => {\r\n    showAlert('Are you sure you want to delete this held order?', \"confirm\", () => {\r\n      cart.removeHeldOrder(orderId);\r\n      if (cart.heldOrders.length === 0) {\r\n        setShowHeldOrders(false);\r\n      }\r\n    });\r\n  };\r\n\r\n  // KOT Only - Send to kitchen without completing order\r\n  const handleKOTOnly = async () => {\r\n    if (cart.items.length === 0) return;\r\n    if (!validatePhone()) return;\r\n\r\n    try {\r\n      // Create a temporary order object for KOT\r\n      const kotOrder = {\r\n        order_type: cart.orderType,\r\n        table_number: cart.tableNumber,\r\n        customer_name: cart.customerName,\r\n        notes: cart.notes,\r\n        urgency: cart.urgency || 'normal',\r\n        chef_instructions: cart.chefInstructions || null,\r\n        items: cart.items.map(item => ({\r\n          item_name: item.name,\r\n          quantity: item.quantity,\r\n          unit_price: item.unitPrice,\r\n          price: item.unitPrice,\r\n          category_id: item.categoryId,\r\n          special_instructions: item.specialInstructions,\r\n          variant: item.variant,\r\n          addons: item.addons\r\n        }))\r\n      };\r\n\r\n      await window.electronAPI.invoke('print:kotRouted', {\r\n        order: kotOrder,\r\n        items: kotOrder.items\r\n      });\r\n\r\n      // Reset delivery and container charges after sending to KOT\r\n      cart.setDeliveryCharge(0);\r\n      cart.setContainerCharge(0);\r\n\r\n      showAlert('KOT sent to kitchen!', \"success\");\r\n    } catch (error) {\r\n      console.error('KOT print error:', error);\r\n      showAlert('Error sending KOT: ' + error.message, \"error\");\r\n    }\r\n  };\r\n\r\n  // Save & KOT - Create order and send to kitchen (no receipt)\r\n  const handleSaveAndKOT = async () => {\r\n    if (cart.items.length === 0) return;\r\n    if (!validatePhone()) return;\r\n\r\n    try {\r\n      const pm = cart.paymentMethod;\r\n      const pd = cart.paymentDetails;\r\n      // Create order\r\n      const result = await cart.createOrder(user?.id);\r\n\r\n      if (result.success) {\r\n        const order = await window.electronAPI.invoke('order:getById', { id: result.id });\r\n\r\n        // Print KOT routed to kitchen stations\r\n        await window.electronAPI.invoke('print:kotRouted', {\r\n          order: order,\r\n          items: order.items\r\n        });\r\n\r\n        const isFullyPaid = ['cash', 'card', 'upi'].includes(pm) || \r\n          (pm === 'split' && !pd?.splits?.some(s => s.method === 'due' && s.amount > 0));\r\n\r\n        if (isFullyPaid) {\r\n          await window.electronAPI.invoke('order:complete', {\r\n            id: result.id,\r\n            paymentMethod: pm,\r\n            paymentDetails: pd,\r\n          });\r\n        }\r\n\r\n        showAlert(`Order #${result.orderNumber} Saved & Sent to KOT!`, \"success\");\r\n        setShowBillSheet(false);\r\n      } else {\r\n        throw new Error(result.error || 'Failed to create order');\r\n      }\r\n    } catch (error) {\r\n      console.error('Save & KOT error:', error);\r\n      showAlert('Error: ' + error.message, \"error\");\r\n    }\r\n  };\r\n\r\n  // KOT & Print - Send to kitchen and print receipt preview\r\n  const handleKOTAndPrint = async () => {\r\n    if (cart.items.length === 0) return;\r\n    if (!validatePhone()) return;\r\n\r\n    try {\r\n      const pm = cart.paymentMethod;\r\n      const pd = cart.paymentDetails;\r\n      // Create order first\r\n      const result = await cart.createOrder(user?.id);\r\n\r\n      if (result.success) {\r\n        const order = await window.electronAPI.invoke('order:getById', { id: result.id });\r\n\r\n        // Print KOT & Bill simultaneously via routed handler\r\n        await window.electronAPI.invoke('print:kotRouted', {\r\n          order: order,\r\n          items: order.items,\r\n          printBill: true\r\n        }).catch(err => console.error(\"KOT+Bill Print Failed\", err));\r\n\r\n        const isFullyPaid = ['cash', 'card', 'upi'].includes(pm) || \r\n          (pm === 'split' && !pd?.splits?.some(s => s.method === 'due' && s.amount > 0));\r\n\r\n        if (isFullyPaid) {\r\n          await window.electronAPI.invoke('order:complete', {\r\n            id: result.id,\r\n            paymentMethod: pm,\r\n            paymentDetails: pd,\r\n          });\r\n        }\r\n\r\n        showAlert(`Order #${result.orderNumber} placed! KOT & Receipt printed.`, \"success\");\r\n      } else {\r\n        throw new Error(result.error || 'Failed to create order');\r\n      }\r\n    } catch (error) {\r\n      console.error('KOT & Print error:', error);\r\n      showAlert('Error: ' + error.message, \"error\");\r\n    }\r\n  };\r\n\r\n  // Save & Print - Complete order and print receipt\r\n  const handleSaveAndPrint = async () => {\r\n    if (cart.items.length === 0) return;\r\n    if (!validatePhone()) return;\r\n\r\n    try {\r\n      const result = await cart.createOrder(user?.id);\r\n\r\n      if (result.success) {\r\n        const order = await window.electronAPI.invoke('order:getById', { id: result.id });\r\n\r\n        // Complete order with selected payment method\r\n        await window.electronAPI.invoke('order:complete', {\r\n          id: result.id,\r\n          paymentMethod: cart.paymentMethod,\r\n          paymentDetails: cart.paymentDetails,\r\n        });\r\n\r\n        // Print Receipt\r\n        await window.electronAPI.invoke('print:receipt', { order: order });\r\n\r\n        showAlert(`Order #${result.orderNumber} completed! Receipt printed.`, \"success\");\r\n      } else {\r\n        throw new Error(result.error || 'Failed to create order');\r\n      }\r\n    } catch (error) {\r\n      console.error('Save & Print error:', error);\r\n      showAlert('Error: ' + error.message, \"error\");\r\n    }\r\n  };\r\n\r\n  const calculateTotal = () => {\r\n    return cart.getTotal();\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        height: '100vh',\r\n        background: '#f5f5f5',\r\n        color: '#546E7A'\r\n      }}>\r\n        <div className=\"loading-spinner\" style={{ width: '48px', height: '48px', borderWidth: '4px' }}></div>\r\n        <p style={{ marginTop: '16px', fontWeight: '600', fontSize: '18px' }}>Loading POS System...</p>\r\n        <p style={{ fontSize: '14px', color: '#90A4AE' }}>Getting things ready for you</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"pos-fullscreen\">\r\n      {/* Header Bar - Strict PetPooja Design */}\r\n      <CustomerHistoryModal\r\n        isOpen={showHistoryModal}\r\n        onClose={() => setShowHistoryModal(false)}\r\n        history={historyData}\r\n        customerName={cart.customerName}\r\n        customerPhone={cart.customerPhone}\r\n      />\r\n      <div className=\"pos-header-bar\">\r\n        <div className=\"pos-header-left\">\r\n          <button\r\n            className=\"pos-header-menu-btn\"\r\n            onClick={() => setShowMainSidebar(true)}\r\n          >\r\n            <Menu size={24} color=\"#546E7A\" />\r\n          </button>\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n            <img src={logoImg} alt=\"ZapBill Logo\" style={{ height: '32px', width: 'auto', objectFit: 'contain' }} />\r\n          </div>\r\n          {/* Active Menu Name Badge */}\r\n          {activeMenu && (\r\n            <div style={{ \r\n              marginLeft: '12px', \r\n              padding: '4px 12px', \r\n              background: '#E3F2FD', \r\n              borderRadius: '16px', \r\n              fontSize: '12px', \r\n              fontWeight: 600, \r\n              color: '#1565C0',\r\n              border: '1px solid #BBDEFB',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: '6px'\r\n            }}>\r\n              <Menu size={14} />\r\n              {activeMenu.name}\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"pos-search-wrapper\">\r\n          <div className=\"pos-search-box\">\r\n            <Search size={18} color=\"#90A4AE\" />\r\n            <input\r\n              type=\"text\"\r\n              placeholder=\"Search by Item Name / Short Code\"\r\n              value={searchQuery}\r\n              onChange={(e) => setSearchQuery(e.target.value)}\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"pos-header-right\">\r\n          <button className=\"pos-new-order-btn\" onClick={handleNewOrder}>\r\n            New Order\r\n          </button>\r\n\r\n          <div className=\"pos-support-box\">\r\n            <span>Support</span>\r\n            <strong>9310065542</strong>\r\n          </div>\r\n\r\n          <div className=\"pos-header-actions\">\r\n            <button className=\"pos-header-icon-btn\" title=\"Refresh App\" onClick={() => window.location.reload()}>\r\n              <RefreshCw size={20} />\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main Body */}\r\n      <div className=\"pos-main-body\">\r\n\r\n        {/* Left Section: Categories & Menu */}\r\n        <div className=\"pos-left-panel\">\r\n          {/* Category Sidebar */}\r\n          <div className=\"pos-category-sidebar\">\r\n            <div\r\n              className={`pos-category-item ${!selectedCategory ? 'active' : ''}`}\r\n              onClick={() => setSelectedCategory(null)}\r\n            >\r\n              <div className=\"pos-category-icon-wrapper\" style={{ marginBottom: '4px' }}>\r\n                <ClipboardList size={32} />\r\n              </div>\r\n              <span>All Items</span>\r\n            </div>\r\n            \r\n            {/* Favorites Category */}\r\n            <div\r\n              className={`pos-category-item ${selectedCategory === 'favorites' ? 'active' : ''}`}\r\n              onClick={() => setSelectedCategory('favorites')}\r\n            >\r\n              <div className=\"pos-category-icon-wrapper\" style={{ marginBottom: '4px' }}>\r\n                <Star size={32} fill={selectedCategory === 'favorites' ? \"white\" : \"#FFC107\"} color={selectedCategory === 'favorites' ? \"white\" : \"#FFB300\"} />\r\n              </div>\r\n              <span>Favorites</span>\r\n            </div>\r\n\r\n            {categories.map((category, index) => {\r\n              // Helper to get icon based on category name\r\n              const getIcon = (name) => {\r\n                const n = name.toLowerCase();\r\n                if (n.includes('pizza')) return <Pizza size={32} />;\r\n                if (n.includes('coffee') || n.includes('tea') || n.includes('beverage')) return <Coffee size={32} />;\r\n                if (n.includes('ice') || n.includes('dessert')) return <IceCream size={32} />;\r\n                if (n.includes('sandwich') || n.includes('burger')) return <Sandwich size={32} />;\r\n                if (n.includes('soup')) return <Soup size={32} />;\r\n                if (n.includes('veg') || n.includes('salad')) return <Carrot size={32} />;\r\n                if (n.includes('chicken') || n.includes('beef') || n.includes('meat')) return <Beef size={32} />;\r\n                if (n.includes('cake') || n.includes('pastry')) return <Cake size={32} />;\r\n                if (n.includes('beer') || n.includes('alcohol')) return <Beer size={32} />;\r\n                return <Utensils size={32} />;\r\n              };\r\n\r\n              return (\r\n                <div\r\n                  key={category.id}\r\n                  className={`pos-category-item ${selectedCategory === category.id ? 'active' : ''}`}\r\n                  onClick={() => setSelectedCategory(category.id)}\r\n                >\r\n                  <div className=\"pos-category-icon-wrapper\" style={{ marginBottom: '4px' }}>\r\n                    {getIcon(category.name)}\r\n                  </div>\r\n                  <span>{category.name}</span>\r\n                </div>\r\n              );\r\n            })}\r\n          </div>\r\n\r\n          {/* Menu Grid Area */}\r\n          <div className=\"pos-menu-area\">\r\n            <div className=\"pos-menu-grid\">\r\n              {filteredItems.length > 0 ? (\r\n                filteredItems.map(item => {\r\n                  const itemDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && (!d.variant_name));\r\n                  let displayPrice = item.price;\r\n                  if (itemDiscount) {\r\n                     let discountAmount = 0;\r\n                     if (itemDiscount.discount_type === 'percentage') {\r\n                       discountAmount = displayPrice * (itemDiscount.discount_value / 100);\r\n                     } else if (itemDiscount.discount_type === 'flat') {\r\n                       discountAmount = itemDiscount.discount_value;\r\n                     }\r\n                     displayPrice -= discountAmount;\r\n                     if (displayPrice < 0) displayPrice = 0;\r\n                  }\r\n\r\n                  return (\r\n                  <div key={item.id} className={`pos-menu-card ${item.is_vegetarian ? 'veg' : 'nonveg'}`} onClick={() => handleAddToCart(item)}>\r\n                    <div \r\n                      className={`favorite-btn ${item.is_favorite ? 'is-fav' : ''}`}\r\n                      onClick={(e) => toggleFavorite(e, item)}\r\n                    >\r\n                      <Star size={16} fill={item.is_favorite ? \"#FFC107\" : \"none\"} color={item.is_favorite ? \"#FFC107\" : \"#CBD5E1\"} />\r\n                    </div>\r\n                    <div className=\"pos-menu-card-inner\">\r\n                      <span className=\"pos-menu-card-name\">{item.name}</span>\r\n                      <span className=\"pos-menu-card-price\">\r\n                        {itemDiscount ? (\r\n                          <>\r\n                            <span style={{ textDecoration: 'line-through', color: '#90A4AE', marginRight: '6px', fontSize: '11px' }}>{item.price.toFixed(0)}</span>\r\n                            <span style={{ color: '#0096FF' }}>{displayPrice.toFixed(0)}</span>\r\n                          </>\r\n                        ) : (\r\n                          <>{displayPrice.toFixed(0)}</>\r\n                        )}\r\n                      </span>\r\n                    </div>\r\n                  </div>\r\n                  );\r\n                })\r\n\r\n              ) : (\r\n                <div className=\"pos-empty-state\">\r\n                  <div className=\"pos-empty-state-icon\">\r\n                    <UtensilsCrossed size={48} />\r\n                  </div>\r\n                  <h3>No Items Found</h3>\r\n                  <p>Try selecting a different category or search term</p>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Right Section: Cart Panel */}\r\n        <div className=\"pos-cart-panel\">\r\n          {/* Order Type Tabs - Moved Inside Cart Panel */}\r\n          <div className=\"pos-cart-header-tabs\">\r\n            <button\r\n              className={`pos-order-type-tab ${cart.orderType === 'dine_in' ? 'active dine-in' : ''}`}\r\n              onClick={() => cart.setOrderType('dine_in')}\r\n            >\r\n              Dine In\r\n            </button>\r\n            <button\r\n              className={`pos-order-type-tab ${cart.orderType === 'delivery' ? 'active delivery' : ''}`}\r\n              onClick={() => cart.setOrderType('delivery')}\r\n            >\r\n              Delivery\r\n            </button>\r\n            <button\r\n              className={`pos-order-type-tab ${cart.orderType === 'takeaway' ? 'active pickup' : ''}`}\r\n              onClick={() => cart.setOrderType('takeaway')}\r\n            >\r\n              Pick Up\r\n            </button>\r\n          </div>\r\n\r\n          {/* 4 Equal-Width Tab Buttons */}\r\n          <div className=\"pos-customer-bar\">\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr 1fr', gap: '4px', width: '100%', padding: '6px 8px' }}>\r\n              {/* Tab 1: Table */}\r\n              <button\r\n                onClick={() => setActiveCartTab(activeCartTab === 'table' ? null : 'table')}\r\n                style={{\r\n                  display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '4px',\r\n                  padding: '8px 4px', borderRadius: '6px', cursor: 'pointer', fontSize: '12px', fontWeight: 600,\r\n                  background: activeCartTab === 'table' ? '#FFF3E0' : '#F5F5F5',\r\n                  color: activeCartTab === 'table' ? '#E65100' : '#546E7A',\r\n                  border: activeCartTab === 'table' ? '1.5px solid #FFB74D' : '1px solid #E0E0E0',\r\n                  transition: 'all 0.15s'\r\n                }}\r\n              >\r\n                <MapPin size={15} /> {cart.tableNumber || 'Table'}\r\n              </button>\r\n\r\n              {/* Tab 2: User */}\r\n              <button\r\n                onClick={() => setActiveCartTab(activeCartTab === 'user' ? null : 'user')}\r\n                style={{\r\n                  display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '4px',\r\n                  padding: '8px 4px', borderRadius: '6px', cursor: 'pointer', fontSize: '12px', fontWeight: 600,\r\n                  background: activeCartTab === 'user' ? '#E3F2FD' : '#F5F5F5',\r\n                  color: activeCartTab === 'user' ? '#1565C0' : '#546E7A',\r\n                  border: activeCartTab === 'user' ? '1.5px solid #90CAF9' : '1px solid #E0E0E0',\r\n                  transition: 'all 0.15s'\r\n                }}\r\n              >\r\n                <User size={15} /> User\r\n              </button>\r\n\r\n              {/* Tab 3: Chef */}\r\n              <button\r\n                onClick={() => setActiveCartTab(activeCartTab === 'chef' ? null : 'chef')}\r\n                style={{\r\n                  display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '4px',\r\n                  padding: '8px 4px', borderRadius: '6px', cursor: 'pointer', fontSize: '12px', fontWeight: 600,\r\n                  background: activeCartTab === 'chef' ? '#FFF8E1' : '#F5F5F5',\r\n                  color: activeCartTab === 'chef' ? '#F57F17' : '#546E7A',\r\n                  border: activeCartTab === 'chef' ? '1.5px solid #FFE082' : '1px solid #E0E0E0',\r\n                  transition: 'all 0.15s'\r\n                }}\r\n              >\r\n                <ChefHat size={15} /> Chef\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Tab 1 Panel: Table Selection (only for Dine In) */}\r\n          {activeCartTab === 'table' && (\r\n            <div style={{ background: 'white', padding: '12px', borderBottom: '1px solid #E0E0E0', animation: 'slideDown 0.2s ease-out' }}>\r\n              {cart.orderType === 'dine_in' ? (\r\n                <>\r\n                  <div style={{ fontWeight: 700, fontSize: '13px', color: '#37474F', marginBottom: '8px' }}> Enter Table Number</div>\r\n                  <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>\r\n                    <input\r\n                      type=\"text\"\r\n                      placeholder=\"e.g. 5, 12, P1\"\r\n                      value={cart.tableNumber || ''}\r\n                      onChange={(e) => cart.setTableNumber(e.target.value.toUpperCase())}\r\n                      style={{\r\n                        flex: 1,\r\n                        padding: '10px 12px',\r\n                        border: '1.5px solid #CFD8DC',\r\n                        borderRadius: '8px',\r\n                        fontSize: '16px',\r\n                        fontWeight: '700',\r\n                        textAlign: 'center',\r\n                        color: '#E65100',\r\n                        background: '#FFF8E1',\r\n                        outline: 'none',\r\n                        boxShadow: 'inset 0 2px 4px rgba(0,0,0,0.05)'\r\n                      }}\r\n                      autoFocus\r\n                    />\r\n                    <button\r\n                      onClick={() => cart.setTableNumber('')}\r\n                      style={{\r\n                        padding: '10px 16px',\r\n                        background: '#ECEFF1',\r\n                        border: '1px solid #CFD8DC',\r\n                        borderRadius: '8px',\r\n                        color: '#546E7A',\r\n                        fontWeight: '600',\r\n                        cursor: 'pointer',\r\n                        fontSize: '13px'\r\n                      }}\r\n                    >\r\n                      Clear\r\n                    </button>\r\n                  </div>\r\n                </>\r\n              ) : (\r\n                <div style={{ textAlign: 'center', padding: '16px', color: '#90A4AE', fontSize: '13px' }}>Table selection is only available for Dine In orders.</div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Tab 2 Panel: User Info Form */}\r\n          {activeCartTab === 'user' && (\r\n            <div className=\"pos-user-info-form\" style={{ background: 'white', padding: '12px', borderBottom: '1px solid #E0E0E0', fontSize: '13px', animation: 'slideDown 0.2s ease-out', display: 'flex', flexDirection: 'column', gap: '10px' }}>\r\n\r\n              {/* Mobile Number with Autocomplete */}\r\n              <div style={{ position: 'relative' }}>\r\n                <label style={{ color: customerDue.hasDue ? '#f44336' : '#546E7A', fontWeight: 600, display: 'block', marginBottom: '4px' }}>\r\n                  Mobile Number: {customerDue.hasDue && <span style={{ fontSize: '10px' }}>(DEBTOR)</span>}\r\n                </label>\r\n                <div style={{ display: 'flex', gap: '8px' }}>\r\n                  <input\r\n                    type=\"text\"\r\n                    placeholder=\"Enter Mobile No\"\r\n                    value={cart.customerPhone || ''}\r\n                    onChange={handlePhoneInput}\r\n                    onBlur={() => setTimeout(() => setShowSuggestions(false), 200)}\r\n                    autoComplete=\"off\"\r\n                    autoFocus\r\n                    style={{ \r\n                      border: `1px solid ${customerDue.hasDue ? '#f44336' : '#CFD8DC'}`, \r\n                      background: customerDue.hasDue ? '#FFEBEE' : 'white',\r\n                      borderRadius: '4px', padding: '8px', fontSize: '14px', outline: 'none', flex: 1 \r\n                    }}\r\n                  />\r\n                  <button\r\n                    onClick={fetchHistory}\r\n                    style={{ background: '#ECEFF1', border: '1px solid #CFD8DC', borderRadius: '4px', padding: '0 10px', cursor: 'pointer', display: 'flex', alignItems: 'center', gap: '4px' }}\r\n                    title=\"View History\"\r\n                  >\r\n                    <Clock size={16} color=\"#546E7A\" />\r\n                    <span style={{ color: '#546E7A', fontWeight: 500 }}>History</span>\r\n                  </button>\r\n                </div>\r\n                {/* Suggestions Dropdown */}\r\n                {showSuggestions && customerSuggestions.length > 0 && (\r\n                  <div style={{\r\n                    position: 'absolute', top: '100%', left: 0, right: 0, zIndex: 10,\r\n                    background: 'white', border: '1px solid #eee', borderRadius: '4px', boxShadow: '0 4px 12px rgba(0,0,0,0.1)',\r\n                    maxHeight: '200px', overflowY: 'auto'\r\n                  }}>\r\n                    {customerSuggestions.map((cust, i) => (\r\n                      <div\r\n                        key={i}\r\n                        onMouseDown={() => selectCustomer(cust)}\r\n                        style={{ padding: '8px 12px', borderBottom: '1px solid #f5f5f5', cursor: 'pointer' }}\r\n                      >\r\n                        <div style={{ fontWeight: '500', color: '#2c3e50' }}>{cust.customer_phone}</div>\r\n                        <div style={{ fontSize: '12px', color: '#7f8c8d' }}>{cust.customer_name}</div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                )}\r\n              </div>\r\n\r\n              {/* Name */}\r\n              <div>\r\n                <label style={{ color: customerDue.hasDue ? '#f44336' : '#546E7A', fontWeight: 600, display: 'block', marginBottom: '4px' }}>\r\n                  Customer Name: {customerDue.hasDue && <span style={{ fontSize: '10px' }}>(OVERDUE: {customerDue.totalDue})</span>}\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Enter Name\"\r\n                  value={cart.customerName || ''}\r\n                  onChange={(e) => cart.setCustomerName(e.target.value)}\r\n                  style={{ \r\n                    border: `1px solid ${customerDue.hasDue ? '#f44336' : '#CFD8DC'}`, \r\n                    background: customerDue.hasDue ? '#FFEBEE' : 'white',\r\n                    borderRadius: '4px', padding: '8px', fontSize: '14px', outline: 'none', width: '100%' \r\n                  }}\r\n                />\r\n              </div>\r\n\r\n              {/* Address */}\r\n              <div>\r\n                <label style={{ color: '#546E7A', fontWeight: 600, display: 'block', marginBottom: '4px' }}>Address:</label>\r\n                <input\r\n                  type=\"text\"\r\n                  placeholder=\"Enter Address\"\r\n                  value={customerAddress}\r\n                  onChange={(e) => setCustomerAddress(e.target.value)}\r\n                  style={{ border: '1px solid #CFD8DC', borderRadius: '4px', padding: '8px', fontSize: '14px', outline: 'none', width: '100%' }}\r\n                />\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Tab 3 Panel: Chef Instructions & Urgency */}\r\n          {activeCartTab === 'chef' && (\r\n            <div style={{ background: 'white', padding: '12px', borderBottom: '1px solid #E0E0E0', fontSize: '13px', animation: 'slideDown 0.2s ease-out' }}>\r\n              <div style={{ fontWeight: 700, fontSize: '13px', color: '#37474F', marginBottom: '10px', display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                <ChefHat size={16} color=\"#E65100\" /> Chef Instructions\r\n              </div>\r\n\r\n              {/* Urgency Selector */}\r\n              <div style={{ marginBottom: '10px' }}>\r\n                <label style={{ color: '#546E7A', fontWeight: 600, display: 'block', marginBottom: '6px', fontSize: '12px' }}>Order Urgency:</label>\r\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '6px' }}>\r\n                  {[\r\n                    { value: 'normal', label: ' Normal', bg: '#E8F5E9', border: '#A5D6A7', activeBg: '#4CAF50', color: '#2E7D32' },\r\n                    { value: 'urgent', label: ' Urgent', bg: '#FFF3E0', border: '#FFB74D', activeBg: '#FF9800', color: '#E65100' },\r\n                    { value: 'critical', label: ' Critical', bg: '#FFEBEE', border: '#EF9A9A', activeBg: '#F44336', color: '#C62828' },\r\n                  ].map(opt => (\r\n                    <button\r\n                      key={opt.value}\r\n                      onClick={() => cart.setUrgency(opt.value)}\r\n                      style={{\r\n                        padding: '8px 6px',\r\n                        borderRadius: '6px',\r\n                        border: cart.urgency === opt.value ? `2px solid ${opt.activeBg}` : `1px solid ${opt.border}`,\r\n                        background: cart.urgency === opt.value ? opt.bg : '#FAFAFA',\r\n                        color: cart.urgency === opt.value ? opt.color : '#78909C',\r\n                        fontWeight: cart.urgency === opt.value ? 700 : 500,\r\n                        fontSize: '12px',\r\n                        cursor: 'pointer',\r\n                        transition: 'all 0.15s'\r\n                      }}\r\n                    >\r\n                      {opt.label}\r\n                    </button>\r\n                  ))}\r\n                </div>\r\n              </div>\r\n\r\n              {/* Chef Notes Textarea */}\r\n              <div>\r\n                <label style={{ color: '#546E7A', fontWeight: 600, display: 'block', marginBottom: '4px', fontSize: '12px' }}>Notes for Chef:</label>\r\n                <textarea\r\n                  placeholder=\"e.g. Customer is allergic to nuts, prepare with less oil, no onion in all items...\"\r\n                  value={cart.chefInstructions || ''}\r\n                  onChange={(e) => cart.setChefInstructions(e.target.value)}\r\n                  style={{ width: '100%', border: '1px solid #CFD8DC', borderRadius: '6px', padding: '8px 10px', fontSize: '13px', resize: 'vertical', minHeight: '60px', maxHeight: '100px', outline: 'none', fontFamily: 'inherit', color: '#37474F' }}\r\n                />\r\n              </div>\r\n\r\n              {/* Current urgency display */}\r\n              {cart.urgency !== 'normal' && (\r\n                <div style={{ marginTop: '8px', padding: '6px 10px', borderRadius: '6px', fontSize: '12px', fontWeight: 600, background: cart.urgency === 'critical' ? '#FFEBEE' : '#FFF3E0', color: cart.urgency === 'critical' ? '#C62828' : '#E65100', display: 'flex', alignItems: 'center', gap: '4px' }}>\r\n                  <AlertTriangle size={14} /> This order is marked as {cart.urgency.toUpperCase()}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n\r\n          {/* Tab 4 Panel: Order Summary */}\r\n          {activeCartTab === 'summary' && (\r\n            <div style={{ background: 'white', padding: '12px', borderBottom: '1px solid #E0E0E0', fontSize: '13px', animation: 'slideDown 0.2s ease-out' }}>\r\n              <div style={{ fontWeight: 700, fontSize: '14px', color: '#37474F', marginBottom: '8px', borderBottom: '1px solid #ECEFF1', paddingBottom: '6px' }}> Order Summary</div>\r\n              <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '6px 16px', marginBottom: '8px' }}>\r\n                <div><span style={{ color: '#78909C' }}>Type:</span> <strong>{cart.orderType?.replace('_', ' ').toUpperCase()}</strong></div>\r\n                {cart.tableNumber && <div><span style={{ color: '#78909C' }}>Table:</span> <strong>{cart.tableNumber}</strong></div>}\r\n                {cart.customerName && <div><span style={{ color: '#78909C' }}>Customer:</span> <strong>{cart.customerName}</strong></div>}\r\n                {cart.customerPhone && <div><span style={{ color: '#78909C' }}>Phone:</span> <strong>{cart.customerPhone}</strong></div>}\r\n                <div><span style={{ color: '#78909C' }}>Urgency:</span> <strong style={{ color: cart.urgency === 'critical' ? '#C62828' : cart.urgency === 'urgent' ? '#E65100' : '#2E7D32' }}>{(cart.urgency || 'normal').toUpperCase()}</strong></div>\r\n              </div>\r\n              {cart.chefInstructions && (\r\n                <div style={{ padding: '6px 8px', background: '#FFF8E1', borderRadius: '6px', border: '1px solid #FFE082', marginBottom: '8px', fontSize: '12px' }}>\r\n                  <strong style={{ color: '#E65100' }}>Chef Notes:</strong> {cart.chefInstructions}\r\n                </div>\r\n              )}\r\n              {cart.items.length > 0 && (\r\n                <div style={{ borderTop: '1px dashed #CFD8DC', paddingTop: '8px' }}>\r\n                  <div style={{ fontWeight: 600, color: '#546E7A', marginBottom: '6px' }}>Items ({cart.items.reduce((s, i) => s + i.quantity, 0)})</div>\r\n                  {cart.items.map((item, idx) => (\r\n                    <div key={idx} style={{ marginBottom: '6px', padding: '4px 0', borderBottom: '1px solid #f5f5f5' }}>\r\n                      <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                        <span>{item.name}  {item.quantity}</span>\r\n                        <span style={{ fontWeight: 600 }}>{(item.unitPrice * item.quantity).toFixed(2)}</span>\r\n                      </div>\r\n                      {item.addons?.length > 0 && <div style={{ fontSize: '11px', color: '#78909C', marginTop: '2px' }}>+ {item.addons.map(a => a.name).join(', ')}</div>}\r\n                      {item.specialInstructions && <div style={{ fontSize: '11px', color: '#E65100', fontStyle: 'italic', marginTop: '2px' }}> {item.specialInstructions}</div>}\r\n                    </div>\r\n                  ))}\r\n                  <div style={{ display: 'flex', justifyContent: 'space-between', fontWeight: 700, paddingTop: '6px', fontSize: '14px', color: '#D32F2F' }}>\r\n                    <span>Grand Total</span>\r\n                    <span>{cart.getGrandTotal().toFixed(2)}</span>\r\n                  </div>\r\n                </div>\r\n              )}\r\n              {cart.notes && <div style={{ marginTop: '6px', fontSize: '12px', color: '#E65100', fontStyle: 'italic' }}>Notes: {cart.notes}</div>}\r\n            </div>\r\n          )}\r\n\r\n          <div className=\"pos-cart-table-header\">\r\n            <span>ITEMS</span>\r\n            <span style={{ textAlign: 'center' }}>QTY.</span>\r\n            <span style={{ textAlign: 'right' }}>PRICE</span>\r\n          </div>\r\n\r\n          {/* Cart Items List */}\r\n          <div className=\"pos-cart-items\">\r\n            {cart.items.length === 0 ? (\r\n              <div className=\"pos-cart-empty\">\r\n                <ShoppingCart size={48} />\r\n                <p>Cart is Empty</p>\r\n              </div>\r\n            ) : (\r\n              cart.items.map(item => (\r\n                <div key={item.id} className=\"pos-cart-item\" style={{ padding: '14px 16px', minHeight: '65px' }}>\r\n                  <div className=\"pos-cart-item-details\">\r\n                    <div style={{ display: 'flex', alignItems: 'flex-start', gap: '10px' }}>\r\n                      <button className=\"pos-cart-item-remove\" style={{ marginTop: '2px', marginLeft: 0 }} onClick={() => cart.removeItem(item.id)}>\r\n                        <X size={20} style={{ background: '#D32F2F', borderRadius: '50%', color: 'white', padding: '3px' }} />\r\n                      </button>\r\n                      <div style={{ display: 'flex', flexDirection: 'column', gap: '2px' }}>\r\n                        <span className=\"pos-cart-item-name\" style={{ fontSize: '16px', lineHeight: '1.2' }}>{item.name}</span>\r\n                        {item.variant && item.variant.name && (\r\n                           <span style={{ fontSize: '13px', color: '#64748B', fontWeight: 600 }}>{item.variant.name}</span>\r\n                        )}\r\n                      </div>\r\n                    </div>\r\n                    {item.addons && item.addons.length > 0 && (\r\n                      <div className=\"pos-cart-item-addons\" style={{ paddingLeft: '30px', marginTop: '6px', fontSize: '12px' }}>\r\n                        {item.addons.map(a => a.name).join(', ')}\r\n                      </div>\r\n                    )}\r\n                    {item.specialInstructions && (\r\n                      <div style={{ fontSize: '11px', color: '#E65100', fontStyle: 'italic', marginTop: '4px', paddingLeft: '30px' }}>\r\n                         {item.specialInstructions}\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n\r\n                  <div className=\"pos-cart-qty-ctrl\" style={{ margin: '0 120px', height: '32px' }}>\r\n                    <button className=\"pos-cart-qty-btn\" onClick={() => cart.updateQuantity(item.id, item.quantity - 1)}>-</button>\r\n                    <div className=\"pos-cart-qty-val\">{item.quantity}</div>\r\n                    <button className=\"pos-cart-qty-btn\" onClick={() => cart.updateQuantity(item.id, item.quantity + 1)}>+</button>\r\n                  </div>\r\n\r\n                  <div className=\"pos-cart-item-price\" style={{ textAlign: 'right' }}>\r\n                    <div style={{ fontSize: '14px', fontWeight: 'bold' }}>{(item.unitPrice * item.quantity).toFixed(2)}</div>\r\n                    <div style={{ fontSize: '11px', color: '#888' }}>{item.unitPrice.toFixed(2)}</div>\r\n                  </div>\r\n                </div>\r\n              ))\r\n            )}\r\n          </div>\r\n\r\n          {/* 3. Bill Breakdown (Standard View) */}\r\n          <div className=\"pos-bill-breakdown\" style={{ background: 'white', borderTop: '1px solid #ddd' }}>\r\n            <div className=\"pos-bill-row\">\r\n              <span className=\"pos-bill-label\">Sub Total</span>\r\n              <span className=\"pos-bill-value\">{cart.getSubtotal().toFixed(2)}</span>\r\n            </div>\r\n\r\n            <div className=\"pos-bill-row\">\r\n              <span className=\"pos-bill-label\">SGST 2.5%</span>\r\n              <span className=\"pos-bill-value\">{cart.getTaxBreakdown().sgst.toFixed(2)}</span>\r\n            </div>\r\n\r\n            <div className=\"pos-bill-row\">\r\n              <span className=\"pos-bill-label\">CGST 2.5%</span>\r\n              <span className=\"pos-bill-value\">{cart.getTaxBreakdown().cgst.toFixed(2)}</span>\r\n            </div>\r\n\r\n            {cart.getServiceCharge() > 0 && (\r\n              <div className=\"pos-bill-row\">\r\n                <span className=\"pos-bill-label\">Service Charge ({cart.serviceChargePercent}%)</span>\r\n                <span className=\"pos-bill-value\">{cart.getServiceCharge().toFixed(2)}</span>\r\n              </div>\r\n            )}\r\n\r\n            <div className=\"pos-bill-divider\"></div>\r\n\r\n            <div className=\"pos-bill-total-row\">\r\n              <span className=\"pos-bill-total-label\">Grand Total</span>\r\n              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                <span className=\"pos-bill-total-value\">{cart.getGrandTotal().toFixed(2)}</span>\r\n                <button\r\n                  onClick={() => setShowBillSheet(true)}\r\n                  style={{ background: '#ECEFF1', border: '1px solid #CFD8DC', borderRadius: '4px', cursor: 'pointer', color: '#546E7A', padding: '4px', display: 'flex', alignItems: 'center' }}\r\n                  title=\"View Detailed Bill\"\r\n                >\r\n                  <ChevronDown size={20} />\r\n                </button>\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n\r\n          {/* 4. Bill Details Sheet - POSITIONED ABSOLUTE TO PANEL */}\r\n          <div className={`pos-bottom-sheet ${showBillSheet ? 'active' : ''}`} style={{ paddingBottom: '120px' }}>\r\n            <div className=\"sheet-header\" style={{ padding: '12px 16px', background: '#0096FF', color: 'white', display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderRadius: '16px 16px 0 0' }}>\r\n              <h3 style={{ margin: 0, fontSize: '16px' }}>Bill Details</h3>\r\n              <button onClick={() => setShowBillSheet(false)} style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer' }}><ChevronDown size={24} /></button>\r\n            </div>\r\n            <div className=\"sheet-body\" style={{ padding: '20px', background: 'white', flex: 1, overflowY: 'auto' }}>\r\n              <div className=\"bill-row\" style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px', fontSize: '14px', color: '#37474F' }}>\r\n                <span>Subtotal</span>\r\n                <span style={{ fontWeight: 700, color: '#1e293b' }}>{cart.getSubtotal().toFixed(2)}</span>\r\n              </div>\r\n\r\n              {/* Taxes breakdown */}\r\n              <div className=\"bill-row\" style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px', fontSize: '14px', color: '#78909C' }}>\r\n                <span>SGST 2.5%</span>\r\n                <span>{cart.getTaxBreakdown().sgst.toFixed(2)}</span>\r\n              </div>\r\n              <div className=\"bill-row\" style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px', fontSize: '14px', color: '#78909C' }}>\r\n                <span>CGST 2.5%</span>\r\n                <span>{cart.getTaxBreakdown().cgst.toFixed(2)}</span>\r\n              </div>\r\n\r\n              {/* Editable Container Charge */}\r\n              {cart.orderType === 'delivery' && (\r\n              <div className=\"bill-row\" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px', fontSize: '14px', color: '#37474F' }}>\r\n                <span>Container Charge</span>\r\n                <input\r\n                  type=\"number\"\r\n                  value={cart.containerCharge || ''}\r\n                  onChange={(e) => cart.setContainerCharge(parseFloat(e.target.value) || 0)}\r\n                  placeholder=\"0\"\r\n                  style={{ width: '80px', textAlign: 'right', border: '1px solid #CFD8DC', padding: '4px 8px', borderRadius: '4px', outline: 'none', fontSize: '14px' }}\r\n                />\r\n              </div>\r\n              )}\r\n\r\n              {/* Editable Delivery Charge */}\r\n              {cart.orderType === 'delivery' && (\r\n              <div className=\"bill-row\" style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px', fontSize: '14px', color: '#37474F' }}>\r\n                <span>Delivery Charge</span>\r\n                <input\r\n                  type=\"number\"\r\n                  value={cart.deliveryCharge || ''}\r\n                  onChange={(e) => cart.setDeliveryCharge(parseFloat(e.target.value) || 0)}\r\n                  placeholder=\"0\"\r\n                  style={{ width: '80px', textAlign: 'right', border: '1px solid #CFD8DC', padding: '4px 8px', borderRadius: '4px', outline: 'none', fontSize: '14px' }}\r\n                />\r\n              </div>\r\n              )}\r\n\r\n              {/* Divider */}\r\n              <div style={{ height: '1px', background: '#eee', marginBottom: '16px' }}></div>\r\n\r\n              {/* Grand Total */}\r\n              <div className=\"bill-row\" style={{ \r\n                display: 'flex', \r\n                justifyContent: 'space-between', \r\n                fontSize: '20px', \r\n                fontWeight: '900', \r\n                color: '#0096FF',\r\n                marginTop: '16px'\r\n              }}>\r\n                <span>Grand Total</span>\r\n                <span>{cart.getGrandTotal().toFixed(2)}</span>\r\n              </div>\r\n\r\n              {/* Customer Payment & Return Calculator */}\r\n              <div style={{\r\n                marginTop: '24px',\r\n                padding: '16px',\r\n                background: '#F8FAFC',\r\n                border: '1px solid #E2E8F0',\r\n                borderRadius: '12px'\r\n              }}>\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>\r\n                  <label style={{ fontSize: '14px', fontWeight: '700', color: '#475569' }}>Customer Paid Amount</label>\r\n                  <div style={{ position: 'relative' }}>\r\n                    <span style={{ position: 'absolute', left: '12px', top: '50%', transform: 'translateY(-50%)', color: '#64748B', fontWeight: 'bold' }}></span>\r\n                    <input\r\n                      type=\"number\"\r\n                      value={cart.customerPaid || ''}\r\n                      onChange={(e) => cart.setCustomerPaid(parseFloat(e.target.value) || 0)}\r\n                      placeholder=\"0.00\"\r\n                      style={{\r\n                        width: '120px',\r\n                        padding: '10px 12px 10px 28px',\r\n                        fontSize: '16px',\r\n                        fontWeight: '800',\r\n                        color: '#1E293B',\r\n                        textAlign: 'right',\r\n                        border: '2px solid #CBD5E1',\r\n                        borderRadius: '8px',\r\n                        outline: 'none',\r\n                        transition: 'border-color 0.2s',\r\n                        background: 'white'\r\n                      }}\r\n                      onFocus={(e) => e.target.style.borderColor = '#0096FF'}\r\n                      onBlur={(e) => e.target.style.borderColor = '#CBD5E1'}\r\n                    />\r\n                  </div>\r\n                </div>\r\n\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', paddingTop: '16px', borderTop: '1px dashed #CBD5E1' }}>\r\n                  <span style={{ fontSize: '14px', fontWeight: '700', color: '#475569' }}>Change to Return</span>\r\n                  <span style={{ fontSize: '24px', fontWeight: '900', color: (cart.customerPaid > cart.getGrandTotal()) ? '#10B981' : '#94A3B8' }}>\r\n                    {Math.max(0, (cart.customerPaid || 0) - cart.getGrandTotal()).toFixed(2)}\r\n                  </span>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Save & Send to KOT Button REMOVED as per request */}\r\n            </div>\r\n          </div>\r\n\r\n          {/* Split Payment Sheet - POSITIONED ABSOLUTE TO PANEL */}\r\n          <div className={`pos-bottom-sheet ${showSplitPaymentSheet ? 'active' : ''}`} style={{ paddingBottom: '120px' }}>\r\n            <div className=\"sheet-header\" style={{ padding: '12px 16px', background: '#0096FF', color: 'white', display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderRadius: '16px 16px 0 0' }}>\r\n              <h3 style={{ margin: 0, fontSize: '16px', display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                <Split size={18} /> Split Payment\r\n              </h3>\r\n              <button onClick={() => setShowSplitPaymentSheet(false)} style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer' }}><ChevronDown size={24} /></button>\r\n            </div>\r\n            <div className=\"sheet-body\" style={{ padding: '20px', background: 'white', flex: 1, overflowY: 'auto' }}>\r\n              <div style={{ background: '#F8FAFC', padding: '16px', borderRadius: '8px', marginBottom: '20px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', border: '1px solid #E2E8F0' }}>\r\n                 <span style={{ fontSize: '14px', color: '#475569', fontWeight: '600' }}>Grand Total</span>\r\n                 <span style={{ fontSize: '20px', color: '#0096FF', fontWeight: '800' }}>{cart.getGrandTotal().toFixed(2)}</span>\r\n              </div>\r\n\r\n              <div style={{ display: 'flex', flexDirection: 'column', gap: '12px', marginBottom: '20px' }}>\r\n                {splitPayments.map((split, index) => (\r\n                  <div key={index} style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>\r\n                    <select\r\n                      value={split.method}\r\n                      onChange={(e) => handleSplitPaymentChange(index, 'method', e.target.value)}\r\n                      style={{ flex: 1, padding: '10px', borderRadius: '6px', border: '1px solid #CBD5E1', outline: 'none', background: 'white', color: '#334155' }}\r\n                    >\r\n                      <option value=\"cash\">Cash</option>\r\n                      <option value=\"card\">Card</option>\r\n                      <option value=\"upi\">UPI</option>\r\n                      <option value=\"due\">Due</option>\r\n                    </select>\r\n                    <div style={{ position: 'relative', width: '140px' }}>\r\n                      <span style={{ position: 'absolute', left: '12px', top: '50%', transform: 'translateY(-50%)', color: '#64748B' }}></span>\r\n                      <input\r\n                        type=\"number\"\r\n                        value={split.amount}\r\n                        onChange={(e) => handleSplitPaymentChange(index, 'amount', parseFloat(e.target.value) || '')}\r\n                        placeholder=\"0.00\"\r\n                        style={{ width: '100%', padding: '10px 12px 10px 28px', borderRadius: '6px', border: '1px solid #CBD5E1', outline: 'none', textAlign: 'right' }}\r\n                      />\r\n                    </div>\r\n                    {splitPayments.length > 2 && (\r\n                      <button \r\n                        onClick={() => removeSplitPaymentMethod(index)}\r\n                        style={{ background: '#FEE2E2', border: 'none', width: '36px', height: '36px', borderRadius: '6px', display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', color: '#EF4444' }}\r\n                      >\r\n                        <X size={16} strokeWidth={3} />\r\n                      </button>\r\n                    )}\r\n                  </div>\r\n                ))}\r\n              </div>\r\n\r\n              <button\r\n                 onClick={addSplitPaymentMethod}\r\n                 style={{ width: '100%', padding: '10px', background: 'transparent', border: '1px dashed #0096FF', color: '#0096FF', borderRadius: '6px', fontWeight: '600', display: 'flex', justifyContent: 'center', alignItems: 'center', gap: '8px', cursor: 'pointer', marginBottom: '20px' }}\r\n              >\r\n                 <Plus size={16} /> Add Payment Method\r\n              </button>\r\n\r\n              {(() => {\r\n                const totalSplitPaid = splitPayments.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);\r\n                const remaining = cart.getGrandTotal() - totalSplitPaid;\r\n                return (\r\n                  <div style={{ paddingTop: '16px', borderTop: '1px dashed #CBD5E1' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '8px' }}>\r\n                       <span style={{ color: '#64748B' }}>Total Split Configured:</span>\r\n                       <span style={{ fontWeight: 'bold', color: '#334155' }}>{totalSplitPaid.toFixed(2)}</span>\r\n                    </div>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                       <span style={{ color: remaining > 0 ? '#EF4444' : '#10B981', fontWeight: 'bold' }}>\r\n                         {remaining > 0 ? 'Remaining to collect:' : 'Change to return:'}\r\n                       </span>\r\n                       <span style={{ fontSize: '18px', fontWeight: '800', color: remaining > 0 ? '#EF4444' : '#10B981' }}>\r\n                         {Math.abs(remaining).toFixed(2)}\r\n                       </span>\r\n                    </div>\r\n                    \r\n                    <button \r\n                      onClick={() => {\r\n                         cart.setPaymentDetails({ splits: splitPayments });\r\n                         setShowSplitPaymentSheet(false);\r\n                      }}\r\n                      style={{\r\n                         width: '100%',\r\n                         padding: '12px',\r\n                         background: '#0096FF',\r\n                         color: 'white',\r\n                         border: 'none',\r\n                         borderRadius: '8px',\r\n                         fontWeight: 'bold',\r\n                         fontSize: '16px',\r\n                         marginTop: '20px',\r\n                         cursor: 'pointer'\r\n                      }}\r\n                    >\r\n                       Confirm Split\r\n                    </button>\r\n                  </div>\r\n                );\r\n              })()}\r\n            </div>\r\n          </div>\r\n\r\n          {/* 5. Fixed Footer Controls - Z-INDEX 1000 to STAY ON TOP */}\r\n          <div className=\"pos-fixed-footer\" style={{ position: 'absolute', bottom: 0, left: 0, right: 0, height: '130px', zIndex: 1000, background: 'white', boxShadow: '0 -2px 10px rgba(0,0,0,0.05)', display: 'flex', flexDirection: 'column', justifyContent: 'flex-end' }}>\r\n            {/* Payment Modes Grid */}\r\n            <div className=\"pos-payment-modes\">\r\n              {[\r\n                { id: 'cash', label: 'Cash', icon: Banknote },\r\n                { id: 'card', label: 'Card', icon: CreditCard },\r\n                { id: 'upi', label: 'UPI', icon: Smartphone },\r\n                { id: 'due', label: 'Due', icon: Clock },\r\n                { id: 'mixed', label: 'Split', icon: Split }\r\n              ].map(mode => (\r\n                <button\r\n                  key={mode.id}\r\n                  className={`payment-mode-btn ${cart.paymentMethod === mode.id ? 'active' : ''}`}\r\n                  onClick={() => {\r\n                    cart.setPaymentMethod(mode.id);\r\n                    if (mode.id === 'mixed') {\r\n                      setShowSplitPaymentSheet(true);\r\n                    }\r\n                  }}\r\n                >\r\n                  <mode.icon className=\"payment-mode-icon\" size={20} />\r\n                  <span className=\"payment-mode-label\">{mode.label}</span>\r\n                </button>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Action Bar */}\r\n            <div className=\"pos-action-bar\">\r\n              <button className=\"pos-action-btn btn-save\" onClick={handleCheckout}>\r\n                <CheckCircle size={24} style={{ marginBottom: '4px', strokeWidth: 2.5 }} />\r\n                Save\r\n              </button>\r\n              <button className=\"pos-action-btn btn-print\" onClick={handleSaveAndPrint}>\r\n                <Printer size={22} style={{ marginBottom: '4px' }} />\r\n                Print\r\n              </button>\r\n              <button className=\"pos-action-btn btn-kot\" onClick={handleKOTOnly}>\r\n                <ChefHat size={22} style={{ marginBottom: '4px' }} />\r\n                KOT\r\n              </button>\r\n              <button className=\"pos-action-btn btn-kot-print\" onClick={handleKOTAndPrint}>\r\n                <Printer size={22} style={{ marginBottom: '4px' }} />\r\n                KOT+Print\r\n              </button>\r\n              <button className=\"pos-action-btn btn-hold\" onClick={handleHoldOrder} style={{ position: 'relative' }}>\r\n                <PauseCircle size={22} style={{ marginBottom: '4px' }} />\r\n                Hold\r\n                {cart.heldOrders.length > 0 && (\r\n                  <span style={{\r\n                    position: 'absolute',\r\n                    top: '-5px',\r\n                    right: '-5px',\r\n                    background: '#D32F2F',\r\n                    color: 'white',\r\n                    borderRadius: '50%',\r\n                    width: '20px',\r\n                    height: '20px',\r\n                    fontSize: '12px',\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'center',\r\n                    border: '2px solid white'\r\n                  }}>\r\n                    {cart.heldOrders.length}\r\n                  </span>\r\n                )}\r\n              </button>\r\n              <button className=\"pos-action-btn btn-secondary\" onClick={() => setShowHeldOrders(true)} title=\"View Held Orders\">\r\n                <ClipboardList size={18} style={{ marginBottom: '4px' }} />\r\n                Recall\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n\r\n        </div>\r\n      </div>\r\n\r\n\r\n\r\n      {/* Modals */}\r\n      {showAddonModal && selectedItemForAddon && (\r\n        <AddonSelectionModal\r\n          item={selectedItemForAddon}\r\n          masterAddons={masterAddons}\r\n          globalAddons={globalAddons}\r\n          onClose={() => {\r\n            setShowAddonModal(false);\r\n            setSelectedItemForAddon(null);\r\n          }}\r\n          onAddToCart={(item, quantity, notes, variant, addons) => {\r\n            cart.addItem(item, quantity, notes, variant, addons);\r\n            setShowAddonModal(false);\r\n            setSelectedItemForAddon(null);\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {showHeldOrders && (\r\n        <HeldOrdersModal\r\n          orders={cart.heldOrders}\r\n          onClose={() => setShowHeldOrders(false)}\r\n          onResume={handleResumeOrder}\r\n          onDelete={handleDeleteHeldOrder}\r\n        />\r\n      )}\r\n\r\n      {showPayment && (\r\n        <PaymentModal\r\n          total={cart.getGrandTotal()}\r\n          onClose={() => setShowPayment(false)}\r\n          onSuccess={() => {\r\n            setShowPayment(false);\r\n            cart.clearCart();\r\n            loadData();\r\n          }}\r\n          userId={user?.id}\r\n        />\r\n      )}\r\n\r\n      {/* Discount Modal */}\r\n      {showDiscountModal && (\r\n        <DiscountModal\r\n          onClose={() => setShowDiscountModal(false)}\r\n          onApply={(type, value, reason) => {\r\n            cart.applyDiscount(type, value, reason);\r\n            setShowDiscountModal(false);\r\n          }}\r\n          onClear={() => {\r\n            cart.clearDiscount();\r\n            setShowDiscountModal(false);\r\n          }}\r\n          currentType={cart.discountType}\r\n          currentValue={cart.discountValue}\r\n          subtotal={cart.getSubtotal()}\r\n        />\r\n      )}\r\n\r\n\r\n      {/* Strict Design: Customer History Drawer */}\r\n      <div className={`pos-drawer-overlay ${showHistoryDrawer ? 'active' : ''}`} onClick={() => setShowHistoryDrawer(false)}></div>\r\n      <div className={`pos-right-drawer ${showHistoryDrawer ? 'active' : ''}`}>\r\n        <div className=\"drawer-header\" style={{ padding: '16px', borderBottom: '1px solid #eee', display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: '#37474F', color: 'white' }}>\r\n          <h3 style={{ margin: 0, fontSize: '16px' }}>Customer History</h3>\r\n          <button onClick={() => setShowHistoryDrawer(false)} style={{ background: 'none', border: 'none', color: 'white', cursor: 'pointer' }}><X size={20} /></button>\r\n        </div>\r\n        <div className=\"drawer-body\" style={{ padding: '16px' }}>\r\n          <div className=\"history-search\">\r\n            <input type=\"text\" placeholder=\"Search orders...\" style={{ width: '100%', padding: '8px', marginBottom: '16px', border: '1px solid #ddd', borderRadius: '4px' }} />\r\n          </div>\r\n          <div className=\"history-list\">\r\n            <p style={{ textAlign: 'center', color: '#999', marginTop: '20px' }}>\r\n              <Clock size={32} style={{ marginBottom: '8px', opacity: 0.5 }} /><br />\r\n              No history found for {cart.customerPhone || 'this customer'}\r\n            </p>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Strict Design: Bill Breakdown Sheet - Moved to Cart Panel */ }\r\n\r\n      {/* Main Sidebar Overlay */}\r\n      <MainSidebar isOpen={showMainSidebar} onClose={() => setShowMainSidebar(false)} />\r\n\r\n      {/* Confirmation Modal */}\r\n      <ConfirmOrderModal \r\n        isOpen={showConfirmModal}\r\n        onClose={() => setShowConfirmModal(false)}\r\n        onConfirm={pendingOrderAction}\r\n        total={cart.getGrandTotal()}\r\n        itemsCount={cart.items.reduce((acc, item) => acc + item.quantity, 0)}\r\n      />\r\n\r\n      <CustomAlert \r\n        isOpen={alertState.isOpen}\r\n        message={alertState.message}\r\n        type={alertState.type}\r\n        onClose={closeAlert}\r\n        onConfirm={alertState.onConfirm}\r\n      />\r\n\r\n    </div>\r\n  );\r\n};\r\n\r\n// Addon Selection Modal Component - Redesigned to match reference\r\nconst AddonSelectionModal = ({ item, onClose, onAddToCart, masterAddons = [], globalAddons = [] }) => {\r\n  const [quantity, setQuantity] = useState(1);\r\n  const parsedVariants = item.parsedVariants || [];\r\n  const parsedAddons = item.parsedAddons || [];\r\n  const [selectedVariant, setSelectedVariant] = useState(parsedVariants.length > 0 ? parsedVariants[0] : null);\r\n  const [selectedAddons, setSelectedAddons] = useState([]);\r\n  const [addonSearch, setAddonSearch] = useState('');\r\n  const [specialInstructions, setSpecialInstructions] = useState('');\r\n\r\n  // activeItemDiscounts was passed along as part of `item` object.\r\n  const activeItemDiscounts = item.activeItemDiscounts || [];\r\n\r\n  // Resolve master addon groups assigned directly to the item OR selected variant\r\n  const getAssignedMasterAddons = () => {\r\n    let idsToFetch = [];\r\n    \r\n    // 1. From item (new schema)\r\n    if (item.master_addon_ids) {\r\n      try {\r\n        const parsed = typeof item.master_addon_ids === 'string' ? JSON.parse(item.master_addon_ids) : item.master_addon_ids;\r\n        if (Array.isArray(parsed)) idsToFetch = [...idsToFetch, ...parsed];\r\n      } catch (e) {\r\n        console.error('Error parsing item master_addon_ids', e);\r\n      }\r\n    }\r\n    \r\n    // 2. From variant (legacy fallback, as variants used to have a single master_addon_id string)\r\n    if (selectedVariant?.master_addon_id) {\r\n       if (!idsToFetch.includes(selectedVariant.master_addon_id)) {\r\n           idsToFetch.push(selectedVariant.master_addon_id);\r\n       }\r\n    }\r\n\r\n    return masterAddons.filter(ma => idsToFetch.includes(ma.id)).map(ma => {\r\n       // Parse global addon IDs inside the group\r\n       let addonIds = [];\r\n       try {\r\n         addonIds = typeof ma.addon_ids === 'string' ? JSON.parse(ma.addon_ids) : (ma.addon_ids || []);\r\n       } catch (e) {}\r\n       \r\n       const groupAddons = globalAddons.filter(ga => addonIds.includes(ga.id));\r\n       return { ...ma, groupAddons };\r\n    }).filter(ma => ma.groupAddons.length > 0);\r\n  };\r\n\r\n  const assignedGroups = getAssignedMasterAddons();\r\n  const itemLevelAddons = parsedAddons;\r\n\r\n  const calculateTotal = () => {\r\n    let basePrice = item.price;\r\n    let appliedDiscount = null;\r\n\r\n    if (selectedVariant) {\r\n      basePrice = parseFloat(selectedVariant.price);\r\n      // Check if there's a variant-specific discount for this item\r\n      const variantDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && d.variant_name === selectedVariant.name);\r\n      if (variantDiscount) {\r\n        appliedDiscount = variantDiscount;\r\n      } else {\r\n        // Fallback to item-level discount if no variant-specific discount\r\n        appliedDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && (!d.variant_name || d.variant_name === ''));\r\n      }\r\n    } else {\r\n      // Non-variant item discount logic\r\n      appliedDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && (!d.variant_name || d.variant_name === ''));\r\n    }\r\n\r\n    // Apply the discount to the base price before addons\r\n    if (appliedDiscount) {\r\n       let discountAmount = 0;\r\n       if (appliedDiscount.discount_type === 'percentage') {\r\n         discountAmount = basePrice * (appliedDiscount.discount_value / 100);\r\n       } else if (appliedDiscount.discount_type === 'flat') {\r\n         discountAmount = appliedDiscount.discount_value;\r\n       }\r\n       basePrice -= discountAmount;\r\n       if (basePrice < 0) basePrice = 0;\r\n    }\r\n\r\n    let total = basePrice;\r\n    selectedAddons.forEach(addon => {\r\n      total += parseFloat(addon.price) * (addon.quantity || 1);\r\n    });\r\n    return total * quantity;\r\n  };\r\n\r\n  const toggleAddonForGroup = (addon, group) => {\r\n    const isSingle = group.selection_type === 'single';\r\n\r\n    if (isSingle) {\r\n      // For single select, remove all other selected addons from THIS group\r\n      const otherGroupAddonIds = group.groupAddons.filter(ga => ga.id !== addon.id).map(ga => ga.id);\r\n      let newSelected = selectedAddons.filter(sa => !otherGroupAddonIds.includes(sa.id));\r\n      \r\n      const existing = newSelected.find(a => a.id === addon.id);\r\n      // Toggle off if already selected, otherwise add\r\n      if (existing) {\r\n         setSelectedAddons(newSelected.filter(a => a.id !== addon.id));\r\n      } else {\r\n         setSelectedAddons([...newSelected, { ...addon, quantity: 1, _groupId: group.id }]);\r\n      }\r\n    } else {\r\n      // Multi select - allow multiple quantity\r\n      toggleAddon(addon, group.id);\r\n    }\r\n  };\r\n\r\n  const toggleAddon = (addon, groupId = null) => {\r\n    const existing = selectedAddons.find(a => a.name === addon.name && a._groupId === groupId);\r\n    if (existing) {\r\n      setSelectedAddons(selectedAddons.map(a => \r\n        (a.name === addon.name && a._groupId === groupId) ? { ...a, quantity: (a.quantity || 1) + 1 } : a\r\n      ));\r\n    } else {\r\n      setSelectedAddons([...selectedAddons, { ...addon, quantity: 1, _groupId: groupId }]);\r\n    }\r\n  };\r\n\r\n  const decreaseAddon = (e, addon, groupId = null) => {\r\n    e.stopPropagation();\r\n    const existing = selectedAddons.find(a => a.name === addon.name && a._groupId === groupId);\r\n    if (existing) {\r\n      if (existing.quantity > 1) {\r\n        setSelectedAddons(selectedAddons.map(a => \r\n          (a.name === addon.name && a._groupId === groupId) ? { ...a, quantity: a.quantity - 1 } : a\r\n        ));\r\n      } else {\r\n        setSelectedAddons(selectedAddons.filter(a => !(a.name === addon.name && a._groupId === groupId)));\r\n      }\r\n    }\r\n  };\r\n\r\n  const allAvailableAddons = [...itemLevelAddons, ...assignedGroups.flatMap(g => g.groupAddons || [])];\r\n\r\n  // Calculate if all mandatory groups are satisfied\r\n  const isSatisfied = () => {\r\n    for (const group of assignedGroups) {\r\n      if (group.is_mandatory) {\r\n         const hasSelection = selectedAddons.some(sa => sa._groupId === group.id);\r\n         if (!hasSelection) return false;\r\n      }\r\n    }\r\n    return true;\r\n  };\r\n\r\n  // Sync selected addons when variant changes\r\n  useEffect(() => {\r\n    setSelectedAddons([]);\r\n  }, [selectedVariant]);\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose} style={{ zIndex: 1050 }}>\r\n      <div className=\"modal addon-modal\" onClick={(e) => e.stopPropagation()} style={{ maxWidth: '1400px', width: '95%', maxHeight: '90vh', height: 'auto' }}>\r\n        {/* Modal Header */}\r\n        <div className=\"addon-modal-header\">\r\n          <div>\r\n            <span className=\"addon-modal-title\">{item.name}</span>\r\n            <span className=\"addon-modal-price\">\r\n              {(() => {\r\n                let basePrice = item.price;\r\n                let appliedDiscount = null;\r\n                if (selectedVariant) {\r\n                  basePrice = parseFloat(selectedVariant.price);\r\n                  appliedDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && d.variant_name === selectedVariant.name) || activeItemDiscounts.find(d => d.menu_item_id === item.id && (!d.variant_name || d.variant_name === ''));\r\n                } else {\r\n                  appliedDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && (!d.variant_name || d.variant_name === ''));\r\n                }\r\n                let displayPrice = basePrice;\r\n                if (appliedDiscount) {\r\n                   if (appliedDiscount.discount_type === 'percentage') displayPrice -= displayPrice * (appliedDiscount.discount_value / 100);\r\n                   else displayPrice -= appliedDiscount.discount_value;\r\n                   if (displayPrice < 0) displayPrice = 0;\r\n                }\r\n                return (\r\n                  <>\r\n                    <span style={{ margin: '0 12px', color: '#B0BEC5', fontSize: '22px', fontWeight: '300' }}>|</span>\r\n                    {appliedDiscount && <span style={{ textDecoration: 'line-through', color: '#90A4AE', marginRight: '8px', fontSize: '16px', fontWeight: '500' }}>{basePrice.toFixed(2)}</span>}\r\n                    <span style={{ color: '#0096FF', fontSize: '22px', fontWeight: '800' }}>{displayPrice.toFixed(2)}</span>\r\n                  </>\r\n                );\r\n              })()}\r\n            </span>\r\n          </div>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}>\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Variant Tabs at Top */}\r\n        {parsedVariants.length > 0 && (\r\n          <div className=\"addon-variant-tabs\">\r\n            {parsedVariants.map((variant, idx) => {\r\n              const variantDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && d.variant_name === variant.name);\r\n              const itemDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && (!d.variant_name || d.variant_name === ''));\r\n              let appliedDiscount = variantDiscount || itemDiscount;\r\n\r\n              let displayPrice = parseFloat(variant.price);\r\n              if (appliedDiscount) {\r\n                 if (appliedDiscount.discount_type === 'percentage') {\r\n                   displayPrice -= displayPrice * (appliedDiscount.discount_value / 100);\r\n                 } else {\r\n                   displayPrice -= appliedDiscount.discount_value;\r\n                 }\r\n                 if (displayPrice < 0) displayPrice = 0;\r\n              }\r\n\r\n              return (\r\n              <button\r\n                key={idx}\r\n                className={`addon-variant-tab ${selectedVariant === variant ? 'active' : ''}`}\r\n                onClick={() => setSelectedVariant(variant)}\r\n                style={{ position: 'relative' }}\r\n              >\r\n                {appliedDiscount && (\r\n                  <div style={{ position: 'absolute', top: '-10px', right: '-10px', background: '#FFF3E0', color: '#E65100', border: '1px solid #FFE0B2', fontSize: '11px', padding: '2px 8px', borderRadius: '12px', fontWeight: 'bold', zIndex: 1 }}>\r\n                    {appliedDiscount.discount_type === 'percentage' ? `${appliedDiscount.discount_value}% OFF` : `${appliedDiscount.discount_value} OFF`}\r\n                  </div>\r\n                )}\r\n                <span className=\"addon-variant-tab-name\">{variant.name}</span>\r\n                <span className=\"addon-variant-tab-price\">\r\n                  {appliedDiscount ? (\r\n                    <>\r\n                      <span style={{ textDecoration: 'line-through', color: '#90A4AE', marginRight: '4px', fontSize: '12px' }}>{parseFloat(variant.price).toFixed(0)}</span>\r\n                      <span style={{ color: selectedVariant === variant ? '#0096FF' : '#37474F' }}>{displayPrice.toFixed(0)}</span>\r\n                    </>\r\n                  ) : (\r\n                    <>{parseFloat(variant.price).toFixed(0)}</>\r\n                  )}\r\n                </span>\r\n              </button>\r\n            )})}\r\n          </div>\r\n        )}\r\n\r\n        {/* Addon Search */}\r\n        {allAvailableAddons.length > 0 && (\r\n          <div className=\"addon-search-box\">\r\n            <div style={{ position: 'relative' }}>\r\n              <Search size={16} style={{ position: 'absolute', left: '12px', top: '50%', transform: 'translateY(-50%)', color: '#90A4AE' }} />\r\n              <input\r\n                type=\"text\"\r\n                className=\"addon-search-input\"\r\n                placeholder=\"Search addon item...\"\r\n                value={addonSearch}\r\n                onChange={(e) => setAddonSearch(e.target.value)}\r\n              />\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        {/* Addon Groups */}\r\n        <div className=\"addon-groups\">\r\n          \r\n          {/* Render Master Add-on Groups */}\r\n          {assignedGroups.map(group => {\r\n            const isSingle = group.selection_type === 'single';\r\n\r\n            return (\r\n              <div key={group.id} className=\"addon-group\">\r\n                <div className=\"addon-group-header\">\r\n                  <span className=\"addon-group-name\">\r\n                    <span style={{ width: '4px', height: '16px', background: '#FF9800', borderRadius: '4px', display: 'inline-block' }}></span>\r\n                    {group.name}\r\n                  </span>\r\n                  <span className=\"addon-group-info\" style={{ fontSize: '12px', color: '#78909C' }}>\r\n                    {isSingle ? 'Choose 1 option' : 'Click to add/increase quantity'}\r\n                  </span>\r\n                </div>\r\n                \r\n                <div className=\"addon-grid\" style={{ gridTemplateColumns: 'repeat(auto-fill, minmax(180px, 1fr))' }}>\r\n                  {group.groupAddons\r\n                    .filter(a => a.name.toLowerCase().includes(addonSearch.toLowerCase()))\r\n                    .map((addon) => {\r\n                    const selected = selectedAddons.find(a => a.id === addon.id && a._groupId === group.id);\r\n                    const isSelected = !!selected;\r\n                    const qty = selected?.quantity || 0;\r\n                    \r\n                    return (\r\n                      <div\r\n                        key={addon.id}\r\n                        className={`addon-item ${addon.type !== 'veg' ? 'nonveg' : ''} ${isSelected ? 'selected' : ''}`}\r\n                        onClick={() => toggleAddonForGroup(addon, group)}\r\n                        style={{ position: 'relative', overflow: 'hidden' }}\r\n                      >\r\n                        <span className=\"addon-item-name\">{addon.name}</span>\r\n                        {parseFloat(addon.price) > 0 && <span className=\"addon-item-price\">{parseFloat(addon.price).toFixed(0)}</span>}\r\n                        \r\n                        {isSelected && (\r\n                          <div style={{ \r\n                            position: 'absolute', \r\n                            top: 0, \r\n                            right: 0, \r\n                            background: '#E49B0F', \r\n                            color: 'white', \r\n                            padding: '4px 10px', \r\n                            borderRadius: '0 0 0 12px',\r\n                            fontSize: '15px',\r\n                            fontWeight: 'bold',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            gap: '6px'\r\n                          }}>\r\n                            {qty >= 1 && (\r\n                              <div \r\n                                onClick={(e) => decreaseAddon(e, addon, group.id)}\r\n                                style={{ \r\n                                  cursor: 'pointer',\r\n                                  background: 'rgba(0,0,0,0.2)',\r\n                                  borderRadius: '50%',\r\n                                  width: '22px',\r\n                                  height: '22px',\r\n                                  display: 'flex',\r\n                                  alignItems: 'center',\r\n                                  justifyContent: 'center',\r\n                                  marginRight: '2px',\r\n                                  transition: 'background 0.2s',\r\n                                }}\r\n                                onMouseOver={e => e.currentTarget.style.background = 'rgba(0,0,0,0.4)'}\r\n                                onMouseOut={e => e.currentTarget.style.background = 'rgba(0,0,0,0.2)'}\r\n                              >\r\n                                <Minus size={14} strokeWidth={3} />\r\n                              </div>\r\n                            )}\r\n                            <span style={{ fontSize: '14px', marginTop: '1px' }}>x{qty}</span>\r\n                          </div>\r\n                        )}\r\n                      </div>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            );\r\n          })}\r\n\r\n          {/* Render Item-Level Addons (Inline) */}\r\n          {itemLevelAddons.length > 0 && (\r\n            <div className=\"addon-group\">\r\n              <div className=\"addon-group-header\">\r\n                <span className=\"addon-group-name\">\r\n                  <span style={{ width: '4px', height: '16px', background: '#FF9800', borderRadius: '4px', display: 'inline-block' }}></span>\r\n                  Extra Add-ons\r\n                </span>\r\n                <span className=\"addon-group-info\" style={{ fontSize: '12px', color: '#78909C' }}>\r\n                  Click to add/increase quantity\r\n                </span>\r\n              </div>\r\n              \r\n              <div className=\"addon-grid\" style={{ gridTemplateColumns: 'repeat(auto-fill, minmax(180px, 1fr))' }}>\r\n                {itemLevelAddons\r\n                  .filter(a => a.name.toLowerCase().includes(addonSearch.toLowerCase()))\r\n                  .map((addon, idx) => {\r\n                  const selected = selectedAddons.find(a => a.name === addon.name && a._groupId === null);\r\n                  const isSelected = !!selected;\r\n                  const qty = selected?.quantity || 0;\r\n\r\n                  return (\r\n                    <div\r\n                      key={idx}\r\n                      className={`addon-item ${addon.type !== 'veg' ? 'nonveg' : ''} ${isSelected ? 'selected' : ''}`}\r\n                      onClick={() => toggleAddon(addon)}\r\n                      style={{ position: 'relative', overflow: 'hidden' }}\r\n                    >\r\n                      <span className=\"addon-item-name\">{addon.name}</span>\r\n                      {parseFloat(addon.price) > 0 && <span className=\"addon-item-price\">{parseFloat(addon.price).toFixed(0)}</span>}\r\n\r\n                      {isSelected && (\r\n                        <div style={{ \r\n                          position: 'absolute', \r\n                          top: 0, \r\n                          right: 0, \r\n                          background: '#E49B0F', \r\n                          color: 'white', \r\n                          padding: '4px 10px', \r\n                          borderRadius: '0 0 0 12px',\r\n                          fontSize: '15px',\r\n                          fontWeight: 'bold',\r\n                          display: 'flex',\r\n                          alignItems: 'center',\r\n                          gap: '6px'\r\n                        }}>\r\n                          {qty >= 1 && (\r\n                            <div \r\n                              onClick={(e) => decreaseAddon(e, addon, null)}\r\n                              style={{ \r\n                                cursor: 'pointer',\r\n                                background: 'rgba(0,0,0,0.2)',\r\n                                borderRadius: '50%',\r\n                                width: '22px',\r\n                                height: '22px',\r\n                                display: 'flex',\r\n                                alignItems: 'center',\r\n                                justifyContent: 'center',\r\n                                marginRight: '2px',\r\n                                transition: 'background 0.2s',\r\n                              }}\r\n                              onMouseOver={e => e.currentTarget.style.background = 'rgba(0,0,0,0.4)'}\r\n                              onMouseOut={e => e.currentTarget.style.background = 'rgba(0,0,0,0.2)'}\r\n                            >\r\n                              <Minus size={14} strokeWidth={3} />\r\n                            </div>\r\n                          )}\r\n                          <span style={{ fontSize: '14px', marginTop: '1px' }}>x{qty}</span>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  );\r\n                })}\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Empty state if no addons */}\r\n          {assignedGroups.length === 0 && itemLevelAddons.length === 0 && (\r\n            <div style={{ textAlign: 'center', padding: '40px', color: 'var(--gray-500)' }}>\r\n              <p>No add-ons available for this item</p>\r\n            </div>\r\n          )}\r\n        </div>\r\n\r\n        {/* Special Instructions */}\r\n        <div style={{ padding: '12px 16px', borderTop: '1px solid #ECEFF1' }}>\r\n          <label style={{ fontWeight: 600, fontSize: '13px', color: '#546E7A', display: 'block', marginBottom: '6px' }}>\r\n             Special Instructions\r\n          </label>\r\n          <textarea\r\n            placeholder=\"e.g. Less sugar, Extra spicy, No onions...\"\r\n            value={specialInstructions}\r\n            onChange={(e) => setSpecialInstructions(e.target.value)}\r\n            style={{ width: '100%', border: '1px solid #CFD8DC', borderRadius: '6px', padding: '8px 10px', fontSize: '13px', resize: 'vertical', minHeight: '50px', maxHeight: '80px', outline: 'none', fontFamily: 'inherit', color: '#37474F' }}\r\n          />\r\n        </div>\r\n\r\n        {/* Action Buttons */}\r\n        <div className=\"addon-modal-footer\" style={{ display: 'flex', alignItems: 'center', gap: '16px', padding: '16px', borderTop: '1px solid #ECEFF1' }}>\r\n          \r\n          <button\r\n            className=\"btn btn-ghost\"\r\n            style={{ padding: '12px 20px', borderRadius: '8px', border: '1px solid #CFD8DC', color: '#546E7A', fontWeight: 'bold' }}\r\n            onClick={onClose}\r\n          >\r\n            Cancel\r\n          </button>\r\n          \r\n          <div className=\"addon-quantity-control\" style={{ display: 'flex', alignItems: 'center', background: '#F8FAFC', borderRadius: '8px', border: '1px solid #E2E8F0', padding: '4px' }}>\r\n            <button \r\n              className=\"btn btn-icon\" \r\n              style={{ width: '36px', height: '36px', borderRadius: '6px', background: 'white', color: '#334155', border: '1px solid #CBD5E1', display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer' }} \r\n              onClick={() => setQuantity(Math.max(1, quantity - 1))}\r\n            >\r\n              <Minus size={18} strokeWidth={2.5} />\r\n            </button>\r\n            <span className=\"qty-display\" style={{ width: '44px', textAlign: 'center', fontWeight: 'bold', fontSize: '16px', color: '#1E293B' }}>{quantity}</span>\r\n            <button \r\n              className=\"btn btn-icon\" \r\n              style={{ width: '36px', height: '36px', borderRadius: '6px', background: 'white', color: '#334155', border: '1px solid #CBD5E1', display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer' }} \r\n              onClick={() => setQuantity(quantity + 1)}\r\n            >\r\n              <Plus size={18} strokeWidth={2.5} />\r\n            </button>\r\n          </div>\r\n\r\n          <button\r\n            className=\"btn btn-primary addon-add-btn\"\r\n            disabled={!isSatisfied()}\r\n            style={{ flex: 1, padding: '14px', borderRadius: '8px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', fontSize: '16px', fontWeight: 'bold', opacity: isSatisfied() ? 1 : 0.6 }}\r\n            onClick={() => {\r\n              if (!isSatisfied()) return;\r\n              \r\n              // Flatten addons for cart state\r\n              const flattenedAddons = selectedAddons.flatMap(addon => {\r\n                return Array(addon.quantity).fill({ ...addon });\r\n              });\r\n              \r\n              let appliedDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && (!d.variant_name || d.variant_name === ''));\r\n              if (selectedVariant) {\r\n                const variantDiscount = activeItemDiscounts.find(d => d.menu_item_id === item.id && d.variant_name === selectedVariant.name);\r\n                if (variantDiscount) appliedDiscount = variantDiscount;\r\n              }\r\n\r\n              onAddToCart({ ...item, appliedDiscount }, quantity, specialInstructions, selectedVariant, flattenedAddons);\r\n              onClose();\r\n            }}\r\n          >\r\n            <span>{isSatisfied() ? 'Add to Cart' : 'Select Required Options'}</span>\r\n            <span className=\"addon-add-btn-price\" style={{ background: 'rgba(255,255,255,0.2)', padding: '4px 8px', borderRadius: '6px' }}>{calculateTotal().toFixed(2)}</span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// HeldOrdersModal was defined here but is now defined at the end of the file. Removing duplicate.\r\n\r\n\r\n\r\n// Bill Preview Modal Component\r\nconst BillPreviewModal = ({ order, onClose, onPrint }) => {\r\n  if (!order) return null;\r\n\r\n  const formatDate = (dateStr) => {\r\n    return new Date(dateStr).toLocaleString('en-IN', {\r\n      day: '2-digit',\r\n      month: 'short',\r\n      year: 'numeric',\r\n      hour: '2-digit',\r\n      minute: '2-digit'\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose} style={{ zIndex: 1001 }}>\r\n      <div className=\"modal modal-sm\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <h3 className=\"modal-title\">Bill Preview</h3>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}>\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"modal-body\" style={{ padding: 0 }}>\r\n          {/* Bill Content */}\r\n          <div style={{\r\n            background: '#fafafa',\r\n            padding: 'var(--spacing-4)',\r\n            border: '1px dashed var(--gray-300)',\r\n            margin: 'var(--spacing-3)',\r\n            borderRadius: 'var(--radius-md)',\r\n            fontFamily: 'monospace' // Restore monospace for receipt look\r\n          }}>\r\n            {/* Header */}\r\n            <div style={{ textAlign: 'center', marginBottom: 'var(--spacing-3)' }}>\r\n              <h3 style={{ fontSize: 'var(--font-size-lg)', marginBottom: '4px' }}>\r\n                Restaurant POS\r\n              </h3>\r\n              <div style={{ fontSize: 'var(--font-size-xs)', color: 'var(--gray-600)' }}>\r\n                {formatDate(order.created_at)}\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{\r\n              borderTop: '1px dashed var(--gray-400)',\r\n              borderBottom: '1px dashed var(--gray-400)',\r\n              padding: 'var(--spacing-2) 0',\r\n              marginBottom: 'var(--spacing-2)'\r\n            }}>\r\n              <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 'var(--font-size-sm)' }}>\r\n                <span>Bill No:</span>\r\n                <strong>#{order.order_number}</strong>\r\n              </div>\r\n              {order.table_number && (\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 'var(--font-size-sm)' }}>\r\n                  <span>Table:</span>\r\n                  <span>{order.table_number}</span>\r\n                </div>\r\n              )}\r\n              <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 'var(--font-size-sm)' }}>\r\n                <span>Type:</span>\r\n                <span>{order.order_type?.replace('_', ' ').toUpperCase()}</span>\r\n              </div>\r\n              {order.customer_name && (\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 'var(--font-size-sm)' }}>\r\n                  <span>Customer:</span>\r\n                  <span>{order.customer_name}</span>\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            {/* Items */}\r\n            <div style={{ marginBottom: 'var(--spacing-2)' }}>\r\n              <div style={{\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                fontWeight: 600,\r\n                fontSize: 'var(--font-size-xs)',\r\n                borderBottom: '1px solid var(--gray-300)',\r\n                paddingBottom: '4px',\r\n                marginBottom: '4px'\r\n              }}>\r\n                <span>Item</span>\r\n                <span>Qty</span>\r\n                <span>Amount</span>\r\n              </div>\r\n              {order.items?.map((item, idx) => (\r\n                <div key={idx}>\r\n                  <div style={{\r\n                    display: 'flex',\r\n                    justifyContent: 'space-between',\r\n                    fontSize: 'var(--font-size-sm)',\r\n                    padding: '2px 0'\r\n                  }}>\r\n                    <span style={{ flex: 2 }}>{item.item_name}</span>\r\n                    <span style={{ flex: 0.5, textAlign: 'center' }}>{item.quantity}</span>\r\n                    <span style={{ flex: 1, textAlign: 'right' }}>{(item.item_total || 0).toFixed(2)}</span>\r\n                  </div>\r\n                  {item.special_instructions && (\r\n                    <div style={{ fontSize: '11px', color: '#E65100', fontStyle: 'italic', paddingLeft: '4px', marginBottom: '2px' }}>\r\n                       {item.special_instructions}\r\n                    </div>\r\n                  )}\r\n                </div>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Totals */}\r\n            <div style={{\r\n              borderTop: '1px dashed var(--gray-400)',\r\n              paddingTop: 'var(--spacing-2)',\r\n              fontSize: 'var(--font-size-sm)'\r\n            }}>\r\n              <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                <span>Subtotal:</span>\r\n                <span>{(order.subtotal || 0).toFixed(2)}</span>\r\n              </div>\r\n              {order.tax_amount > 0 && (\r\n                <div style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                  <span>Tax:</span>\r\n                  <span>{(order.tax_amount || 0).toFixed(2)}</span>\r\n                </div>\r\n              )}\r\n              {order.discount_amount > 0 && (\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', color: 'var(--success-600)' }}>\r\n                  <span>Discount:</span>\r\n                  <span>-{(order.discount_amount || 0).toFixed(2)}</span>\r\n                </div>\r\n              )}\r\n              <div style={{\r\n                display: 'flex',\r\n                justifyContent: 'space-between',\r\n                fontWeight: 700,\r\n                fontSize: 'var(--font-size-lg)',\r\n                marginTop: 'var(--spacing-2)',\r\n                paddingTop: 'var(--spacing-2)',\r\n                borderTop: '2px solid var(--gray-900)'\r\n              }}>\r\n                <span>TOTAL:</span>\r\n                <span>{(order.total_amount || 0).toFixed(2)}</span>\r\n              </div>\r\n            </div>\r\n\r\n            {/* Payment Info */}\r\n            {order.payment_method && (\r\n              <div style={{\r\n                textAlign: 'center',\r\n                marginTop: 'var(--spacing-3)',\r\n                fontSize: 'var(--font-size-sm)',\r\n                color: 'var(--gray-600)'\r\n              }}>\r\n                Paid via {order.payment_method.toUpperCase()}\r\n              </div>\r\n            )}\r\n\r\n            {/* Footer */}\r\n            <div style={{\r\n              textAlign: 'center',\r\n              marginTop: 'var(--spacing-3)',\r\n              fontSize: 'var(--font-size-xs)',\r\n              color: 'var(--gray-500)'\r\n            }}>\r\n              Thank you for dining with us!\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"modal-footer\" style={{ display: 'flex', gap: 'var(--spacing-2)' }}>\r\n          <button className=\"btn btn-secondary\" style={{ flex: 1 }} onClick={onClose}>\r\n            Close\r\n          </button>\r\n          <button className=\"btn btn-primary\" style={{ flex: 1 }} onClick={onPrint}>\r\n            <Printer size={18} />\r\n            Print Bill\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// Payment Modal Component with Customer Info Step\r\nconst PaymentModal = ({ total, onClose, onSuccess, userId }) => {\r\n  const [step, setStep] = useState('customer'); // 'customer', 'payment', or 'cash'\r\n  const [customerName, setCustomerName] = useState('');\r\n  const [customerPhone, setCustomerPhone] = useState('');\r\n  const [customerEmail, setCustomerEmail] = useState('');\r\n  const [paymentMethod, setPaymentMethod] = useState(null);\r\n  const [isProcessing, setIsProcessing] = useState(false);\r\n  const [orderComplete, setOrderComplete] = useState(false);\r\n  const [orderNumber, setOrderNumber] = useState(null);\r\n  const [orderId, setOrderId] = useState(null);\r\n  const [showBillPreview, setShowBillPreview] = useState(false);\r\n  const [viewingOrder, setViewingOrder] = useState(null);\r\n  const [customerDue, setCustomerDue] = useState({ hasDue: false, totalDue: 0 });\r\n\r\n  // Change calculator state\r\n  const [amountReceived, setAmountReceived] = useState('');\r\n  const [changeToReturn, setChangeToReturn] = useState(0);\r\n\r\n  // Customer history state\r\n  const [customerHistory, setCustomerHistory] = useState([]);\r\n  const [showHistory, setShowHistory] = useState(false);\r\n  const [loadingHistory, setLoadingHistory] = useState(false);\r\n\r\n  const cart = useCartStore();\r\n\r\n  // Lookup customer history when phone number changes\r\n  const lookupCustomerHistory = async (phone) => {\r\n    if (!phone || phone.length < 10) {\r\n      setCustomerHistory([]);\r\n      return;\r\n    }\r\n\r\n    setLoadingHistory(true);\r\n    try {\r\n      const orders = await window.electronAPI.invoke('order:getByPhone', { phone });\r\n      setCustomerHistory(orders || []);\r\n      \r\n      const dueInfo = await window.electronAPI.invoke('customer:getDueStatus', { phone });\r\n      setCustomerDue(dueInfo);\r\n    } catch (error) {\r\n      console.error('Failed to load customer history:', error);\r\n      setCustomerHistory([]);\r\n    } finally {\r\n      setLoadingHistory(false);\r\n    }\r\n  };\r\n\r\n  // Calculate change when amount received changes\r\n  const handleAmountChange = (value) => {\r\n    setAmountReceived(value);\r\n    const received = parseFloat(value) || 0;\r\n    const change = received - total;\r\n    setChangeToReturn(change >= 0 ? change : 0);\r\n  };\r\n\r\n  const handleProceedToPayment = () => {\r\n    // Update cart with customer info\r\n    cart.setCustomerName(customerName);\r\n    cart.setCustomerPhone(customerPhone);\r\n    setStep('payment');\r\n  };\r\n\r\n  const handleCashPayment = () => {\r\n    setPaymentMethod('cash');\r\n    setAmountReceived('');\r\n    setChangeToReturn(0);\r\n    setStep('cash');\r\n  };\r\n\r\n  const handleConfirmCashPayment = () => {\r\n    const received = parseFloat(amountReceived) || 0;\r\n    if (received < total) {\r\n      alert('Insufficient amount received');\r\n      return;\r\n    }\r\n    handlePayment('cash');\r\n  };\r\n\r\n  const handlePayment = async (method) => {\r\n    setPaymentMethod(method);\r\n    setIsProcessing(true);\r\n\r\n    try {\r\n      // Create order\r\n      const result = await cart.createOrder(userId);\r\n\r\n      if (result.success) {\r\n        // Get the full order details\r\n        const order = await window.electronAPI.invoke('order:getById', { id: result.id });\r\n\r\n        // 1. Print KOT to Kitchen stations immediately when order is placed\r\n        console.log('Printing KOT to kitchen stations...');\r\n        await window.electronAPI.invoke('print:kotRouted', {\r\n          order: order,\r\n          items: order.items\r\n        });\r\n\r\n        // 2. Complete the order with payment method\r\n        await window.electronAPI.invoke('order:complete', {\r\n          id: result.id,\r\n          paymentMethod: method,\r\n        });\r\n\r\n        // 3. Refresh order with payment info and print Receipt to customer\r\n        const completedOrder = await window.electronAPI.invoke('order:getById', { id: result.id });\r\n        console.log('Printing receipt to customer...');\r\n        await window.electronAPI.invoke('print:receipt', { order: completedOrder });\r\n\r\n        setOrderId(result.id);\r\n        setOrderNumber(result.orderNumber);\r\n        setOrderComplete(true);\r\n      } else {\r\n        throw new Error(result.error || 'Failed to create order');\r\n      }\r\n    } catch (error) {\r\n      console.error('Payment error:', error);\r\n      alert('Payment failed: ' + error.message);\r\n    } finally {\r\n      setIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  // View Bill handler\r\n  const handleViewBill = async () => {\r\n    try {\r\n      const order = await window.electronAPI.invoke('order:getById', { id: orderId });\r\n      setViewingOrder(order);\r\n      setShowBillPreview(true);\r\n    } catch (error) {\r\n      console.error('Failed to load order:', error);\r\n      alert('Failed to load bill: ' + error.message);\r\n    }\r\n  };\r\n\r\n  // Reprint Bill handler\r\n  const handleReprintBill = async () => {\r\n    try {\r\n      const order = await window.electronAPI.invoke('order:getById', { id: orderId });\r\n      await window.electronAPI.invoke('print:receipt', { order });\r\n      alert('Bill reprinted successfully!');\r\n    } catch (error) {\r\n      console.error('Failed to print:', error);\r\n      alert('Failed to print: ' + error.message);\r\n    }\r\n  };\r\n\r\n  if (orderComplete) {\r\n    return (\r\n      <div className=\"modal-overlay\">\r\n        <div className=\"modal modal-sm\" style={{ textAlign: 'center', padding: 'var(--spacing-8)' }}>\r\n          <div style={{\r\n            width: '80px',\r\n            height: '80px',\r\n            borderRadius: '50%',\r\n            background: 'var(--success-50)',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'center',\r\n            margin: '0 auto var(--spacing-4)',\r\n          }}>\r\n            <Check size={40} style={{ color: 'var(--success-500)' }} />\r\n          </div>\r\n          <h2 style={{ marginBottom: 'var(--spacing-2)' }}>Order Complete!</h2>\r\n          <p style={{ color: 'var(--gray-600)', marginBottom: 'var(--spacing-2)' }}>\r\n            Order #{orderNumber} has been placed successfully.\r\n          </p>\r\n          <p style={{ color: 'var(--gray-500)', fontSize: 'var(--font-size-sm)', marginBottom: 'var(--spacing-4)' }}>\r\n            KOT sent to kitchen  Receipt printed\r\n          </p>\r\n\r\n          <div style={{ display: 'flex', gap: 'var(--spacing-2)', marginBottom: 'var(--spacing-3)' }}>\r\n            <button\r\n              className=\"btn btn-secondary\"\r\n              style={{ flex: 1 }}\r\n              onClick={handleViewBill}\r\n            >\r\n              <FileText size={18} />\r\n              View Bill\r\n            </button>\r\n            <button\r\n              className=\"btn btn-secondary\"\r\n              style={{ flex: 1 }}\r\n              onClick={handleReprintBill}\r\n            >\r\n              <Printer size={18} />\r\n              Reprint\r\n            </button>\r\n          </div>\r\n\r\n          <button className=\"btn btn-primary btn-lg\" style={{ width: '100%' }} onClick={onSuccess}>\r\n            New Order\r\n          </button>\r\n        </div>\r\n\r\n        {/* Bill Preview Modal */}\r\n        {showBillPreview && viewingOrder && (\r\n          <BillPreviewModal\r\n            order={viewingOrder}\r\n            onClose={() => setShowBillPreview(false)}\r\n            onPrint={handleReprintBill}\r\n          />\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Customer Info Step\r\n  if (step === 'customer') {\r\n    return (\r\n      <div className=\"modal-overlay\" onClick={onClose}>\r\n        <div className=\"modal\" onClick={(e) => e.stopPropagation()}>\r\n          <div className=\"modal-header\">\r\n            <h3 className=\"modal-title\">Customer Information</h3>\r\n            <button className=\"btn btn-ghost btn-icon\" onClick={onClose}>\r\n              <X size={20} />\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"modal-body\">\r\n            <div style={{\r\n              textAlign: 'center',\r\n              padding: 'var(--spacing-3)',\r\n              background: 'var(--gray-50)',\r\n              borderRadius: 'var(--radius-lg)',\r\n              marginBottom: 'var(--spacing-4)',\r\n            }}>\r\n              <div style={{ color: 'var(--gray-500)', fontSize: 'var(--font-size-sm)' }}>\r\n                Total Amount\r\n              </div>\r\n              <div style={{\r\n                fontSize: 'var(--font-size-2xl)',\r\n                fontWeight: 700,\r\n                color: 'var(--primary-600)'\r\n              }}>\r\n                {total.toFixed(2)}\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 'var(--spacing-3)' }}>\r\n              <div>\r\n                <label className=\"label\" style={{ color: customerDue.hasDue ? '#f44336' : 'inherit' }}>\r\n                  Customer Name (Optional) {customerDue.hasDue && <span style={{ fontSize: '10px' }}>(OVERDUE: {customerDue.totalDue})</span>}\r\n                </label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"input\"\r\n                  placeholder=\"Enter customer name\"\r\n                  value={customerName}\r\n                  onChange={(e) => setCustomerName(e.target.value)}\r\n                  style={{ \r\n                    border: customerDue.hasDue ? '1px solid #f44336' : '', \r\n                    background: customerDue.hasDue ? '#FFEBEE' : '' \r\n                  }}\r\n                  autoFocus\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"label\" style={{ color: customerDue.hasDue ? '#f44336' : 'inherit' }}>\r\n                  Phone Number (Optional) {customerDue.hasDue && <span style={{ fontSize: '10px' }}>(DEBTOR)</span>}\r\n                </label>\r\n                <input\r\n                  type=\"tel\"\r\n                  className=\"input\"\r\n                  placeholder=\"Enter phone number\"\r\n                  value={customerPhone}\r\n                  onChange={(e) => setCustomerPhone(e.target.value)}\r\n                  onBlur={(e) => lookupCustomerHistory(e.target.value)}\r\n                  style={{ \r\n                    border: customerDue.hasDue ? '1px solid #f44336' : '', \r\n                    background: customerDue.hasDue ? '#FFEBEE' : '' \r\n                  }}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"label\">Email (Optional)</label>\r\n                <input\r\n                  type=\"email\"\r\n                  className=\"input\"\r\n                  placeholder=\"Enter email address\"\r\n                  value={customerEmail}\r\n                  onChange={(e) => setCustomerEmail(e.target.value)}\r\n                />\r\n              </div>\r\n\r\n              {/* Customer History */}\r\n              {customerHistory.length > 0 && (\r\n                <div style={{\r\n                  padding: 'var(--spacing-3)',\r\n                  background: 'var(--primary-50)',\r\n                  borderRadius: 'var(--radius-md)',\r\n                  border: '1px solid var(--primary-200)'\r\n                }}>\r\n                  <div style={{\r\n                    display: 'flex',\r\n                    alignItems: 'center',\r\n                    justifyContent: 'space-between',\r\n                    marginBottom: 'var(--spacing-2)'\r\n                  }}>\r\n                    <span style={{ fontWeight: 600, color: 'var(--primary-700)' }}>\r\n                      Returning Customer! ({customerHistory.length} orders)\r\n                    </span>\r\n                  </div>\r\n                  <div style={{ fontSize: 'var(--font-size-sm)', color: 'var(--gray-600)' }}>\r\n                    Last order: #{customerHistory[0].order_number} - {customerHistory[0].total_amount.toFixed(2)} ({new Date(customerHistory[0].created_at).toLocaleDateString()})\r\n                  </div>\r\n                </div>\r\n              )}\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"modal-footer\" style={{ display: 'flex', gap: 'var(--spacing-2)' }}>\r\n            <button className=\"btn btn-secondary\" onClick={onClose}>\r\n              Cancel\r\n            </button>\r\n            <button\r\n              className=\"btn btn-primary\"\r\n              style={{ flex: 1 }}\r\n              onClick={handleProceedToPayment}\r\n            >\r\n              Proceed to Payment\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Payment Step\r\n  if (step === 'cash') {\r\n    return (\r\n      <div className=\"modal-overlay\" onClick={() => setStep('payment')}>\r\n        <div className=\"modal\" onClick={(e) => e.stopPropagation()}>\r\n          <div className=\"modal-header\">\r\n            <h3 className=\"modal-title\">Cash Payment</h3>\r\n            <button className=\"btn btn-ghost btn-icon\" onClick={() => setStep('payment')}>\r\n              <X size={20} />\r\n            </button>\r\n          </div>\r\n\r\n          <div className=\"modal-body\">\r\n            <div style={{\r\n              textAlign: 'center',\r\n              padding: 'var(--spacing-4)',\r\n              background: 'var(--gray-50)',\r\n              borderRadius: 'var(--radius-lg)',\r\n              marginBottom: 'var(--spacing-4)',\r\n            }}>\r\n              <div style={{ color: 'var(--gray-500)', fontSize: 'var(--font-size-sm)' }}>\r\n                Total Amount Due\r\n              </div>\r\n              <div style={{\r\n                fontSize: 'var(--font-size-4xl)',\r\n                fontWeight: 700,\r\n                color: 'var(--primary-600)'\r\n              }}>\r\n                {total.toFixed(2)}\r\n              </div>\r\n            </div>\r\n\r\n            {/* Amount Received Input */}\r\n            <div style={{ marginBottom: 'var(--spacing-4)' }}>\r\n              <label className=\"label\">Amount Received</label>\r\n              <input\r\n                type=\"number\"\r\n                className=\"input\"\r\n                placeholder=\"Enter amount received\"\r\n                value={amountReceived}\r\n                onChange={(e) => handleAmountChange(e.target.value)}\r\n                style={{ fontSize: 'var(--font-size-xl)', textAlign: 'center', fontWeight: 600 }}\r\n                autoFocus\r\n              />\r\n            </div>\r\n\r\n            {/* Quick Amount Buttons */}\r\n            <div style={{\r\n              display: 'grid',\r\n              gridTemplateColumns: 'repeat(4, 1fr)',\r\n              gap: 'var(--spacing-2)',\r\n              marginBottom: 'var(--spacing-4)'\r\n            }}>\r\n              {[Math.ceil(total / 10) * 10, Math.ceil(total / 50) * 50, Math.ceil(total / 100) * 100, Math.ceil(total / 500) * 500].map((amount) => (\r\n                <button\r\n                  key={amount}\r\n                  className=\"btn btn-secondary\"\r\n                  onClick={() => handleAmountChange(amount.toString())}\r\n                  style={{ padding: 'var(--spacing-2)' }}\r\n                >\r\n                  {amount}\r\n                </button>\r\n              ))}\r\n            </div>\r\n\r\n            {/* Change to Return */}\r\n            {parseFloat(amountReceived) >= total && (\r\n              <div style={{\r\n                textAlign: 'center',\r\n                padding: 'var(--spacing-4)',\r\n                background: 'var(--success-50)',\r\n                borderRadius: 'var(--radius-lg)',\r\n                border: '2px solid var(--success-200)',\r\n              }}>\r\n                <div style={{ color: 'var(--success-700)', fontSize: 'var(--font-size-sm)', marginBottom: 'var(--spacing-1)' }}>\r\n                  Change to Return\r\n                </div>\r\n                <div style={{\r\n                  fontSize: 'var(--font-size-3xl)',\r\n                  fontWeight: 700,\r\n                  color: 'var(--success-600)'\r\n                }}>\r\n                  {changeToReturn.toFixed(2)}\r\n                </div>\r\n              </div>\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"modal-footer\" style={{ display: 'flex', gap: 'var(--spacing-2)' }}>\r\n            <button className=\"btn btn-secondary\" onClick={() => setStep('payment')}>\r\n              Back\r\n            </button>\r\n            <button\r\n              className=\"btn btn-success\"\r\n              style={{ flex: 1 }}\r\n              onClick={handleConfirmCashPayment}\r\n              disabled={isProcessing || !amountReceived || parseFloat(amountReceived) < total}\r\n            >\r\n              {isProcessing ? 'Processing...' : `Confirm Payment`}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Payment Method Selection Step\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\">\r\n          <h3 className=\"modal-title\">Payment</h3>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={() => setStep('customer')}>\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        <div className=\"modal-body\">\r\n          <div style={{\r\n            textAlign: 'center',\r\n            padding: 'var(--spacing-4)',\r\n            background: 'var(--gray-50)',\r\n            borderRadius: 'var(--radius-lg)',\r\n            marginBottom: 'var(--spacing-4)',\r\n          }}>\r\n            <div style={{ color: 'var(--gray-600)', fontSize: 'var(--font-size-sm)' }}>\r\n              {customerName}  {customerPhone}\r\n            </div>\r\n            <div style={{ color: 'var(--gray-500)', fontSize: 'var(--font-size-sm)', marginTop: 'var(--spacing-1)' }}>\r\n              Total Amount\r\n            </div>\r\n            <div style={{\r\n              fontSize: 'var(--font-size-4xl)',\r\n              fontWeight: 700,\r\n              color: 'var(--primary-600)'\r\n            }}>\r\n              {total.toFixed(2)}\r\n            </div>\r\n          </div>\r\n\r\n          <p style={{\r\n            textAlign: 'center',\r\n            marginBottom: 'var(--spacing-4)',\r\n            color: 'var(--gray-600)'\r\n          }}>\r\n            Select payment method\r\n          </p>\r\n\r\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 'var(--spacing-3)' }}>\r\n            <button\r\n              className=\"btn btn-lg\"\r\n              style={{\r\n                background: 'var(--success-50)',\r\n                color: 'var(--success-700)',\r\n                border: '2px solid var(--success-200)',\r\n                justifyContent: 'flex-start',\r\n                padding: 'var(--spacing-4)',\r\n              }}\r\n              onClick={handleCashPayment}\r\n              disabled={isProcessing}\r\n            >\r\n              <Banknote size={24} />\r\n              <span style={{ flex: 1, textAlign: 'left', marginLeft: 'var(--spacing-3)' }}>\r\n                Cash\r\n              </span>\r\n            </button>\r\n\r\n            <button\r\n              className=\"btn btn-lg\"\r\n              style={{\r\n                background: 'var(--primary-50)',\r\n                color: 'var(--primary-700)',\r\n                border: '2px solid var(--primary-200)',\r\n                justifyContent: 'flex-start',\r\n                padding: 'var(--spacing-4)',\r\n              }}\r\n              onClick={() => handlePayment('card')}\r\n              disabled={isProcessing}\r\n            >\r\n              <CreditCard size={24} />\r\n              <span style={{ flex: 1, textAlign: 'left', marginLeft: 'var(--spacing-3)' }}>\r\n                Card\r\n              </span>\r\n            </button>\r\n\r\n            <button\r\n              className=\"btn btn-lg\"\r\n              style={{\r\n                background: 'var(--secondary-50)',\r\n                color: 'var(--secondary-700)',\r\n                border: '2px solid var(--secondary-200)',\r\n                justifyContent: 'flex-start',\r\n                padding: 'var(--spacing-4)',\r\n              }}\r\n              onClick={() => handlePayment('upi')}\r\n              disabled={isProcessing}\r\n            >\r\n              <Smartphone size={24} />\r\n              <span style={{ flex: 1, textAlign: 'left', marginLeft: 'var(--spacing-3)' }}>\r\n                UPI\r\n              </span>\r\n            </button>\r\n\r\n            <button\r\n              className=\"btn btn-lg\"\r\n              style={{\r\n                background: '#FFF3E0',\r\n                color: '#E65100',\r\n                border: '2px solid #FFCC80',\r\n                justifyContent: 'flex-start',\r\n                padding: 'var(--spacing-4)',\r\n              }}\r\n              onClick={() => handlePayment('due')}\r\n              disabled={isProcessing}\r\n            >\r\n              <Clock size={24} />\r\n              <span style={{ flex: 1, textAlign: 'left', marginLeft: 'var(--spacing-3)' }}>\r\n                Due / Credit\r\n              </span>\r\n              <span style={{ fontSize: '12px', color: '#F57C00' }}>Pay Later</span>\r\n            </button>\r\n          </div>\r\n\r\n          {isProcessing && (\r\n            <div style={{\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              marginTop: 'var(--spacing-4)',\r\n              gap: 'var(--spacing-2)'\r\n            }}>\r\n              <div className=\"loading-spinner\" style={{ width: '24px', height: '24px' }} />\r\n              <span>Processing payment...</span>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n      {/* Modals & Overlays */}\r\n      <MainSidebar\r\n        isOpen={showMainSidebar}\r\n        onClose={() => setShowMainSidebar(false)}\r\n      />\r\n\r\n      {showDiscountModal && (\r\n        <DiscountModal\r\n          currentType={cart.discountType || 'percentage'}\r\n          currentValue={cart.discountValue || 0}\r\n          subtotal={cart.getSubtotal()}\r\n          onApply={(type, val, reason) => {\r\n            cart.applyDiscount(type, val, reason);\r\n            setShowDiscountModal(false);\r\n          }}\r\n          onClear={() => {\r\n            cart.clearDiscount();\r\n            setShowDiscountModal(false);\r\n          }}\r\n          onClose={() => setShowDiscountModal(false)}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// Discount Modal Component\r\nconst DiscountModal = ({ onClose, onApply, onClear, currentType, currentValue, subtotal }) => {\r\n  const [discountType, setDiscountType] = React.useState(currentType !== 'none' ? currentType : 'percentage');\r\n  const [discountValue, setDiscountValue] = React.useState(currentValue || 0);\r\n  const [reason, setReason] = React.useState('');\r\n\r\n  const calculatePreview = () => {\r\n    if (discountType === 'percentage') {\r\n      return (subtotal * discountValue) / 100;\r\n    }\r\n    return Math.min(discountValue, subtotal);\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose} style={{ zIndex: 1005 }}>\r\n      <div className=\"modal\" onClick={(e) => e.stopPropagation()} style={{ width: '450px', height: 'auto', maxHeight: '90vh' }}>\r\n        {/* Header */}\r\n        <div className=\"modal-header\" style={{ background: '#D32F2F', color: 'white' }}>\r\n          <h3 className=\"modal-title\" style={{ color: 'white', fontSize: '18px' }}>Apply Discount</h3>\r\n          <button\r\n            className=\"modal-close-btn\"\r\n            onClick={onClose}\r\n            style={{ background: 'rgba(255,255,255,0.2)', color: 'white', border: 'none' }}\r\n          >\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Body */}\r\n        <div className=\"modal-body\">\r\n          {/* Discount Type Selection */}\r\n          <div style={{ marginBottom: '20px' }}>\r\n            <label className=\"label\">Discount Type</label>\r\n            <div style={{ display: 'flex', gap: '12px' }}>\r\n              <button\r\n                onClick={() => setDiscountType('percentage')}\r\n                style={{\r\n                  flex: 1,\r\n                  padding: '12px',\r\n                  border: discountType === 'percentage' ? '2px solid #D32F2F' : '1px solid #CFD8DC',\r\n                  borderRadius: '8px',\r\n                  background: discountType === 'percentage' ? '#FFEBEE' : 'white',\r\n                  color: discountType === 'percentage' ? '#D32F2F' : '#546E7A',\r\n                  fontWeight: '600',\r\n                  cursor: 'pointer',\r\n                  transition: 'all 0.2s'\r\n                }}\r\n              >\r\n                Percentage (%)\r\n              </button>\r\n              <button\r\n                onClick={() => setDiscountType('flat')}\r\n                style={{\r\n                  flex: 1,\r\n                  padding: '12px',\r\n                  border: discountType === 'flat' ? '2px solid #D32F2F' : '1px solid #CFD8DC',\r\n                  borderRadius: '8px',\r\n                  background: discountType === 'flat' ? '#FFEBEE' : 'white',\r\n                  color: discountType === 'flat' ? '#D32F2F' : '#546E7A',\r\n                  fontWeight: '600',\r\n                  cursor: 'pointer',\r\n                  transition: 'all 0.2s'\r\n                }}\r\n              >\r\n                Flat Amount ()\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Discount Value */}\r\n          <div style={{ marginBottom: '20px' }}>\r\n            <label className=\"label\">\r\n              {discountType === 'percentage' ? 'Discount Percentage' : 'Discount Amount'}\r\n            </label>\r\n            <div style={{ position: 'relative' }}>\r\n              <input\r\n                type=\"number\"\r\n                value={discountValue}\r\n                onChange={(e) => setDiscountValue(parseFloat(e.target.value) || 0)}\r\n                placeholder={discountType === 'percentage' ? 'Enter percentage (e.g., 10)' : 'Enter amount (e.g., 50)'}\r\n                className=\"input\"\r\n                style={{ fontSize: '18px', fontWeight: 'bold' }}\r\n                min=\"0\"\r\n                max={discountType === 'percentage' ? 100 : subtotal}\r\n                autoFocus\r\n              />\r\n              <span style={{ position: 'absolute', right: '12px', top: '50%', transform: 'translateY(-50%)', color: '#90A4AE', fontWeight: 'bold' }}>\r\n                {discountType === 'percentage' ? '%' : ''}\r\n              </span>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Reason */}\r\n          <div style={{ marginBottom: '20px' }}>\r\n            <label className=\"label\">Reason (Optional)</label>\r\n            <input\r\n              type=\"text\"\r\n              value={reason}\r\n              onChange={(e) => setReason(e.target.value)}\r\n              placeholder=\"E.g., Birthday discount, Loyalty reward\"\r\n              className=\"input\"\r\n            />\r\n          </div>\r\n\r\n          {/* Preview */}\r\n          <div style={{ background: '#E8F5E9', padding: '16px', borderRadius: '12px', border: '1px solid #C8E6C9' }}>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', color: '#2E7D32', fontWeight: '700', marginBottom: '8px' }}>\r\n              <span>Discount Amount:</span>\r\n              <span>-{calculatePreview().toFixed(2)}</span>\r\n            </div>\r\n            <div style={{ display: 'flex', justifyContent: 'space-between', color: '#546E7A', fontSize: '14px', borderTop: '1px dashed #A5D6A7', paddingTop: '8px' }}>\r\n              <span>New Total:</span>\r\n              <span style={{ fontWeight: '600', color: '#37474F' }}>{(subtotal - calculatePreview()).toFixed(2)}</span>\r\n            </div>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Footer */}\r\n        <div className=\"modal-footer\">\r\n          {currentType !== 'none' && (\r\n            <button\r\n              onClick={onClear}\r\n              className=\"btn\"\r\n              style={{ border: '1px solid #FFCDD2', color: '#D32F2F', background: '#FFEBEE' }}\r\n            >\r\n              Clear\r\n            </button>\r\n          )}\r\n          <div style={{ flex: 1 }}></div>\r\n          <button\r\n            onClick={onClose}\r\n            className=\"btn btn-secondary\"\r\n          >\r\n            Cancel\r\n          </button>\r\n          <button\r\n            onClick={() => onApply(discountType, discountValue, reason)}\r\n            disabled={discountValue <= 0}\r\n            className=\"btn btn-primary\"\r\n            style={{ background: '#D32F2F', borderColor: '#D32F2F' }}\r\n          >\r\n            Apply Discount\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default POSPage;\r\n\r\nconst HeldOrdersModal = ({ orders, onClose, onResume, onDelete }) => {\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose} style={{ zIndex: 2000 }}>\r\n      <div className=\"modal\" onClick={(e) => e.stopPropagation()} style={{ width: '750px', height: 'auto', maxHeight: '85vh', borderRadius: '16px' }}>\r\n        <div className=\"modal-header\" style={{ background: '#2c3e50', color: 'white', padding: '20px 24px' }}>\r\n          <h3 className=\"modal-title\" style={{ color: 'white', fontSize: '20px', fontWeight: 'bold' }}>Held Orders ({orders.length})</h3>\r\n          <button \r\n            className=\"modal-close-btn\" \r\n            onClick={onClose} \r\n            style={{ \r\n              background: 'rgba(255,255,255,0.15)', \r\n              color: 'white', \r\n              border: 'none',\r\n              borderRadius: '50%',\r\n              width: '36px',\r\n              height: '36px',\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              transition: 'background 0.2s'\r\n            }}\r\n            onMouseOver={e => e.currentTarget.style.background = 'rgba(255,255,255,0.25)'}\r\n            onMouseOut={e => e.currentTarget.style.background = 'rgba(255,255,255,0.15)'}\r\n          >\r\n            <X size={22} />\r\n          </button>\r\n        </div>\r\n        <div className=\"modal-body\" style={{ padding: '0' }}>\r\n          {orders.length === 0 ? (\r\n            <div className=\"empty-state\" style={{ padding: '60px 20px', display: 'flex', flexDirection: 'column', alignItems: 'center', textAlign: 'center' }}>\r\n              <div style={{ background: '#f8fafc', padding: '24px', borderRadius: '50%', marginBottom: '16px' }}>\r\n                <PauseCircle size={64} color=\"#94a3b8\" />\r\n              </div>\r\n              <h4 style={{ margin: 0, color: '#475569', fontSize: '18px' }}>No orders currently on hold</h4>\r\n              <p style={{ marginTop: '8px', color: '#94a3b8', maxWidth: '300px' }}>Orders you place on hold will appear here for later retrieval.</p>\r\n            </div>\r\n          ) : (\r\n            <div className=\"held-orders-list\">\r\n              {orders.map(order => (\r\n                <div \r\n                  key={order.id} \r\n                  onClick={() => onResume(order)}\r\n                  style={{ \r\n                    padding: '20px 24px', \r\n                    borderBottom: '1px solid #f1f5f9', \r\n                    display: 'flex', \r\n                    justifyContent: 'space-between', \r\n                    alignItems: 'center',\r\n                    cursor: 'pointer',\r\n                    transition: 'all 0.2s'\r\n                  }} \r\n                  onMouseOver={e => e.currentTarget.style.background = '#f8fafc'}\r\n                  onMouseOut={e => e.currentTarget.style.background = 'white'}\r\n                >\r\n                  <div style={{ flex: 1 }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>\r\n                      <div style={{ fontWeight: '800', fontSize: '18px', color: '#1e293b' }}>Order #{order.orderNumber}</div>\r\n                      <span style={{ fontSize: '12px', background: '#f1f5f9', padding: '4px 10px', borderRadius: '20px', color: '#64748b', fontWeight: '600' }}>\r\n                        {new Date(order.timestamp).toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' })}\r\n                      </span>\r\n                    </div>\r\n                    <div style={{ fontSize: '13px', color: '#64748b', marginTop: '6px', fontWeight: '500' }}>\r\n                      {order.items.reduce((acc, i) => acc + i.quantity, 0)} Items  {order.orderType?.replace('_', ' ').toUpperCase()}\r\n                    </div>\r\n                    {(order.customerName || order.customerPhone) && (\r\n                      <div style={{ fontSize: '13px', color: '#3b82f6', marginTop: '4px', fontWeight: '600', display: 'flex', alignItems: 'center', gap: '6px' }}>\r\n                        <User size={14} />\r\n                        {order.customerName || 'Walk-in'} {order.customerPhone ? `(${order.customerPhone})` : ''}\r\n                      </div>\r\n                    )}\r\n                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px', marginTop: '8px' }}>\r\n                      {order.items.slice(0, 3).map((item, idx) => (\r\n                        <span key={idx} style={{ fontSize: '11px', color: '#94a3b8', background: '#f8fafc', padding: '2px 8px', borderRadius: '4px', border: '1px solid #f1f5f9' }}>\r\n                          {item.quantity} {item.name}\r\n                        </span>\r\n                      ))}\r\n                      {order.items.length > 3 && <span style={{ fontSize: '11px', color: '#94a3b8', padding: '2px 4px' }}>+{order.items.length - 3} more</span>}\r\n                    </div>\r\n                  </div>\r\n\r\n                  <div style={{ textAlign: 'right', display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: '12px', marginLeft: '20px' }}>\r\n                    <div style={{ fontWeight: '900', fontSize: '22px', color: '#ef4444' }}>\r\n                      {order.totalAmount.toFixed(2)}\r\n                    </div>\r\n                    <div style={{ display: 'flex', gap: '10px' }}>\r\n                      <button\r\n                        onClick={(e) => { e.stopPropagation(); onDelete(order.id); }}\r\n                        className=\"btn\"\r\n                        style={{ \r\n                          padding: '10px 20px', \r\n                          fontSize: '14px', \r\n                          fontWeight: '700',\r\n                          border: '1.5px solid #fee2e2', \r\n                          background: '#fef2f2', \r\n                          color: '#ef4444',\r\n                          borderRadius: '8px',\r\n                          display: 'flex',\r\n                          alignItems: 'center',\r\n                          gap: '6px',\r\n                          transition: 'all 0.2s'\r\n                        }}\r\n                        onMouseOver={e => { e.currentTarget.style.background = '#fee2e2'; }}\r\n                        onMouseOut={e => { e.currentTarget.style.background = '#fef2f2'; }}\r\n                      >\r\n                        <Trash2 size={16} />\r\n                        Delete\r\n                      </button>\r\n                      <button\r\n                        onClick={(e) => { e.stopPropagation(); onResume(order); }}\r\n                        className=\"btn btn-primary\"\r\n                        style={{ \r\n                          padding: '10px 24px', \r\n                          fontSize: '14px', \r\n                          fontWeight: '700',\r\n                          background: '#3b82f6',\r\n                          borderColor: '#3b82f6',\r\n                          borderRadius: '8px',\r\n                          display: 'flex',\r\n                          alignItems: 'center',\r\n                          gap: '6px',\r\n                          boxShadow: '0 4px 6px -1px rgba(59, 130, 246, 0.2)'\r\n                        }}\r\n                      >\r\n                        <PlayCircle size={16} />\r\n                        Resume\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\PrintersPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'ArrowRight' is defined but never used.","line":12,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":13},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":500,"column":68,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[22911,23157],"text":"\r\n                      This printer handles KOTs for items that aren&apos;t assigned to any specific kitchen station. \r\n                      If you have kitchen stations configured, only unmapped category items will print here.\r\n                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[22911,23157],"text":"\r\n                      This printer handles KOTs for items that aren&lsquo;t assigned to any specific kitchen station. \r\n                      If you have kitchen stations configured, only unmapped category items will print here.\r\n                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[22911,23157],"text":"\r\n                      This printer handles KOTs for items that aren&#39;t assigned to any specific kitchen station. \r\n                      If you have kitchen stations configured, only unmapped category items will print here.\r\n                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[22911,23157],"text":"\r\n                      This printer handles KOTs for items that aren&rsquo;t assigned to any specific kitchen station. \r\n                      If you have kitchen stations configured, only unmapped category items will print here.\r\n                    "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":675,"column":107,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[34785,34834],"text":"Click &quot;Add Station\" to create your first station."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[34785,34834],"text":"Click &ldquo;Add Station\" to create your first station."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[34785,34834],"text":"Click &#34;Add Station\" to create your first station."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[34785,34834],"text":"Click &rdquo;Add Station\" to create your first station."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":675,"column":119,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[34785,34834],"text":"Click \"Add Station&quot; to create your first station."},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[34785,34834],"text":"Click \"Add Station&ldquo; to create your first station."},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[34785,34834],"text":"Click \"Add Station&#34; to create your first station."},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[34785,34834],"text":"Click \"Add Station&rdquo; to create your first station."},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":835,"column":106,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[46145,46293],"text":"\r\n                    When a biller places an order, multiple print jobs are triggered simultaneously. Here&apos;s the complete flow:\r\n                  "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[46145,46293],"text":"\r\n                    When a biller places an order, multiple print jobs are triggered simultaneously. Here&lsquo;s the complete flow:\r\n                  "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[46145,46293],"text":"\r\n                    When a biller places an order, multiple print jobs are triggered simultaneously. Here&#39;s the complete flow:\r\n                  "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[46145,46293],"text":"\r\n                    When a biller places an order, multiple print jobs are triggered simultaneously. Here&rsquo;s the complete flow:\r\n                  "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":887,"column":92,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station&apos;s printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station&lsquo;s printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station&#39;s printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station&rsquo;s printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&rsquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":888,"column":38,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, &quot;Drinks\" category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, &ldquo;Drinks\" category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, &#34;Drinks\" category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, &rdquo;Drinks\" category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":888,"column":45,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks&quot; category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks&ldquo; category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks&#34; category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks&rdquo; category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":888,"column":81,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, &quot;Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, &ldquo;Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, &#34;Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, &rdquo;Tandoor\" items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":888,"column":89,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, \"Tandoor&quot; items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, \"Tandoor&ldquo; items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, \"Tandoor&#34; items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[49762,50044],"text":"\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, \"Tandoor&rdquo; items go to Tandoor printer.\r\n                      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":905,"column":28,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[51066,51317],"text":"\r\n                        If &quot;Attach Mini-Bill\" is enabled, each KOT printout includes a tear-off condensed bill summary below the kitchen items, \r\n                        showing the complete order total for kitchen reference.\r\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[51066,51317],"text":"\r\n                        If &ldquo;Attach Mini-Bill\" is enabled, each KOT printout includes a tear-off condensed bill summary below the kitchen items, \r\n                        showing the complete order total for kitchen reference.\r\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[51066,51317],"text":"\r\n                        If &#34;Attach Mini-Bill\" is enabled, each KOT printout includes a tear-off condensed bill summary below the kitchen items, \r\n                        showing the complete order total for kitchen reference.\r\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[51066,51317],"text":"\r\n                        If &rdquo;Attach Mini-Bill\" is enabled, each KOT printout includes a tear-off condensed bill summary below the kitchen items, \r\n                        showing the complete order total for kitchen reference.\r\n                      "},"desc":"Replace with `&rdquo;`."}]},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`\"` can be escaped with `&quot;`, `&ldquo;`, `&#34;`, `&rdquo;`.","line":905,"column":45,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&quot;"},"fix":{"range":[51066,51317],"text":"\r\n                        If \"Attach Mini-Bill&quot; is enabled, each KOT printout includes a tear-off condensed bill summary below the kitchen items, \r\n                        showing the complete order total for kitchen reference.\r\n                      "},"desc":"Replace with `&quot;`."},{"messageId":"replaceWithAlt","data":{"alt":"&ldquo;"},"fix":{"range":[51066,51317],"text":"\r\n                        If \"Attach Mini-Bill&ldquo; is enabled, each KOT printout includes a tear-off condensed bill summary below the kitchen items, \r\n                        showing the complete order total for kitchen reference.\r\n                      "},"desc":"Replace with `&ldquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#34;"},"fix":{"range":[51066,51317],"text":"\r\n                        If \"Attach Mini-Bill&#34; is enabled, each KOT printout includes a tear-off condensed bill summary below the kitchen items, \r\n                        showing the complete order total for kitchen reference.\r\n                      "},"desc":"Replace with `&#34;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rdquo;"},"fix":{"range":[51066,51317],"text":"\r\n                        If \"Attach Mini-Bill&rdquo; is enabled, each KOT printout includes a tear-off condensed bill summary below the kitchen items, \r\n                        showing the complete order total for kitchen reference.\r\n                      "},"desc":"Replace with `&rdquo;`."}]}],"suppressedMessages":[],"errorCount":11,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Printer, \r\n  Store, \r\n  Receipt, \r\n  ChefHat, \r\n  Image, \r\n  Plus, \r\n  Trash2, \r\n  Upload,\r\n  CheckCircle2,\r\n  ArrowRight,\r\n  Zap,\r\n  FileText,\r\n  RefreshCw,\r\n  Info,\r\n  Workflow,\r\n  X\r\n} from 'lucide-react';\r\n\r\nconst PrintersPage = () => {\r\n  const [settings, setSettings] = useState({});\r\n  const [printers, setPrinters] = useState([]);\r\n  const [stations, setStations] = useState([]);\r\n  const [categories, setCategories] = useState([]);\r\n  const [categoryMap, setCategoryMap] = useState([]);\r\n  \r\n  const [printerTab, setPrinterTab] = useState('bill');\r\n  const [newStation, setNewStation] = useState({ station_name: '', printer_name: '' });\r\n  const [showAddStation, setShowAddStation] = useState(false);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [testingPrinter, setTestingPrinter] = useState(null);\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n  }, []);\r\n\r\n  const loadData = async () => {\r\n    try {\r\n      const [settingsResult, printersResult, stationsResult, categoriesResult, categoryMapResult] = await Promise.all([\r\n        window.electronAPI.invoke('settings:getAll', {}),\r\n        window.electronAPI.invoke('print:getPrinters'),\r\n        window.electronAPI.invoke('printer:getStations').catch(() => []),\r\n        window.electronAPI.invoke('menu:getCategories').catch(() => []),\r\n        window.electronAPI.invoke('printer:getCategoryMap').catch(() => [])\r\n      ]);\r\n      \r\n      if (Array.isArray(settingsResult)) {\r\n        const settingsObj = {};\r\n        settingsResult.forEach(row => { settingsObj[row.key] = row.value; });\r\n        setSettings(settingsObj);\r\n      }\r\n      if (Array.isArray(printersResult)) setPrinters(printersResult);\r\n      if (Array.isArray(stationsResult)) setStations(stationsResult);\r\n      if (Array.isArray(categoriesResult)) setCategories(categoriesResult);\r\n      if (Array.isArray(categoryMapResult)) setCategoryMap(categoryMapResult);\r\n    } catch (error) {\r\n      console.error('Failed to load data:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const updateSetting = async (key, value) => {\r\n    setSettings(prev => ({ ...prev, [key]: value }));\r\n    try {\r\n      await window.electronAPI.invoke('settings:update', { key, value });\r\n    } catch (error) {\r\n      console.error('Failed to update setting:', error);\r\n    }\r\n  };\r\n\r\n  const handleTestPrint = async (printerName) => {\r\n    if (!printerName) return;\r\n    setTestingPrinter(printerName);\r\n    try {\r\n      const result = await window.electronAPI.invoke('print:testPrint', { printerName });\r\n      if (result.success) alert(' Test print sent successfully!');\r\n      else alert(' Print failed: ' + (result.error || 'Unknown error'));\r\n    } catch (error) {\r\n      alert(' Print failed: ' + error.message);\r\n    } finally {\r\n      setTestingPrinter(null);\r\n    }\r\n  };\r\n\r\n  const handleAddStation = async () => {\r\n    if (!newStation.station_name || !newStation.printer_name) {\r\n      alert('Please enter station name and select a printer');\r\n      return;\r\n    }\r\n    try {\r\n      await window.electronAPI.invoke('printer:saveStation', { station: newStation });\r\n      setNewStation({ station_name: '', printer_name: '' });\r\n      setShowAddStation(false);\r\n      const updated = await window.electronAPI.invoke('printer:getStations');\r\n      setStations(updated || []);\r\n    } catch (e) { console.error(e); }\r\n  };\r\n\r\n  const handleDeleteStation = async (id) => {\r\n    if (!confirm('Delete this station? This will remove its category assignments.')) return;\r\n    try {\r\n      await window.electronAPI.invoke('printer:deleteStation', { id });\r\n      const updated = await window.electronAPI.invoke('printer:getStations');\r\n      setStations(updated || []);\r\n      const mapUpdated = await window.electronAPI.invoke('printer:getCategoryMap');\r\n      setCategoryMap(mapUpdated || []);\r\n    } catch (e) { console.error(e); }\r\n  };\r\n\r\n  const handleToggleCategoryStation = async (categoryId, stationId) => {\r\n    const existing = categoryMap.filter(m => m.category_id === categoryId).map(m => m.station_id);\r\n    let newIds = existing.includes(stationId)\r\n      ? existing.filter(id => id !== stationId)\r\n      : [...existing, stationId];\r\n      \r\n    try {\r\n      await window.electronAPI.invoke('printer:saveCategoryMap', { categoryId, stationIds: newIds });\r\n      const updated = await window.electronAPI.invoke('printer:getCategoryMap');\r\n      setCategoryMap(updated || []);\r\n    } catch (e) { console.error(e); }\r\n  };\r\n\r\n  const handleSelectLogo = async () => {\r\n    try {\r\n      const result = await window.electronAPI.invoke('print:selectLogo');\r\n      if (result && result.success) {\r\n        updateSetting('bill_logo_path', result.base64);\r\n      }\r\n    } catch (e) { console.error(e); }\r\n  };\r\n\r\n  // Toggle Switch Component\r\n  const Toggle = ({ checked, onChange }) => (\r\n    <button\r\n      onClick={() => onChange(!checked)}\r\n      style={{ background: 'none', border: 'none', cursor: 'pointer', padding: 0, flexShrink: 0 }}\r\n    >\r\n      <div style={{\r\n        width: '44px',\r\n        height: '24px',\r\n        borderRadius: '12px',\r\n        background: checked ? 'var(--primary-500)' : 'var(--gray-300)',\r\n        position: 'relative',\r\n        transition: 'background 0.2s ease'\r\n      }}>\r\n        <div style={{\r\n          width: '20px',\r\n          height: '20px',\r\n          borderRadius: '50%',\r\n          background: 'white',\r\n          position: 'absolute',\r\n          top: '2px',\r\n          left: checked ? '22px' : '2px',\r\n          transition: 'left 0.2s ease',\r\n          boxShadow: '0 1px 3px rgba(0,0,0,0.25)'\r\n        }} />\r\n      </div>\r\n    </button>\r\n  );\r\n\r\n  const tabs = [\r\n    { id: 'bill', label: 'Bill Printer', icon: Receipt, desc: 'Customer receipt printer', color: 'var(--success-500)', bg: 'var(--success-50)' },\r\n    { id: 'kot', label: 'KOT Printer', icon: ChefHat, desc: 'Default kitchen printer', color: 'var(--warning-600)', bg: 'var(--warning-50)' },\r\n    { id: 'stations', label: 'Kitchen Stations', icon: Store, desc: 'Station routing & printers', color: 'var(--info-500)', bg: 'var(--info-50)' },\r\n    { id: 'format', label: 'Bill Format', icon: FileText, desc: 'Logo, QR & invoice options', color: 'var(--gray-600)', bg: 'var(--gray-100)' },\r\n    { id: 'flow', label: 'Print Flow', icon: Workflow, desc: 'How printing works', color: 'var(--primary-500)', bg: 'var(--primary-50)' }\r\n  ];\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '60vh' }}>\r\n        <div style={{ textAlign: 'center' }}>\r\n          <RefreshCw size={32} style={{ color: 'var(--primary-500)', animation: 'spin 1s linear infinite' }} />\r\n          <p style={{ marginTop: '12px', color: 'var(--gray-500)' }}>Loading printer configuration...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ \r\n      padding: '24px', \r\n      height: 'calc(100vh - 65px)', \r\n      display: 'flex', \r\n      flexDirection: 'column',\r\n      overflow: 'hidden'\r\n    }}>\r\n      {/* Header */}\r\n      <div style={{ \r\n        display: 'flex', \r\n        justifyContent: 'space-between', \r\n        alignItems: 'center',\r\n        marginBottom: '20px',\r\n        flexShrink: 0\r\n      }}>\r\n        <div>\r\n          <h1 style={{ fontSize: '22px', fontWeight: '700', color: 'var(--gray-900)', margin: 0 }}>\r\n            Printer Management\r\n          </h1>\r\n          <p style={{ color: 'var(--gray-500)', fontSize: '13px', margin: '4px 0 0' }}>\r\n            Configure receipts, kitchen stations, and print formats\r\n          </p>\r\n        </div>\r\n        <button \r\n          className=\"btn btn-secondary\"\r\n          onClick={loadData}\r\n          style={{ display: 'flex', alignItems: 'center', gap: '8px', fontSize: '13px' }}\r\n        >\r\n          <RefreshCw size={15} /> Refresh Printers\r\n        </button>\r\n      </div>\r\n\r\n      {/* Main Content: Tabs Left + Content Right */}\r\n      <div style={{ \r\n        display: 'grid', \r\n        gridTemplateColumns: '260px 1fr', \r\n        gap: '20px', \r\n        flex: 1, \r\n        minHeight: 0 \r\n      }}>\r\n        {/*  LEFT: Tab Navigation  */}\r\n        <div style={{ \r\n          display: 'flex', \r\n          flexDirection: 'column', \r\n          gap: '6px',\r\n          background: 'var(--gray-50)',\r\n          borderRadius: 'var(--radius-lg)',\r\n          border: '1px solid var(--gray-200)',\r\n          padding: '12px',\r\n          height: 'fit-content'\r\n        }}>\r\n          {tabs.map(tab => {\r\n            const isActive = printerTab === tab.id;\r\n            const Icon = tab.icon;\r\n            return (\r\n              <button\r\n                key={tab.id}\r\n                onClick={() => setPrinterTab(tab.id)}\r\n                style={{\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  gap: '12px',\r\n                  padding: '14px 16px',\r\n                  border: 'none',\r\n                  borderRadius: 'var(--radius-md)',\r\n                  cursor: 'pointer',\r\n                  textAlign: 'left',\r\n                  width: '100%',\r\n                  background: isActive ? 'white' : 'transparent',\r\n                  boxShadow: isActive ? '0 2px 8px rgba(0,0,0,0.08)' : 'none',\r\n                  transition: 'all 0.2s ease',\r\n                  position: 'relative'\r\n                }}\r\n              >\r\n                {isActive && (\r\n                  <div style={{\r\n                    position: 'absolute',\r\n                    left: 0,\r\n                    top: '50%',\r\n                    transform: 'translateY(-50%)',\r\n                    width: '3px',\r\n                    height: '24px',\r\n                    borderRadius: '0 3px 3px 0',\r\n                    background: tab.color\r\n                  }} />\r\n                )}\r\n                <div style={{ \r\n                  width: '36px',\r\n                  height: '36px',\r\n                  borderRadius: '10px', \r\n                  background: isActive ? tab.bg : 'var(--gray-100)',\r\n                  display: 'flex',\r\n                  alignItems: 'center',\r\n                  justifyContent: 'center',\r\n                  flexShrink: 0,\r\n                  transition: 'all 0.2s'\r\n                }}>\r\n                  <Icon size={18} style={{ color: isActive ? tab.color : 'var(--gray-400)' }} />\r\n                </div>\r\n                <div style={{ overflow: 'hidden' }}>\r\n                  <div style={{ \r\n                    fontWeight: isActive ? '600' : '500', \r\n                    fontSize: '14px', \r\n                    color: isActive ? 'var(--gray-900)' : 'var(--gray-600)',\r\n                    whiteSpace: 'nowrap'\r\n                  }}>\r\n                    {tab.label}\r\n                  </div>\r\n                  <div style={{ \r\n                    fontSize: '11px', \r\n                    color: isActive ? 'var(--gray-500)' : 'var(--gray-400)', \r\n                    marginTop: '1px',\r\n                    whiteSpace: 'nowrap',\r\n                    overflow: 'hidden',\r\n                    textOverflow: 'ellipsis'\r\n                  }}>\r\n                    {tab.desc}\r\n                  </div>\r\n                </div>\r\n              </button>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/*  RIGHT: Content Area  */}\r\n        <div style={{ \r\n          background: 'white', \r\n          borderRadius: 'var(--radius-lg)', \r\n          border: '1px solid var(--gray-200)',\r\n          display: 'flex',\r\n          flexDirection: 'column',\r\n          minHeight: 0,\r\n          overflow: 'hidden'\r\n        }}>\r\n          {/* Content Header */}\r\n          <div style={{ \r\n            padding: '20px 28px', \r\n            borderBottom: '1px solid var(--gray-200)', \r\n            background: 'var(--gray-50)',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            gap: '12px',\r\n            flexShrink: 0\r\n          }}>\r\n            {(() => {\r\n              const activeTab = tabs.find(t => t.id === printerTab);\r\n              const Icon = activeTab?.icon;\r\n              return (\r\n                <>\r\n                  <div style={{ \r\n                    width: '40px', height: '40px', borderRadius: '10px', \r\n                    background: activeTab?.bg, \r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center' \r\n                  }}>\r\n                    {Icon && <Icon size={20} style={{ color: activeTab?.color }} />}\r\n                  </div>\r\n                  <div>\r\n                    <h3 style={{ fontSize: '17px', fontWeight: '600', color: 'var(--gray-900)', margin: 0 }}>\r\n                      {activeTab?.label}\r\n                    </h3>\r\n                    <p style={{ fontSize: '12px', color: 'var(--gray-500)', margin: '2px 0 0' }}>\r\n                      {activeTab?.desc}\r\n                    </p>\r\n                  </div>\r\n                </>\r\n              );\r\n            })()}\r\n          </div>\r\n\r\n          {/* Content Body */}\r\n          <div style={{ padding: '28px', overflowY: 'auto', flex: 1 }}>\r\n\r\n            {/*  TAB: Bill Printer  */}\r\n            {printerTab === 'bill' && (\r\n              <div style={{ display: 'grid', gap: '28px' }}>\r\n                {/* Info Banner */}\r\n                <div style={{ \r\n                  display: 'flex', gap: '14px', padding: '16px 20px', \r\n                  background: 'var(--success-50)', borderRadius: '12px', \r\n                  border: '1px solid var(--success-200)', alignItems: 'flex-start' \r\n                }}>\r\n                  <Printer size={22} style={{ color: 'var(--success-600)', flexShrink: 0, marginTop: '2px' }} />\r\n                  <div>\r\n                    <strong style={{ color: 'var(--success-700)', fontSize: '14px' }}>Primary Bill Printer</strong>\r\n                    <p style={{ color: 'var(--success-600)', fontSize: '13px', marginTop: '4px', lineHeight: '1.5' }}>\r\n                      This printer is used for printing customer receipts and invoices. When an order is placed, \r\n                      the bill is automatically sent to this printer.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Printer Selection */}\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Printer Configuration</h4>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>\r\n                    <div className=\"input-group\">\r\n                      <label className=\"input-label\" style={{ display: 'flex', justifyContent: 'space-between' }}>\r\n                        Select Printer \r\n                        <span style={{ fontSize: '11px', color: 'var(--success-600)', fontWeight: 'normal' }}>USB / Wi-Fi / Bluetooth supported</span>\r\n                      </label>\r\n                      <select className=\"input select\" value={settings.printer_bill || ''} onChange={(e) => updateSetting('printer_bill', e.target.value)}>\r\n                        <option value=\"\">-- Select Printer --</option>\r\n                        {printers.map(p => <option key={p.name} value={p.name}>{p.displayName || p.name} {p.isDefault ? '(Default)' : ''}</option>)}\r\n                      </select>\r\n                    </div>\r\n                    <div className=\"input-group\">\r\n                      <label className=\"input-label\">Paper Width</label>\r\n                      <select className=\"input select\" value={settings.bill_paper_width || '80'} onChange={(e) => updateSetting('bill_paper_width', e.target.value)}>\r\n                        <option value=\"80\">80mm (Standard)</option>\r\n                        <option value=\"58\">58mm (Compact)</option>\r\n                      </select>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Receipt Footer</h4>\r\n                  <div className=\"input-group\">\r\n                    <label className=\"input-label\">Footer Message</label>\r\n                    <input\r\n                      type=\"text\" className=\"input\"\r\n                      value={settings.receipt_footer || ''}\r\n                      onChange={(e) => updateSetting('receipt_footer', e.target.value)}\r\n                      placeholder=\"Thank you for dining with us!\"\r\n                    />\r\n                    <p style={{ fontSize: '12px', color: 'var(--gray-400)', marginTop: '6px' }}>This message will appear at the bottom of every printed bill.</p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Test Print */}\r\n                <div style={{ \r\n                  padding: '20px', background: 'var(--gray-50)', borderRadius: '12px', \r\n                  border: '1px solid var(--gray-200)',\r\n                  display: 'flex', justifyContent: 'space-between', alignItems: 'center'\r\n                }}>\r\n                  <div>\r\n                    <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)' }}>Test Bill Printer</div>\r\n                    <div style={{ fontSize: '13px', color: 'var(--gray-500)', marginTop: '2px' }}>\r\n                      Send a test page to verify printer connection\r\n                    </div>\r\n                  </div>\r\n                  <button \r\n                    className=\"btn btn-primary\"\r\n                    onClick={() => handleTestPrint(settings.printer_bill)}\r\n                    disabled={!settings.printer_bill || testingPrinter === settings.printer_bill}\r\n                    style={{ display: 'flex', alignItems: 'center', gap: '8px' }}\r\n                  >\r\n                    <Printer size={16} />\r\n                    {testingPrinter === settings.printer_bill ? 'Printing...' : 'Test Print'}\r\n                  </button>\r\n                </div>\r\n\r\n                {/* System Printers List */}\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)', display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                    <Zap size={18} style={{ color: 'var(--primary-500)' }} /> Detected System Printers\r\n                  </h4>\r\n                  <div style={{ \r\n                    background: 'white', borderRadius: '12px', border: '1px solid var(--gray-200)', overflow: 'hidden'\r\n                  }}>\r\n                    {printers.length === 0 ? (\r\n                      <div style={{ padding: '24px', textAlign: 'center', color: 'var(--gray-500)', fontSize: '13px' }}>\r\n                        No printers detected on this computer.\r\n                      </div>\r\n                    ) : (\r\n                      <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '13px' }}>\r\n                        <thead style={{ background: 'var(--gray-50)' }}>\r\n                          <tr>\r\n                            <th style={{ padding: '12px 16px', textAlign: 'left', fontWeight: '600', color: 'var(--gray-700)', borderBottom: '1px solid var(--gray-200)' }}>Printer Name</th>\r\n                            <th style={{ padding: '12px 16px', textAlign: 'left', fontWeight: '600', color: 'var(--gray-700)', borderBottom: '1px solid var(--gray-200)' }}>Status</th>\r\n                            <th style={{ padding: '12px 16px', textAlign: 'left', fontWeight: '600', color: 'var(--gray-700)', borderBottom: '1px solid var(--gray-200)' }}>Type</th>\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {printers.map((p, i) => (\r\n                            <tr key={i} style={{ borderBottom: '1px solid var(--gray-100)' }}>\r\n                              <td style={{ padding: '12px 16px', fontWeight: '500', color: 'var(--gray-800)' }}>\r\n                                {p.displayName || p.name}\r\n                                {p.isDefault && <span style={{ marginLeft: '8px', fontSize: '10px', background: 'var(--primary-100)', color: 'var(--primary-700)', padding: '2px 6px', borderRadius: '10px', fontWeight: 'bold' }}>DEFAULT</span>}\r\n                              </td>\r\n                              <td style={{ padding: '12px 16px' }}>\r\n                                {p.status !== 0 ? (\r\n                                  <span style={{ color: 'var(--error-600)', fontSize: '12px', display:'flex', alignItems:'center', gap:'4px' }}><span style={{width:'8px', height:'8px', borderRadius:'50%', background:'var(--error-500)'}}></span> Offline / Error</span>\r\n                                ) : (\r\n                                  <span style={{ color: 'var(--success-600)', fontSize: '12px', display:'flex', alignItems:'center', gap:'4px' }}><span style={{width:'8px', height:'8px', borderRadius:'50%', background:'var(--success-500)'}}></span> Ready</span>\r\n                                )}\r\n                              </td>\r\n                              <td style={{ padding: '12px 16px', color: 'var(--gray-500)', fontSize: '12px' }}>\r\n                                {p.name.toLowerCase().includes('pdf') || p.name.toLowerCase().includes('xps') || p.name.toLowerCase().includes('onenote') ? 'Virtual/Software' : 'Hardware (USB/Network)'}\r\n                              </td>\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    )}\r\n                  </div>\r\n                  <p style={{ fontSize: '12px', color: 'var(--gray-500)', marginTop: '12px', display: 'flex', gap: '6px', alignItems: 'center' }}>\r\n                    <Info size={14} /> ZapBill automatically detects any USB, Wi-Fi, Ethernet, or Bluetooth printer connected to your operating system.\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/*  TAB: KOT Printer  */}\r\n            {printerTab === 'kot' && (\r\n              <div style={{ display: 'grid', gap: '28px' }}>\r\n                {/* Info Banner */}\r\n                <div style={{ \r\n                  display: 'flex', gap: '14px', padding: '16px 20px', \r\n                  background: 'var(--warning-50)', borderRadius: '12px', \r\n                  border: '1px solid var(--warning-200)', alignItems: 'flex-start' \r\n                }}>\r\n                  <Info size={22} style={{ color: 'var(--warning-600)', flexShrink: 0, marginTop: '2px' }} />\r\n                  <div>\r\n                    <strong style={{ color: 'var(--warning-700)', fontSize: '14px' }}>Default / Fallback Printer</strong>\r\n                    <p style={{ color: 'var(--warning-600)', fontSize: '13px', marginTop: '4px', lineHeight: '1.5' }}>\r\n                      This printer handles KOTs for items that aren't assigned to any specific kitchen station. \r\n                      If you have kitchen stations configured, only unmapped category items will print here.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Printer Selection */}\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>KOT Printer Configuration</h4>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>\r\n                    <div className=\"input-group\">\r\n                      <label className=\"input-label\">Select KOT Printer</label>\r\n                      <select className=\"input select\" value={settings.printer_kot || ''} onChange={(e) => updateSetting('printer_kot', e.target.value)}>\r\n                        <option value=\"\">-- Select Printer --</option>\r\n                        {printers.map(p => <option key={p.name} value={p.name}>{p.displayName || p.name} {p.isDefault ? '(Default)' : ''}</option>)}\r\n                      </select>\r\n                    </div>\r\n                    <div style={{ display: 'flex', alignItems: 'flex-end' }}>\r\n                      <button \r\n                        className=\"btn btn-primary\"\r\n                        onClick={() => handleTestPrint(settings.printer_kot)}\r\n                        disabled={!settings.printer_kot || testingPrinter === settings.printer_kot}\r\n                        style={{ display: 'flex', alignItems: 'center', gap: '8px', height: '42px' }}\r\n                      >\r\n                        <Printer size={16} />\r\n                        {testingPrinter === settings.printer_kot ? 'Printing...' : 'Test Print'}\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* KOT Options */}\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>KOT Printing Options</h4>\r\n                  <div style={{ display: 'grid', gap: '12px' }}>\r\n                    <div style={{ \r\n                      display: 'flex', justifyContent: 'space-between', alignItems: 'center',\r\n                      padding: '18px 20px', background: 'var(--gray-50)', \r\n                      borderRadius: '12px', border: '1px solid var(--gray-200)' \r\n                    }}>\r\n                      <div>\r\n                        <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)' }}>Auto-Print KOT</div>\r\n                        <div style={{ fontSize: '13px', color: 'var(--gray-500)', marginTop: '3px' }}>\r\n                          Automatically send KOT to kitchen when saving a new order\r\n                        </div>\r\n                      </div>\r\n                      <Toggle checked={settings.auto_print_kot === 'true'} onChange={(v) => updateSetting('auto_print_kot', v ? 'true' : 'false')} />\r\n                    </div>\r\n\r\n                    <div style={{ \r\n                      display: 'flex', justifyContent: 'space-between', alignItems: 'center',\r\n                      padding: '18px 20px', background: 'var(--gray-50)', \r\n                      borderRadius: '12px', border: '1px solid var(--gray-200)' \r\n                    }}>\r\n                      <div>\r\n                        <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)' }}>Attach Mini-Bill with KOT</div>\r\n                        <div style={{ fontSize: '13px', color: 'var(--gray-500)', marginTop: '3px' }}>\r\n                          Print a condensed bill summary below each KOT (tear-off kitchen reference copy)\r\n                        </div>\r\n                      </div>\r\n                      <Toggle checked={settings.kot_attach_bill !== 'false'} onChange={(v) => updateSetting('kot_attach_bill', v ? 'true' : 'false')} />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/*  TAB: Kitchen Stations  */}\r\n            {printerTab === 'stations' && (\r\n              <div style={{ display: 'grid', gap: '28px' }}>\r\n                {/* Header with Add Button */}\r\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                  <div>\r\n                    <p style={{ color: 'var(--gray-500)', fontSize: '13px', margin: 0 }}>\r\n                      Create stations (e.g., Bar, Tandoor, Chinese) and assign menu categories to route KOTs to separate kitchen printers.\r\n                    </p>\r\n                  </div>\r\n                  <button className=\"btn btn-primary\" onClick={() => setShowAddStation(true)} style={{ display: 'flex', alignItems: 'center', gap: '6px', whiteSpace: 'nowrap' }}>\r\n                    <Plus size={16} /> Add Station\r\n                  </button>\r\n                </div>\r\n\r\n                {/* Add Station Form */}\r\n                {showAddStation && (\r\n                  <div style={{ padding: '20px', background: 'var(--primary-50)', borderRadius: '12px', border: '1px solid var(--primary-200)' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '16px' }}>\r\n                      <h4 style={{ fontSize: '15px', fontWeight: '700', color: 'var(--primary-700)', margin: 0 }}>New Kitchen Station</h4>\r\n                      <button onClick={() => setShowAddStation(false)} style={{ background: 'none', border: 'none', cursor: 'pointer', color: 'var(--gray-400)', padding: '4px' }}>\r\n                        <X size={18} />\r\n                      </button>\r\n                    </div>\r\n                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr auto', gap: '16px', alignItems: 'end' }}>\r\n                      <div className=\"input-group\">\r\n                        <label className=\"input-label\">Station Name</label>\r\n                        <input type=\"text\" className=\"input\" value={newStation.station_name}\r\n                          onChange={(e) => setNewStation(prev => ({ ...prev, station_name: e.target.value }))}\r\n                          placeholder=\"e.g. Bar Section\" style={{ background: 'white' }}\r\n                        />\r\n                      </div>\r\n                      <div className=\"input-group\">\r\n                        <label className=\"input-label\">Assigned Printer</label>\r\n                        <select className=\"input select\" value={newStation.printer_name}\r\n                          onChange={(e) => setNewStation(prev => ({ ...prev, printer_name: e.target.value }))}\r\n                          style={{ background: 'white' }}\r\n                        >\r\n                          <option value=\"\">-- Select --</option>\r\n                          {printers.map(p => <option key={p.name} value={p.name}>{p.name}</option>)}\r\n                        </select>\r\n                      </div>\r\n                      <div style={{ display: 'flex', gap: '8px' }}>\r\n                        <button className=\"btn btn-primary\" onClick={handleAddStation}>Save</button>\r\n                        <button className=\"btn btn-secondary\" onClick={() => setShowAddStation(false)}>Cancel</button>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n\r\n                {/* Stations Grid */}\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>\r\n                    Active Stations ({stations.length})\r\n                  </h4>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(260px, 1fr))', gap: '16px' }}>\r\n                    {stations.map(station => {\r\n                      const assignedCats = categoryMap\r\n                        .filter(m => m.station_id === station.id)\r\n                        .map(m => categories.find(c => c.id === m.category_id))\r\n                        .filter(Boolean);\r\n                      return (\r\n                        <div key={station.id} style={{ \r\n                          padding: '20px', border: '1px solid var(--gray-200)', borderRadius: '12px',\r\n                          background: 'white', transition: 'box-shadow 0.2s'\r\n                        }}\r\n                          onMouseEnter={e => e.currentTarget.style.boxShadow = '0 4px 12px rgba(0,0,0,0.08)'}\r\n                          onMouseLeave={e => e.currentTarget.style.boxShadow = 'none'}\r\n                        >\r\n                          <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>\r\n                            <div>\r\n                              <h4 style={{ fontWeight: '700', fontSize: '15px', color: 'var(--gray-900)', margin: 0 }}>{station.station_name}</h4>\r\n                              <div style={{ display: 'flex', alignItems: 'center', gap: '6px', color: 'var(--gray-500)', fontSize: '12px', marginTop: '4px' }}>\r\n                                <Printer size={12} /> {station.printer_name}\r\n                              </div>\r\n                            </div>\r\n                            <button onClick={() => handleDeleteStation(station.id)}\r\n                              style={{ background: 'var(--danger-50)', border: '1px solid var(--danger-200)', borderRadius: '8px', padding: '6px 8px', cursor: 'pointer', color: 'var(--danger-500)', height: 'fit-content' }}\r\n                              title=\"Delete Station\"\r\n                            >\r\n                              <Trash2 size={14} />\r\n                            </button>\r\n                          </div>\r\n                          {assignedCats.length > 0 ? (\r\n                            <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px', marginBottom: '14px' }}>\r\n                              {assignedCats.map(cat => (\r\n                                <span key={cat.id} style={{ fontSize: '11px', padding: '2px 8px', borderRadius: '10px', background: 'var(--primary-50)', color: 'var(--primary-700)', border: '1px solid var(--primary-200)' }}>\r\n                                  {cat.name}\r\n                                </span>\r\n                              ))}\r\n                            </div>\r\n                          ) : (\r\n                            <p style={{ fontSize: '12px', color: 'var(--gray-400)', marginBottom: '14px', fontStyle: 'italic' }}>No categories assigned yet</p>\r\n                          )}\r\n                          <button className=\"btn btn-secondary\" style={{ width: '100%', fontSize: '12px', padding: '8px' }}\r\n                            onClick={() => handleTestPrint(station.printer_name)}\r\n                            disabled={testingPrinter === station.printer_name}\r\n                          >\r\n                            <Printer size={13} style={{ marginRight: '6px' }} />\r\n                            {testingPrinter === station.printer_name ? 'Testing...' : 'Test Connection'}\r\n                          </button>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                    {stations.length === 0 && !showAddStation && (\r\n                      <div style={{ gridColumn: '1/-1', textAlign: 'center', padding: '48px', background: 'var(--gray-50)', borderRadius: '12px', border: '2px dashed var(--gray-200)' }}>\r\n                        <Store size={40} style={{ color: 'var(--gray-300)', marginBottom: '12px' }} />\r\n                        <p style={{ color: 'var(--gray-500)', fontWeight: '500', margin: 0 }}>No kitchen stations configured.</p>\r\n                        <p style={{ color: 'var(--gray-400)', fontSize: '13px', marginTop: '4px' }}>Click \"Add Station\" to create your first station.</p>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Category Routing Matrix */}\r\n                {stations.length > 0 && categories.length > 0 && (\r\n                  <div>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '16px' }}>\r\n                      <h4 style={{ fontSize: '15px', fontWeight: '600', color: 'var(--gray-800)', margin: 0 }}>Category  Station Routing</h4>\r\n                      <span style={{ fontSize: '11px', padding: '3px 10px', borderRadius: '10px', background: 'var(--primary-50)', color: 'var(--primary-700)', fontWeight: '600' }}>\r\n                        Click checkboxes to assign\r\n                      </span>\r\n                    </div>\r\n                    <div style={{ border: '1px solid var(--gray-200)', borderRadius: '12px', overflow: 'hidden' }}>\r\n                      <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '13px' }}>\r\n                        <thead>\r\n                          <tr style={{ background: 'var(--gray-50)', borderBottom: '2px solid var(--gray-200)' }}>\r\n                            <th style={{ padding: '14px 20px', textAlign: 'left', fontWeight: '600', color: 'var(--gray-700)' }}>Category</th>\r\n                            {stations.map(s => (\r\n                              <th key={s.id} style={{ padding: '14px 12px', textAlign: 'center', fontWeight: '600', color: 'var(--gray-700)', borderLeft: '1px solid var(--gray-200)' }}>\r\n                                <div>{s.station_name}</div>\r\n                                <div style={{ fontSize: '10px', fontWeight: '400', color: 'var(--gray-400)', marginTop: '2px' }}>{s.printer_name}</div>\r\n                              </th>\r\n                            ))}\r\n                          </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                          {categories.map((cat, idx) => (\r\n                            <tr key={cat.id} style={{ borderBottom: '1px solid var(--gray-100)', background: idx % 2 === 0 ? 'white' : 'var(--gray-50)' }}>\r\n                              <td style={{ padding: '12px 20px', fontWeight: '500', color: 'var(--gray-800)' }}>{cat.name}</td>\r\n                              {stations.map(station => {\r\n                                const isAssigned = categoryMap.some(m => m.category_id === cat.id && m.station_id === station.id);\r\n                                return (\r\n                                  <td key={station.id} style={{ padding: '10px', textAlign: 'center', borderLeft: '1px solid var(--gray-200)' }}>\r\n                                    <div onClick={() => handleToggleCategoryStation(cat.id, station.id)}\r\n                                      style={{ \r\n                                        width: '26px', height: '26px', borderRadius: '7px',\r\n                                        border: isAssigned ? 'none' : '2px solid var(--gray-300)',\r\n                                        background: isAssigned ? 'var(--primary-500)' : 'white',\r\n                                        color: 'white', display: 'flex', alignItems: 'center', justifyContent: 'center',\r\n                                        cursor: 'pointer', margin: '0 auto', transition: 'all 0.15s ease',\r\n                                        boxShadow: isAssigned ? '0 2px 4px rgba(0,150,255,0.3)' : 'none'\r\n                                      }}\r\n                                    >\r\n                                      {isAssigned && <CheckCircle2 size={16} />}\r\n                                    </div>\r\n                                  </td>\r\n                                );\r\n                              })}\r\n                            </tr>\r\n                          ))}\r\n                        </tbody>\r\n                      </table>\r\n                    </div>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/*  TAB: Bill Format  */}\r\n            {printerTab === 'format' && (\r\n              <div style={{ display: 'grid', gap: '28px' }}>\r\n                {/* Logo Section */}\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Restaurant Logo</h4>\r\n                  <div style={{ padding: '20px', background: 'var(--gray-50)', borderRadius: '12px', border: '1px solid var(--gray-200)' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n                      <div>\r\n                        <p style={{ fontSize: '13px', color: 'var(--gray-500)', margin: '0 0 16px' }}>Printed at the top of every bill. Recommended: Black & White PNG.</p>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>\r\n                          {settings.bill_logo_path ? (\r\n                            <div style={{ padding: '8px', background: 'white', border: '1px solid var(--gray-200)', borderRadius: '10px' }}>\r\n                              <img src={settings.bill_logo_path} alt=\"Logo\" style={{ height: '60px', width: 'auto' }} />\r\n                            </div>\r\n                          ) : (\r\n                            <div style={{ height: '60px', width: '60px', background: 'var(--gray-200)', borderRadius: '10px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                              <Image size={24} color=\"var(--gray-400)\" />\r\n                            </div>\r\n                          )}\r\n                          <button className=\"btn btn-secondary\" onClick={handleSelectLogo} style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                            <Upload size={16} /> {settings.bill_logo_path ? 'Change Logo' : 'Upload Logo'}\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                      <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                        <span style={{ fontSize: '12px', color: 'var(--gray-500)' }}>Show on bill</span>\r\n                        <Toggle checked={settings.bill_show_logo === 'true'} onChange={(v) => updateSetting('bill_show_logo', v ? 'true' : 'false')} />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* QR Code */}\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>UPI QR Code</h4>\r\n                  <div style={{ padding: '20px', background: 'var(--gray-50)', borderRadius: '12px', border: '1px solid var(--gray-200)' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: settings.bill_show_qr === 'true' ? '16px' : '0' }}>\r\n                      <p style={{ fontSize: '13px', color: 'var(--gray-500)', margin: 0 }}>Print a scannable payment QR code at the bottom of the bill.</p>\r\n                      <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n                        <span style={{ fontSize: '12px', color: 'var(--gray-500)' }}>Enable</span>\r\n                        <Toggle checked={settings.bill_show_qr === 'true'} onChange={(v) => updateSetting('bill_show_qr', v ? 'true' : 'false')} />\r\n                      </div>\r\n                    </div>\r\n                    {settings.bill_show_qr === 'true' && (\r\n                      <div className=\"input-group\" style={{ marginTop: '8px' }}>\r\n                        <label className=\"input-label\">UPI ID (VPA)</label>\r\n                        <input type=\"text\" className=\"input\" value={settings.bill_qr_upi_id || ''}\r\n                          onChange={(e) => updateSetting('bill_qr_upi_id', e.target.value)}\r\n                          placeholder=\"e.g. merchant@okhdfcbank\"\r\n                        />\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Additional Details */}\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Additional Invoice Details</h4>\r\n                  <div style={{ display: 'grid', gap: '0', border: '1px solid var(--gray-200)', borderRadius: '12px', overflow: 'hidden' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '18px 20px', borderBottom: '1px solid var(--gray-100)', background: 'white' }}>\r\n                      <div>\r\n                        <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)' }}>Item-wise Tax Breakdown</div>\r\n                        <p style={{ fontSize: '12px', color: 'var(--gray-500)', marginTop: '3px' }}>Show tax details (CGST/SGST) for each item row.</p>\r\n                      </div>\r\n                      <Toggle checked={settings.bill_show_itemwise_tax === 'true'} onChange={(v) => updateSetting('bill_show_itemwise_tax', v ? 'true' : 'false')} />\r\n                    </div>\r\n\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', padding: '18px 20px', borderBottom: '1px solid var(--gray-100)', background: 'white' }}>\r\n                      <div>\r\n                        <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)' }}>Customer Details</div>\r\n                        <p style={{ fontSize: '12px', color: 'var(--gray-500)', marginTop: '3px' }}>Print customer name and phone number on the bill.</p>\r\n                      </div>\r\n                      <Toggle checked={settings.bill_show_customer_details !== 'false'} onChange={(v) => updateSetting('bill_show_customer_details', v ? 'true' : 'false')} />\r\n                    </div>\r\n\r\n                    <div style={{ padding: '18px 20px', background: 'white' }}>\r\n                      <div className=\"input-group\">\r\n                        <label className=\"input-label\">FSSAI License Number</label>\r\n                        <input type=\"text\" className=\"input\" value={settings.bill_fssai_number || ''}\r\n                          onChange={(e) => updateSetting('bill_fssai_number', e.target.value)}\r\n                          placeholder=\"e.g. 12345678901234\"\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/*  TAB: Print Flow  */}\r\n            {printerTab === 'flow' && (\r\n              <div style={{ display: 'grid', gap: '28px' }}>\r\n                <div style={{ \r\n                  padding: '24px', background: 'linear-gradient(135deg, var(--primary-50) 0%, #f0f4ff 100%)', \r\n                  borderRadius: '12px', border: '1px solid var(--primary-200)' \r\n                }}>\r\n                  <h4 style={{ fontSize: '16px', fontWeight: '700', marginBottom: '8px', color: 'var(--gray-900)' }}>How Order Printing Works</h4>\r\n                  <p style={{ fontSize: '13px', color: 'var(--gray-600)', lineHeight: '1.6', margin: 0 }}>\r\n                    When a biller places an order, multiple print jobs are triggered simultaneously. Here's the complete flow:\r\n                  </p>\r\n                </div>\r\n\r\n                {/* Flow Steps */}\r\n                <div style={{ display: 'grid', gap: '16px' }}>\r\n                  {/* Step 1 */}\r\n                  <div style={{ display: 'flex', gap: '16px', alignItems: 'flex-start' }}>\r\n                    <div style={{ \r\n                      width: '36px', height: '36px', borderRadius: '50%', flexShrink: 0,\r\n                      background: 'var(--primary-500)', color: 'white', display: 'flex', \r\n                      alignItems: 'center', justifyContent: 'center', fontWeight: '700', fontSize: '14px' \r\n                    }}>1</div>\r\n                    <div style={{ padding: '16px 20px', background: 'var(--gray-50)', borderRadius: '12px', border: '1px solid var(--gray-200)', flex: 1 }}>\r\n                      <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)', marginBottom: '4px' }}>\r\n                         Order is Placed\r\n                      </div>\r\n                      <p style={{ fontSize: '13px', color: 'var(--gray-500)', margin: 0, lineHeight: '1.5' }}>\r\n                        Biller saves an order from the POS billing page. The system identifies all items and their categories.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Step 2 */}\r\n                  <div style={{ display: 'flex', gap: '16px', alignItems: 'flex-start' }}>\r\n                    <div style={{ \r\n                      width: '36px', height: '36px', borderRadius: '50%', flexShrink: 0,\r\n                      background: 'var(--success-500)', color: 'white', display: 'flex', \r\n                      alignItems: 'center', justifyContent: 'center', fontWeight: '700', fontSize: '14px' \r\n                    }}>2</div>\r\n                    <div style={{ padding: '16px 20px', background: 'var(--success-50)', borderRadius: '12px', border: '1px solid var(--success-200)', flex: 1 }}>\r\n                      <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)', marginBottom: '4px' }}>\r\n                         Customer Bill Prints\r\n                      </div>\r\n                      <p style={{ fontSize: '13px', color: 'var(--gray-500)', margin: 0, lineHeight: '1.5' }}>\r\n                        The complete bill (with all items, totals, taxes, logo, QR code) is sent to the <strong>Bill Printer</strong> for the customer.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Step 3 */}\r\n                  <div style={{ display: 'flex', gap: '16px', alignItems: 'flex-start' }}>\r\n                    <div style={{ \r\n                      width: '36px', height: '36px', borderRadius: '50%', flexShrink: 0,\r\n                      background: 'var(--warning-500)', color: 'white', display: 'flex', \r\n                      alignItems: 'center', justifyContent: 'center', fontWeight: '700', fontSize: '14px' \r\n                    }}>3</div>\r\n                    <div style={{ padding: '16px 20px', background: 'var(--warning-50)', borderRadius: '12px', border: '1px solid var(--warning-200)', flex: 1 }}>\r\n                      <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)', marginBottom: '4px' }}>\r\n                         Station KOTs Print (Simultaneously)\r\n                      </div>\r\n                      <p style={{ fontSize: '13px', color: 'var(--gray-500)', margin: 0, lineHeight: '1.5' }}>\r\n                        Items are grouped by their category  station mapping. Each station's printer receives only its assigned items. \r\n                        For example, \"Drinks\" category items go to Bar printer, \"Tandoor\" items go to Tandoor printer.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Step 4 */}\r\n                  <div style={{ display: 'flex', gap: '16px', alignItems: 'flex-start' }}>\r\n                    <div style={{ \r\n                      width: '36px', height: '36px', borderRadius: '50%', flexShrink: 0,\r\n                      background: 'var(--info-500)', color: 'white', display: 'flex', \r\n                      alignItems: 'center', justifyContent: 'center', fontWeight: '700', fontSize: '14px' \r\n                    }}>4</div>\r\n                    <div style={{ padding: '16px 20px', background: 'var(--info-50)', borderRadius: '12px', border: '1px solid var(--info-200)', flex: 1 }}>\r\n                      <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)', marginBottom: '4px' }}>\r\n                         Mini-Bill Attached (Optional)\r\n                      </div>\r\n                      <p style={{ fontSize: '13px', color: 'var(--gray-500)', margin: 0, lineHeight: '1.5' }}>\r\n                        If \"Attach Mini-Bill\" is enabled, each KOT printout includes a tear-off condensed bill summary below the kitchen items, \r\n                        showing the complete order total for kitchen reference.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n\r\n                  {/* Step 5 */}\r\n                  <div style={{ display: 'flex', gap: '16px', alignItems: 'flex-start' }}>\r\n                    <div style={{ \r\n                      width: '36px', height: '36px', borderRadius: '50%', flexShrink: 0,\r\n                      background: 'var(--gray-400)', color: 'white', display: 'flex', \r\n                      alignItems: 'center', justifyContent: 'center', fontWeight: '700', fontSize: '14px' \r\n                    }}>5</div>\r\n                    <div style={{ padding: '16px 20px', background: 'var(--gray-50)', borderRadius: '12px', border: '1px solid var(--gray-200)', flex: 1 }}>\r\n                      <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)', marginBottom: '4px' }}>\r\n                         Unmapped Items  Default KOT Printer\r\n                      </div>\r\n                      <p style={{ fontSize: '13px', color: 'var(--gray-500)', margin: 0, lineHeight: '1.5' }}>\r\n                        Any items whose category is not assigned to a specific station will be sent to the <strong>Default KOT Printer</strong> as a fallback.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Current Config Summary */}\r\n                <div style={{ padding: '20px', background: 'var(--gray-50)', borderRadius: '12px', border: '1px solid var(--gray-200)' }}>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Current Configuration</h4>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '12px' }}>\r\n                    <div style={{ padding: '12px 16px', background: 'white', borderRadius: '10px', border: '1px solid var(--gray-200)' }}>\r\n                      <div style={{ fontSize: '11px', textTransform: 'uppercase', color: 'var(--gray-400)', fontWeight: '600', letterSpacing: '0.5px' }}>Bill Printer</div>\r\n                      <div style={{ fontSize: '14px', fontWeight: '600', color: settings.printer_bill ? 'var(--success-600)' : 'var(--danger-500)', marginTop: '4px' }}>\r\n                        {settings.printer_bill || 'Not Configured'}\r\n                      </div>\r\n                    </div>\r\n                    <div style={{ padding: '12px 16px', background: 'white', borderRadius: '10px', border: '1px solid var(--gray-200)' }}>\r\n                      <div style={{ fontSize: '11px', textTransform: 'uppercase', color: 'var(--gray-400)', fontWeight: '600', letterSpacing: '0.5px' }}>KOT Printer</div>\r\n                      <div style={{ fontSize: '14px', fontWeight: '600', color: settings.printer_kot ? 'var(--success-600)' : 'var(--danger-500)', marginTop: '4px' }}>\r\n                        {settings.printer_kot || 'Not Configured'}\r\n                      </div>\r\n                    </div>\r\n                    <div style={{ padding: '12px 16px', background: 'white', borderRadius: '10px', border: '1px solid var(--gray-200)' }}>\r\n                      <div style={{ fontSize: '11px', textTransform: 'uppercase', color: 'var(--gray-400)', fontWeight: '600', letterSpacing: '0.5px' }}>Kitchen Stations</div>\r\n                      <div style={{ fontSize: '14px', fontWeight: '600', color: 'var(--gray-800)', marginTop: '4px' }}>\r\n                        {stations.length} Station{stations.length !== 1 ? 's' : ''}\r\n                      </div>\r\n                    </div>\r\n                    <div style={{ padding: '12px 16px', background: 'white', borderRadius: '10px', border: '1px solid var(--gray-200)' }}>\r\n                      <div style={{ fontSize: '11px', textTransform: 'uppercase', color: 'var(--gray-400)', fontWeight: '600', letterSpacing: '0.5px' }}>Auto-Print KOT</div>\r\n                      <div style={{ fontSize: '14px', fontWeight: '600', color: settings.auto_print_kot === 'true' ? 'var(--success-600)' : 'var(--gray-400)', marginTop: '4px' }}>\r\n                        {settings.auto_print_kot === 'true' ? 'Enabled' : 'Disabled'}\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default PrintersPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\ReportsPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'BarChart3' is defined but never used.","line":9,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":9,"endColumn":12},{"ruleId":"no-unused-vars","severity":1,"message":"'Calendar' is defined but never used.","line":14,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":11},{"ruleId":"no-unused-vars","severity":1,"message":"'PieChartIcon' is defined but never used.","line":19,"column":15,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":27},{"ruleId":"no-unused-vars","severity":1,"message":"'Filter' is defined but never used.","line":21,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":21,"endColumn":9},{"ruleId":"no-unused-vars","severity":1,"message":"'CreditCard' is defined but never used.","line":23,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'setRowsPerPage' is assigned a value but never used.","line":149,"column":23,"nodeType":"Identifier","messageId":"unusedVar","endLine":149,"endColumn":37},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReport'. Either include it or remove the dependency array.","line":158,"column":6,"nodeType":"ArrayExpression","endLine":158,"endColumn":52,"suggestions":[{"desc":"Update the dependencies array to be: [selectedDate, reportType, startDate, endDate, loadReport]","fix":{"range":[7894,7940],"text":"[selectedDate, reportType, startDate, endDate, loadReport]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'paymentData' is assigned a value but never used.","line":264,"column":9,"nodeType":"Identifier","messageId":"unusedVar","endLine":264,"endColumn":20},{"ruleId":"no-unused-vars","severity":1,"message":"'innerRadius' is defined but never used.","line":270,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":270,"endColumn":65},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":270,"column":89,"nodeType":"Identifier","messageId":"unusedVar","endLine":270,"endColumn":94}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":11,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect, useMemo } from 'react';\r\nimport { useSearchParams } from 'react-router-dom';\r\nimport SalesReports from './Reports/SalesReports';\r\nimport InventoryReports from './Reports/InventoryReports';\r\nimport CRMReports from './Reports/CRMReports';\r\nimport StaffReports from './Reports/StaffReports';\r\nimport PaymentReports from './Reports/PaymentReports';\r\nimport { \r\n  BarChart3, \r\n  TrendingUp, \r\n  TrendingDown,\r\n  ShoppingCart,\r\n  DollarSign,\r\n  Calendar,\r\n  Download,\r\n  ChevronLeft,\r\n  ChevronRight,\r\n  XCircle,\r\n  PieChart as PieChartIcon,\r\n  Search,\r\n  Filter,\r\n  Clock,\r\n  CreditCard,\r\n  LayoutDashboard,\r\n  Table as TableIcon,\r\n  ShoppingBag\r\n} from 'lucide-react';\r\nimport { \r\n  BarChart, \r\n  Bar, \r\n  XAxis, \r\n  YAxis, \r\n  CartesianGrid, \r\n  Tooltip, \r\n  ResponsiveContainer,\r\n  AreaChart, \r\n  Area,      \r\n  PieChart,\r\n  Pie,\r\n  Cell,\r\n  Legend\r\n} from 'recharts';\r\nimport { format, subDays, startOfWeek, addDays } from 'date-fns';\r\nimport * as XLSX from 'xlsx';\r\n\r\n// Modern Color Palette\r\nconst COLORS = ['#6366f1', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#0ea5e9', '#14b8a6', '#f43f5e', '#a855f7'];\r\nconst PAYMENT_COLORS = { Cash: '#10b981', Card: '#6366f1', UPI: '#f59e0b' };\r\n\r\nconst thStyle = { padding: '14px 20px', textAlign: 'left', fontWeight: 600, color: '#64748b', fontSize: '15px' };\r\nconst tdStyle = { padding: '14px 20px', color: '#334155', fontSize: '15px' };\r\n\r\n// Order Details Modal Component\r\nconst OrderDetailsModal = ({ order, onClose }) => {\r\n  if (!order) return null;\r\n\r\n  return (\r\n    <div style={{\r\n      position: 'fixed', top: 0, left: 0, right: 0, bottom: 0,\r\n      background: 'rgba(15, 23, 42, 0.6)', backdropFilter: 'blur(4px)', zIndex: 9999, display: 'flex', justifyContent: 'center', alignItems: 'center'\r\n    }} onClick={onClose}>\r\n      <div \r\n        style={{\r\n          background: 'white', width: '90%', maxWidth: '550px', maxHeight: '90vh', overflowY: 'auto',\r\n          borderRadius: '20px', padding: '32px', position: 'relative', boxShadow: '0 25px 50px -12px rgba(0,0,0,0.25)'\r\n        }} \r\n        onClick={e => e.stopPropagation()}\r\n      >\r\n        <button onClick={onClose} style={{ position: 'absolute', top: '24px', right: '24px', border: 'none', background: '#f1f5f9', color: '#64748b', borderRadius: '50%', width: '36px', height: '36px', display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', transition: 'all 0.2s' }}>\r\n          <XCircle size={24} />\r\n        </button>\r\n        \r\n        <h2 style={{ margin: '0 0 24px 0', fontSize: '22px', fontWeight: 800, color: '#1e293b', borderBottom: '1px solid #f1f5f9', paddingBottom: '16px' }}>\r\n          Order #{order.order_number}\r\n        </h2>\r\n\r\n        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px', marginBottom: '30px' }}>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#94a3b8', textTransform: 'uppercase', fontWeight: 700, letterSpacing: '0.05em', marginBottom: '4px' }}>Date & Time</div>\r\n             <div style={{ fontWeight: '600', color: '#334155' }}>{new Date(order.created_at).toLocaleString()}</div>\r\n           </div>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#94a3b8', textTransform: 'uppercase', fontWeight: 700, letterSpacing: '0.05em', marginBottom: '4px' }}>Order Type</div>\r\n             <div style={{ fontWeight: '600', color: '#334155', textTransform: 'capitalize' }}>{order.order_type?.replace('_', ' ')}</div>\r\n           </div>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#94a3b8', textTransform: 'uppercase', fontWeight: 700, letterSpacing: '0.05em', marginBottom: '4px' }}>Payment Method</div>\r\n             <div style={{ fontWeight: '600', color: '#6366f1', textTransform: 'uppercase' }}>{order.payment_method || '-'}</div>\r\n           </div>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#94a3b8', textTransform: 'uppercase', fontWeight: 700, letterSpacing: '0.05em', marginBottom: '4px' }}>Status</div>\r\n             <div style={{ fontWeight: '700', textTransform: 'uppercase', color: order.status === 'completed' ? '#10b981' : '#f59e0b', fontSize: '13px' }}>{order.status || 'Completed'}</div>\r\n           </div>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#94a3b8', textTransform: 'uppercase', fontWeight: 700, letterSpacing: '0.05em', marginBottom: '4px' }}>Customer</div>\r\n             <div style={{ fontWeight: '600', color: '#334155' }}>{order.customer_name || 'Walk-in'}</div>\r\n           </div>\r\n           <div>\r\n             <div style={{ fontSize: '12px', color: '#94a3b8', textTransform: 'uppercase', fontWeight: 700, letterSpacing: '0.05em', marginBottom: '4px' }}>Phone</div>\r\n             <div style={{ fontWeight: '600', color: '#334155' }}>{order.customer_phone || '-'}</div>\r\n           </div>\r\n        </div>\r\n\r\n        <h3 style={{ fontSize: '16px', fontWeight: 700, margin: '0 0 16px 0', color: '#1e293b', display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n          <ShoppingBag size={18} /> Order Items\r\n        </h3>\r\n        <div style={{ border: '1px solid #f1f5f9', borderRadius: '12px', overflow: 'hidden', marginBottom: '24px' }}>\r\n           <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '14px' }}>\r\n             <thead style={{ background: '#f8fafc' }}>\r\n               <tr>\r\n                 <th style={{ padding: '12px 16px', textAlign: 'left', borderBottom: '1px solid #f1f5f9', color: '#64748b' }}>Item</th>\r\n                 <th style={{ padding: '12px 16px', textAlign: 'center', borderBottom: '1px solid #f1f5f9', color: '#64748b' }}>Qty</th>\r\n                 <th style={{ padding: '12px 16px', textAlign: 'right', borderBottom: '1px solid #f1f5f9', color: '#64748b' }}>Price</th>\r\n               </tr>\r\n             </thead>\r\n             <tbody>\r\n               {order.items?.map((item, idx) => (\r\n                 <tr key={idx} style={{ borderBottom: '1px solid #f1f5f9' }}>\r\n                   <td style={{ padding: '12px 16px', fontWeight: 500 }}>{item.item_name || item.name}</td>\r\n                   <td style={{ padding: '12px 16px', textAlign: 'center', fontWeight: 600 }}>{item.quantity}</td>\r\n                   <td style={{ padding: '12px 16px', textAlign: 'right', fontWeight: 600 }}>{(item.item_total || 0).toFixed(2)}</td>\r\n                 </tr>\r\n               ))}\r\n             </tbody>\r\n           </table>\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', borderTop: '2px solid #f1f5f9', paddingTop: '20px' }}>\r\n           <span style={{ fontSize: '16px', fontWeight: 600, color: '#64748b' }}>Total Amount</span>\r\n           <span style={{ fontSize: '24px', fontWeight: 800, color: '#10b981' }}>{(order.total_amount || 0).toFixed(2)}</span>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nconst ReportsPage = () => {\r\n  const [selectedDate, setSelectedDate] = useState(new Date());\r\n  const [reportType, setReportType] = useState('daily'); \r\n  const [data, setData] = useState(null);\r\n  const [detailedData, setDetailedData] = useState([]);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [selectedOrder, setSelectedOrder] = useState(null);\r\n  const [viewMode, setViewMode] = useState('dashboard');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [filterPayment, setFilterPayment] = useState('all');\r\n  const [filterType, setFilterType] = useState('all');\r\n  const [currentPage, setCurrentPage] = useState(1);\r\n  const [rowsPerPage, setRowsPerPage] = useState(10);\r\n  const [startDate, setStartDate] = useState(new Date());\r\n  const [endDate, setEndDate] = useState(new Date());\r\n\r\n  const [searchParams] = useSearchParams();\r\n  const category = searchParams.get('category');\r\n\r\n  useEffect(() => {\r\n    loadReport();\r\n  }, [selectedDate, reportType, startDate, endDate]);\r\n\r\n  useEffect(() => {\r\n    setCurrentPage(1);\r\n  }, [searchTerm, filterPayment, filterType, viewMode]);\r\n\r\n  const loadReport = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      let result;\r\n      let dateStr;\r\n\r\n      if (reportType === 'daily') {\r\n        dateStr = format(selectedDate, 'yyyy-MM-dd');\r\n        result = await window.electronAPI.invoke('reports:daily', { date: dateStr });\r\n        const details = await window.electronAPI.invoke('reports:dailyDetailed', { date: dateStr });\r\n        setDetailedData(details || []);\r\n      } else if (reportType === 'weekly') {\r\n        const weekStart = format(startOfWeek(selectedDate, { weekStartsOn: 1 }), 'yyyy-MM-dd');\r\n        result = await window.electronAPI.invoke('reports:weekly', { startDate: weekStart });\r\n        setDetailedData([]);\r\n      } else if (reportType === 'monthly') {\r\n        const monthStr = format(selectedDate, 'yyyy-MM');\r\n        result = await window.electronAPI.invoke('reports:monthly', { month: monthStr });\r\n        setDetailedData([]);\r\n      } else if (reportType === 'shift') {\r\n        dateStr = format(selectedDate, 'yyyy-MM-dd');\r\n        const shiftResult = await window.electronAPI.invoke('shifts:getByDate', { date: dateStr });\r\n        result = { shifts: shiftResult || [] };\r\n        setDetailedData([]);\r\n      } else if (reportType === 'custom') {\r\n        const startStr = format(startDate, 'yyyy-MM-dd');\r\n        const endStr = format(endDate, 'yyyy-MM-dd');\r\n        result = await window.electronAPI.invoke('reports:custom', { startDate: startStr, endDate: endStr });\r\n        setDetailedData([]);\r\n      }\r\n      setData(result);\r\n    } catch (error) {\r\n      console.error('Failed to load report:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const navigateDate = (direction) => {\r\n    if (reportType === 'daily') {\r\n      setSelectedDate(prev => direction === 'prev' ? subDays(prev, 1) : addDays(prev, 1));\r\n    } else if (reportType === 'weekly') {\r\n      setSelectedDate(prev => direction === 'prev' ? subDays(prev, 7) : addDays(prev, 7));\r\n    } else {\r\n      setSelectedDate(prev => {\r\n        const d = new Date(prev);\r\n        d.setMonth(d.getMonth() + (direction === 'prev' ? -1 : 1));\r\n        return d;\r\n      });\r\n    }\r\n  };\r\n\r\n  const FormatDateRange = () => {\r\n    if (reportType === 'daily') return format(selectedDate, 'EEEE, MMMM d, yyyy');\r\n    if (reportType === 'weekly') {\r\n      const start = startOfWeek(selectedDate, { weekStartsOn: 1 });\r\n      const end = addDays(start, 6);\r\n      return `${format(start, 'MMM d')} - ${format(end, 'MMM d, yyyy')}`;\r\n    }\r\n    return format(selectedDate, 'MMMM yyyy');\r\n  };\r\n\r\n  const exportToExcel = async () => {\r\n    try {\r\n      if (!data) return;\r\n      const wb = XLSX.utils.book_new();\r\n      const summaryData = [{\r\n        'Report Period': FormatDateRange(),\r\n        'Total Revenue ()': (data.sales?.total_revenue || 0).toFixed(2),\r\n        'Total Expenses ()': (data.sales?.total_expenses || 0).toFixed(2),\r\n        'Net Revenue ()': (data.sales?.net_revenue || 0).toFixed(2),\r\n        'Total Orders': data.sales?.total_orders || 0,\r\n        'Cash Sales ()': (data.sales?.cash_amount || 0).toFixed(2),\r\n        'Card Sales ()': (data.sales?.card_amount || 0).toFixed(2),\r\n        'UPI Sales ()': (data.sales?.upi_amount || 0).toFixed(2),\r\n      }];\r\n      XLSX.utils.book_append_sheet(wb, XLSX.utils.json_to_sheet(summaryData), 'Summary');\r\n      XLSX.writeFile(wb, `${reportType}_Report_${format(new Date(), 'yyyyMMdd')}.xlsx`);\r\n    } catch (error) { console.error(error); }\r\n  };\r\n\r\n  const filteredData = useMemo(() => {\r\n    if (!detailedData) return [];\r\n    return detailedData.filter(item => {\r\n      const searchLower = searchTerm.toLowerCase();\r\n      const matchSearch = !searchTerm || item.order_number?.toLowerCase().includes(searchLower) || item.customer_name?.toLowerCase().includes(searchLower) || item.item_name?.toLowerCase().includes(searchLower);\r\n      const matchPayment = filterPayment === 'all' || item.payment_method === filterPayment;\r\n      const matchType = filterType === 'all' || item.order_type === filterType;\r\n      return matchSearch && matchPayment && matchType;\r\n    });\r\n  }, [detailedData, searchTerm, filterPayment, filterType]);\r\n\r\n  const totalPages = Math.ceil(filteredData.length / rowsPerPage);\r\n  const paginatedData = filteredData.slice((currentPage - 1) * rowsPerPage, currentPage * rowsPerPage);\r\n\r\n  const sales = data?.sales || {};\r\n  const topItems = data?.topItems || [];\r\n  const categorySales = data?.categorySales || [];\r\n  const dailyTrend = data?.dailyTrend || [];\r\n  const orders = data?.orders || [];\r\n  const paymentData = sales.cash_amount !== undefined ? [\r\n    { name: 'Cash', value: sales.cash_amount || 0 },\r\n    { name: 'Card', value: sales.card_amount || 0 },\r\n    { name: 'UPI', value: sales.upi_amount || 0 },\r\n  ].filter(d => d.value > 0) : [];\r\n\r\n  const renderCustomizedLabel = ({ cx, cy, midAngle, innerRadius, outerRadius, percent, index, category_name }) => {\r\n    const RADIAN = Math.PI / 180;\r\n    const radius = outerRadius + 20;\r\n    const x = cx + radius * Math.cos(-midAngle * RADIAN);\r\n    const y = cy + radius * Math.sin(-midAngle * RADIAN);\r\n    const textAnchor = x > cx ? 'start' : 'end';\r\n    return (\r\n      <text x={x} y={y} fill=\"#1e293b\" textAnchor={textAnchor} dominantBaseline=\"central\" fontSize=\"13\" fontWeight=\"700\">\r\n        {`${category_name} (${(percent * 100).toFixed(0)}%)`}\r\n      </text>\r\n    );\r\n  };\r\n\r\n  const SubReportWrapper = ({ children }) => (\r\n    <div style={{ padding: '24px', height: 'calc(100vh - 64px)', marginTop: '64px', overflowY: 'auto', background: '#f8fafc' }}>\r\n      {children}\r\n    </div>\r\n  );\r\n\r\n  if (category === 'sales') return <SubReportWrapper><SalesReports /></SubReportWrapper>;\r\n  if (category === 'inventory') return <SubReportWrapper><InventoryReports /></SubReportWrapper>;\r\n  if (category === 'crm') return <SubReportWrapper><CRMReports /></SubReportWrapper>;\r\n  if (category === 'staff') return <SubReportWrapper><StaffReports /></SubReportWrapper>;\r\n  if (category === 'payment') return <SubReportWrapper><PaymentReports /></SubReportWrapper>;\r\n\r\n  return (\r\n    <div style={{ padding: '24px', height: 'calc(100vh - 64px)', marginTop: '64px', display: 'flex', flexDirection: 'column', background: '#f8fafc', overflowY: 'auto' }}>\r\n      {/* Header */}\r\n      <div style={{ \r\n        padding: '20px 24px',\r\n        background: 'white',\r\n        borderRadius: '16px',\r\n        display: 'flex',\r\n        justifyContent: 'space-between',\r\n        alignItems: 'center',\r\n        boxShadow: '0 4px 6px -1px rgba(0,0,0,0.05)',\r\n        marginBottom: '24px'\r\n      }}>\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '20px' }}>\r\n          <h1 style={{ fontSize: '24px', fontWeight: 800, color: '#1e293b', margin: 0 }}>Reports</h1>\r\n          <div style={{ display: 'flex', background: '#f1f5f9', borderRadius: '10px', padding: '4px' }}>\r\n            {['daily', 'weekly', 'monthly', 'shift', 'custom'].map(type => (\r\n              <button key={type} onClick={() => setReportType(type)} style={{\r\n                padding: '8px 18px', borderRadius: '8px', border: 'none', background: reportType === type ? 'white' : 'transparent',\r\n                color: reportType === type ? '#6366f1' : '#64748b', fontWeight: 600, fontSize: '14px', cursor: 'pointer', transition: 'all 0.2s',\r\n                boxShadow: reportType === type ? '0 1px 3px rgba(0,0,0,0.1)' : 'none', textTransform: 'capitalize'\r\n              }}>{type}</button>\r\n            ))}\r\n          </div>\r\n          {reportType === 'daily' && (\r\n             <div style={{ display: 'flex', background: '#e0e7ff', borderRadius: '10px', padding: '4px' }}>\r\n                <button onClick={() => setViewMode('dashboard')} style={{\r\n                    padding: '8px 14px', borderRadius: '8px', border: 'none', background: viewMode === 'dashboard' ? '#6366f1' : 'transparent',\r\n                    color: viewMode === 'dashboard' ? 'white' : '#4f46e5', fontWeight: 600, fontSize: '14px', cursor: 'pointer', gap: '6px', display: 'flex', alignItems: 'center'\r\n                }}><LayoutDashboard size={16} /> Dashboard</button>\r\n                <button onClick={() => setViewMode('detailed')} style={{\r\n                    padding: '8px 14px', borderRadius: '8px', border: 'none', background: viewMode === 'detailed' ? '#6366f1' : 'transparent',\r\n                    color: viewMode === 'detailed' ? 'white' : '#4f46e5', fontWeight: 600, fontSize: '14px', cursor: 'pointer', gap: '6px', display: 'flex', alignItems: 'center'\r\n                }}><TableIcon size={16} /> Detailed</button>\r\n             </div>\r\n          )}\r\n        </div>\r\n\r\n        <div style={{ display: 'flex', gap: '12px' }}>\r\n          {reportType === 'custom' ? (\r\n            <div style={{ display: 'flex', gap: '10px', alignItems: 'center', background: 'white', padding: '6px 12px', borderRadius: '10px', border: '1px solid #e2e8f0' }}>\r\n              <input type=\"date\" value={format(startDate, 'yyyy-MM-dd')} onChange={(e) => setStartDate(new Date(e.target.value))} style={{ border: 'none', outline: 'none', fontWeight: 500 }} />\r\n              <span style={{ color: '#cbd5e1' }}></span>\r\n              <input type=\"date\" value={format(endDate, 'yyyy-MM-dd')} onChange={(e) => setEndDate(new Date(e.target.value))} style={{ border: 'none', outline: 'none', fontWeight: 500 }} />\r\n            </div>\r\n          ) : (\r\n            <div style={{ display: 'flex', alignItems: 'center', background: 'white', borderRadius: '10px', border: '1px solid #e2e8f0', overflow: 'hidden' }}>\r\n              <button onClick={() => navigateDate('prev')} style={{ padding: '10px', border: 'none', background: 'none', cursor: 'pointer', color: '#64748b' }}><ChevronLeft size={20} /></button>\r\n              <div style={{ padding: '0 20px', fontWeight: 700, minWidth: '220px', textAlign: 'center', borderLeft: '1px solid #f1f5f9', borderRight: '1px solid #f1f5f9' }}>{FormatDateRange()}</div>\r\n              <button onClick={() => navigateDate('next')} style={{ padding: '10px', border: 'none', background: 'none', cursor: 'pointer', color: '#64748b' }}><ChevronRight size={20} /></button>\r\n            </div>\r\n          )}\r\n          <button onClick={exportToExcel} style={{ display: 'flex', gap: '8px', alignItems: 'center', padding: '10px 20px', background: '#10b981', color: 'white', border: 'none', borderRadius: '10px', fontWeight: 700, cursor: 'pointer' }}>\r\n            <Download size={18} /> Export\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      <div style={{ flex: 1 }}>\r\n        {isLoading ? (\r\n          <div style={{ padding: '100px', textAlign: 'center' }}>\r\n            <div className=\"spinner\" style={{ border: '4px solid #f3f3f3', borderTop: '4px solid #6366f1', borderRadius: '50%', width: '40px', height: '40px', animation: 'spin 1s linear infinite', margin: '0 auto 20px' }}></div>\r\n            <span style={{ fontSize: '18px', color: '#64748b', fontWeight: 500 }}>Loading reports...</span>\r\n          </div>\r\n        ) : (\r\n          <>\r\n            {reportType === 'shift' && (\r\n              <div style={{ background: 'white', borderRadius: '20px', overflow: 'hidden', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.05)', border: '1px solid #f1f5f9' }}>\r\n                <div style={{ padding: '24px', borderBottom: '1px solid #f1f5f9', display: 'flex', alignItems: 'center', gap: '10px' }}>\r\n                  <Clock size={20} style={{ color: '#6366f1' }} />\r\n                  <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 800 }}>Shift Reports</h3>\r\n                </div>\r\n                <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                  <thead style={{ background: '#f8fafc' }}>\r\n                    <tr>\r\n                      <th style={thStyle}>Staff</th>\r\n                      <th style={thStyle}>Started At</th>\r\n                      <th style={thStyle}>Ended At</th>\r\n                      <th style={thStyle}>Status</th>\r\n                      <th style={{...thStyle, textAlign: 'right'}}>Orders</th>\r\n                      <th style={{...thStyle, textAlign: 'right'}}>Revenue</th>\r\n                      <th style={{...thStyle, textAlign: 'right'}}>Cash Details</th>\r\n                    </tr>\r\n                  </thead>\r\n                  <tbody>\r\n                    {data?.shifts?.length > 0 ? data.shifts.map((shift) => (\r\n                      <tr key={shift.id} style={{ borderBottom: '1px solid #f1f5f9' }}>\r\n                        <td style={tdStyle}>\r\n                          <div style={{ fontWeight: 700 }}>{shift.user_name}</div>\r\n                          <div style={{ fontSize: '12px', color: '#94a3b8', textTransform: 'uppercase' }}>{shift.user_role}</div>\r\n                        </td>\r\n                        <td style={tdStyle}>{new Date(shift.start_time).toLocaleTimeString()}</td>\r\n                        <td style={tdStyle}>{shift.end_time ? new Date(shift.end_time).toLocaleTimeString() : '-'}</td>\r\n                        <td style={tdStyle}>\r\n                          <span style={{ padding: '4px 12px', borderRadius: '20px', fontSize: '12px', fontWeight: 700, background: shift.status === 'active' ? '#f0fdf4' : '#f1f5f9', color: shift.status === 'active' ? '#10b981' : '#64748b', textTransform: 'uppercase' }}>{shift.status}</span>\r\n                        </td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 700}}>{shift.sales?.total_orders || 0}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 800, color: '#10b981'}}>{shift.sales?.total_revenue?.toFixed(2)}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right'}}>\r\n                          <div style={{ fontSize: '12px' }}>Open: {shift.start_cash}</div>\r\n                          {shift.end_cash !== null && <div style={{ fontSize: '12px', fontWeight: 600 }}>Close: {shift.end_cash}</div>}\r\n                        </td>\r\n                      </tr>\r\n                    )) : <tr><td colSpan=\"7\" style={{ padding: '60px', textAlign: 'center', color: '#94a3b8' }}>No shift records found for this date.</td></tr>}\r\n                  </tbody>\r\n                </table>\r\n              </div>\r\n            )}\r\n\r\n            {reportType !== 'shift' && viewMode === 'dashboard' && (\r\n                <>\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '24px', marginBottom: '24px' }}>\r\n                  <div style={{ background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)', padding: '24px', borderRadius: '20px', color: 'white', boxShadow: '0 10px 20px -5px rgba(245, 158, 11, 0.4)' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>\r\n                      <span style={{ fontSize: '14px', fontWeight: 600, opacity: 0.9 }}>Opening Balance</span>\r\n                      <DollarSign size={20} />\r\n                    </div>\r\n                    <div style={{ fontSize: '28px', fontWeight: 800 }}>{(sales.opening_balance || 0).toLocaleString()}</div>\r\n                  </div>\r\n                  <div style={{ background: 'linear-gradient(135deg, #6366f1 0%, #4f46e5 100%)', padding: '24px', borderRadius: '20px', color: 'white', boxShadow: '0 10px 20px -5px rgba(99, 102, 241, 0.4)' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>\r\n                      <span style={{ fontSize: '14px', fontWeight: 600, opacity: 0.9 }}>Total Sales</span>\r\n                      <ShoppingCart size={20} />\r\n                    </div>\r\n                    <div style={{ fontSize: '28px', fontWeight: 800 }}>{(sales.total_revenue || 0).toLocaleString()}</div>\r\n                  </div>\r\n                  <div style={{ background: 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)', padding: '24px', borderRadius: '20px', color: 'white', boxShadow: '0 10px 20px -5px rgba(239, 68, 68, 0.4)' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>\r\n                      <span style={{ fontSize: '14px', fontWeight: 600, opacity: 0.9 }}>Total Expenses</span>\r\n                      <TrendingDown size={20} />\r\n                    </div>\r\n                    <div style={{ fontSize: '28px', fontWeight: 800 }}>{(sales.total_expenses || 0).toLocaleString()}</div>\r\n                  </div>\r\n                  <div style={{ background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)', padding: '24px', borderRadius: '20px', color: 'white', boxShadow: '0 10px 20px -5px rgba(16, 185, 129, 0.4)' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>\r\n                      <span style={{ fontSize: '14px', fontWeight: 600, opacity: 0.9 }}>Net Revenue</span>\r\n                      <TrendingUp size={20} />\r\n                    </div>\r\n                    <div style={{ fontSize: '28px', fontWeight: 800 }}>{(sales.net_revenue || 0).toLocaleString()}</div>\r\n                  </div>\r\n                  <div style={{ background: 'linear-gradient(135deg, #0ea5e9 0%, #2563eb 100%)', padding: '24px', borderRadius: '20px', color: 'white', boxShadow: '0 10px 20px -5px rgba(14, 165, 233, 0.4)' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>\r\n                      <span style={{ fontSize: '14px', fontWeight: 600, opacity: 0.9 }}>Estimated Cash</span>\r\n                      <div style={{ display: 'flex', gap: '4px' }}><DollarSign size={20} /><DollarSign size={20} style={{ opacity: 0.6 }} /></div>\r\n                    </div>\r\n                    <div style={{ fontSize: '28px', fontWeight: 800 }}>{((sales.opening_balance || 0) + (sales.cash_amount || 0) - (sales.total_expenses || 0)).toLocaleString()}</div>\r\n                  </div>\r\n                  <div style={{ background: 'linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)', padding: '24px', borderRadius: '20px', color: 'white', boxShadow: '0 10px 20px -5px rgba(139, 92, 246, 0.4)' }}>\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '12px' }}>\r\n                      <span style={{ fontSize: '14px', fontWeight: 600, opacity: 0.9 }}>Total Orders</span>\r\n                      <ShoppingCart size={20} />\r\n                    </div>\r\n                    <div style={{ fontSize: '28px', fontWeight: 800 }}>{(sales.total_orders || 0)}</div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(12, 1fr)', gap: '24px', marginBottom: '24px' }}>\r\n                  {(reportType === 'weekly' || reportType === 'monthly') && (\r\n                    <div style={{ gridColumn: 'span 12', background: 'white', padding: '24px', borderRadius: '20px', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.05)', height: '400px' }}>\r\n                      <h3 style={{ margin: '0 0 20px 0', fontSize: '18px', fontWeight: 800 }}>Revenue Trend</h3>\r\n                      <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                        <AreaChart data={dailyTrend}>\r\n                          <defs><linearGradient id=\"colorRev\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\"><stop offset=\"5%\" stopColor=\"#6366f1\" stopOpacity={0.8}/><stop offset=\"95%\" stopColor=\"#6366f1\" stopOpacity={0}/></linearGradient></defs>\r\n                          <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#f1f5f9\" />\r\n                          <XAxis dataKey=\"date\" tickFormatter={(str) => format(new Date(str), 'MMM d')} tick={{ fontSize: 12, fill: '#94a3b8' }} axisLine={false} tickLine={false} />\r\n                          <YAxis tick={{ fontSize: 12, fill: '#94a3b8' }} axisLine={false} tickLine={false} tickFormatter={(v) => `${v}`} />\r\n                          <Tooltip contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 25px -5px rgba(0,0,0,0.1)' }} />\r\n                          <Area type=\"monotone\" dataKey=\"total_revenue\" stroke=\"#6366f1\" fillOpacity={1} fill=\"url(#colorRev)\" strokeWidth={3} />\r\n                        </AreaChart>\r\n                      </ResponsiveContainer>\r\n                    </div>\r\n                  )}\r\n\r\n                  <div style={{ gridColumn: 'span 5', background: 'white', padding: '24px', borderRadius: '20px', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.05)', height: '420px' }}>\r\n                    <h3 style={{ margin: '0 0 20px 0', fontSize: '18px', fontWeight: 800 }}>Sales by Category</h3>\r\n                    {categorySales.length > 0 ? (\r\n                      <ResponsiveContainer width=\"100%\" height=\"95%\">\r\n                        <PieChart margin={{ top: 20, right: 30, left: 30, bottom: 20 }}>\r\n                          <Pie data={categorySales} cx=\"50%\" cy=\"45%\" innerRadius={70} outerRadius={100} paddingAngle={4} dataKey=\"total_revenue\" nameKey=\"category_name\" label={renderCustomizedLabel}>\r\n                            {categorySales.map((entry, index) => <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />)}\r\n                          </Pie>\r\n                          <Tooltip formatter={(v) => `${v.toFixed(2)}`} contentStyle={{ borderRadius: '12px', border: 'none' }} />\r\n                          <Legend verticalAlign=\"bottom\" height={36} iconType=\"circle\" />\r\n                        </PieChart>\r\n                      </ResponsiveContainer>\r\n                    ) : <div style={{ height: '300px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#94a3b8' }}>No data available</div>}\r\n                  </div>\r\n\r\n                  <div style={{ gridColumn: 'span 7', background: 'white', padding: '24px', borderRadius: '20px', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.05)', height: '420px' }}>\r\n                    <h3 style={{ margin: '0 0 20px 0', fontSize: '18px', fontWeight: 800 }}>Top Selling Items</h3>\r\n                    {topItems.length > 0 ? (\r\n                      <ResponsiveContainer width=\"100%\" height=\"90%\">\r\n                        <BarChart data={topItems} layout=\"vertical\" margin={{ left: 10, right: 40 }}>\r\n                          <XAxis type=\"number\" hide />\r\n                          <YAxis dataKey=\"item_name\" type=\"category\" width={140} tick={{ fontSize: 13, fill: '#475569', fontWeight: 600 }} axisLine={false} tickLine={false} />\r\n                          <Tooltip formatter={(v) => [v, 'Quantity Sold']} contentStyle={{ borderRadius: '12px', border: 'none' }} />\r\n                          <Bar dataKey=\"total_quantity\" fill=\"#6366f1\" radius={[0, 6, 6, 0]} barSize={24} label={{ position: 'right', fill: '#64748b', fontSize: 12, fontWeight: 700 }} />\r\n                        </BarChart>\r\n                      </ResponsiveContainer>\r\n                    ) : <div style={{ height: '300px', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#94a3b8' }}>No data available</div>}\r\n                  </div>\r\n\r\n                  <div style={{ gridColumn: 'span 12', display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '20px' }}>\r\n                      {['Cash', 'Card', 'UPI'].map(m => {\r\n                          const val = sales[m.toLowerCase() + '_amount'] || 0;\r\n                          const total = (sales.cash_amount || 0) + (sales.card_amount || 0) + (sales.upi_amount || 0);\r\n                          const pct = total > 0 ? (val / total * 100).toFixed(0) : 0;\r\n                          return (\r\n                              <div key={m} style={{ background: 'white', padding: '20px', borderRadius: '16px', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.05)' }}>\r\n                                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '10px' }}>\r\n                                      <div style={{ display: 'flex', alignItems: 'center', gap: '8px', color: '#64748b', fontWeight: 600 }}>\r\n                                          <div style={{ width: '10px', height: '10px', borderRadius: '50%', background: PAYMENT_COLORS[m] }}></div>\r\n                                          {m}\r\n                                      </div>\r\n                                      <span style={{ fontSize: '12px', fontWeight: 800, color: PAYMENT_COLORS[m], background: `${PAYMENT_COLORS[m]}15`, padding: '2px 8px', borderRadius: '10px' }}>{pct}%</span>\r\n                                  </div>\r\n                                  <div style={{ fontSize: '22px', fontWeight: 800, color: '#1e293b' }}>{val.toLocaleString()}</div>\r\n                                  <div style={{ marginTop: '10px', height: '6px', borderRadius: '3px', background: '#f1f5f9', overflow: 'hidden' }}>\r\n                                      <div style={{ width: `${pct}%`, height: '100%', background: PAYMENT_COLORS[m], borderRadius: '3px' }}></div>\r\n                                  </div>\r\n                              </div>\r\n                          )\r\n                      })}\r\n                  </div>\r\n                </div>\r\n\r\n                <div style={{ background: 'white', borderRadius: '20px', overflow: 'hidden', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.05)', border: '1px solid #f1f5f9', marginBottom: '40px' }}>\r\n                    <div style={{ padding: '24px', borderBottom: '1px solid #f1f5f9' }}>\r\n                        <h3 style={{ margin: 0, fontSize: '18px', fontWeight: 800 }}>{reportType === 'daily' ? ' Recent Orders' : ' Breakdown'}</h3>\r\n                    </div>\r\n                    <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                        <thead style={{ background: '#f8fafc' }}>\r\n                            {reportType === 'daily' ? (\r\n                                <tr>\r\n                                    <th style={thStyle}>Order #</th>\r\n                                    <th style={thStyle}>Time</th>\r\n                                    <th style={thStyle}>Type</th>\r\n                                    <th style={thStyle}>Status</th>\r\n                                    <th style={thStyle}>Payment</th>\r\n                                    <th style={{...thStyle, textAlign: 'right'}}>Amount</th>\r\n                                </tr>\r\n                            ) : (\r\n                                <tr>\r\n                                    <th style={thStyle}>Date</th>\r\n                                    <th style={thStyle}>Orders</th>\r\n                                    <th style={{...thStyle, textAlign: 'right'}}>Tax</th>\r\n                                    <th style={{...thStyle, textAlign: 'right'}}>Revenue</th>\r\n                                </tr>\r\n                            )}\r\n                        </thead>\r\n                        <tbody>\r\n                            {reportType === 'daily' ? (\r\n                                orders.length > 0 ? orders.slice(0, 10).map(order => (\r\n                                    <tr key={order.id} onClick={async () => {\r\n                                        try {\r\n                                          const fullOrder = await window.electronAPI.invoke('order:getById', { id: order.id });\r\n                                          setSelectedOrder(fullOrder);\r\n                                        } catch (error) {\r\n                                          console.error('Failed to load full order:', error);\r\n                                          setSelectedOrder(order);\r\n                                        }\r\n                                    }} style={{ borderBottom: '1px solid #f1f5f9', cursor: 'pointer' }}>\r\n                                        <td style={{...tdStyle, fontWeight: 700, color: '#6366f1'}}>#{order.order_number}</td>\r\n                                        <td style={tdStyle}>{new Date(order.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</td>\r\n                                        <td style={{...tdStyle, textTransform: 'capitalize'}}>{order.order_type.replace('_', ' ')}</td>\r\n                                        <td style={tdStyle}><span style={{ padding: '4px 10px', borderRadius: '10px', fontSize: '12px', fontWeight: 700, background: order.status === 'completed' ? '#f0fdf4' : '#fef2f2', color: order.status === 'completed' ? '#10b981' : '#ef4444' }}>{order.status}</span></td>\r\n                                        <td style={tdStyle}><span style={{ fontWeight: 600 }}>{order.payment_method?.toUpperCase()}</span></td>\r\n                                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 800}}>{order.total_amount.toFixed(2)}</td>\r\n                                    </tr>\r\n                                )) : <tr><td colSpan=\"6\" style={{ padding: '40px', textAlign: 'center', color: '#94a3b8' }}>No orders found</td></tr>\r\n                            ) : (\r\n                                dailyTrend.map((day, idx) => (\r\n                                    <tr key={idx} style={{ borderBottom: '1px solid #f1f5f9' }}>\r\n                                        <td style={{...tdStyle, fontWeight: 600}}>{format(new Date(day.date), 'MMM d, yyyy')}</td>\r\n                                        <td style={tdStyle}>{day.total_orders}</td>\r\n                                        <td style={{...tdStyle, textAlign: 'right'}}>{day.total_tax.toFixed(2)}</td>\r\n                                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 800, color: '#10b981'}}>{day.total_revenue.toFixed(2)}</td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n                </>\r\n            )}\r\n\r\n            {reportType !== 'shift' && viewMode === 'detailed' && (\r\n                <div style={{ background: 'white', borderRadius: '20px', overflow: 'hidden', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.05)', border: '1px solid #f1f5f9', display: 'flex', flexDirection: 'column' }}>\r\n                    <div style={{ padding: '20px 24px', background: '#f8fafc', borderBottom: '1px solid #f1f5f9', display: 'flex', gap: '20px', alignItems: 'center' }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', background: 'white', border: '1px solid #e2e8f0', borderRadius: '10px', padding: '0 12px', flex: 1, maxWidth: '400px' }}>\r\n                            <Search size={18} style={{ color: '#94a3b8' }} />\r\n                            <input type=\"text\" placeholder=\"Search orders, items, customers...\" value={searchTerm} onChange={(e) => setSearchTerm(e.target.value)} style={{ border: 'none', padding: '12px 10px', width: '100%', outline: 'none', fontSize: '14px' }} />\r\n                        </div>\r\n                        <select value={filterPayment} onChange={(e) => setFilterPayment(e.target.value)} style={{ padding: '10px 16px', borderRadius: '10px', border: '1px solid #e2e8f0', outline: 'none', fontSize: '14px', fontWeight: 600 }}>\r\n                            <option value=\"all\">All Payments</option><option value=\"cash\">Cash</option><option value=\"card\">Card</option><option value=\"upi\">UPI</option>\r\n                        </select>\r\n                        <select value={filterType} onChange={(e) => setFilterType(e.target.value)} style={{ padding: '10px 16px', borderRadius: '10px', border: '1px solid #e2e8f0', outline: 'none', fontSize: '14px', fontWeight: 600 }}>\r\n                            <option value=\"all\">All Types</option><option value=\"dine_in\">Dine In</option><option value=\"takeaway\">Takeaway</option><option value=\"delivery\">Delivery</option>\r\n                        </select>\r\n                        <div style={{ marginLeft: 'auto', fontSize: '14px', fontWeight: 600, color: '#64748b' }}>{filteredData.length} Records</div>\r\n                    </div>\r\n                    <div style={{ overflowX: 'auto' }}>\r\n                        <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                            <thead style={{ background: '#f8fafc', position: 'sticky', top: 0, zIndex: 10 }}>\r\n                                <tr>\r\n                                    <th style={thStyle}>Order #</th>\r\n                                    <th style={thStyle}>Time</th>\r\n                                    <th style={thStyle}>Item</th>\r\n                                    <th style={{...thStyle, textAlign: 'center'}}>Qty</th>\r\n                                    <th style={{...thStyle, textAlign: 'right'}}>Amount</th>\r\n                                    <th style={thStyle}>Customer</th>\r\n                                    <th style={thStyle}>Type</th>\r\n                                    <th style={thStyle}>Payment</th>\r\n                                    <th style={thStyle}>Cashier</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {paginatedData.map((row, idx) => (\r\n                                    <tr key={idx} style={{ borderBottom: '1px solid #f1f5f9' }}>\r\n                                        <td style={{...tdStyle, fontWeight: 700, color: '#6366f1'}}>#{row.order_number}</td>\r\n                                        <td style={tdStyle}>{row.order_time}</td>\r\n                                        <td style={{...tdStyle, fontWeight: 500}}>{row.item_name}</td>\r\n                                        <td style={{...tdStyle, textAlign: 'center', fontWeight: 600}}>{row.quantity}</td>\r\n                                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 800}}>{row.item_total?.toFixed(2)}</td>\r\n                                        <td style={tdStyle}>{row.customer_name || '-'}</td>\r\n                                        <td style={{...tdStyle, textTransform: 'capitalize'}}>{row.order_type?.replace('_', ' ')}</td>\r\n                                        <td style={tdStyle}><span style={{ fontWeight: 600 }}>{row.payment_method?.toUpperCase()}</span></td>\r\n                                        <td style={tdStyle}>{row.cashier_name}</td>\r\n                                    </tr>\r\n                                ))}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                    {totalPages > 1 && (\r\n                        <div style={{ padding: '20px 24px', borderTop: '1px solid #f1f5f9', display: 'flex', justifyContent: 'flex-end', gap: '15px', alignItems: 'center' }}>\r\n                            <button onClick={() => setCurrentPage(p => Math.max(1, p - 1))} disabled={currentPage === 1} style={{ padding: '8px', borderRadius: '8px', border: '1px solid #e2e8f0', background: 'white', cursor: 'pointer', opacity: currentPage === 1 ? 0.5 : 1 }}><ChevronLeft size={18} /></button>\r\n                            <span style={{ fontWeight: 700, fontSize: '14px' }}>Page {currentPage} of {totalPages}</span>\r\n                            <button onClick={() => setCurrentPage(p => Math.min(totalPages, p + 1))} disabled={currentPage === totalPages} style={{ padding: '8px', borderRadius: '8px', border: '1px solid #e2e8f0', background: 'white', cursor: 'pointer', opacity: currentPage === totalPages ? 0.5 : 1 }}><ChevronRight size={18} /></button>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n          </>\r\n        )}\r\n      </div>\r\n      {selectedOrder && <OrderDetailsModal order={selectedOrder} onClose={() => setSelectedOrder(null)} />}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ReportsPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\Reports\\CRMReports.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":18,"column":6,"nodeType":"ArrayExpression","endLine":18,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, startDate, endDate, fetchData]","fix":{"range":[743,774],"text":"[activeTab, startDate, endDate, fetchData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Download } from 'lucide-react';\r\nimport * as XLSX from 'xlsx';\r\nimport { format } from 'date-fns';\r\n\r\nconst thStyle = { padding: '14px 20px', textAlign: 'left', fontWeight: 600, color: '#64748b', fontSize: '15px' };\r\nconst tdStyle = { padding: '14px 20px', color: '#334155', fontSize: '15px' };\r\n\r\nconst CRMReports = () => {\r\n  const [activeTab, setActiveTab] = useState('frequency');\r\n  const [data, setData] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [startDate, setStartDate] = useState(format(new Date(), 'yyyy-MM-dd'));\r\n  const [endDate, setEndDate] = useState(format(new Date(), 'yyyy-MM-dd'));\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [activeTab, startDate, endDate]);\r\n\r\n  const fetchData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      let result = [];\r\n      if (activeTab === 'frequency') {\r\n        result = await window.electronAPI.invoke('reports:customerVisitFrequency', { startDate, endDate });\r\n      }\r\n      setData(result || []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching CRM data:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const exportToExcel = () => {\r\n      const ws = XLSX.utils.json_to_sheet(data);\r\n      const wb = XLSX.utils.book_new();\r\n      XLSX.utils.book_append_sheet(wb, ws, \"CRM\");\r\n      XLSX.writeFile(wb, `CRM_Report.xlsx`);\r\n  };\r\n\r\n  const getTabStyle = (active) => ({\r\n    padding: '10px 20px',\r\n    borderRadius: '8px',\r\n    border: 'none',\r\n    background: active ? '#6366f1' : 'white',\r\n    color: active ? 'white' : '#64748b',\r\n    cursor: 'pointer',\r\n    textTransform: 'capitalize',\r\n    fontWeight: 600,\r\n    fontSize: '15px',\r\n    boxShadow: '0 2px 4px rgba(0,0,0,0.05)',\r\n    transition: 'all 0.2s'\r\n  });\r\n\r\n  return (\r\n    <div className=\"report-container\">\r\n        <div className=\"report-header\" style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '24px', flexWrap: 'wrap', gap: '12px' }}>\r\n            <div className=\"tabs\" style={{ display: 'flex', gap: '10px' }}>\r\n                <button onClick={() => setActiveTab('frequency')} style={getTabStyle(activeTab === 'frequency')}>Visit Frequency</button>\r\n            </div>\r\n            <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>\r\n                <input \r\n                    type=\"date\" \r\n                    value={startDate} \r\n                    onChange={(e) => setStartDate(e.target.value)} \r\n                    style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #cbd5e1', fontSize: '15px', outline: 'none' }} \r\n                />\r\n                <input \r\n                    type=\"date\" \r\n                    value={endDate} \r\n                    onChange={(e) => setEndDate(e.target.value)} \r\n                    style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #cbd5e1', fontSize: '15px', outline: 'none' }} \r\n                />\r\n                <button onClick={exportToExcel} className=\"btn-secondary\" style={{ display: 'flex', gap: '8px', alignItems: 'center', padding: '10px 20px', background: '#10b981', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: 600, fontSize: '15px' }}>\r\n                    <Download size={18} /> Export\r\n                </button>\r\n            </div>\r\n        </div>\r\n\r\n        {loading ? (\r\n            <div style={{ padding: '80px', textAlign: 'center', color: '#64748b' }}>\r\n                <div className=\"spinner\" style={{ border: '4px solid #f3f3f3', borderTop: '4px solid #6366f1', borderRadius: '50%', width: '32px', height: '32px', animation: 'spin 1s linear infinite', margin: '0 auto 20px' }}></div>\r\n                <span style={{ fontSize: '16px', fontWeight: 500 }}>Loading CRM data...</span>\r\n            </div>\r\n        ) : (\r\n             <div style={{ background: 'white', borderRadius: '16px', overflow: 'hidden', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)', border: '1px solid #f1f5f9' }}>\r\n             <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n               <thead style={{ background: '#f8fafc', borderBottom: '2px solid #e2e8f0' }}>\r\n                 <tr>\r\n                    <th style={thStyle}>Customer Name</th>\r\n                    <th style={thStyle}>Phone</th>\r\n                    <th style={{...thStyle, textAlign: 'center'}}>Visits</th>\r\n                    <th style={{...thStyle, textAlign: 'right'}}>Total Spent</th>\r\n                    <th style={thStyle}>Last Visit</th>\r\n                    <th style={thStyle}>Avg. Ticket Size</th>\r\n                 </tr>\r\n               </thead>\r\n               <tbody>\r\n                 {data.map((item, idx) => (\r\n                    <tr key={idx} style={{ borderBottom: '1px solid #f1f5f9' }}>\r\n                        <td style={{...tdStyle, fontWeight: 700, color: '#6366f1'}}>{item.customer_name || 'Unknown'}</td>\r\n                        <td style={{...tdStyle, fontWeight: 500}}>{item.customer_phone}</td>\r\n                        <td style={{...tdStyle, textAlign: 'center', fontWeight: 600}}>{item.visit_count}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 700, color: '#10b981'}}>{item.total_spent?.toFixed(2)}</td>\r\n                        <td style={tdStyle}>{new Date(item.last_visit).toLocaleDateString()}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 600}}>{(item.total_spent / item.visit_count).toFixed(2)}</td>\r\n                    </tr>\r\n                 ))}\r\n                 {data.length === 0 && (\r\n                    <tr>\r\n                        <td colSpan=\"6\" style={{ padding: '60px', textAlign: 'center', color: '#94a3b8', fontSize: '16px' }}>No CRM data found.</td>\r\n                    </tr>\r\n                 )}\r\n               </tbody>\r\n            </table>\r\n            </div>\r\n        )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default CRMReports;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\Reports\\InventoryReports.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":15,"column":6,"nodeType":"ArrayExpression","endLine":15,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, fetchData]","fix":{"range":[572,583],"text":"[activeTab, fetchData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Download, AlertTriangle } from 'lucide-react';\r\nimport * as XLSX from 'xlsx';\r\n\r\nconst thStyle = { padding: '14px 20px', textAlign: 'left', fontWeight: 600, color: '#64748b', fontSize: '15px' };\r\nconst tdStyle = { padding: '14px 20px', color: '#334155', fontSize: '15px' };\r\n\r\nconst InventoryReports = () => {\r\n  const [activeTab, setActiveTab] = useState('stock-level');\r\n  const [data, setData] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [activeTab]);\r\n\r\n  const fetchData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      let result = [];\r\n      if (activeTab === 'stock-level') {\r\n        result = await window.electronAPI.invoke('reports:stockLevel');\r\n      } else if (activeTab === 'history') {\r\n        const today = new Date().toISOString().split('T')[0];\r\n        result = await window.electronAPI.invoke('reports:inventoryHistory', { startDate: '2024-01-01', endDate: today });\r\n      }\r\n      setData(result || []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching inventory data:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const exportToExcel = () => {\r\n    const ws = XLSX.utils.json_to_sheet(data);\r\n    const wb = XLSX.utils.book_new();\r\n    XLSX.utils.book_append_sheet(wb, ws, \"Inventory\");\r\n    XLSX.writeFile(wb, `Inventory_${activeTab}.xlsx`);\r\n  };\r\n\r\n  const getTabStyle = (active) => ({\r\n    padding: '10px 20px',\r\n    borderRadius: '8px',\r\n    border: 'none',\r\n    background: active ? '#6366f1' : 'white',\r\n    color: active ? 'white' : '#64748b',\r\n    cursor: 'pointer',\r\n    textTransform: 'capitalize',\r\n    fontWeight: 600,\r\n    fontSize: '15px',\r\n    boxShadow: '0 2px 4px rgba(0,0,0,0.05)',\r\n    transition: 'all 0.2s'\r\n  });\r\n\r\n  return (\r\n    <div className=\"report-container\">\r\n       <div className=\"report-header\" style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '24px', flexWrap: 'wrap', gap: '12px' }}>\r\n         <div className=\"tabs\" style={{ display: 'flex', gap: '10px' }}>\r\n           <button onClick={() => setActiveTab('stock-level')} style={getTabStyle(activeTab === 'stock-level')}>Stock Levels</button>\r\n           <button onClick={() => setActiveTab('history')} style={getTabStyle(activeTab === 'history')}>Consumption History</button>\r\n         </div>\r\n         <button onClick={exportToExcel} className=\"btn-secondary\" style={{ display: 'flex', gap: '8px', alignItems: 'center', padding: '10px 20px', background: '#10b981', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: 600, fontSize: '15px' }}>\r\n            <Download size={18} /> Export\r\n         </button>\r\n       </div>\r\n\r\n       {loading ? (\r\n         <div style={{ padding: '80px', textAlign: 'center', color: '#64748b' }}>\r\n           <div className=\"spinner\" style={{ border: '4px solid #f3f3f3', borderTop: '4px solid #6366f1', borderRadius: '50%', width: '32px', height: '32px', animation: 'spin 1s linear infinite', margin: '0 auto 20px' }}></div>\r\n           <span style={{ fontSize: '16px', fontWeight: 500 }}>Loading inventory data...</span>\r\n         </div>\r\n       ) : (\r\n         <div style={{ background: 'white', borderRadius: '16px', overflow: 'hidden', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)', border: '1px solid #f1f5f9' }}>\r\n           <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n             <thead style={{ background: '#f8fafc', borderBottom: '2px solid #e2e8f0' }}>\r\n               <tr>\r\n                 {activeTab === 'stock-level' ? (\r\n                   <>\r\n                     <th style={thStyle}>Item Name</th>\r\n                     <th style={thStyle}>Supplier</th>\r\n                     <th style={{...thStyle, textAlign: 'center'}}>Unit</th>\r\n                     <th style={{...thStyle, textAlign: 'right'}}>Stock</th>\r\n                     <th style={{...thStyle, textAlign: 'right'}}>Value</th>\r\n                     <th style={thStyle}>Status</th>\r\n                   </>\r\n                 ) : (\r\n                   <>\r\n                     <th style={thStyle}>Date</th>\r\n                     <th style={thStyle}>Item</th>\r\n                     <th style={thStyle}>Type</th>\r\n                     <th style={{...thStyle, textAlign: 'center'}}>Reason</th>\r\n                     <th style={{...thStyle, textAlign: 'right'}}>Quantity Change</th>\r\n                     <th style={thStyle}>Notes</th>\r\n                   </>\r\n                 )}\r\n               </tr>\r\n             </thead>\r\n             <tbody>\r\n               {data.map((item, idx) => (\r\n                 <tr key={idx} style={{ borderBottom: '1px solid #f1f5f9' }}>\r\n                   {activeTab === 'stock-level' ? (\r\n                     <>\r\n                       <td style={{...tdStyle, fontWeight: 600}}>{item.name}</td>\r\n                       <td style={tdStyle}>{item.supplier || '-'}</td>\r\n                       <td style={{...tdStyle, textAlign: 'center'}}>{item.unit}</td>\r\n                       <td style={{...tdStyle, textAlign: 'right', fontWeight: 700}}>{item.current_stock}</td>\r\n                       <td style={{...tdStyle, textAlign: 'right', color: '#10b981', fontWeight: 700}}>{item.stock_value?.toFixed(2)}</td>\r\n                       <td style={tdStyle}>\r\n                         {item.status === 'Low Stock' ? (\r\n                            <span style={{ display: 'inline-flex', alignItems: 'center', gap: '6px', color: '#ef4444', fontWeight: 700, background: '#fef2f2', padding: '4px 10px', borderRadius: '20px', fontSize: '13px' }}>\r\n                              <AlertTriangle size={14} /> Low Stock\r\n                            </span>\r\n                         ) : (\r\n                            <span style={{ color: '#10b981', fontWeight: 600, background: '#f0fdf4', padding: '4px 10px', borderRadius: '20px', fontSize: '13px' }}>In Stock</span>\r\n                         )}\r\n                       </td>\r\n                     </>\r\n                   ) : (\r\n                     <>\r\n                        <td style={tdStyle}>{new Date(item.created_at).toLocaleString()}</td>\r\n                        <td style={{...tdStyle, fontWeight: 600}}>{item.item_name}</td>\r\n                        <td style={{...tdStyle, textTransform: 'capitalize', fontWeight: 500}}>{item.type}</td>\r\n                        <td style={{...tdStyle, textAlign: 'center'}}>{item.reason || '-'}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 700, color: item.type === 'add' ? '#10b981' : '#ef4444'}}>\r\n                          {item.type === 'add' ? '+' : '-'}{item.quantity} {item.unit}\r\n                        </td>\r\n                        <td style={tdStyle}>{item.notes || '-'}</td>\r\n                     </>\r\n                   )}\r\n                 </tr>\r\n               ))}\r\n               {data.length === 0 && (\r\n                 <tr>\r\n                   <td colSpan=\"10\" style={{ padding: '60px', textAlign: 'center', color: '#94a3b8', fontSize: '16px' }}>No inventory data found.</td>\r\n                 </tr>\r\n               )}\r\n             </tbody>\r\n           </table>\r\n         </div>\r\n       )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InventoryReports;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\Reports\\PaymentReports.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":19,"column":8,"nodeType":"ArrayExpression","endLine":19,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [startDate, endDate, fetchData]","fix":{"range":[918,938],"text":"[startDate, endDate, fetchData]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'innerRadius' is defined but never used.","line":41,"column":56,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":67},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":41,"column":91,"nodeType":"Identifier","messageId":"unusedVar","endLine":41,"endColumn":96}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Download } from 'lucide-react';\r\nimport { PieChart, Pie, Cell, Tooltip, ResponsiveContainer, Legend } from 'recharts';\r\nimport * as XLSX from 'xlsx';\r\nimport { format } from 'date-fns';\r\n\r\nconst thStyle = { padding: '14px 20px', textAlign: 'left', fontWeight: 600, color: '#64748b', fontSize: '15px' };\r\nconst tdStyle = { padding: '14px 20px', color: '#334155', fontSize: '15px' };\r\nconst COLORS = ['#6366f1', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#0ea5e9', '#14b8a6', '#f43f5e', '#a855f7'];\r\n\r\nconst PaymentReports = () => {\r\n    const [data, setData] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [startDate, setStartDate] = useState(format(new Date(), 'yyyy-MM-dd'));\r\n    const [endDate, setEndDate] = useState(format(new Date(), 'yyyy-MM-dd'));\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, [startDate, endDate]);\r\n\r\n    const fetchData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const result = await window.electronAPI.invoke('reports:paymentMode', { startDate, endDate });\r\n            setData(result || []);\r\n        } catch (error) {\r\n            console.error(\"Error fetching payment data:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const exportToExcel = () => {\r\n        const ws = XLSX.utils.json_to_sheet(data);\r\n        const wb = XLSX.utils.book_new();\r\n        XLSX.utils.book_append_sheet(wb, ws, \"Payment\");\r\n        XLSX.writeFile(wb, `Payment_Report_${startDate}.xlsx`);\r\n    };\r\n\r\n    // Custom Label for Pie Chart\r\n    const renderCustomizedLabel = ({ cx, cy, midAngle, innerRadius, outerRadius, percent, index, payment_method }) => {\r\n        const RADIAN = Math.PI / 180;\r\n        const radius = outerRadius + 25; // Push label outside\r\n        const x = cx + radius * Math.cos(-midAngle * RADIAN);\r\n        const y = cy + radius * Math.sin(-midAngle * RADIAN);\r\n        const textAnchor = x > cx ? 'start' : 'end';\r\n\r\n        return (\r\n            <text x={x} y={y} fill=\"#1e293b\" textAnchor={textAnchor} dominantBaseline=\"central\" fontSize=\"13\" fontWeight=\"700\">\r\n                {`${payment_method.toUpperCase()} (${(percent * 100).toFixed(0)}%)`}\r\n            </text>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"report-container\">\r\n            <div className=\"report-header\" style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '24px', flexWrap: 'wrap', gap: '12px' }}>\r\n                <h3 style={{ margin: 0, color: '#1e293b', fontSize: '22px', fontWeight: 800 }}>Payment Reconciliation</h3>\r\n                <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>\r\n                    <input \r\n                        type=\"date\" \r\n                        value={startDate} \r\n                        onChange={(e) => setStartDate(e.target.value)} \r\n                        style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #cbd5e1', fontSize: '15px', outline: 'none' }} \r\n                    />\r\n                    <input \r\n                        type=\"date\" \r\n                        value={endDate} \r\n                        onChange={(e) => setEndDate(e.target.value)} \r\n                        style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #cbd5e1', fontSize: '15px', outline: 'none' }} \r\n                    />\r\n                    <button onClick={exportToExcel} className=\"btn-secondary\" style={{ display: 'flex', gap: '8px', alignItems: 'center', padding: '10px 20px', background: '#10b981', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: 600, fontSize: '15px' }}>\r\n                        <Download size={18} /> Export\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div style={{ padding: '80px', textAlign: 'center', color: '#64748b' }}>\r\n                    <div className=\"spinner\" style={{ border: '4px solid #f3f3f3', borderTop: '4px solid #6366f1', borderRadius: '50%', width: '32px', height: '32px', animation: 'spin 1s linear infinite', margin: '0 auto 20px' }}></div>\r\n                    <span style={{ fontSize: '16px', fontWeight: 500 }}>Loading report data...</span>\r\n                </div>\r\n            ) : (\r\n                <div className=\"report-content\">\r\n                    {/* Charts */}\r\n                    {data.length > 0 && (\r\n                        <div style={{ height: '450px', marginBottom: '24px', background: 'white', padding: '30px', borderRadius: '16px', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)', border: '1px solid #f1f5f9' }}>\r\n                            <ResponsiveContainer width=\"100%\" height=\"95%\">\r\n                                <PieChart margin={{ top: 20, right: 30, left: 30, bottom: 20 }}>\r\n                                    <Pie\r\n                                        data={data}\r\n                                        cx=\"50%\"\r\n                                        cy=\"45%\"\r\n                                        innerRadius={70}\r\n                                        outerRadius={110}\r\n                                        paddingAngle={3}\r\n                                        dataKey=\"total_amount\"\r\n                                        nameKey=\"payment_method\"\r\n                                        labelLine={true}\r\n                                        label={renderCustomizedLabel}\r\n                                    >\r\n                                        {data.map((entry, index) => (\r\n                                            <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                                        ))}\r\n                                    </Pie>\r\n                                    <Tooltip \r\n                                        formatter={(value) => [`${value.toFixed(2)}`, 'Collected']} \r\n                                        contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)', padding: '12px' }}\r\n                                    />\r\n                                    <Legend verticalAlign=\"bottom\" height={40} iconType=\"circle\" iconSize={10} wrapperStyle={{ fontSize: '14px', fontWeight: 500, paddingTop: '20px' }} />\r\n                                </PieChart>\r\n                            </ResponsiveContainer>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div style={{ background: 'white', borderRadius: '16px', overflow: 'hidden', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)', border: '1px solid #f1f5f9' }}>\r\n                        <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                            <thead style={{ background: '#f8fafc', borderBottom: '2px solid #e2e8f0' }}>\r\n                                <tr>\r\n                                    <th style={thStyle}>Payment Mode</th>\r\n                                    <th style={{...thStyle, textAlign: 'center'}}>Transaction Count</th>\r\n                                    <th style={{...thStyle, textAlign: 'right'}}>Total Collected</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody>\r\n                                {data.map((item, idx) => (\r\n                                    <tr key={idx} style={{ borderBottom: '1px solid #f1f5f9' }}>\r\n                                        <td style={{...tdStyle, textTransform: 'uppercase', fontWeight: 700, color: '#6366f1'}}>{item.payment_method}</td>\r\n                                        <td style={{...tdStyle, textAlign: 'center', fontWeight: 600}}>{item.count}</td>\r\n                                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 800, color: '#10b981', fontSize: '16px'}}>{item.total_amount?.toFixed(2)}</td>\r\n                                    </tr>\r\n                                ))}\r\n                                {data.length === 0 && (\r\n                                    <tr>\r\n                                        <td colSpan=\"3\" style={{ padding: '60px', textAlign: 'center', color: '#94a3b8', fontSize: '16px' }}>No payment data found for the selected period.</td>\r\n                                    </tr>\r\n                                )}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default PaymentReports;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\Reports\\SalesReports.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":23,"column":6,"nodeType":"ArrayExpression","endLine":23,"endColumn":37,"suggestions":[{"desc":"Update the dependencies array to be: [activeTab, startDate, endDate, fetchData]","fix":{"range":[1084,1115],"text":"[activeTab, startDate, endDate, fetchData]"}}]},{"ruleId":"no-unused-vars","severity":1,"message":"'innerRadius' is defined but never used.","line":79,"column":54,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":65},{"ruleId":"no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":79,"column":89,"nodeType":"Identifier","messageId":"unusedVar","endLine":79,"endColumn":94}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { \r\n  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer,\r\n  PieChart, Pie, Cell, Legend\r\n} from 'recharts';\r\nimport { Download } from 'lucide-react';\r\nimport { format } from 'date-fns';\r\nimport * as XLSX from 'xlsx';\r\n\r\nconst thStyle = { padding: '14px 20px', textAlign: 'left', fontWeight: 600, color: '#64748b', fontSize: '15px' };\r\nconst tdStyle = { padding: '14px 20px', color: '#334155', fontSize: '15px' };\r\nconst COLORS = ['#6366f1', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#ec4899', '#0ea5e9', '#14b8a6', '#f43f5e', '#a855f7'];\r\n\r\nconst SalesReports = () => {\r\n  const [activeTab, setActiveTab] = useState('item-wise'); // item-wise, category-wise, add-ons, hourly, cancelled, discounts, gst\r\n  const [startDate, setStartDate] = useState(format(new Date(), 'yyyy-MM-dd'));\r\n  const [endDate, setEndDate] = useState(format(new Date(), 'yyyy-MM-dd'));\r\n  const [data, setData] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n  }, [activeTab, startDate, endDate]);\r\n\r\n  const fetchData = async () => {\r\n    setLoading(true);\r\n    console.log(`[SalesReports] Fetching ${activeTab} for ${startDate} to ${endDate}`);\r\n    try {\r\n      let result = [];\r\n      switch (activeTab) {\r\n        case 'item-wise':\r\n          result = await window.electronAPI.invoke('reports:itemWiseSales', { startDate, endDate });\r\n          break;\r\n        case 'category-wise':\r\n          result = await window.electronAPI.invoke('reports:categoryWiseSales', { startDate, endDate });\r\n          break;\r\n        case 'add-ons':\r\n          result = await window.electronAPI.invoke('reports:addonSales', { startDate, endDate });\r\n          break;\r\n        case 'hourly':\r\n          result = await window.electronAPI.invoke('reports:hourlySales', { date: startDate });\r\n          break;\r\n        case 'cancelled':\r\n          result = await window.electronAPI.invoke('reports:cancelledOrders', { startDate, endDate });\r\n          break;\r\n        case 'discounts':\r\n          result = await window.electronAPI.invoke('reports:discounts', { startDate, endDate });\r\n          break;\r\n        case 'gst':\r\n          result = await window.electronAPI.invoke('reports:gst', { startDate, endDate });\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n      if (activeTab === 'item-wise' && Array.isArray(result)) {\r\n        result = result.map(row => ({\r\n          ...row,\r\n          displayName: row.variant_name ? `${row.item_name} (${row.variant_name})` : row.item_name\r\n        }));\r\n      }\r\n\r\n      console.log(`[SalesReports] Received ${result?.length} rows`, result);\r\n      setData(result || []);\r\n    } catch (error) {\r\n      console.error(\"Error fetching sales data:\", error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const exportToExcel = () => {\r\n    const ws = XLSX.utils.json_to_sheet(data);\r\n    const wb = XLSX.utils.book_new();\r\n    XLSX.utils.book_append_sheet(wb, ws, \"Report\");\r\n    XLSX.writeFile(wb, `Sales_${activeTab}_${startDate}.xlsx`);\r\n  };\r\n\r\n  // Custom Label for Pie Chart\r\n  const renderCustomizedLabel = ({ cx, cy, midAngle, innerRadius, outerRadius, percent, index, category_name }) => {\r\n    const RADIAN = Math.PI / 180;\r\n    const radius = outerRadius + 25; // Push label outside\r\n    const x = cx + radius * Math.cos(-midAngle * RADIAN);\r\n    const y = cy + radius * Math.sin(-midAngle * RADIAN);\r\n    const textAnchor = x > cx ? 'start' : 'end';\r\n\r\n    return (\r\n      <text x={x} y={y} fill=\"#1e293b\" textAnchor={textAnchor} dominantBaseline=\"central\" fontSize=\"13\" fontWeight=\"700\">\r\n        {`${category_name} (${(percent * 100).toFixed(0)}%)`}\r\n      </text>\r\n    );\r\n  };\r\n\r\n  return (\r\n    <div className=\"report-container\">\r\n      <div className=\"report-header\" style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '24px', flexWrap: 'wrap', gap: '12px' }}>\r\n        <div className=\"tabs\" style={{ display: 'flex', gap: '10px', overflowX: 'auto', paddingBottom: '4px' }}>\r\n          {['item-wise', 'category-wise', 'add-ons', 'hourly', 'cancelled', 'discounts', 'gst'].map(tab => (\r\n            <button\r\n              key={tab}\r\n              onClick={() => setActiveTab(tab)}\r\n              style={{\r\n                padding: '10px 20px',\r\n                borderRadius: '8px',\r\n                border: 'none',\r\n                background: activeTab === tab ? '#6366f1' : 'white',\r\n                color: activeTab === tab ? 'white' : '#64748b',\r\n                cursor: 'pointer',\r\n                textTransform: 'capitalize',\r\n                fontWeight: 600,\r\n                fontSize: '15px',\r\n                boxShadow: '0 2px 4px rgba(0,0,0,0.05)',\r\n                whiteSpace: 'nowrap',\r\n                transition: 'all 0.2s'\r\n              }}\r\n            >\r\n              {tab.replace('-', ' ')}\r\n            </button>\r\n          ))}\r\n        </div>\r\n        \r\n        <div className=\"controls\" style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>\r\n          <input \r\n            type=\"date\" \r\n            value={startDate} \r\n            onChange={(e) => setStartDate(e.target.value)}\r\n            style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #cbd5e1', fontSize: '15px', outline: 'none' }}\r\n          />\r\n          {activeTab !== 'hourly' && (\r\n            <input \r\n              type=\"date\" \r\n              value={endDate} \r\n              onChange={(e) => setEndDate(e.target.value)}\r\n              style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #cbd5e1', fontSize: '15px', outline: 'none' }}\r\n            />\r\n          )}\r\n          <button onClick={exportToExcel} className=\"btn-secondary\" style={{ display: 'flex', gap: '8px', alignItems: 'center', padding: '10px 20px', background: '#10b981', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: 600, fontSize: '15px' }}>\r\n            <Download size={18} /> Export\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {loading ? (\r\n        <div style={{ padding: '80px', textAlign: 'center', color: '#64748b' }}>\r\n          <div className=\"spinner\" style={{ border: '4px solid #f3f3f3', borderTop: '4px solid #6366f1', borderRadius: '50%', width: '32px', height: '32px', animation: 'spin 1s linear infinite', margin: '0 auto 20px' }}></div>\r\n          <span style={{ fontSize: '16px', fontWeight: 500 }}>Loading report data...</span>\r\n        </div>\r\n      ) : (\r\n        <div className=\"report-content\">\r\n          {/* Visualizations for specific tabs */}\r\n          {activeTab === 'item-wise' && data.length > 0 && (\r\n            <div style={{ height: '400px', marginBottom: '24px', background: 'white', padding: '30px', borderRadius: '16px', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)', border: '1px solid #f1f5f9' }}>\r\n              <h4 style={{ margin: '0 0 24px 0', color: '#1e293b', fontSize: '18px', fontWeight: 700 }}>Top Items by Revenue</h4>\r\n              <ResponsiveContainer width=\"100%\" height=\"90%\">\r\n                <BarChart data={data.slice(0, 10)}>\r\n                  <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e2e8f0\" />\r\n                  <XAxis dataKey=\"displayName\" tick={{ fontSize: 13, fill: '#64748b', fontWeight: 500 }} axisLine={false} tickLine={false} interval={0} angle={-15} textAnchor=\"end\" height={70} />\r\n                  <YAxis tick={{ fontSize: 13, fill: '#64748b', fontWeight: 500 }} axisLine={false} tickLine={false} tickFormatter={(val) => `${val}`} />\r\n                  <Tooltip \r\n                    cursor={{ fill: '#f8fafc' }}\r\n                    contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)', padding: '12px' }}\r\n                    labelStyle={{ fontWeight: 700, marginBottom: '4px' }}\r\n                    formatter={(value) => `${value}`} \r\n                  />\r\n                  <Bar dataKey=\"total_revenue\" fill=\"#6366f1\" radius={[6, 6, 0, 0]} maxBarSize={65} />\r\n                </BarChart>\r\n              </ResponsiveContainer>\r\n            </div>\r\n          )}\r\n\r\n          {activeTab === 'category-wise' && data.length > 0 && (\r\n            <div style={{ height: '450px', marginBottom: '24px', background: 'white', padding: '30px', borderRadius: '16px', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)', border: '1px solid #f1f5f9' }}>\r\n               <h4 style={{ margin: '0 0 24px 0', color: '#1e293b', fontSize: '18px', fontWeight: 700 }}>Category Breakdown</h4>\r\n               <ResponsiveContainer width=\"100%\" height=\"95%\">\r\n                 <PieChart margin={{ top: 20, right: 30, left: 30, bottom: 20 }}>\r\n                    <Pie\r\n                      data={data}\r\n                      cx=\"50%\"\r\n                      cy=\"45%\"\r\n                      labelLine={true}\r\n                      label={renderCustomizedLabel}\r\n                      outerRadius={110}\r\n                      innerRadius={70}\r\n                      paddingAngle={3}\r\n                      dataKey=\"total_revenue\"\r\n                      nameKey=\"category_name\"\r\n                    >\r\n                      {data.map((entry, index) => (\r\n                        <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n                      ))}\r\n                    </Pie>\r\n                    <Tooltip \r\n                      formatter={(value) => [`${value.toFixed(2)}`, 'Revenue']} \r\n                      contentStyle={{ borderRadius: '12px', border: 'none', boxShadow: '0 10px 15px -3px rgba(0,0,0,0.1)', padding: '12px' }}\r\n                    />\r\n                    <Legend verticalAlign=\"bottom\" height={40} iconType=\"circle\" iconSize={10} wrapperStyle={{ fontSize: '14px', fontWeight: 500, paddingTop: '20px' }} />\r\n                 </PieChart>\r\n               </ResponsiveContainer>\r\n            </div>\r\n          )}\r\n\r\n          {/* Data Table */}\r\n          <div style={{ background: 'white', borderRadius: '16px', overflow: 'hidden', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)', border: '1px solid #f1f5f9' }}>\r\n            <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n              <thead style={{ background: '#f8fafc', borderBottom: '2px solid #e2e8f0' }}>\r\n                <tr>\r\n                   {activeTab === 'item-wise' && (\r\n                     <>\r\n                       <th style={thStyle}>Item Name</th>\r\n                       <th style={thStyle}>Category</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Quantity</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Revenue</th>\r\n                     </>\r\n                   )}\r\n                   {activeTab === 'category-wise' && (\r\n                     <>\r\n                       <th style={thStyle}>Category</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Orders</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Quantity</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Revenue</th>\r\n                     </>\r\n                   )}\r\n                   {activeTab === 'add-ons' && (\r\n                     <>\r\n                       <th style={thStyle}>Add-on Name</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Quantity Sold</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Total Revenue</th>\r\n                     </>\r\n                   )}\r\n                   {activeTab === 'hourly' && (\r\n                     <>\r\n                       <th style={thStyle}>Hour</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Orders Per Hour</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Revenue Per Hour</th>\r\n                     </>\r\n                   )}\r\n                   {activeTab === 'cancelled' && (\r\n                     <>\r\n                       <th style={thStyle}>Order #</th>\r\n                       <th style={thStyle}>Cancelled At</th>\r\n                       <th style={thStyle}>Reason</th>\r\n                       <th style={thStyle}>Cashier</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Amount</th>\r\n                     </>\r\n                   )}\r\n                   {activeTab === 'discounts' && (\r\n                     <>\r\n                       <th style={thStyle}>Order #</th>\r\n                       <th style={thStyle}>Date</th>\r\n                       <th style={thStyle}>Discount Reason</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Subtotal</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Discount</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Final</th>\r\n                     </>\r\n                   )}\r\n                   {activeTab === 'gst' && (\r\n                     <>\r\n                       <th style={thStyle}>Date</th>\r\n                       <th style={{...thStyle, textAlign: 'center'}}>Total Orders</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Taxable Amount</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Tax (GST)</th>\r\n                       <th style={{...thStyle, textAlign: 'right'}}>Total Amount</th>\r\n                     </>\r\n                   )}\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {data.map((item, idx) => (\r\n                  <tr key={idx} style={{ borderBottom: '1px solid #f1f5f9', transition: 'background 0.2s' }}>\r\n                    {activeTab === 'item-wise' && (\r\n                      <>\r\n                        <td style={tdStyle}>\r\n                          <div style={{ fontWeight: 600 }}>{item.item_name}</div>\r\n                          {item.variant_name && <div style={{ fontSize: '12px', color: '#64748b', marginTop: '4px' }}>{item.variant_name}</div>}\r\n                        </td>\r\n                        <td style={tdStyle}>{item.category_name}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 600}}>{item.total_quantity}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 700, color: '#10b981'}}>{item.total_revenue?.toFixed(2)}</td>\r\n                      </>\r\n                    )}\r\n                    {activeTab === 'category-wise' && (\r\n                      <>\r\n                        <td style={tdStyle}>{item.category_name}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 600}}>{item.orders_count}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right'}}>{item.total_quantity}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 700, color: '#10b981'}}>{item.total_revenue?.toFixed(2)}</td>\r\n                      </>\r\n                    )}\r\n                    {activeTab === 'add-ons' && (\r\n                      <>\r\n                        <td style={tdStyle}>{item.name}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 600}}>{item.quantity}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 700, color: '#10b981'}}>{item.revenue?.toFixed(2)}</td>\r\n                      </>\r\n                    )}\r\n                    {activeTab === 'hourly' && (\r\n                      <>\r\n                        <td style={tdStyle}>{item.hour}:00 - {item.hour}:59</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 600}}>{item.total_orders}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 700, color: '#10b981'}}>{item.total_revenue?.toFixed(2)}</td>\r\n                      </>\r\n                    )}\r\n                    {activeTab === 'cancelled' && (\r\n                      <>\r\n                        <td style={tdStyle}>#{item.order_number}</td>\r\n                        <td style={tdStyle}>{new Date(item.cancelled_at).toLocaleString()}</td>\r\n                        <td style={tdStyle}>{item.reason || '-'}</td>\r\n                        <td style={tdStyle}>{item.cashier_name || 'Unknown'}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 700, color: '#ef4444'}}>{item.total_amount?.toFixed(2)}</td>\r\n                      </>\r\n                    )}\r\n                    {activeTab === 'discounts' && (\r\n                      <>\r\n                        <td style={tdStyle}>#{item.order_number}</td>\r\n                        <td style={tdStyle}>{new Date(item.created_at).toLocaleDateString()}</td>\r\n                        <td style={tdStyle}>{item.discount_reason || 'Manual'}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right'}}>{item.subtotal?.toFixed(2)}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', color: '#ef4444', fontWeight: 600}}>-{item.discount_amount?.toFixed(2)}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 800}}>{item.total_amount?.toFixed(2)}</td>\r\n                      </>\r\n                    )}\r\n                    {activeTab === 'gst' && (\r\n                      <>\r\n                        <td style={tdStyle}>{new Date(item.date).toLocaleDateString()}</td>\r\n                        <td style={{...tdStyle, textAlign: 'center', fontWeight: 600}}>{item.total_orders}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right'}}>{item.taxable_amount?.toFixed(2)}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', color: '#6366f1'}}>{item.total_tax?.toFixed(2)}</td>\r\n                        <td style={{...tdStyle, textAlign: 'right', fontWeight: 800, color: '#10b981'}}>{item.total_amount?.toFixed(2)}</td>\r\n                      </>\r\n                    )}\r\n                  </tr>\r\n                ))}\r\n                {data.length === 0 && (\r\n                   <tr>\r\n                     <td colSpan=\"6\" style={{ padding: '60px', textAlign: 'center', color: '#94a3b8', fontSize: '16px' }}>No data found for the selected period.</td>\r\n                   </tr>\r\n                )}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SalesReports;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\Reports\\StaffReports.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":17,"column":8,"nodeType":"ArrayExpression","endLine":17,"endColumn":28,"suggestions":[{"desc":"Update the dependencies array to be: [startDate, endDate, fetchData]","fix":{"range":[701,721],"text":"[startDate, endDate, fetchData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { Download } from 'lucide-react';\r\nimport * as XLSX from 'xlsx';\r\nimport { format } from 'date-fns';\r\n\r\nconst thStyle = { padding: '14px 20px', textAlign: 'left', fontWeight: 600, color: '#64748b', fontSize: '15px' };\r\nconst tdStyle = { padding: '14px 20px', color: '#334155', fontSize: '15px' };\r\n\r\nconst StaffReports = () => {\r\n    const [data, setData] = useState([]);\r\n    const [loading, setLoading] = useState(false);\r\n    const [startDate, setStartDate] = useState(format(new Date(), 'yyyy-MM-dd'));\r\n    const [endDate, setEndDate] = useState(format(new Date(), 'yyyy-MM-dd'));\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, [startDate, endDate]);\r\n\r\n    const fetchData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            const result = await window.electronAPI.invoke('reports:staffPerformance', { startDate, endDate });\r\n            setData(result || []);\r\n        } catch (error) {\r\n            console.error(\"Error fetching staff data:\", error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const exportToExcel = () => {\r\n        const ws = XLSX.utils.json_to_sheet(data);\r\n        const wb = XLSX.utils.book_new();\r\n        XLSX.utils.book_append_sheet(wb, ws, \"Staff\");\r\n        XLSX.writeFile(wb, `Staff_Performance_${startDate}.xlsx`);\r\n    };\r\n\r\n    return (\r\n        <div className=\"report-container\">\r\n            <div className=\"report-header\" style={{ display: 'flex', justifyContent: 'space-between', marginBottom: '24px', flexWrap: 'wrap', gap: '12px' }}>\r\n                <h3 style={{ margin: 0, color: '#1e293b', fontSize: '22px', fontWeight: 800 }}>Staff Performance</h3>\r\n                <div style={{ display: 'flex', gap: '12px', alignItems: 'center' }}>\r\n                    <input \r\n                        type=\"date\" \r\n                        value={startDate} \r\n                        onChange={(e) => setStartDate(e.target.value)} \r\n                        style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #cbd5e1', fontSize: '15px', outline: 'none' }} \r\n                    />\r\n                    <input \r\n                        type=\"date\" \r\n                        value={endDate} \r\n                        onChange={(e) => setEndDate(e.target.value)} \r\n                        style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #cbd5e1', fontSize: '15px', outline: 'none' }} \r\n                    />\r\n                    <button onClick={exportToExcel} className=\"btn-secondary\" style={{ display: 'flex', gap: '8px', alignItems: 'center', padding: '10px 20px', background: '#10b981', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer', fontWeight: 600, fontSize: '15px' }}>\r\n                        <Download size={18} /> Export\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {loading ? (\r\n                <div style={{ padding: '80px', textAlign: 'center', color: '#64748b' }}>\r\n                    <div className=\"spinner\" style={{ border: '4px solid #f3f3f3', borderTop: '4px solid #6366f1', borderRadius: '50%', width: '32px', height: '32px', animation: 'spin 1s linear infinite', margin: '0 auto 20px' }}></div>\r\n                    <span style={{ fontSize: '16px', fontWeight: 500 }}>Loading staff data...</span>\r\n                </div>\r\n            ) : (\r\n                <div style={{ background: 'white', borderRadius: '16px', overflow: 'hidden', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)', border: '1px solid #f1f5f9' }}>\r\n                    <table style={{ width: '100%', borderCollapse: 'collapse' }}>\r\n                        <thead style={{ background: '#f8fafc', borderBottom: '2px solid #e2e8f0' }}>\r\n                            <tr>\r\n                                <th style={thStyle}>Staff Name</th>\r\n                                <th style={thStyle}>Role</th>\r\n                                <th style={{...thStyle, textAlign: 'center'}}>Orders Handled</th>\r\n                                <th style={{...thStyle, textAlign: 'right'}}>Total Sales Generated</th>\r\n                                <th style={{...thStyle, textAlign: 'right'}}>Avg. Order Value</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody>\r\n                            {data.map((item, idx) => (\r\n                                <tr key={idx} style={{ borderBottom: '1px solid #f1f5f9' }}>\r\n                                    <td style={{...tdStyle, fontWeight: 700, color: '#6366f1'}}>{item.staff_name}</td>\r\n                                    <td style={{...tdStyle, textTransform: 'capitalize', fontWeight: 500}}>{item.role}</td>\r\n                                    <td style={{...tdStyle, textAlign: 'center', fontWeight: 600}}>{item.orders_handled}</td>\r\n                                    <td style={{...tdStyle, textAlign: 'right', fontWeight: 700, color: '#10b981'}}>{item.total_sales?.toFixed(2)}</td>\r\n                                    <td style={{...tdStyle, textAlign: 'right', fontWeight: 600}}>{item.avg_order_value?.toFixed(2)}</td>\r\n                                </tr>\r\n                            ))}\r\n                            {data.length === 0 && (\r\n                                <tr>\r\n                                    <td colSpan=\"5\" style={{ padding: '60px', textAlign: 'center', color: '#94a3b8', fontSize: '16px' }}>No staff data found.</td>\r\n                                </tr>\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default StaffReports;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\SettingsPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"no-unused-vars","severity":1,"message":"'Settings' is defined but never used.","line":3,"column":3,"nodeType":"Identifier","messageId":"unusedVar","endLine":3,"endColumn":11},{"ruleId":"react/no-unescaped-entities","severity":2,"message":"`'` can be escaped with `&apos;`, `&lsquo;`, `&#39;`, `&rsquo;`.","line":389,"column":123,"nodeType":"JSXText","messageId":"unescapedEntityAlts","suggestions":[{"messageId":"replaceWithAlt","data":{"alt":"&apos;"},"fix":{"range":[20376,20541],"text":"\r\n                      Import menu items or inventory data from spreadsheet files. Make sure the column names match ZapBill&apos;s expected format.\r\n                    "},"desc":"Replace with `&apos;`."},{"messageId":"replaceWithAlt","data":{"alt":"&lsquo;"},"fix":{"range":[20376,20541],"text":"\r\n                      Import menu items or inventory data from spreadsheet files. Make sure the column names match ZapBill&lsquo;s expected format.\r\n                    "},"desc":"Replace with `&lsquo;`."},{"messageId":"replaceWithAlt","data":{"alt":"&#39;"},"fix":{"range":[20376,20541],"text":"\r\n                      Import menu items or inventory data from spreadsheet files. Make sure the column names match ZapBill&#39;s expected format.\r\n                    "},"desc":"Replace with `&#39;`."},{"messageId":"replaceWithAlt","data":{"alt":"&rsquo;"},"fix":{"range":[20376,20541],"text":"\r\n                      Import menu items or inventory data from spreadsheet files. Make sure the column names match ZapBill&rsquo;s expected format.\r\n                    "},"desc":"Replace with `&rsquo;`."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Settings, \r\n  Save, \r\n  Cloud,\r\n  Store,\r\n  Upload,\r\n  Database,\r\n  Receipt,\r\n  RefreshCw,\r\n  CheckCircle2,\r\n  AlertCircle,\r\n  Info,\r\n  IndianRupee\r\n} from 'lucide-react';\r\n\r\nconst SettingsPage = () => {\r\n  const [settings, setSettings] = useState({});\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [saveMessage, setSaveMessage] = useState('');\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const [importStats, setImportStats] = useState(null);\r\n  const [importing, setImporting] = useState(null);\r\n  const [activeTab, setActiveTab] = useState('restaurant');\r\n  const [dbPath, setDbPath] = useState('');\r\n  const [isMovingDb, setIsMovingDb] = useState(false);\r\n  const [importMenuName, setImportMenuName] = useState('');\r\n\r\n  useEffect(() => {\r\n    loadData();\r\n  }, []);\r\n\r\n  const loadData = async () => {\r\n    try {\r\n      const settingsResult = await window.electronAPI.invoke('settings:getAll', {});\r\n      if (Array.isArray(settingsResult)) {\r\n        const settingsObj = {};\r\n        settingsResult.forEach(row => { settingsObj[row.key] = row.value; });\r\n        setSettings(settingsObj);\r\n      }\r\n      window.electronAPI.invoke('db:getPath').then(setDbPath).catch(console.error);\r\n    } catch (error) {\r\n      console.error('Failed to load data:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleSave = async () => {\r\n    setIsSaving(true);\r\n    setSaveMessage('');\r\n    try {\r\n      for (const [key, value] of Object.entries(settings)) {\r\n        await window.electronAPI.invoke('settings:update', { key, value });\r\n      }\r\n      setSaveMessage('success');\r\n      setTimeout(() => setSaveMessage(''), 3000);\r\n    } catch (error) {\r\n      console.error('Save failed:', error);\r\n      setSaveMessage('error');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  const updateSetting = (key, value) => {\r\n    setSettings(prev => ({ ...prev, [key]: value }));\r\n  };\r\n\r\n  const handleImport = async (type) => {\r\n    setImporting(type);\r\n    setImportStats(null);\r\n\r\n    try {\r\n      // Use Electron's native file dialog instead of HTML file input\r\n      const fileResult = await window.electronAPI.invoke('dialog:selectFile', {\r\n        title: type === 'menu' ? 'Select Menu File' : 'Select Inventory File',\r\n        filters: [\r\n          { name: 'Spreadsheets', extensions: ['xlsx', 'xls', 'csv'] },\r\n          { name: 'All Files', extensions: ['*'] }\r\n        ]\r\n      });\r\n\r\n      if (!fileResult.success) {\r\n        // User cancelled or error\r\n        if (fileResult.error) alert('Error: ' + fileResult.error);\r\n        setImporting(null);\r\n        return;\r\n      }\r\n\r\n      const channel = type === 'menu' ? 'data:importMenu' : 'data:importInventory';\r\n      const result = await window.electronAPI.invoke(channel, { \r\n        filePath: fileResult.filePath,\r\n        menuName: type === 'menu' ? importMenuName : null\r\n      });\r\n      \r\n      if (result.success) {\r\n        setImportStats({\r\n          type,\r\n          success: result.successCount,\r\n          error: result.errorCount,\r\n          menuName: type === 'menu' ? (importMenuName || 'Default Menu') : null,\r\n          details: result.errors || []\r\n        });\r\n        if (type === 'menu') setImportMenuName(''); // Clear after success\r\n      } else {\r\n        alert('Import failed: ' + result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Import error:', error);\r\n      alert('Error during import: ' + error.message);\r\n    } finally {\r\n      setImporting(null);\r\n    }\r\n  };\r\n\r\n  const handleMoveDb = async () => {\r\n    if (!confirm('Are you sure you want to move the database? The application will need to restart.')) return;\r\n    setIsMovingDb(true);\r\n    try {\r\n      const result = await window.electronAPI.invoke('db:movePath');\r\n      if (result.success) {\r\n        alert('Database moved successfully! The application will now restart.');\r\n        window.location.reload();\r\n      } else if (!result.cancelled) {\r\n        alert('Failed to move database: ' + result.error);\r\n      }\r\n    } catch (error) {\r\n      console.error('Move DB error:', error);\r\n      alert('Error moving database: ' + error.message);\r\n    } finally {\r\n      setIsMovingDb(false);\r\n    }\r\n  };\r\n\r\n  // Toggle Switch Component\r\n  const Toggle = ({ checked, onChange }) => (\r\n    <button onClick={() => onChange(!checked)} style={{ background: 'none', border: 'none', cursor: 'pointer', padding: 0, flexShrink: 0 }}>\r\n      <div style={{\r\n        width: '44px', height: '24px', borderRadius: '12px',\r\n        background: checked ? 'var(--primary-500)' : 'var(--gray-300)',\r\n        position: 'relative', transition: 'background 0.2s ease'\r\n      }}>\r\n        <div style={{\r\n          width: '20px', height: '20px', borderRadius: '50%', background: 'white',\r\n          position: 'absolute', top: '2px', left: checked ? '22px' : '2px',\r\n          transition: 'left 0.2s ease', boxShadow: '0 1px 3px rgba(0,0,0,0.25)'\r\n        }} />\r\n      </div>\r\n    </button>\r\n  );\r\n\r\n  const tabs = [\r\n    { id: 'restaurant', label: 'Restaurant Info', icon: Store, desc: 'Name, address & details', color: 'var(--primary-500)', bg: 'var(--primary-50)' },\r\n    { id: 'tax', label: 'Tax Settings', icon: IndianRupee, desc: 'Tax rates & configuration', color: 'var(--success-500)', bg: 'var(--success-50)' },\r\n    { id: 'import', label: 'Data Import', icon: Upload, desc: 'Import menu & inventory', color: 'var(--warning-600)', bg: 'var(--warning-50)' },\r\n    { id: 'database', label: 'Database', icon: Database, desc: 'Storage & backup', color: 'var(--info-500)', bg: 'var(--info-50)' },\r\n    { id: 'about', label: 'About', icon: Info, desc: 'System information', color: 'var(--gray-500)', bg: 'var(--gray-100)' }\r\n  ];\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '60vh' }}>\r\n        <div style={{ textAlign: 'center' }}>\r\n          <RefreshCw size={32} style={{ color: 'var(--primary-500)', animation: 'spin 1s linear infinite' }} />\r\n          <p style={{ marginTop: '12px', color: 'var(--gray-500)' }}>Loading settings...</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ padding: '24px', height: 'calc(100vh - 65px)', display: 'flex', flexDirection: 'column', overflow: 'hidden' }}>\r\n      {/* Header */}\r\n      <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px', flexShrink: 0 }}>\r\n        <div>\r\n          <h1 style={{ fontSize: '22px', fontWeight: '700', color: 'var(--gray-900)', margin: 0 }}>Settings</h1>\r\n          <p style={{ color: 'var(--gray-500)', fontSize: '13px', margin: '4px 0 0' }}>Configure your restaurant POS system</p>\r\n        </div>\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>\r\n          {saveMessage && (\r\n            <div style={{\r\n              display: 'flex', alignItems: 'center', gap: '6px',\r\n              padding: '8px 16px', borderRadius: '8px', fontSize: '13px', fontWeight: '500',\r\n              background: saveMessage === 'success' ? 'var(--success-50)' : 'var(--danger-50)',\r\n              color: saveMessage === 'success' ? 'var(--success-700)' : 'var(--danger-700)',\r\n              border: `1px solid ${saveMessage === 'success' ? 'var(--success-200)' : 'var(--danger-200)'}`\r\n            }}>\r\n              {saveMessage === 'success' ? <CheckCircle2 size={15} /> : <AlertCircle size={15} />}\r\n              {saveMessage === 'success' ? 'Settings saved!' : 'Save failed'}\r\n            </div>\r\n          )}\r\n          <button className=\"btn btn-primary\" onClick={handleSave} disabled={isSaving}\r\n            style={{ display: 'flex', alignItems: 'center', gap: '8px', fontSize: '13px' }}>\r\n            <Save size={15} /> {isSaving ? 'Saving...' : 'Save Changes'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Main: Tabs Left + Content Right */}\r\n      <div style={{ display: 'grid', gridTemplateColumns: '260px 1fr', gap: '20px', flex: 1, minHeight: 0 }}>\r\n        {/* Left Tabs */}\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: '6px', background: 'var(--gray-50)', borderRadius: 'var(--radius-lg)', border: '1px solid var(--gray-200)', padding: '12px', height: 'fit-content' }}>\r\n          {tabs.map(tab => {\r\n            const isActive = activeTab === tab.id;\r\n            const Icon = tab.icon;\r\n            return (\r\n              <button key={tab.id} onClick={() => setActiveTab(tab.id)}\r\n                style={{\r\n                  display: 'flex', alignItems: 'center', gap: '12px', padding: '14px 16px',\r\n                  border: 'none', borderRadius: 'var(--radius-md)', cursor: 'pointer', textAlign: 'left', width: '100%',\r\n                  background: isActive ? 'white' : 'transparent',\r\n                  boxShadow: isActive ? '0 2px 8px rgba(0,0,0,0.08)' : 'none',\r\n                  transition: 'all 0.2s ease', position: 'relative'\r\n                }}>\r\n                {isActive && (\r\n                  <div style={{ position: 'absolute', left: 0, top: '50%', transform: 'translateY(-50%)', width: '3px', height: '24px', borderRadius: '0 3px 3px 0', background: tab.color }} />\r\n                )}\r\n                <div style={{\r\n                  width: '36px', height: '36px', borderRadius: '10px',\r\n                  background: isActive ? tab.bg : 'var(--gray-100)',\r\n                  display: 'flex', alignItems: 'center', justifyContent: 'center', flexShrink: 0, transition: 'all 0.2s'\r\n                }}>\r\n                  <Icon size={18} style={{ color: isActive ? tab.color : 'var(--gray-400)' }} />\r\n                </div>\r\n                <div style={{ overflow: 'hidden' }}>\r\n                  <div style={{ fontWeight: isActive ? '600' : '500', fontSize: '14px', color: isActive ? 'var(--gray-900)' : 'var(--gray-600)', whiteSpace: 'nowrap' }}>\r\n                    {tab.label}\r\n                  </div>\r\n                  <div style={{ fontSize: '11px', color: isActive ? 'var(--gray-500)' : 'var(--gray-400)', marginTop: '1px', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>\r\n                    {tab.desc}\r\n                  </div>\r\n                </div>\r\n              </button>\r\n            );\r\n          })}\r\n        </div>\r\n\r\n        {/* Right Content */}\r\n        <div style={{ background: 'white', borderRadius: 'var(--radius-lg)', border: '1px solid var(--gray-200)', display: 'flex', flexDirection: 'column', minHeight: 0, overflow: 'hidden' }}>\r\n          {/* Content Header */}\r\n          <div style={{ padding: '20px 28px', borderBottom: '1px solid var(--gray-200)', background: 'var(--gray-50)', display: 'flex', alignItems: 'center', gap: '12px', flexShrink: 0 }}>\r\n            {(() => {\r\n              const t = tabs.find(t => t.id === activeTab);\r\n              const Icon = t?.icon;\r\n              return (\r\n                <>\r\n                  <div style={{ width: '40px', height: '40px', borderRadius: '10px', background: t?.bg, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                    {Icon && <Icon size={20} style={{ color: t?.color }} />}\r\n                  </div>\r\n                  <div>\r\n                    <h3 style={{ fontSize: '17px', fontWeight: '600', color: 'var(--gray-900)', margin: 0 }}>{t?.label}</h3>\r\n                    <p style={{ fontSize: '12px', color: 'var(--gray-500)', margin: '2px 0 0' }}>{t?.desc}</p>\r\n                  </div>\r\n                </>\r\n              );\r\n            })()}\r\n          </div>\r\n\r\n          {/* Content Body */}\r\n          <div style={{ padding: '28px', overflowY: 'auto', flex: 1 }}>\r\n\r\n            {/*  TAB: Restaurant Info  */}\r\n            {activeTab === 'restaurant' && (\r\n              <div style={{ display: 'grid', gap: '28px' }}>\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Basic Information</h4>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>\r\n                    <div className=\"input-group\">\r\n                      <label className=\"input-label\">Restaurant Name</label>\r\n                      <input type=\"text\" className=\"input\" value={settings.restaurant_name || ''}\r\n                        onChange={(e) => updateSetting('restaurant_name', e.target.value)} placeholder=\"e.g. Tasty Bites\" />\r\n                    </div>\r\n                    <div className=\"input-group\">\r\n                      <label className=\"input-label\">Phone Number</label>\r\n                      <input type=\"text\" className=\"input\" value={settings.restaurant_phone || ''}\r\n                        onChange={(e) => updateSetting('restaurant_phone', e.target.value)} placeholder=\"e.g. +91 9876543210\" />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Address</h4>\r\n                  <div className=\"input-group\">\r\n                    <label className=\"input-label\">Full Address</label>\r\n                    <textarea className=\"input\" value={settings.restaurant_address || ''}\r\n                      onChange={(e) => updateSetting('restaurant_address', e.target.value)}\r\n                      placeholder=\"Full address of the restaurant\" rows={3} style={{ resize: 'vertical' }} />\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Billing Details</h4>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>\r\n                    <div className=\"input-group\">\r\n                      <label className=\"input-label\">GST Number</label>\r\n                      <input type=\"text\" className=\"input\" value={settings.gst_number || ''}\r\n                        onChange={(e) => updateSetting('gst_number', e.target.value)} placeholder=\"GSTIN\" />\r\n                    </div>\r\n                    <div className=\"input-group\">\r\n                      <label className=\"input-label\">Currency Symbol</label>\r\n                      <input type=\"text\" className=\"input\" value={settings.currency_symbol || ''}\r\n                        onChange={(e) => updateSetting('currency_symbol', e.target.value)} />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div style={{ padding: '16px 20px', background: 'var(--primary-50)', borderRadius: '12px', border: '1px solid var(--primary-200)', display: 'flex', gap: '12px', alignItems: 'center' }}>\r\n                  <Info size={18} style={{ color: 'var(--primary-600)', flexShrink: 0 }} />\r\n                  <p style={{ fontSize: '13px', color: 'var(--primary-700)', margin: 0 }}>\r\n                    Restaurant details appear on printed bills and receipts. Click <strong>Save Changes</strong> to apply.\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/*  TAB: Tax Settings  */}\r\n            {activeTab === 'tax' && (\r\n              <div style={{ display: 'grid', gap: '28px' }}>\r\n                <div style={{ display: 'flex', gap: '14px', padding: '16px 20px', background: 'var(--success-50)', borderRadius: '12px', border: '1px solid var(--success-200)', alignItems: 'flex-start' }}>\r\n                  <IndianRupee size={22} style={{ color: 'var(--success-600)', flexShrink: 0, marginTop: '2px' }} />\r\n                  <div>\r\n                    <strong style={{ color: 'var(--success-700)', fontSize: '14px' }}>Tax Configuration</strong>\r\n                    <p style={{ color: 'var(--success-600)', fontSize: '13px', marginTop: '4px', lineHeight: '1.5' }}>\r\n                      Configure GST/tax settings for your bills. When enabled, tax will be calculated and applied to all orders.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Tax Options</h4>\r\n                  <div style={{ display: 'grid', gap: '12px' }}>\r\n                    <div style={{\r\n                      display: 'flex', justifyContent: 'space-between', alignItems: 'center',\r\n                      padding: '18px 20px', background: 'var(--gray-50)', borderRadius: '12px', border: '1px solid var(--gray-200)'\r\n                    }}>\r\n                      <div>\r\n                        <div style={{ fontWeight: '600', fontSize: '14px', color: 'var(--gray-800)' }}>Enable Tax</div>\r\n                        <div style={{ fontSize: '13px', color: 'var(--gray-500)', marginTop: '3px' }}>\r\n                          Apply tax to all orders. Tax will be shown on bills and reports.\r\n                        </div>\r\n                      </div>\r\n                      <Toggle checked={settings.tax_enabled === 'true'} onChange={(v) => updateSetting('tax_enabled', v ? 'true' : 'false')} />\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Tax Rate</h4>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>\r\n                    <div className=\"input-group\">\r\n                      <label className=\"input-label\">Default Tax Rate (%)</label>\r\n                      <input type=\"number\" step=\"0.01\" className=\"input\" value={settings.default_tax_rate || '5'}\r\n                        onChange={(e) => updateSetting('default_tax_rate', e.target.value)} />\r\n                      <p style={{ fontSize: '12px', color: 'var(--gray-400)', marginTop: '6px' }}>\r\n                        This is the total GST rate. It will be split equally into CGST and SGST on bills.\r\n                      </p>\r\n                    </div>\r\n                    <div style={{ padding: '16px 20px', background: 'var(--gray-50)', borderRadius: '12px', border: '1px solid var(--gray-200)' }}>\r\n                      <div style={{ fontSize: '13px', color: 'var(--gray-500)', marginBottom: '8px' }}>Preview</div>\r\n                      <div style={{ display: 'grid', gap: '6px' }}>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '14px' }}>\r\n                          <span style={{ color: 'var(--gray-600)' }}>Total GST</span>\r\n                          <strong>{settings.default_tax_rate || '5'}%</strong>\r\n                        </div>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '13px', color: 'var(--gray-500)' }}>\r\n                          <span>CGST</span>\r\n                          <span>{((parseFloat(settings.default_tax_rate) || 5) / 2).toFixed(2)}%</span>\r\n                        </div>\r\n                        <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: '13px', color: 'var(--gray-500)' }}>\r\n                          <span>SGST</span>\r\n                          <span>{((parseFloat(settings.default_tax_rate) || 5) / 2).toFixed(2)}%</span>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/*  TAB: Data Import  */}\r\n            {activeTab === 'import' && (\r\n              <div style={{ display: 'grid', gap: '28px' }}>\r\n                <div style={{ display: 'flex', gap: '14px', padding: '16px 20px', background: 'var(--warning-50)', borderRadius: '12px', border: '1px solid var(--warning-200)', alignItems: 'flex-start' }}>\r\n                  <Info size={22} style={{ color: 'var(--warning-600)', flexShrink: 0, marginTop: '2px' }} />\r\n                  <div>\r\n                    <strong style={{ color: 'var(--warning-700)', fontSize: '14px' }}>Import Data from Excel/CSV</strong>\r\n                    <p style={{ color: 'var(--warning-600)', fontSize: '13px', marginTop: '4px', lineHeight: '1.5' }}>\r\n                      Import menu items or inventory data from spreadsheet files. Make sure the column names match ZapBill's expected format.\r\n                    </p>\r\n                  </div>\r\n                </div>\r\n\r\n                <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>\r\n                  {/* Menu Import Card */}\r\n                  <div style={{ padding: '24px', border: '1px solid var(--gray-200)', borderRadius: '12px', background: 'white' }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '12px' }}>\r\n                      <div style={{ width: '40px', height: '40px', borderRadius: '10px', background: 'var(--primary-50)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                        <Receipt size={20} style={{ color: 'var(--primary-500)' }} />\r\n                      </div>\r\n                      <h4 style={{ fontSize: '15px', fontWeight: '600', color: 'var(--gray-800)', margin: 0 }}>Import Menu Items</h4>\r\n                    </div>\r\n                    <p style={{ fontSize: '13px', color: 'var(--gray-500)', marginBottom: '16px', lineHeight: '1.5' }}>\r\n                      Updates existing items by Name, creates new Categories if needed. Supports <strong>.xlsx</strong>, <strong>.xls</strong>, and <strong>.csv</strong> formats.\r\n                    </p>\r\n                    <div style={{ fontSize: '12px', color: 'var(--gray-400)', marginBottom: '16px', padding: '12px', background: 'var(--gray-50)', borderRadius: '8px' }}>\r\n                      <strong style={{ color: 'var(--gray-600)' }}>Expected columns:</strong> Name, Category, Price, Tax Rate, Description\r\n                    </div>\r\n                    \r\n                    <div style={{ marginBottom: '16px' }}>\r\n                      <label className=\"input-label\" style={{ fontSize: '11px', marginBottom: '6px' }}>Menu Profile Name (Optional)</label>\r\n                      <input \r\n                        type=\"text\" \r\n                        className=\"input\" \r\n                        placeholder=\"e.g. Summer Menu, Breakfast\"\r\n                        value={importMenuName}\r\n                        onChange={(e) => setImportMenuName(e.target.value)}\r\n                        style={{ fontSize: '12px', padding: '8px 12px' }}\r\n                      />\r\n                      <p style={{ fontSize: '10px', color: 'var(--gray-400)', marginTop: '4px' }}>\r\n                        If blank, items will be imported into the currently active menu.\r\n                      </p>\r\n                    </div>\r\n\r\n                    <button className=\"btn btn-primary\" onClick={() => handleImport('menu')} disabled={importing !== null}\r\n                      style={{ display: 'flex', alignItems: 'center', gap: '8px', width: '100%', justifyContent: 'center' }}>\r\n                      <Upload size={16} />\r\n                      {importing === 'menu' ? 'Importing...' : 'Select Menu File'}\r\n                    </button>\r\n                  </div>\r\n\r\n                  {/* Inventory Import Card */}\r\n                  <div style={{ padding: '24px', border: '1px solid var(--gray-200)', borderRadius: '12px', background: 'white' }}>\r\n                    <div style={{ display: 'flex', alignItems: 'center', gap: '10px', marginBottom: '12px' }}>\r\n                      <div style={{ width: '40px', height: '40px', borderRadius: '10px', background: 'var(--info-50)', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n                        <Database size={20} style={{ color: 'var(--info-500)' }} />\r\n                      </div>\r\n                      <h4 style={{ fontSize: '15px', fontWeight: '600', color: 'var(--gray-800)', margin: 0 }}>Import Inventory</h4>\r\n                    </div>\r\n                    <p style={{ fontSize: '13px', color: 'var(--gray-500)', marginBottom: '16px', lineHeight: '1.5' }}>\r\n                      Updates Stock and Unit details for existing inventory items. Supports <strong>.xlsx</strong>, <strong>.xls</strong>, and <strong>.csv</strong> formats.\r\n                    </p>\r\n                    <div style={{ fontSize: '12px', color: 'var(--gray-400)', marginBottom: '16px', padding: '12px', background: 'var(--gray-50)', borderRadius: '8px' }}>\r\n                      <strong style={{ color: 'var(--gray-600)' }}>Expected columns:</strong> Item Name, Stock, Unit, Min Stock\r\n                    </div>\r\n                    <button className=\"btn btn-primary\" onClick={() => handleImport('inventory')} disabled={importing !== null}\r\n                      style={{ display: 'flex', alignItems: 'center', gap: '8px', width: '100%', justifyContent: 'center' }}>\r\n                      <Upload size={16} />\r\n                      {importing === 'inventory' ? 'Importing...' : 'Select Inventory File'}\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n\r\n                {/* Import Results */}\r\n                {importStats && (\r\n                  <div style={{ padding: '20px', borderRadius: '12px', border: '1px solid var(--gray-200)', background: 'var(--gray-50)' }}>\r\n                    <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>\r\n                      Last Import Results ({importStats.type === 'menu' ? 'Menu' : 'Inventory'})\r\n                    </h4>\r\n                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '12px', marginBottom: importStats.error > 0 ? '16px' : '0' }}>\r\n                      <div style={{ padding: '14px 16px', background: 'var(--success-50)', borderRadius: '10px', border: '1px solid var(--success-200)' }}>\r\n                        <div style={{ fontSize: '24px', fontWeight: '700', color: 'var(--success-600)' }}>{importStats.success}</div>\r\n                        <div style={{ fontSize: '12px', color: 'var(--success-600)', marginTop: '2px' }}>Successfully Imported</div>\r\n                      </div>\r\n                      <div style={{ padding: '14px 16px', background: 'white', borderRadius: '10px', border: '1px solid var(--primary-200)' }}>\r\n                        <div style={{ fontSize: '18px', fontWeight: '700', color: 'var(--primary-600)', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>{importStats.menuName || 'N/A'}</div>\r\n                        <div style={{ fontSize: '12px', color: 'var(--primary-600)', marginTop: '2px' }}>Menu Profile</div>\r\n                      </div>\r\n                      <div style={{ padding: '14px 16px', background: importStats.error > 0 ? 'var(--danger-50)' : 'var(--success-50)', borderRadius: '10px', border: `1px solid ${importStats.error > 0 ? 'var(--danger-200)' : 'var(--success-200)'}` }}>\r\n                        <div style={{ fontSize: '24px', fontWeight: '700', color: importStats.error > 0 ? 'var(--danger-600)' : 'var(--success-600)' }}>{importStats.error}</div>\r\n                        <div style={{ fontSize: '12px', color: importStats.error > 0 ? 'var(--danger-600)' : 'var(--success-600)', marginTop: '2px' }}>Failed</div>\r\n                      </div>\r\n                    </div>\r\n                    {importStats.error > 0 && importStats.details.length > 0 && (\r\n                      <div style={{ padding: '12px 16px', background: 'white', borderRadius: '8px', border: '1px solid var(--danger-200)' }}>\r\n                        <div style={{ fontSize: '13px', fontWeight: '600', color: 'var(--danger-600)', marginBottom: '8px' }}>Errors:</div>\r\n                        <ul style={{ fontSize: '12px', color: 'var(--gray-600)', paddingLeft: '20px', margin: 0 }}>\r\n                          {importStats.details.slice(0, 5).map((err, i) => <li key={i} style={{ marginBottom: '4px' }}>{err}</li>)}\r\n                          {importStats.details.length > 5 && <li style={{ color: 'var(--gray-400)' }}>...and {importStats.details.length - 5} more</li>}\r\n                        </ul>\r\n                      </div>\r\n                    )}\r\n                  </div>\r\n                )}\r\n              </div>\r\n            )}\r\n\r\n            {/*  TAB: Database  */}\r\n            {activeTab === 'database' && (\r\n              <div style={{ display: 'grid', gap: '28px' }}>\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Database Location</h4>\r\n                  <div style={{ padding: '20px', background: 'var(--gray-50)', borderRadius: '12px', border: '1px solid var(--gray-200)' }}>\r\n                    <div className=\"input-group\">\r\n                      <label className=\"input-label\">Current Database Path</label>\r\n                      <div style={{ display: 'flex', gap: '10px' }}>\r\n                        <input type=\"text\" className=\"input\" value={dbPath || 'Loading...'} readOnly disabled\r\n                          style={{ background: 'var(--gray-100)', color: 'var(--gray-600)', fontFamily: 'monospace', fontSize: '13px' }} />\r\n                        <button className=\"btn btn-secondary\" onClick={handleMoveDb} disabled={isMovingDb}\r\n                          style={{ whiteSpace: 'nowrap' }}>\r\n                          {isMovingDb ? 'Moving...' : 'Move...'}\r\n                        </button>\r\n                      </div>\r\n                    </div>\r\n                    <div style={{ display: 'flex', gap: '8px', alignItems: 'flex-start', marginTop: '12px', padding: '12px 16px', background: 'var(--warning-50)', borderRadius: '8px', border: '1px solid var(--warning-200)' }}>\r\n                      <AlertCircle size={16} style={{ color: 'var(--warning-600)', flexShrink: 0, marginTop: '1px' }} />\r\n                      <p style={{ fontSize: '12px', color: 'var(--warning-700)', margin: 0, lineHeight: '1.5' }}>\r\n                        Moving the database will restart the application. Make sure no orders are being processed.\r\n                      </p>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>Storage Information</h4>\r\n                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px' }}>\r\n                    <div style={{ padding: '18px 20px', background: 'var(--gray-50)', borderRadius: '12px', border: '1px solid var(--gray-200)' }}>\r\n                      <div style={{ fontSize: '11px', textTransform: 'uppercase', color: 'var(--gray-400)', fontWeight: '600', letterSpacing: '0.5px' }}>Database Type</div>\r\n                      <div style={{ fontSize: '15px', fontWeight: '600', color: 'var(--gray-800)', marginTop: '6px' }}>SQLite (Local)</div>\r\n                    </div>\r\n                    <div style={{ padding: '18px 20px', background: 'var(--gray-50)', borderRadius: '12px', border: '1px solid var(--gray-200)' }}>\r\n                      <div style={{ fontSize: '11px', textTransform: 'uppercase', color: 'var(--gray-400)', fontWeight: '600', letterSpacing: '0.5px' }}>Mode</div>\r\n                      <div style={{ fontSize: '15px', fontWeight: '600', color: 'var(--success-600)', marginTop: '6px' }}>Fully Offline</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {/*  TAB: About  */}\r\n            {activeTab === 'about' && (\r\n              <div style={{ display: 'grid', gap: '28px' }}>\r\n                <div style={{ padding: '32px', background: 'linear-gradient(135deg, var(--success-50) 0%, #f0fdf4 100%)', borderRadius: '12px', border: '1px solid var(--success-200)', textAlign: 'center' }}>\r\n                  <div style={{\r\n                    width: '60px', height: '60px', borderRadius: '50%', background: 'var(--success-100)',\r\n                    display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 16px'\r\n                  }}>\r\n                    <Cloud size={28} style={{ color: 'var(--success-600)' }} />\r\n                  </div>\r\n                  <h3 style={{ fontSize: '20px', fontWeight: '700', color: 'var(--success-700)', margin: '0 0 8px' }}>\r\n                    Fully Offline POS System\r\n                  </h3>\r\n                  <p style={{ fontSize: '14px', color: 'var(--success-600)', margin: 0, lineHeight: '1.6' }}>\r\n                    ZapBill works completely offline. All data is stored locally on your device.\r\n                    <br />No internet connection required for any functionality.\r\n                  </p>\r\n                </div>\r\n\r\n                <div>\r\n                  <h4 style={{ fontSize: '15px', fontWeight: '600', marginBottom: '16px', color: 'var(--gray-800)' }}>System Details</h4>\r\n                  <div style={{ border: '1px solid var(--gray-200)', borderRadius: '12px', overflow: 'hidden' }}>\r\n                    {[\r\n                      { label: 'Application', value: 'ZapBill POS' },\r\n                      { label: 'Platform', value: 'Electron (Desktop)' },\r\n                      { label: 'Database', value: 'SQLite' },\r\n                      { label: 'Data Storage', value: 'Local (Offline)' },\r\n                    ].map((item, idx) => (\r\n                      <div key={idx} style={{\r\n                        display: 'flex', justifyContent: 'space-between', alignItems: 'center',\r\n                        padding: '14px 20px', borderBottom: idx < 3 ? '1px solid var(--gray-100)' : 'none',\r\n                        background: idx % 2 === 0 ? 'white' : 'var(--gray-50)'\r\n                      }}>\r\n                        <span style={{ fontSize: '14px', color: 'var(--gray-600)' }}>{item.label}</span>\r\n                        <span style={{ fontSize: '14px', fontWeight: '600', color: 'var(--gray-800)' }}>{item.value}</span>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default SettingsPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\pages\\UsersPage.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'React' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":13},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadReport'. Either include it or remove the dependency array.","line":34,"column":6,"nodeType":"ArrayExpression","endLine":34,"endColumn":26,"suggestions":[{"desc":"Update the dependencies array to be: [user, selectedDate, loadReport]","fix":{"range":[757,777],"text":"[user, selectedDate, loadReport]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import React, { useState, useEffect } from 'react';\r\nimport { \r\n  Users, \r\n  Plus, \r\n  Edit2, \r\n  Trash2,\r\n  X,\r\n  Save,\r\n  Shield,\r\n  User,\r\n  Eye,\r\n  EyeOff,\r\n  BarChart3,\r\n  DollarSign,\r\n  ShoppingCart,\r\n  CreditCard,\r\n  Banknote,\r\n  Smartphone,\r\n  Calendar,\r\n  Clock,\r\n  ChevronLeft,\r\n  ChevronRight\r\n} from 'lucide-react';\r\nimport { format, subDays, addDays } from 'date-fns';\r\n\r\n// ==================== Biller Performance Modal ====================\r\nconst BillerPerformanceModal = ({ user, onClose }) => {\r\n  const [selectedDate, setSelectedDate] = useState(format(new Date(), 'yyyy-MM-dd'));\r\n  const [report, setReport] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    if (user) loadReport();\r\n  }, [user, selectedDate]);\r\n\r\n  const loadReport = async () => {\r\n    setIsLoading(true);\r\n    try {\r\n      const result = await window.electronAPI.invoke('reports:billerDaily', {\r\n        userId: user.id,\r\n        date: selectedDate,\r\n      });\r\n      setReport(result);\r\n    } catch (error) {\r\n      console.error('Failed to load biller report:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const navigateDate = (direction) => {\r\n    const current = new Date(selectedDate + 'T00:00:00');\r\n    const newDate = direction === 'prev' ? subDays(current, 1) : addDays(current, 1);\r\n    // Don't allow future dates\r\n    if (newDate <= new Date()) {\r\n      setSelectedDate(format(newDate, 'yyyy-MM-dd'));\r\n    }\r\n  };\r\n\r\n  if (!user) return null;\r\n\r\n  const sales = report?.sales || {};\r\n  const orders = report?.orders || [];\r\n  const avgOrderValue = sales.total_orders > 0 ? (sales.total_revenue / sales.total_orders) : 0;\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" style={{ maxWidth: '700px', maxHeight: '90vh', overflow: 'hidden', display: 'flex', flexDirection: 'column' }} onClick={e => e.stopPropagation()}>\r\n        {/* Header */}\r\n        <div className=\"modal-header\" style={{ borderBottom: '1px solid var(--gray-200)' }}>\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>\r\n            <div style={{ width: '42px', height: '42px', borderRadius: '50%', background: 'var(--primary-100)', color: 'var(--primary-700)', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 'bold', fontSize: '18px' }}>\r\n              {user.full_name?.charAt(0).toUpperCase() || 'U'}\r\n            </div>\r\n            <div>\r\n              <h3 className=\"modal-title\" style={{ margin: 0 }}>{user.full_name}</h3>\r\n              <span style={{ fontSize: '12px', color: 'var(--gray-500)', textTransform: 'capitalize' }}>\r\n                {user.role}  @{user.username}\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <button className=\"btn btn-ghost btn-icon\" onClick={onClose}>\r\n            <X size={20} />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Date Selector */}\r\n        <div style={{ padding: '12px 24px', borderBottom: '1px solid var(--gray-100)', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '16px', background: 'var(--gray-50)' }}>\r\n          <button\r\n            className=\"btn btn-ghost btn-icon btn-sm\"\r\n            onClick={() => navigateDate('prev')}\r\n          >\r\n            <ChevronLeft size={18} />\r\n          </button>\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\r\n            <Calendar size={16} color=\"var(--gray-500)\" />\r\n            <input\r\n              type=\"date\"\r\n              value={selectedDate}\r\n              onChange={e => setSelectedDate(e.target.value)}\r\n              max={format(new Date(), 'yyyy-MM-dd')}\r\n              style={{\r\n                border: '1px solid var(--gray-300)',\r\n                borderRadius: 'var(--radius-md)',\r\n                padding: '6px 12px',\r\n                fontSize: '14px',\r\n                fontWeight: 500,\r\n                background: 'white',\r\n              }}\r\n            />\r\n          </div>\r\n          <button\r\n            className=\"btn btn-ghost btn-icon btn-sm\"\r\n            onClick={() => navigateDate('next')}\r\n            disabled={selectedDate >= format(new Date(), 'yyyy-MM-dd')}\r\n          >\r\n            <ChevronRight size={18} />\r\n          </button>\r\n        </div>\r\n\r\n        {/* Content */}\r\n        <div className=\"modal-body\" style={{ overflowY: 'auto', flex: 1 }}>\r\n          {isLoading ? (\r\n            <div style={{ textAlign: 'center', padding: '40px' }}>\r\n              <div className=\"loading-spinner\" />\r\n              <p className=\"text-muted\" style={{ marginTop: '12px' }}>Loading report...</p>\r\n            </div>\r\n          ) : (\r\n            <>\r\n              {/* Stats Cards */}\r\n              <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '12px', marginBottom: '20px' }}>\r\n                <div style={{ padding: '16px', background: 'linear-gradient(135deg, #e8f5e9, #c8e6c9)', borderRadius: '12px', textAlign: 'center' }}>\r\n                  <DollarSign size={22} style={{ color: '#2e7d32', marginBottom: '4px' }} />\r\n                  <div style={{ fontSize: '22px', fontWeight: 'bold', color: '#1b5e20' }}>\r\n                    {(sales.total_revenue || 0).toLocaleString()}\r\n                  </div>\r\n                  <div style={{ fontSize: '12px', color: '#388e3c' }}>Revenue</div>\r\n                </div>\r\n                <div style={{ padding: '16px', background: 'linear-gradient(135deg, #e3f2fd, #bbdefb)', borderRadius: '12px', textAlign: 'center' }}>\r\n                  <ShoppingCart size={22} style={{ color: '#1565c0', marginBottom: '4px' }} />\r\n                  <div style={{ fontSize: '22px', fontWeight: 'bold', color: '#0d47a1' }}>\r\n                    {sales.total_orders || 0}\r\n                  </div>\r\n                  <div style={{ fontSize: '12px', color: '#1976d2' }}>Orders</div>\r\n                </div>\r\n                <div style={{ padding: '16px', background: 'linear-gradient(135deg, #fff3e0, #ffe0b2)', borderRadius: '12px', textAlign: 'center' }}>\r\n                  <BarChart3 size={22} style={{ color: '#e65100', marginBottom: '4px' }} />\r\n                  <div style={{ fontSize: '22px', fontWeight: 'bold', color: '#bf360c' }}>\r\n                    {avgOrderValue.toFixed(0)}\r\n                  </div>\r\n                  <div style={{ fontSize: '12px', color: '#f57c00' }}>Avg Order</div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Payment Breakdown */}\r\n              <div style={{ marginBottom: '20px' }}>\r\n                <h4 style={{ fontSize: '14px', fontWeight: 600, marginBottom: '10px', color: 'var(--gray-700)' }}>\r\n                  Payment Breakdown\r\n                </h4>\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '10px' }}>\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px', padding: '10px', background: 'var(--gray-50)', borderRadius: '8px' }}>\r\n                    <Banknote size={16} color=\"#43a047\" />\r\n                    <div>\r\n                      <div style={{ fontSize: '15px', fontWeight: 600 }}>{(sales.cash_amount || 0).toLocaleString()}</div>\r\n                      <div style={{ fontSize: '11px', color: 'var(--gray-500)' }}>Cash</div>\r\n                    </div>\r\n                  </div>\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px', padding: '10px', background: 'var(--gray-50)', borderRadius: '8px' }}>\r\n                    <CreditCard size={16} color=\"#1e88e5\" />\r\n                    <div>\r\n                      <div style={{ fontSize: '15px', fontWeight: 600 }}>{(sales.card_amount || 0).toLocaleString()}</div>\r\n                      <div style={{ fontSize: '11px', color: 'var(--gray-500)' }}>Card</div>\r\n                    </div>\r\n                  </div>\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: '8px', padding: '10px', background: 'var(--gray-50)', borderRadius: '8px' }}>\r\n                    <Smartphone size={16} color=\"#7b1fa2\" />\r\n                    <div>\r\n                      <div style={{ fontSize: '15px', fontWeight: 600 }}>{(sales.upi_amount || 0).toLocaleString()}</div>\r\n                      <div style={{ fontSize: '11px', color: 'var(--gray-500)' }}>UPI</div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n\r\n              {/* Orders List */}\r\n              <div>\r\n                <h4 style={{ fontSize: '14px', fontWeight: 600, marginBottom: '10px', color: 'var(--gray-700)' }}>\r\n                  Orders ({orders.length})\r\n                </h4>\r\n                {orders.length > 0 ? (\r\n                  <div style={{ border: '1px solid var(--gray-200)', borderRadius: '8px', overflow: 'hidden' }}>\r\n                    <table style={{ width: '100%', borderCollapse: 'collapse', fontSize: '13px' }}>\r\n                      <thead style={{ background: 'var(--gray-50)' }}>\r\n                        <tr>\r\n                          <th style={{ padding: '8px 12px', textAlign: 'left', fontWeight: 600 }}>Order #</th>\r\n                          <th style={{ padding: '8px 12px', textAlign: 'left', fontWeight: 600 }}>Type</th>\r\n                          <th style={{ padding: '8px 12px', textAlign: 'left', fontWeight: 600 }}>Status</th>\r\n                          <th style={{ padding: '8px 12px', textAlign: 'right', fontWeight: 600 }}>Amount</th>\r\n                          <th style={{ padding: '8px 12px', textAlign: 'right', fontWeight: 600 }}>Time</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        {orders.map(order => (\r\n                          <tr key={order.id} style={{ borderTop: '1px solid var(--gray-100)' }}>\r\n                            <td style={{ padding: '8px 12px', fontWeight: 500 }}>#{order.order_number}</td>\r\n                            <td style={{ padding: '8px 12px', textTransform: 'capitalize' }}>\r\n                              {order.order_type?.replace('_', ' ')}\r\n                            </td>\r\n                            <td style={{ padding: '8px 12px' }}>\r\n                              <span className={`badge ${order.status === 'completed' ? 'badge-success' : order.status === 'cancelled' ? 'badge-danger' : 'badge-warning'}`} style={{ fontSize: '11px' }}>\r\n                                {order.status}\r\n                              </span>\r\n                            </td>\r\n                            <td style={{ padding: '8px 12px', textAlign: 'right', fontWeight: 500 }}>\r\n                              {order.total_amount?.toFixed(0) || 0}\r\n                            </td>\r\n                            <td style={{ padding: '8px 12px', textAlign: 'right', color: 'var(--gray-500)' }}>\r\n                              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'flex-end', gap: '4px' }}>\r\n                                <Clock size={12} />\r\n                                {new Date(order.created_at).toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' })}\r\n                              </div>\r\n                            </td>\r\n                          </tr>\r\n                        ))}\r\n                      </tbody>\r\n                    </table>\r\n                  </div>\r\n                ) : (\r\n                  <div style={{ textAlign: 'center', padding: '30px', color: 'var(--gray-400)' }}>\r\n                    <ShoppingCart size={32} style={{ marginBottom: '8px', opacity: 0.5 }} />\r\n                    <p>No orders on this date</p>\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\n// ==================== Main UsersPage ====================\r\nconst UsersPage = () => {\r\n  const [users, setUsers] = useState([]);\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [editingUser, setEditingUser] = useState(null);\r\n  const [performanceUser, setPerformanceUser] = useState(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    loadUsers();\r\n  }, []);\r\n\r\n  const loadUsers = async () => {\r\n    try {\r\n      const result = await window.electronAPI.invoke('users:getAll');\r\n      setUsers(result);\r\n    } catch (error) {\r\n      console.error('Failed to load users:', error);\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleEdit = (user) => {\r\n    setEditingUser(user);\r\n    setShowModal(true);\r\n  };\r\n\r\n  const handleDelete = async (id) => {\r\n    if (window.confirm('Are you sure you want to delete this user?')) {\r\n      try {\r\n        await window.electronAPI.invoke('users:delete', { id });\r\n        loadUsers();\r\n      } catch (error) {\r\n        console.error('Delete failed:', error);\r\n        alert('Failed to delete user');\r\n      }\r\n    }\r\n  };\r\n\r\n  const getRoleBadge = (role) => {\r\n    const styles = {\r\n      admin: 'badge-primary',\r\n      cashier: 'badge-success',\r\n      kitchen: 'badge-warning',\r\n    };\r\n    return styles[role] || 'badge-gray';\r\n  };\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div className=\"empty-state\">\r\n        <div className=\"loading-spinner\" />\r\n        <p className=\"mt-4\">Loading users...</p>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"page-container\">\r\n      {/* Header */}\r\n      <div style={{ \r\n        display: 'flex', \r\n        justifyContent: 'space-between', \r\n        alignItems: 'center',\r\n        marginBottom: 'var(--spacing-6)',\r\n        paddingTop: '80px' \r\n      }}>\r\n        <div>\r\n          <h1>Staff Management</h1>\r\n          <p className=\"text-muted\">Manage your restaurant staff accounts</p>\r\n        </div>\r\n        <button \r\n          className=\"btn btn-primary\"\r\n          onClick={() => {\r\n            setEditingUser(null);\r\n            setShowModal(true);\r\n          }}\r\n        >\r\n          <Plus size={18} />\r\n          Add Staff\r\n        </button>\r\n      </div>\r\n\r\n      {/* Stats */}\r\n      <div className=\"stats-grid\" style={{ marginBottom: 'var(--spacing-6)' }}>\r\n        <div className=\"stat-card\">\r\n          <div className=\"stat-icon primary\">\r\n            <Users size={24} />\r\n          </div>\r\n          <div>\r\n            <div className=\"stat-value\">{users.length}</div>\r\n            <div className=\"stat-label\">Total Staff</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"stat-card\">\r\n          <div className=\"stat-icon success\">\r\n            <Shield size={24} />\r\n          </div>\r\n          <div>\r\n            <div className=\"stat-value\">{users.filter(u => u.role === 'admin').length}</div>\r\n            <div className=\"stat-label\">Administrators</div>\r\n          </div>\r\n        </div>\r\n        <div className=\"stat-card\">\r\n          <div className=\"stat-icon warning\">\r\n            <User size={24} />\r\n          </div>\r\n          <div>\r\n            <div className=\"stat-value\">{users.filter(u => u.is_active).length}</div>\r\n            <div className=\"stat-label\">Active Users</div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Users Table */}\r\n      <div className=\"table-container\">\r\n        <table className=\"table\">\r\n          <thead>\r\n            <tr>\r\n              <th>Name</th>\r\n              <th>Username</th>\r\n              <th>Role</th>\r\n              <th>Status</th>\r\n              <th>Created</th>\r\n              <th style={{ width: '140px' }}>Actions</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {users.map(user => (\r\n              <tr key={user.id}>\r\n                <td style={{ fontWeight: 500 }}>{user.full_name}</td>\r\n                <td>{user.username}</td>\r\n                <td>\r\n                  <span className={`badge ${getRoleBadge(user.role)}`}>\r\n                    {user.role.toUpperCase()}\r\n                  </span>\r\n                </td>\r\n                <td>\r\n                  <span className={`badge ${user.is_active ? 'badge-success' : 'badge-gray'}`}>\r\n                    {user.is_active ? 'Active' : 'Inactive'}\r\n                  </span>\r\n                </td>\r\n                <td>{new Date(user.created_at).toLocaleDateString()}</td>\r\n                <td>\r\n                  <div style={{ display: 'flex', gap: 'var(--spacing-1)' }}>\r\n                    <button \r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => setPerformanceUser(user)}\r\n                      title=\"View Performance\"\r\n                      style={{ color: 'var(--primary-600)' }}\r\n                    >\r\n                      <BarChart3 size={16} />\r\n                    </button>\r\n                    <button \r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => handleEdit(user)}\r\n                    >\r\n                      <Edit2 size={16} />\r\n                    </button>\r\n                    <button \r\n                      className=\"btn btn-ghost btn-icon btn-sm\"\r\n                      onClick={() => handleDelete(user.id)}\r\n                      style={{ color: 'var(--error-500)' }}\r\n                      disabled={user.username === 'admin'}\r\n                    >\r\n                      <Trash2 size={16} />\r\n                    </button>\r\n                  </div>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n\r\n        {users.length === 0 && (\r\n          <div className=\"empty-state\">\r\n            <Users size={48} />\r\n            <p className=\"empty-state-title\">No users found</p>\r\n            <p className=\"text-muted\">Add your first staff member</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* User Modal */}\r\n      {showModal && (\r\n        <UserModal\r\n          user={editingUser}\r\n          onClose={() => {\r\n            setShowModal(false);\r\n            setEditingUser(null);\r\n          }}\r\n          onSave={() => {\r\n            setShowModal(false);\r\n            setEditingUser(null);\r\n            loadUsers();\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {/* Biller Performance Modal */}\r\n      {performanceUser && (\r\n        <BillerPerformanceModal\r\n          user={performanceUser}\r\n          onClose={() => setPerformanceUser(null)}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\n// ==================== User Modal Component ====================\r\nconst UserModal = ({ user, onClose, onSave }) => {\r\n  const [formData, setFormData] = useState({\r\n    username: user?.username || '',\r\n    password: '',\r\n    fullName: user?.full_name || '',\r\n    role: user?.role || 'cashier',\r\n    pinCode: '',\r\n    isActive: user?.is_active ?? true,\r\n  });\r\n  const [showPassword, setShowPassword] = useState(false);\r\n  const [isSaving, setIsSaving] = useState(false);\r\n  const [error, setError] = useState('');\r\n\r\n  const handleSubmit = async (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    \r\n    if (!user && !formData.password) {\r\n      setError('Password is required for new users');\r\n      return;\r\n    }\r\n    \r\n    setIsSaving(true);\r\n\r\n    try {\r\n      const saveData = { ...formData };\r\n      if (user?.id) {\r\n        saveData.id = user.id;\r\n      }\r\n      \r\n      const result = await window.electronAPI.invoke('users:save', { user: saveData });\r\n      \r\n      if (result.success) {\r\n        onSave();\r\n      } else {\r\n        setError(result.error || 'Failed to save user');\r\n      }\r\n    } catch (error) {\r\n      console.error('Save failed:', error);\r\n      setError('Failed to save user');\r\n    } finally {\r\n      setIsSaving(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"modal-overlay\" onClick={onClose}>\r\n      <div className=\"modal\" style={{ maxWidth: '500px', width: '90%', height: 'auto', maxHeight: '90vh' }} onClick={(e) => e.stopPropagation()}>\r\n        <div className=\"modal-header\" style={{ padding: '12px 16px', borderBottom: '1px solid var(--gray-100)' }}>\r\n          <h3 className=\"modal-title\" style={{ fontSize: '16px', margin: 0 }}>{user ? 'Edit Staff' : 'Add Staff'}</h3>\r\n          <button className=\"btn btn-ghost btn-icon btn-sm\" onClick={onClose} style={{ width: '24px', height: '24px' }}>\r\n            <X size={16} />\r\n          </button>\r\n        </div>\r\n\r\n        <form onSubmit={handleSubmit}>\r\n          <div className=\"modal-body\" style={{ padding: '16px' }}>\r\n            {error && (\r\n              <div style={{\r\n                padding: '6px 10px',\r\n                background: 'var(--error-50)',\r\n                color: 'var(--error-700)',\r\n                borderRadius: '4px',\r\n                marginBottom: '12px',\r\n                fontSize: '12px',\r\n              }}>\r\n                {error}\r\n              </div>\r\n            )}\r\n\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '12px' }}>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\" style={{ fontSize: '12px', marginBottom: '2px' }}>Full Name *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"input\"\r\n                  value={formData.fullName}\r\n                  onChange={(e) => setFormData({ ...formData, fullName: e.target.value })}\r\n                  required\r\n                  autoFocus\r\n                  style={{ padding: '6px 10px', fontSize: '13px' }}\r\n                />\r\n              </div>\r\n\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\" style={{ fontSize: '12px', marginBottom: '2px' }}>Username *</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"input\"\r\n                  value={formData.username}\r\n                  onChange={(e) => setFormData({ ...formData, username: e.target.value })}\r\n                  required\r\n                  disabled={user?.username === 'admin'}\r\n                  style={{ padding: '6px 10px', fontSize: '13px' }}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', marginBottom: '12px' }}>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\" style={{ fontSize: '12px', marginBottom: '2px' }}>\r\n                  Password {user ? '(optional)' : '*'}\r\n                </label>\r\n                <div style={{ position: 'relative' }}>\r\n                  <input\r\n                    type={showPassword ? 'text' : 'password'}\r\n                    className=\"input\"\r\n                    value={formData.password}\r\n                    onChange={(e) => setFormData({ ...formData, password: e.target.value })}\r\n                    style={{ paddingRight: '30px', padding: '6px 10px', fontSize: '13px' }}\r\n                  />\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setShowPassword(!showPassword)}\r\n                    style={{\r\n                      position: 'absolute',\r\n                      right: '6px',\r\n                      top: '50%',\r\n                      transform: 'translateY(-50%)',\r\n                      background: 'none',\r\n                      border: 'none',\r\n                      cursor: 'pointer',\r\n                      color: 'var(--gray-400)',\r\n                      padding: '2px',\r\n                    }}\r\n                  >\r\n                    {showPassword ? <EyeOff size={14} /> : <Eye size={14} />}\r\n                  </button>\r\n                </div>\r\n              </div>\r\n\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\" style={{ fontSize: '12px', marginBottom: '2px' }}>Role *</label>\r\n                <select\r\n                  className=\"input select\"\r\n                  value={formData.role}\r\n                  onChange={(e) => setFormData({ ...formData, role: e.target.value })}\r\n                  required\r\n                  disabled={user?.username === 'admin'}\r\n                  style={{ padding: '6px 10px', fontSize: '13px' }}\r\n                >\r\n                  <option value=\"admin\">Admin</option>\r\n                  <option value=\"cashier\">Cashier</option>\r\n                  <option value=\"kitchen\">Kitchen</option>\r\n                </select>\r\n              </div>\r\n            </div>\r\n\r\n            <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', alignItems: 'end' }}>\r\n              <div className=\"input-group\">\r\n                <label className=\"input-label\" style={{ fontSize: '12px', marginBottom: '2px' }}>Quick PIN</label>\r\n                <input\r\n                  type=\"text\"\r\n                  className=\"input\"\r\n                  value={formData.pinCode}\r\n                  onChange={(e) => {\r\n                    const val = e.target.value.replace(/\\D/g, '').slice(0, 4);\r\n                    setFormData({ ...formData, pinCode: val });\r\n                  }}\r\n                  maxLength={4}\r\n                  placeholder=\"1234\"\r\n                  style={{ padding: '6px 10px', fontSize: '13px' }}\r\n                />\r\n              </div>\r\n\r\n              <label style={{ \r\n                display: 'flex', \r\n                alignItems: 'center', \r\n                gap: '6px', \r\n                cursor: 'pointer',\r\n                userSelect: 'none',\r\n                fontSize: '13px',\r\n                height: '32px',\r\n                marginBottom: '1px'\r\n              }}>\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={formData.isActive}\r\n                  onChange={(e) => setFormData({ ...formData, isActive: e.target.checked })}\r\n                  disabled={user?.username === 'admin'}\r\n                  style={{ width: '14px', height: '14px' }}\r\n                />\r\n                <span>Active Account</span>\r\n              </label>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"modal-footer\" style={{ padding: '12px 16px', background: 'var(--gray-50)', borderTop: '1px solid var(--gray-100)' }}>\r\n            <button type=\"button\" className=\"btn btn-secondary btn-sm\" onClick={onClose} style={{ marginRight: '8px', padding: '6px 12px', fontSize: '13px' }}>\r\n              Cancel\r\n            </button>\r\n            <button type=\"submit\" className=\"btn btn-primary btn-sm\" disabled={isSaving} style={{ padding: '6px 12px', fontSize: '13px' }}>\r\n              <Save size={14} />\r\n              {isSaving ? 'Saving...' : 'Save Member'}\r\n            </button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default UsersPage;\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\stores\\authStore.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\stores\\cartStore.js","messages":[{"ruleId":"no-dupe-keys","severity":2,"message":"Duplicate key 'setIsComplimentary'.","line":167,"column":7,"nodeType":"ObjectExpression","messageId":"unexpected","endLine":167,"endColumn":25}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { create } from 'zustand';\r\nimport { persist } from 'zustand/middleware';\r\n\r\nexport const useCartStore = create(\r\n  persist(\r\n    (set, get) => ({\r\n      items: [],\r\n      orderType: 'dine_in',\r\n      tableNumber: '',\r\n      customerName: '',\r\n      customerPhone: '',\r\n      notes: '',\r\n      urgency: 'normal', // 'normal', 'urgent', 'critical'\r\n      chefInstructions: '',\r\n      // Enhanced billing fields\r\n      discountType: 'none', // 'none', 'percentage', 'flat', 'coupon'\r\n      discountValue: 0,\r\n      discountReason: '',\r\n      couponCode: '',\r\n      serviceChargePercent: 0, // e.g., 5 for 5%\r\n      serviceChargeEnabled: false,\r\n      paymentMethod: 'cash', // 'cash', 'card', 'upi', 'split', 'due'\r\n      paymentDetails: {}, // For split payments or additional info\r\n      isPaid: false,\r\n      isComplimentary: false,\r\n      isSalesReturn: false,\r\n      \r\n      // Local Held Orders\r\n      heldOrders: [],\r\n\r\n      // Bill Sheet Edits\r\n      deliveryCharge: 0,\r\n      containerCharge: 0,\r\n      customerPaid: 0,\r\n\r\n      // Add item to cart\r\n      addItem: (menuItem, quantity = 1, specialInstructions = '', variant = null, addons = []) => {\r\n        const { items } = get();\r\n        \r\n        // Create a unique key for comparison (include variant and addons)\r\n        const getCompositeId = (v, a) => {\r\n          const vId = v ? v.name : '';\r\n          const aId = a ? a.map(add => add.name).sort().join(',') : '';\r\n          return `${vId}|${aId}`;\r\n        };\r\n\r\n        const newItemCompositeId = getCompositeId(variant, addons);\r\n\r\n        const existingIndex = items.findIndex(\r\n          item => item.menuItemId === menuItem.id && \r\n                  item.specialInstructions === specialInstructions &&\r\n                  getCompositeId(item.variant, item.addons) === newItemCompositeId\r\n        );\r\n\r\n        if (existingIndex >= 0) {\r\n          // Update quantity of existing item\r\n          const newItems = [...items];\r\n          newItems[existingIndex].quantity += quantity;\r\n          set({ items: newItems });\r\n        } else {\r\n          // Calculate unit price based on variant and addons\r\n          let finalPrice = menuItem.price;\r\n          if (variant) finalPrice = parseFloat(variant.price);\r\n\r\n          // Apply item-level discount if present\r\n          let appliedDiscount = 0;\r\n          if (menuItem.appliedDiscount) {\r\n             if (menuItem.appliedDiscount.discount_type === 'percentage') {\r\n               appliedDiscount = finalPrice * (menuItem.appliedDiscount.discount_value / 100);\r\n             } else if (menuItem.appliedDiscount.discount_type === 'flat') {\r\n               appliedDiscount = menuItem.appliedDiscount.discount_value;\r\n             }\r\n             finalPrice -= appliedDiscount;\r\n             // Ensure price doesn't go negative\r\n             if (finalPrice < 0) finalPrice = 0;\r\n          }\r\n\r\n          const addonsTotal = addons.reduce((sum, addon) => sum + parseFloat(addon.price), 0);\r\n          finalPrice += addonsTotal;\r\n\r\n          // Add new item\r\n          set({\r\n            items: [...items, {\r\n              id: Date.now().toString(),\r\n              menuItemId: menuItem.id,\r\n              name: menuItem.name,\r\n              categoryId: menuItem.category_id,\r\n              unitPrice: finalPrice,\r\n              quantity,\r\n              taxRate: menuItem.tax_rate || 0,\r\n              isVegetarian: menuItem.is_vegetarian,\r\n              specialInstructions,\r\n              variant,\r\n              addons\r\n            }]\r\n          });\r\n        }\r\n      },\r\n\r\n      // Remove item from cart\r\n      removeItem: (itemId) => {\r\n        const { items } = get();\r\n        set({ items: items.filter(item => item.id !== itemId) });\r\n      },\r\n\r\n      // Update item quantity\r\n      updateQuantity: (itemId, quantity) => {\r\n        const { items } = get();\r\n        if (quantity <= 0) {\r\n          set({ items: items.filter(item => item.id !== itemId) });\r\n        } else {\r\n          set({\r\n            items: items.map(item =>\r\n              item.id === itemId ? { ...item, quantity } : item\r\n            )\r\n          });\r\n        }\r\n      },\r\n\r\n      // Update special instructions\r\n      updateInstructions: (itemId, instructions) => {\r\n        const { items } = get();\r\n        set({\r\n          items: items.map(item =>\r\n            item.id === itemId ? { ...item, specialInstructions: instructions } : item\r\n          )\r\n        });\r\n      },\r\n\r\n      // Set order details\r\n      setOrderType: (type) => set({ orderType: type }),\r\n      setTableNumber: (number) => set({ tableNumber: number }),\r\n      setCustomerName: (name) => set({ customerName: name }),\r\n      setCustomerPhone: (phone) => set({ customerPhone: phone }),\r\n      setNotes: (notes) => set({ notes }),\r\n      setUrgency: (urgency) => set({ urgency }),\r\n      setChefInstructions: (instructions) => set({ chefInstructions: instructions }),\r\n      \r\n      // Enhanced discount setters\r\n      setDiscountType: (type) => set({ discountType: type }),\r\n      setDiscountValue: (value) => set({ discountValue: value }),\r\n      setDiscountReason: (reason) => set({ discountReason: reason }),\r\n      setCouponCode: (code) => set({ couponCode: code }),\r\n      applyDiscount: (type, value, reason = '') => set({\r\n        discountType: type,\r\n        discountValue: value,\r\n        discountReason: reason\r\n      }),\r\n      clearDiscount: () => set({\r\n        discountType: 'none',\r\n        discountValue: 0,\r\n        discountReason: '',\r\n        couponCode: ''\r\n      }),\r\n      \r\n      // Service charge\r\n      setServiceCharge: (percent, enabled = true) => set({\r\n        serviceChargePercent: percent,\r\n        serviceChargeEnabled: enabled\r\n      }),\r\n      \r\n      // Payment method\r\n      setPaymentMethod: (method) => set({ paymentMethod: method }),\r\n      setPaymentDetails: (details) => set({ paymentDetails: details }),\r\n      setIsPaid: (paid) => set({ isPaid: paid }),\r\n      setIsComplimentary: (comp) => set({ isComplimentary: comp }),\r\n      setIsComplimentary: (comp) => set({ isComplimentary: comp }),\r\n      setIsSalesReturn: (ret) => set({ isSalesReturn: ret }),\r\n      \r\n      setDeliveryCharge: (amount) => set({ deliveryCharge: amount }),\r\n      setContainerCharge: (amount) => set({ containerCharge: amount }),\r\n      setCustomerPaid: (amount) => set({ customerPaid: amount }),\r\n\r\n      // Calculate subtotal\r\n      getSubtotal: () => {\r\n        const { items } = get();\r\n        return items.reduce((sum, item) => sum + (item.unitPrice * item.quantity), 0);\r\n      },\r\n\r\n      // Calculate discount amount based on type\r\n      getDiscountAmount: () => {\r\n        const { discountType, discountValue, isComplimentary } = get();\r\n        const subtotal = get().getSubtotal();\r\n        \r\n        if (isComplimentary) return subtotal; // 100% discount\r\n        \r\n        switch (discountType) {\r\n          case 'percentage':\r\n            return (subtotal * discountValue) / 100;\r\n          case 'flat':\r\n            return Math.min(discountValue, subtotal); // Can't discount more than subtotal\r\n          case 'coupon':\r\n            return discountValue; // Coupon provides fixed discount\r\n          default:\r\n            return 0;\r\n        }\r\n      },\r\n\r\n      // Calculate taxable amount (after discount)\r\n      getTaxableAmount: () => {\r\n        const subtotal = get().getSubtotal();\r\n        const discount = get().getDiscountAmount();\r\n        return Math.max(0, subtotal - discount);\r\n      },\r\n\r\n      // Calculate tax with breakdown (CGST + SGST)\r\n      getTaxBreakdown: () => {\r\n        const { items } = get();\r\n        const taxableAmount = get().getTaxableAmount();\r\n        const subtotal = get().getSubtotal();\r\n        \r\n        if (subtotal === 0) return { cgst: 0, sgst: 0, total: 0 };\r\n        \r\n        // Calculate weighted average tax rate\r\n        const totalTax = items.reduce((sum, item) => {\r\n          const itemTotal = item.unitPrice * item.quantity;\r\n          const itemTax = itemTotal * (item.taxRate / 100);\r\n          return sum + itemTax;\r\n        }, 0);\r\n        \r\n        // Scale tax proportionally to taxable amount\r\n        const scaledTax = (totalTax / subtotal) * taxableAmount;\r\n        const cgst = scaledTax / 2;\r\n        const sgst = scaledTax / 2;\r\n        \r\n        return {\r\n          cgst: cgst,\r\n          sgst: sgst,\r\n          total: cgst + sgst\r\n        };\r\n      },\r\n\r\n      // Calculate total tax amount\r\n      getTaxAmount: () => {\r\n        return get().getTaxBreakdown().total;\r\n      },\r\n\r\n      // Calculate service charge\r\n      getServiceCharge: () => {\r\n        const { serviceChargeEnabled, serviceChargePercent } = get();\r\n        if (!serviceChargeEnabled) return 0;\r\n        const taxableAmount = get().getTaxableAmount();\r\n        return (taxableAmount * serviceChargePercent) / 100;\r\n      },\r\n\r\n      // Calculate grand total\r\n      getGrandTotal: () => {\r\n        const { isSalesReturn, deliveryCharge, containerCharge } = get();\r\n        const taxableAmount = get().getTaxableAmount();\r\n        const tax = get().getTaxBreakdown().total;\r\n        const serviceCharge = get().getServiceCharge();\r\n        const total = taxableAmount + tax + serviceCharge + (deliveryCharge || 0) + (containerCharge || 0);\r\n        return isSalesReturn ? -total : total;\r\n      },\r\n\r\n      // Legacy method for compatibility\r\n      getTax: () => get().getTaxBreakdown().total,\r\n      getTotal: () => get().getGrandTotal(),\r\n\r\n      // Get item count\r\n      getItemCount: () => {\r\n        const { items } = get();\r\n        return items.reduce((sum, item) => sum + item.quantity, 0);\r\n      },\r\n\r\n      // Clear cart\r\n      clearCart: () => set({\r\n        items: [],\r\n        orderType: 'dine_in',\r\n        tableNumber: '',\r\n        customerName: '',\r\n        customerPhone: '',\r\n        notes: '',\r\n        urgency: 'normal',\r\n        chefInstructions: '',\r\n        discountType: 'none',\r\n        discountValue: 0,\r\n        discountReason: '',\r\n        couponCode: '',\r\n        serviceChargePercent: 0,\r\n        serviceChargeEnabled: false,\r\n        paymentMethod: 'cash',\r\n        paymentDetails: {},\r\n        isPaid: false,\r\n        isComplimentary: false,\r\n        isSalesReturn: false,\r\n        deliveryCharge: 0,\r\n        containerCharge: 0,\r\n        customerPaid: 0,\r\n      }),\r\n\r\n      // Create order from cart\r\n      createOrder: async (cashierId, status = 'active', isHold = 0) => {\r\n        const state = get();\r\n        \r\n        if (state.items.length === 0) {\r\n          return { success: false, error: 'Cart is empty' };\r\n        }\r\n\r\n        // Build order object with snake_case for database\r\n        const order = {\r\n          order_type: state.orderType,\r\n          table_number: state.tableNumber || null,\r\n          customer_name: state.customerName || null,\r\n          customer_phone: state.customerPhone || null,\r\n          notes: state.notes || null,\r\n          urgency: state.urgency || 'normal',\r\n          chef_instructions: state.chefInstructions || null,\r\n          subtotal: state.getSubtotal(),\r\n          tax_amount: state.getTax(),\r\n          discount_amount: state.getDiscountAmount(),\r\n          discount_type: state.discountType,\r\n          discount_reason: state.discountReason || null,\r\n          service_charge: state.getServiceCharge(),\r\n          total_amount: state.getGrandTotal(),\r\n          payment_method: state.paymentMethod === 'split' ? 'mixed' : state.paymentMethod,\r\n          is_complimentary: state.isComplimentary ? 1 : 0,\r\n          is_sales_return: state.isSalesReturn ? 1 : 0,\r\n          delivery_charge: state.deliveryCharge || 0,\r\n          container_charge: state.containerCharge || 0,\r\n          customer_paid: state.customerPaid || 0,\r\n          payment_details: state.paymentDetails,\r\n          status: status,\r\n          is_hold: isHold\r\n        };\r\n\r\n        // Build items array with correct field names\r\n        const items = state.items.map(item => ({\r\n          menu_item_id: item.menuItemId,\r\n          name: item.name,\r\n          quantity: item.quantity,\r\n          unit_price: item.unitPrice,\r\n          tax_rate: item.taxRate || 0,\r\n          special_instructions: item.specialInstructions || null,\r\n          variant: item.variant ? JSON.stringify(item.variant) : null,\r\n          addons: item.addons && item.addons.length > 0 ? JSON.stringify(item.addons) : null,\r\n        }));\r\n\r\n        try {\r\n          const result = await window.electronAPI.invoke('order:create', { order, items });\r\n          \r\n          if (result && result.id) {\r\n            get().clearCart();\r\n            return { success: true, id: result.id, orderNumber: result.orderNumber };\r\n          }\r\n          \r\n          return result || { success: false, error: 'Order creation failed' };\r\n        } catch (error) {\r\n          return { success: false, error: error.message };\r\n        }\r\n      },\r\n\r\n      // Hold current order locally\r\n      holdOrder: () => {\r\n        const state = get();\r\n        if (state.items.length === 0) return { success: false, error: 'Cart is empty' };\r\n\r\n        const newHeldOrder = {\r\n          id: Date.now().toString(), // Unique ID for held order\r\n          timestamp: Date.now(),\r\n          orderNumber: `HOLD-${state.heldOrders.length + 1}`, // Temporary number\r\n          items: state.items,\r\n          orderType: state.orderType,\r\n          tableNumber: state.tableNumber,\r\n          customerName: state.customerName,\r\n          customerPhone: state.customerPhone,\r\n          notes: state.notes,\r\n          urgency: state.urgency,\r\n          chefInstructions: state.chefInstructions,\r\n          discountType: state.discountType,\r\n          discountValue: state.discountValue,\r\n          discountReason: state.discountReason,\r\n          serviceChargeEnabled: state.serviceChargeEnabled,\r\n          serviceChargePercent: state.serviceChargePercent,\r\n          paymentMethod: state.paymentMethod,\r\n          isComplimentary: state.isComplimentary,\r\n          isSalesReturn: state.isSalesReturn,\r\n          deliveryCharge: state.deliveryCharge,\r\n          containerCharge: state.containerCharge,\r\n          customerPaid: state.customerPaid,\r\n          totalAmount: state.getGrandTotal()\r\n        };\r\n\r\n        set({\r\n          heldOrders: [...state.heldOrders, newHeldOrder]\r\n        });\r\n        \r\n        get().clearCart();\r\n        return { success: true };\r\n      },\r\n\r\n      // Remove a held order\r\n      removeHeldOrder: (heldOrderId) => {\r\n        const { heldOrders } = get();\r\n        set({ heldOrders: heldOrders.filter(order => order.id !== heldOrderId) });\r\n      },\r\n\r\n      // Resume a held order (populate cart from held order object)\r\n      resumeOrder: (heldOrder) => {\r\n        // Clear current cart first\r\n        get().clearCart();\r\n\r\n        set({\r\n          items: heldOrder.items,\r\n          orderType: heldOrder.orderType || 'dine_in',\r\n          tableNumber: heldOrder.tableNumber || '',\r\n          customerName: heldOrder.customerName || '',\r\n          customerPhone: heldOrder.customerPhone || '',\r\n          notes: heldOrder.notes || '',\r\n          urgency: heldOrder.urgency || 'normal',\r\n          chefInstructions: heldOrder.chefInstructions || '',\r\n          discountType: heldOrder.discountType || 'none',\r\n          discountValue: heldOrder.discountValue || 0,\r\n          discountReason: heldOrder.discountReason || '',\r\n          serviceChargeEnabled: heldOrder.serviceChargeEnabled,\r\n          serviceChargePercent: heldOrder.serviceChargePercent || 0,\r\n          paymentMethod: heldOrder.paymentMethod || 'cash',\r\n          isComplimentary: heldOrder.isComplimentary,\r\n          isSalesReturn: heldOrder.isSalesReturn,\r\n          deliveryCharge: heldOrder.deliveryCharge || 0,\r\n          containerCharge: heldOrder.containerCharge || 0,\r\n          customerPaid: heldOrder.customerPaid || 0,\r\n        });\r\n\r\n        // Remove from held orders list\r\n        get().removeHeldOrder(heldOrder.id);\r\n      },\r\n    }),\r\n    {\r\n      name: 'cart-storage',\r\n      partialize: (state) => ({\r\n        items: state.items,\r\n        orderType: state.orderType,\r\n        tableNumber: state.tableNumber,\r\n        customerName: state.customerName,\r\n        customerPhone: state.customerPhone,\r\n        notes: state.notes,\r\n        urgency: state.urgency,\r\n        chefInstructions: state.chefInstructions,\r\n        discountType: state.discountType,\r\n        discountValue: state.discountValue,\r\n        discountReason: state.discountReason,\r\n        couponCode: state.couponCode,\r\n        serviceChargePercent: state.serviceChargePercent,\r\n        serviceChargeEnabled: state.serviceChargeEnabled,\r\n        paymentMethod: state.paymentMethod,\r\n        isComplimentary: state.isComplimentary,\r\n        isSalesReturn: state.isSalesReturn,\r\n        heldOrders: state.heldOrders, // Persist held orders\r\n        deliveryCharge: state.deliveryCharge,\r\n        containerCharge: state.containerCharge,\r\n        customerPaid: state.customerPaid,\r\n      }),\r\n    }\r\n  )\r\n);\r\n","usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]},{"filePath":"C:\\Users\\lenovo\\OneDrive\\Desktop\\Projects\\ZapBill_offline-software\\src\\stores\\syncStore.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[{"ruleId":"no-extra-semi","replacedBy":[]},{"ruleId":"no-mixed-spaces-and-tabs","replacedBy":[]}]}]